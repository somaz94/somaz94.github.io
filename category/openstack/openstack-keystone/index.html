<!DOCTYPE html>
<html lang="en" class="no-js">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    

    
    

    
    

    
    

    <!-- ✅ Google Tag Manager 추가 -->
    <script>
        (function(w,d,s,l,i){
            w[l]=w[l]||[];
            w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
            var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
            j.async=true;
            j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
            f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-MBP83N4Q');
    </script>
      <!-- ✅ End Google Tag Manager -->

    <!-- Mermaid.js 직접 로드 -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>

    <title>Deep Dive into OpenStack Keystone | somaz</title>
    <meta name="description" content="A comprehensive guide to OpenStack Keystone, its architecture, and how it manages authentication and authorization in the cloud">
    
        <meta name="keywords" content="openstack, keystone, identity, authentication, authorization, cloud">
    

    <!-- Social: Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Deep Dive into OpenStack Keystone | somaz">
    <meta name="twitter:description" content="A comprehensive guide to OpenStack Keystone, its architecture, and how it manages authentication and authorization in the cloud">

    
        <meta property="twitter:image" content="https://res.cloudinary.com/dkcm26aem/image/upload/v1756113434/openstack-keystone-1_s3qt85.png">
    
    
    
        <meta name="twitter:site" content="@twitter_username">
    

    <!-- Social: Facebook / Open Graph -->
    <meta property="og:url" content="https://somaz.blog/category/openstack/openstack-keystone/">
    <meta property="og:title" content="Deep Dive into OpenStack Keystone | somaz">
    <meta property="og:image" content="https://res.cloudinary.com/dkcm26aem/image/upload/v1756113434/openstack-keystone-1_s3qt85.png">
    <meta property="og:description" content="A comprehensive guide to OpenStack Keystone, its architecture, and how it manages authentication and authorization in the cloud">
    <meta property="og:site_name" content="Somaz Tech Blog">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/assets/img/icons/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/img/icons/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/img/icons/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/img/icons/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/img/icons/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/img/icons/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/img/icons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/icons/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/img/icons/apple-touch-icon-152x152.png" />

    <!-- Windows 8 Tile Icons -->
    <meta name="application-name" content="somaz">
    <meta name="msapplication-TileColor" content="#141414">
    <meta name="msapplication-square70x70logo" content="smalltile.png" />
    <meta name="msapplication-square150x150logo" content="mediumtile.png" />
    <meta name="msapplication-wide310x150logo" content="widetile.png" />
    <meta name="msapplication-square310x310logo" content="largetile.png" />
    
    <!-- Android Lolipop Theme Color -->
    <meta name="theme-color" content="#141414">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Titillium+Web:300,400,700" rel="stylesheet">

    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="canonical" href="https://somaz.blog/category/openstack/openstack-keystone/">
    <link rel="alternate" type="application/rss+xml" title="Somaz Tech Blog" href="https://somaz.blog/feed.xml" />

    <!-- Include extra styles -->
    

    <!-- JavaScript enabled/disabled -->
    <script>
        document.querySelector('html').classList.remove('no-js');
    </script>

    <!-- Google Adsense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8725590811736154"
        crossorigin="anonymous"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"> -->
    <!-- <link href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/variable/woff2/SUIT-Variable.css" rel="stylesheet"> -->
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- <link href="https://fonts.googleapis.com/css2?family=Albert+Sans:wght@400;500;700&display=swap" rel="stylesheet"> -->

    <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml" />

</head>
<!-- ✅ Google Tag Manager (noscript) -->
<noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MBP83N4Q"
            height="0" width="0" style="display:none;visibility:hidden">
    </iframe>
</noscript>
<!-- ✅ End Google Tag Manager (noscript) -->
    <body class="has-push-menu">
        





        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" display="none" version="1.1"><defs><symbol id="icon-menu" viewBox="0 0 1024 1024"><path class="path1" d="M128 213.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 725.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 469.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5z"/></symbol><symbol id="icon-search" viewBox="0 0 951 1024"><path class="path1" d="M658.286 475.429q0-105.714-75.143-180.857t-180.857-75.143-180.857 75.143-75.143 180.857 75.143 180.857 180.857 75.143 180.857-75.143 75.143-180.857zM950.857 950.857q0 29.714-21.714 51.429t-51.429 21.714q-30.857 0-51.429-21.714l-196-195.429q-102.286 70.857-228 70.857-81.714 0-156.286-31.714t-128.571-85.714-85.714-128.571-31.714-156.286 31.714-156.286 85.714-128.571 128.571-85.714 156.286-31.714 156.286 31.714 128.571 85.714 85.714 128.571 31.714 156.286q0 125.714-70.857 228l196 196q21.143 21.143 21.143 51.429z"/></symbol><symbol id="icon-close" viewBox="0 0 1000 1000"><path d="M969.8,870.3c27,27.7,27,71.8,0,99.1C955.7,983,937.9,990,920,990c-17.9,0-35.7-7-49.7-20.7L500,599L129.6,969.4C115.6,983,97.8,990,79.9,990s-35.7-7-49.7-20.7c-27-27.3-27-71.4,0-99.1L400.9,500L30.3,129.3c-27-27.3-27-71.4,0-99.1c27.3-27,71.8-27,99.4,0L500,400.9L870.4,30.2c27.7-27,71.8-27,99.4,0c27,27.7,27,71.8,0,99.1L599.1,500L969.8,870.3z"/></symbol><symbol id="icon-twitter" viewBox="0 0 951 1024"><path class="path1" d="M925.714 233.143q-38.286 56-92.571 95.429 0.571 8 0.571 24 0 74.286-21.714 148.286t-66 142-105.429 120.286-147.429 83.429-184.571 31.143q-154.857 0-283.429-82.857 20 2.286 44.571 2.286 128.571 0 229.143-78.857-60-1.143-107.429-36.857t-65.143-91.143q18.857 2.857 34.857 2.857 24.571 0 48.571-6.286-64-13.143-106-63.714t-42-117.429v-2.286q38.857 21.714 83.429 23.429-37.714-25.143-60-65.714t-22.286-88q0-50.286 25.143-93.143 69.143 85.143 168.286 136.286t212.286 56.857q-4.571-21.714-4.571-42.286 0-76.571 54-130.571t130.571-54q80 0 134.857 58.286 62.286-12 117.143-44.571-21.143 65.714-81.143 101.714 53.143-5.714 106.286-28.571z"/></symbol><symbol id="icon-facebook" viewBox="0 0 585 1024"><path class="path1" d="M548 6.857v150.857h-89.714q-49.143 0-66.286 20.571t-17.143 61.714v108h167.429l-22.286 169.143h-145.143v433.714h-174.857v-433.714h-145.714v-169.143h145.714v-124.571q0-106.286 59.429-164.857t158.286-58.571q84 0 130.286 6.857z"/></symbol><symbol id="icon-clock" viewBox="0 0 1000 1000"><path d="M500,10C229.8,10,10,229.8,10,500c0,270.2,219.8,490,490,490c270.2,0,490-219.8,490-490C990,229.8,770.2,10,500,10z M500,910.2c-226.2,0-410.2-184-410.2-410.2c0-226.2,184-410.2,410.2-410.2c226.2,0,410.2,184,410.2,410.2C910.2,726.1,726.2,910.2,500,910.2z M753.1,374c8.2,11.9,5.2,28.1-6.6,36.3L509.9,573.7c-4.4,3.1-9.6,4.6-14.8,4.6c-4.1,0-8.3-1-12.1-3c-8.6-4.5-14-13.4-14-23.1V202.5c0-14.4,11.7-26.1,26.1-26.1c14.4,0,26.1,11.7,26.1,26.1v300l195.6-135.1C728.7,359.2,744.9,362.1,753.1,374z"/></symbol><symbol id="icon-calendar" viewBox="0 0 1000 1000"><path d="M920,500v420H80V500H920 M990,430H10v490c0,38.7,31.3,70,70,70h840c38.7,0,70-31.3,70-70V430L990,430z"/><path d="M850,80v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80H360v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80C72.8,80,10,142.7,10,220v140h980V220C990,142.7,927.2,80,850,80z"/><path d="M255,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C290,25.8,274.3,10,255,10z"/><path d="M745,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C780,25.8,764.3,10,745,10z"/></symbol><symbol id="icon-github" viewBox="0 0 12 14"><path d="M6 1q1.633 0 3.012 0.805t2.184 2.184 0.805 3.012q0 1.961-1.145 3.527t-2.957 2.168q-0.211 0.039-0.312-0.055t-0.102-0.234q0-0.023 0.004-0.598t0.004-1.051q0-0.758-0.406-1.109 0.445-0.047 0.801-0.141t0.734-0.305 0.633-0.52 0.414-0.82 0.16-1.176q0-0.93-0.617-1.609 0.289-0.711-0.062-1.594-0.219-0.070-0.633 0.086t-0.719 0.344l-0.297 0.187q-0.727-0.203-1.5-0.203t-1.5 0.203q-0.125-0.086-0.332-0.211t-0.652-0.301-0.664-0.105q-0.352 0.883-0.062 1.594-0.617 0.68-0.617 1.609 0 0.664 0.16 1.172t0.41 0.82 0.629 0.523 0.734 0.305 0.801 0.141q-0.305 0.281-0.383 0.805-0.164 0.078-0.352 0.117t-0.445 0.039-0.512-0.168-0.434-0.488q-0.148-0.25-0.379-0.406t-0.387-0.187l-0.156-0.023q-0.164 0-0.227 0.035t-0.039 0.090 0.070 0.109 0.102 0.094l0.055 0.039q0.172 0.078 0.34 0.297t0.246 0.398l0.078 0.18q0.102 0.297 0.344 0.48t0.523 0.234 0.543 0.055 0.434-0.027l0.18-0.031q0 0.297 0.004 0.691t0.004 0.426q0 0.141-0.102 0.234t-0.312 0.055q-1.812-0.602-2.957-2.168t-1.145-3.527q0-1.633 0.805-3.012t2.184-2.184 3.012-0.805zM2.273 9.617q0.023-0.055-0.055-0.094-0.078-0.023-0.102 0.016-0.023 0.055 0.055 0.094 0.070 0.047 0.102-0.016zM2.516 9.883q0.055-0.039-0.016-0.125-0.078-0.070-0.125-0.023-0.055 0.039 0.016 0.125 0.078 0.078 0.125 0.023zM2.75 10.234q0.070-0.055 0-0.148-0.062-0.102-0.133-0.047-0.070 0.039 0 0.141t0.133 0.055zM3.078 10.562q0.062-0.062-0.031-0.148-0.094-0.094-0.156-0.023-0.070 0.062 0.031 0.148 0.094 0.094 0.156 0.023zM3.523 10.758q0.023-0.086-0.102-0.125-0.117-0.031-0.148 0.055t0.102 0.117q0.117 0.047 0.148-0.047zM4.016 10.797q0-0.102-0.133-0.086-0.125 0-0.125 0.086 0 0.102 0.133 0.086 0.125 0 0.125-0.086zM4.469 10.719q-0.016-0.086-0.141-0.070-0.125 0.023-0.109 0.117t0.141 0.062 0.109-0.109z"></path></symbol><symbol id="icon-medium" viewBox="0 0 1000 1000"><path d="M336.5,240.2v641.5c0,9.1-2.3,16.9-6.8,23.2s-11.2,9.6-20,9.6c-6.2,0-12.2-1.5-18-4.4L37.3,782.7c-7.7-3.6-14.1-9.8-19.4-18.3S10,747.4,10,739V115.5c0-7.3,1.8-13.5,5.5-18.6c3.6-5.1,8.9-7.7,15.9-7.7c5.1,0,13.1,2.7,24.1,8.2l279.5,140C335.9,238.6,336.5,239.5,336.5,240.2L336.5,240.2z M371.5,295.5l292,473.6l-292-145.5V295.5z M990,305.3v576.4c0,9.1-2.6,16.5-7.7,22.1c-5.1,5.7-12,8.5-20.8,8.5s-17.3-2.4-25.7-7.1L694.7,784.9L990,305.3z M988.4,239.7c0,1.1-46.8,77.6-140.3,229.4C754.6,621,699.8,709.8,683.8,735.7L470.5,389l177.2-288.2c6.2-10.2,15.7-15.3,28.4-15.3c5.1,0,9.8,1.1,14.2,3.3l295.9,147.7C987.6,237.1,988.4,238.2,988.4,239.7L988.4,239.7z"/></symbol><symbol id="icon-instagram" viewBox="0 0 489.84 489.84"><path d="M249.62,50.46c65.4,0,73.14.25,99,1.43C372.47,53,385.44,57,394.07,60.32a75.88,75.88,0,0,1,28.16,18.32,75.88,75.88,0,0,1,18.32,28.16c3.35,8.63,7.34,21.6,8.43,45.48,1.18,25.83,1.43,33.57,1.43,99s-0.25,73.14-1.43,99c-1.09,23.88-5.08,36.85-8.43,45.48a81.11,81.11,0,0,1-46.48,46.48c-8.63,3.35-21.6,7.34-45.48,8.43-25.82,1.18-33.57,1.43-99,1.43s-73.15-.25-99-1.43c-23.88-1.09-36.85-5.08-45.48-8.43A75.88,75.88,0,0,1,77,423.86,75.88,75.88,0,0,1,58.69,395.7c-3.35-8.63-7.34-21.6-8.43-45.48-1.18-25.83-1.43-33.57-1.43-99s0.25-73.14,1.43-99c1.09-23.88,5.08-36.85,8.43-45.48A75.88,75.88,0,0,1,77,78.64a75.88,75.88,0,0,1,28.16-18.32c8.63-3.35,21.6-7.34,45.48-8.43,25.83-1.18,33.57-1.43,99-1.43m0-44.13c-66.52,0-74.86.28-101,1.47s-43.87,5.33-59.45,11.38A120.06,120.06,0,0,0,45.81,47.44,120.06,120.06,0,0,0,17.56,90.82C11.5,106.4,7.36,124.2,6.17,150.27s-1.47,34.46-1.47,101,0.28,74.86,1.47,101,5.33,43.87,11.38,59.45a120.06,120.06,0,0,0,28.25,43.38,120.06,120.06,0,0,0,43.38,28.25c15.58,6.05,33.38,10.19,59.45,11.38s34.46,1.47,101,1.47,74.86-.28,101-1.47,43.87-5.33,59.45-11.38a125.24,125.24,0,0,0,71.63-71.63c6.05-15.58,10.19-33.38,11.38-59.45s1.47-34.46,1.47-101-0.28-74.86-1.47-101-5.33-43.87-11.38-59.45a120.06,120.06,0,0,0-28.25-43.38,120.06,120.06,0,0,0-43.38-28.25C394.47,13.13,376.67,9,350.6,7.8s-34.46-1.47-101-1.47h0Z" transform="translate(-4.7 -6.33)" /><path d="M249.62,125.48A125.77,125.77,0,1,0,375.39,251.25,125.77,125.77,0,0,0,249.62,125.48Zm0,207.41a81.64,81.64,0,1,1,81.64-81.64A81.64,81.64,0,0,1,249.62,332.89Z" transform="translate(-4.7 -6.33)"/><circle cx="375.66" cy="114.18" r="29.39" /></symbol><symbol id="icon-linkedin" viewBox="0 0 12 14"><path d="M2.727 4.883v7.742h-2.578v-7.742h2.578zM2.891 2.492q0.008 0.57-0.395 0.953t-1.059 0.383h-0.016q-0.641 0-1.031-0.383t-0.391-0.953q0-0.578 0.402-0.957t1.051-0.379 1.039 0.379 0.398 0.957zM12 8.187v4.437h-2.57v-4.141q0-0.82-0.316-1.285t-0.988-0.465q-0.492 0-0.824 0.27t-0.496 0.668q-0.086 0.234-0.086 0.633v4.32h-2.57q0.016-3.117 0.016-5.055t-0.008-2.313l-0.008-0.375h2.57v1.125h-0.016q0.156-0.25 0.32-0.438t0.441-0.406 0.68-0.34 0.895-0.121q1.336 0 2.148 0.887t0.813 2.598z"></path></symbol><symbol id="icon-heart" viewBox="0 0 34 30"><path d="M17,29.7 L16.4,29.2 C3.5,18.7 0,15 0,9 C0,4 4,0 9,0 C13.1,0 15.4,2.3 17,4.1 C18.6,2.3 20.9,0 25,0 C30,0 34,4 34,9 C34,15 30.5,18.7 17.6,29.2 L17,29.7 Z M9,2 C5.1,2 2,5.1 2,9 C2,14.1 5.2,17.5 17,27.1 C28.8,17.5 32,14.1 32,9 C32,5.1 28.9,2 25,2 C21.5,2 19.6,4.1 18.1,5.8 L17,7.1 L15.9,5.8 C14.4,4.1 12.5,2 9,2 Z" id="Shape"></path></symbol><symbol id="icon-arrow-right" viewBox="0 0 25.452 25.452"><path d="M4.471,24.929v-2.004l12.409-9.788c0.122-0.101,0.195-0.251,0.195-0.411c0-0.156-0.073-0.31-0.195-0.409L4.471,2.526V0.522c0-0.2,0.115-0.384,0.293-0.469c0.18-0.087,0.396-0.066,0.552,0.061l15.47,12.202c0.123,0.1,0.195,0.253,0.195,0.409c0,0.16-0.072,0.311-0.195,0.411L5.316,25.34c-0.155,0.125-0.372,0.147-0.552,0.061C4.586,25.315,4.471,25.13,4.471,24.929z"/></symbol><symbol id="icon-star" viewBox="0 0 48 48"><path fill="currentColor" d="M44,24c0,11.045-8.955,20-20,20S4,35.045,4,24S12.955,4,24,4S44,12.955,44,24z"/><path fill="#ffffff" d="M24,11l3.898,7.898l8.703,1.301l-6.301,6.102l1.5,8.699L24,30.898L16.199,35l1.5-8.699l-6.301-6.102  l8.703-1.301L24,11z"/></symbol><symbol id="icon-read" viewBox="0 0 32 32"><path fill="currentColor" d="M29,4H3C1.343,4,0,5.343,0,7v18c0,1.657,1.343,3,3,3h10c0,0.552,0.448,1,1,1h4c0.552,0,1-0.448,1-1h10  c1.657,0,3-1.343,3-3V7C32,5.343,30.657,4,29,4z M29,5v20H18.708c-0.618,0-1.236,0.146-1.789,0.422l-0.419,0.21V5H29z M15.5,5  v20.632l-0.419-0.21C14.528,25.146,13.91,25,13.292,25H3V5H15.5z M31,25c0,1.103-0.897,2-2,2H18v1h-4v-1H3c-1.103,0-2-0.897-2-2V7  c0-0.737,0.405-1.375,1-1.722V25c0,0.552,0.448,1,1,1h10.292c0.466,0,0.925,0.108,1.342,0.317l0.919,0.46  c0.141,0.07,0.294,0.106,0.447,0.106c0.153,0,0.306-0.035,0.447-0.106l0.919-0.46C17.783,26.108,18.242,26,18.708,26H29  c0.552,0,1-0.448,1-1V5.278C30.595,5.625,31,6.263,31,7V25z M6,12.5C6,12.224,6.224,12,6.5,12h5c0.276,0,0.5,0.224,0.5,0.5  S11.776,13,11.5,13h-5C6.224,13,6,12.776,6,12.5z M6,14.5C6,14.224,6.224,14,6.5,14h5c0.276,0,0.5,0.224,0.5,0.5S11.776,15,11.5,15  h-5C6.224,15,6,14.776,6,14.5z M6,16.5C6,16.224,6.224,16,6.5,16h5c0.276,0,0.5,0.224,0.5,0.5S11.776,17,11.5,17h-5  C6.224,17,6,16.776,6,16.5z M20,12.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,13,25.5,13h-5  C20.224,13,20,12.776,20,12.5z M20,14.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,15,25.5,15h-5  C20.224,15,20,14.776,20,14.5z M20,16.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,17,25.5,17h-5  C20.224,17,20,16.776,20,16.5z"></path></symbol><symbol id="icon-tistory" viewBox="0 0 24 24"><path d="M4 4h16v3h-6v13h-4V7H4V4z"/></symbol></defs></svg>

        <header class="bar-header">
    <a id="menu" role="button">
        <svg id="open" class="icon-menu"><use xlink:href="#icon-menu"></use></svg>
    </a>
    <h1 class="logo">
        <a href="/">
            
                somaz <span class="version">v3.1.2</span>
            
        </a>
    </h1>
    <a id="search" class="dosearch" role="button">
        <svg class="icon-search"><use xlink:href="#icon-search"></use></svg>
    </a>
    
        <a href="https://github.com/thiagorossener/jekflix-template" class="get-theme" role="button">
            Get this theme!
        </a>
    
</header>

<div id="mask" class="overlay"></div>

<aside class="sidebar" id="sidebar">
    <nav id="navigation">
      <h2>Menu</h2>
      <ul>
  
    
      <li>
        <a href="https://somaz.blog/">Home</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/about">About</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/category">Category</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/contact">Contact</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/feed.xml">Feed</a>
      </li>
    
  
</ul>

    </nav>
</aside>

<div class="search-wrapper">
    <div class="search-form">
        <input type="text" class="search-field" placeholder="Search">
        <svg class="icon-remove-sign"><use xlink:href="#icon-close"></use></svg>
        <ul class="search-results search-list"></ul>
    </div>
</div>



        <section class="post two-columns">
            <article role="article" class="post-content">
                <p class="post-info">
                    
                        <svg class="icon-calendar" id="date"><use xlink:href="#icon-calendar"></use></svg>
                        <time class="date" datetime="2025-06-21T00:00:00+00:00">
                            


June 21, 2025

                        </time>
                    
                    <svg id="clock" class="icon-clock"><use xlink:href="#icon-clock"></use></svg>
                    <span>19 min to read</span>
                </p>
                <h1 class="post-title">Deep Dive into OpenStack Keystone</h1>
                <p class="post-subtitle">Understanding OpenStack's Identity Service</p>

                
                    <img src="https://res.cloudinary.com/dkcm26aem/image/upload/v1756113434/openstack-keystone-1_s3qt85.png" alt="Featured image" class="post-cover">
                

                <!-- Pagination links -->



                <!-- Add your table of contents here -->


                <p><br /></p>

<hr />

<h2 id="understanding-openstack-keystone">Understanding OpenStack Keystone</h2>

<p>Keystone is OpenStack’s identity service that provides centralized authentication and authorization for all OpenStack services.</p>

<p>It manages users, projects, and their access to various OpenStack resources through a token-based authentication system.</p>

<p><br /></p>

<h3 id="what-is-keystone">What is Keystone?</h3>

<p><br /></p>

<h4 id="the-identity-management-service">The Identity Management Service</h4>

<p>Keystone serves as the central identity service in OpenStack, providing essential functionality:</p>

<ul>
  <li><strong>Authentication</strong>: Verifies user identity and credentials</li>
  <li><strong>Authorization</strong>: Manages access control and permissions</li>
  <li><strong>Service Catalog</strong>: Maintains service endpoints and URLs</li>
  <li><strong>Token Management</strong>: Issues and validates access tokens</li>
  <li><strong>Multi-tenancy</strong>: Enables resource isolation through projects and domains</li>
  <li><strong>Federation</strong>: Supports identity federation with external systems</li>
</ul>

<blockquote>
  <p>As the security backbone of OpenStack, Keystone ensures secure access to cloud resources while maintaining multi-tenancy and role-based access control.</p>
</blockquote>

<p><br /></p>

<h4 id="keystone-architecture-overview-diagram-description">Keystone Architecture Overview (Diagram Description)</h4>

<ul>
  <li>OpenStack Keystone
    <ul>
      <li>Core Services: Identity Backend, Token Backend, Policy Backend, Catalog Backend</li>
      <li>Identity Management: Users &amp; Groups, Projects, Domains</li>
      <li>Access Control: Roles, Permissions, Policies</li>
      <li>Service Integration: Service Endpoints, API Integration, Token Validation</li>
    </ul>
  </li>
</ul>

<div style="width: 100%; margin: 20px auto;">
  <div class="mermaid">
    graph LR
      A[OpenStack Keystone]
      A --&gt; B[Core Services]
      A --&gt; C[Identity Management]
      A --&gt; D[Access Control]
      A --&gt; E[Service Integration]
      
      B --&gt; B1[Identity Backend]
      B --&gt; B2[Token Backend]
      B --&gt; B3[Policy Backend]
      B --&gt; B4[Catalog Backend]
      
      C --&gt; C1[Users &amp; Groups]
      C --&gt; C2[Projects]
      C --&gt; C3[Domains]
      
      D --&gt; D1[Roles]
      D --&gt; D2[Permissions]
      D --&gt; D3[Policies]
      
      E --&gt; E1[Service Endpoints]
      E --&gt; E2[API Integration]
      E --&gt; E3[Token Validation]

      style A stroke:#333,stroke-width:1px,fill:#f5f5f5
      style B stroke:#333,stroke-width:1px,fill:#a5d6a7
      style C stroke:#333,stroke-width:1px,fill:#64b5f6
      style D stroke:#333,stroke-width:1px,fill:#ffcc80
      style E stroke:#333,stroke-width:1px,fill:#ce93d8
  </div>
</div>

<p><br /></p>

<h3 id="keystone-vs-other-identity-systems">Keystone vs Other Identity Systems</h3>

<div class="table-container">
  <table class="table-beauty">
    <tr>
      <th style="width: 20%;">Aspect</th>
      <th style="width: 25%;">OpenStack Keystone</th>
      <th style="width: 25%;">AWS IAM</th>
      <th style="width: 30%;">Azure Active Directory</th>
    </tr>
    <tr>
      <td><strong>Primary Focus</strong></td>
      <td>OpenStack cloud identity management</td>
      <td>AWS service access control</td>
      <td>Enterprise directory services</td>
    </tr>
    <tr>
      <td><strong>Authentication</strong></td>
      <td>Token-based, LDAP, Database</td>
      <td>Access keys, temporary credentials</td>
      <td>SAML, OAuth, OpenID Connect</td>
    </tr>
    <tr>
      <td><strong>Multi-tenancy</strong></td>
      <td>Projects and domains</td>
      <td>AWS accounts</td>
      <td>Tenants and directories</td>
    </tr>
    <tr>
      <td><strong>Federation</strong></td>
      <td>SAML, OIDC support</td>
      <td>Cross-account roles</td>
      <td>Native federation capabilities</td>
    </tr>
    <tr>
      <td><strong>Use Case</strong></td>
      <td>Private/hybrid cloud</td>
      <td>Public cloud services</td>
      <td>Enterprise applications</td>
    </tr>
  </table>
</div>

<p><br /></p>

<hr />

<h2 id="keystone-architecture-and-components">Keystone Architecture and Components</h2>

<p>Keystone employs a modular architecture with multiple backend services that work together to provide comprehensive identity management.</p>

<p>This design enables flexible authentication methods and robust access control across the OpenStack cloud.</p>

<p><br /></p>

<h3 id="core-components">Core Components</h3>

<div class="table-container">
  <table class="table-beauty">
    <tr>
      <th style="width: 20%;">Component</th>
      <th style="width: 25%;">Role</th>
      <th style="width: 55%;">Description</th>
    </tr>
    <tr>
      <td><strong>Identity Backend</strong></td>
      <td>User Management</td>
      <td>
        <ul>
          <li>Manages user and group authentication</li>
          <li>Supports LDAP and SQL database integration</li>
          <li>Handles user credentials and profiles</li>
          <li>Provides identity verification services</li>
        </ul>
      </td>
    </tr>
    <tr>
      <td><strong>Token Backend</strong></td>
      <td>Session Management</td>
      <td>
        <ul>
          <li>Issues temporary access tokens</li>
          <li>Manages token lifecycle</li>
          <li>Handles token validation</li>
          <li>Supports token revocation</li>
        </ul>
      </td>
    </tr>
    <tr>
      <td><strong>Policy Backend</strong></td>
      <td>Access Control</td>
      <td>
        <ul>
          <li>Manages role-based access control</li>
          <li>Defines access policies</li>
          <li>Enforces permission rules</li>
          <li>Handles authorization decisions</li>
        </ul>
      </td>
    </tr>
    <tr>
      <td><strong>Catalog Backend</strong></td>
      <td>Service Management</td>
      <td>
        <ul>
          <li>Maintains service endpoints</li>
          <li>Manages service URLs</li>
          <li>Handles service discovery</li>
          <li>Provides endpoint information</li>
        </ul>
      </td>
    </tr>
  </table>
</div>

<p><br /></p>

<h3 id="authentication-flow">Authentication Flow</h3>

<h4 id="sequence-diagram-description">Sequence Diagram Description</h4>

<ul>
  <li>User/Service sends authentication request to Keystone</li>
  <li>Keystone validates credentials</li>
  <li>Keystone issues token to User/Service</li>
  <li>User/Service requests OpenStack service with token</li>
  <li>Service validates token with Keystone</li>
  <li>Service responds to User/Service</li>
</ul>

<div style="width: 90%; margin: 20px auto;">
  <div class="mermaid">
    sequenceDiagram
      participant User as "User/Service"
      participant Keystone as "Keystone"
      participant Service as "OpenStack Service"
      
      User-&gt;&gt;Keystone: Authentication Request
      Keystone-&gt;&gt;Keystone: Validate Credentials
      Keystone--&gt;&gt;User: Issue Token
      User-&gt;&gt;Service: Request with Token
      Service-&gt;&gt;Keystone: Validate Token
      Keystone--&gt;&gt;Service: Token Valid
      Service--&gt;&gt;User: Service Response
  </div>
</div>

<p><br /></p>

<h3 id="key-concepts">Key Concepts</h3>

<p>Keystone manages several key concepts:</p>

<ul>
  <li><strong>Domains</strong>: Top-level containers for users, groups, and projects</li>
  <li><strong>Projects</strong>: Resource isolation units (formerly tenants)</li>
  <li><strong>Users &amp; Groups</strong>: Individual accounts and collections</li>
  <li><strong>Roles</strong>: Access control definitions</li>
  <li><strong>Tokens</strong>: Temporary access credentials</li>
  <li><strong>Endpoints</strong>: Service access points</li>
</ul>

<p>These concepts work together to provide comprehensive identity and access management.</p>

<p><br /></p>

<hr />

<h2 id="installation-and-configuration">Installation and Configuration</h2>

<p>Setting up Keystone requires careful planning and configuration.</p>

<p>This section covers installation methods, database setup, and initial configuration for production environments.</p>

<p><br /></p>

<h3 id="prerequisites-and-requirements">Prerequisites and Requirements</h3>

<h4 id="system-requirements">System Requirements</h4>
<script src="https://gist.github.com/somaz94/2025cad2ef2c75d3dfd2d2d7f3a36d62.js"></script>

<h4 id="configuration-file-setup">Configuration File Setup</h4>
<script src="https://gist.github.com/somaz94/f8221653601fd8ae5aff6dbeed946d1d.js"></script>

<h4 id="apache-http-server-configuration">Apache HTTP Server Configuration</h4>
<div class="language-apache highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># /etc/apache2/sites-available/keystone.conf</span>
<span class="nc">Listen</span> 5000

<span class="p">&lt;</span><span class="nl">VirtualHost</span><span class="sr"> *:5000</span><span class="p">&gt;
</span>    WSGIDaemonProcess keystone-public processes=5 threads=1 user=keystone group=keystone display-name=%{GROUP}
    WSGIProcessGroup keystone-public
    WSGIScriptAlias / /usr/bin/keystone-wsgi-public
    WSGIApplicationGroup %{GLOBAL}
    WSGIPassAuthorization <span class="ss">On</span>
    <span class="nc">LimitRequestBody</span> 114688
    
    <span class="nc">ErrorLogFormat</span> "%{cu}t %M"
    <span class="nc">ErrorLog</span> /var/log/apache2/keystone.log
    <span class="nc">CustomLog</span> /var/log/apache2/keystone_access.log combined
    
    <span class="p">&lt;</span><span class="nl">Directory</span><span class="sr"> /usr/bin</span><span class="p">&gt;
</span>        <span class="nc">Require</span> <span class="ss">all</span> granted
    <span class="p">&lt;/</span><span class="nl">Directory</span><span class="p">&gt;
&lt;/</span><span class="nl">VirtualHost</span><span class="p">&gt;
</span>
<span class="c"># Enable the site and restart Apache</span>
sudo a2ensite keystone
sudo systemctl restart apache2
</code></pre></div></div>

<p><br /></p>

<hr />

<h2 id="advanced-configuration-and-integration">Advanced Configuration and Integration</h2>

<p>Advanced Keystone deployments require integration with external systems, high availability setup, and comprehensive security configurations.</p>

<p><br /></p>

<h3 id="ldap-integration">LDAP Integration</h3>

<h4 id="active-directory-integration">Active Directory Integration</h4>
<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># /etc/keystone/keystone.conf - LDAP configuration
</span><span class="nn">[identity]</span>
<span class="py">driver</span> <span class="p">=</span> <span class="s">ldap</span>
<span class="py">default_domain_id</span> <span class="p">=</span> <span class="s">default</span>

<span class="nn">[ldap]</span>
<span class="py">url</span> <span class="p">=</span> <span class="s">ldap://ad.example.com:389</span>
<span class="py">user</span> <span class="p">=</span> <span class="s">cn=keystone,ou=service-accounts,dc=example,dc=com</span>
<span class="py">password</span> <span class="p">=</span> <span class="s">service_account_password</span>
<span class="py">suffix</span> <span class="p">=</span> <span class="s">dc=example,dc=com</span>

<span class="c"># User configuration
</span><span class="py">user_tree_dn</span> <span class="p">=</span> <span class="s">ou=users,dc=example,dc=com</span>
<span class="py">user_objectclass</span> <span class="p">=</span> <span class="s">person</span>
<span class="py">user_id_attribute</span> <span class="p">=</span> <span class="s">sAMAccountName</span>
<span class="py">user_name_attribute</span> <span class="p">=</span> <span class="s">sAMAccountName</span>
<span class="py">user_mail_attribute</span> <span class="p">=</span> <span class="s">mail</span>
<span class="py">user_enabled_attribute</span> <span class="p">=</span> <span class="s">userAccountControl</span>
<span class="py">user_enabled_mask</span> <span class="p">=</span> <span class="s">2</span>
<span class="py">user_enabled_default</span> <span class="p">=</span> <span class="s">512</span>

<span class="c"># Group configuration
</span><span class="py">group_tree_dn</span> <span class="p">=</span> <span class="s">ou=groups,dc=example,dc=com</span>
<span class="py">group_objectclass</span> <span class="p">=</span> <span class="s">group</span>
<span class="py">group_id_attribute</span> <span class="p">=</span> <span class="s">cn</span>
<span class="py">group_name_attribute</span> <span class="p">=</span> <span class="s">cn</span>
<span class="py">group_member_attribute</span> <span class="p">=</span> <span class="s">member</span>
<span class="py">group_desc_attribute</span> <span class="p">=</span> <span class="s">description</span>

<span class="c"># Query configuration
</span><span class="py">query_scope</span> <span class="p">=</span> <span class="s">sub</span>
<span class="py">page_size</span> <span class="p">=</span> <span class="s">1000</span>
<span class="py">alias_dereferencing</span> <span class="p">=</span> <span class="s">never</span>
<span class="py">debug_level</span> <span class="p">=</span> <span class="s">0</span>

<span class="c"># Connection pool
</span><span class="py">use_pool</span> <span class="p">=</span> <span class="s">true</span>
<span class="py">pool_size</span> <span class="p">=</span> <span class="s">10</span>
<span class="py">pool_retry_max</span> <span class="p">=</span> <span class="s">3</span>
<span class="py">pool_retry_delay</span> <span class="p">=</span> <span class="s">0.1</span>
<span class="py">pool_connection_timeout</span> <span class="p">=</span> <span class="s">-1</span>
<span class="py">pool_connection_lifetime</span> <span class="p">=</span> <span class="s">600</span>

<span class="c"># TLS configuration
</span><span class="py">use_tls</span> <span class="p">=</span> <span class="s">true</span>
<span class="py">tls_cacertfile</span> <span class="p">=</span> <span class="s">/etc/ssl/certs/ca-certificates.crt</span>
<span class="py">tls_req_cert</span> <span class="p">=</span> <span class="s">demand</span>
</code></pre></div></div>

<h4 id="multi-domain-ldap-setup">Multi-Domain LDAP Setup</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># Script to configure multiple LDAP domains</span>

<span class="c"># Create domain-specific configuration files</span>
<span class="nb">sudo mkdir</span> <span class="nt">-p</span> /etc/keystone/domains

<span class="c"># Engineering domain</span>
<span class="nb">cat</span> <span class="o">&gt;</span> /etc/keystone/domains/keystone.engineering.conf <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
[ldap]
url = ldap://engineering.example.com:389
user = cn=keystone,ou=service,dc=engineering,dc=example,dc=com
password = eng_service_password
suffix = dc=engineering,dc=example,dc=com
user_tree_dn = ou=users,dc=engineering,dc=example,dc=com
group_tree_dn = ou=groups,dc=engineering,dc=example,dc=com
</span><span class="no">EOF

</span><span class="c"># Sales domain</span>
<span class="nb">cat</span> <span class="o">&gt;</span> /etc/keystone/domains/keystone.sales.conf <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
[ldap]
url = ldap://sales.example.com:389
user = cn=keystone,ou=service,dc=sales,dc=example,dc=com
password = sales_service_password
suffix = dc=sales,dc=example,dc=com
user_tree_dn = ou=users,dc=sales,dc=example,dc=com
group_tree_dn = ou=groups,dc=sales,dc=example,dc=com
</span><span class="no">EOF

</span><span class="c"># Set proper permissions</span>
<span class="nb">sudo chown </span>keystone:keystone /etc/keystone/domains/<span class="k">*</span>
<span class="nb">sudo chmod </span>640 /etc/keystone/domains/<span class="k">*</span>

<span class="c"># Create domains in Keystone</span>
openstack domain create <span class="nt">--description</span> <span class="s2">"Engineering Department"</span> engineering
openstack domain create <span class="nt">--description</span> <span class="s2">"Sales Department"</span> sales
</code></pre></div></div>

<h3 id="high-availability-configuration">High Availability Configuration</h3>

<h4 id="multi-node-keystone-setup">Multi-Node Keystone Setup</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># High availability Keystone deployment script</span>

<span class="c"># Configure shared database (Galera cluster)</span>
<span class="c"># /etc/mysql/mariadb.conf.d/99-galera.cnf</span>
<span class="nb">cat</span> <span class="o">&gt;</span> /etc/mysql/mariadb.conf.d/99-galera.cnf <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
[galera]
wsrep_on=ON
wsrep_provider=/usr/lib/galera/libgalera_smm.so
wsrep_cluster_address="gcomm://controller1,controller2,controller3"
wsrep_cluster_name="openstack"
wsrep_node_address="</span><span class="si">$(</span><span class="nb">hostname</span> <span class="nt">-I</span> | <span class="nb">awk</span> <span class="s1">'{print $1}'</span><span class="si">)</span><span class="sh">"
wsrep_node_name="</span><span class="si">$(</span><span class="nb">hostname</span><span class="si">)</span><span class="sh">"
wsrep_sst_method=rsync
binlog_format=row
default_storage_engine=InnoDB
innodb_autoinc_lock_mode=2
bind-address=0.0.0.0
</span><span class="no">EOF

</span><span class="c"># Shared Fernet keys setup</span>
<span class="c"># Sync Fernet keys across all nodes</span>
rsync <span class="nt">-av</span> /etc/keystone/fernet-keys/ controller2:/etc/keystone/fernet-keys/
rsync <span class="nt">-av</span> /etc/keystone/fernet-keys/ controller3:/etc/keystone/fernet-keys/

<span class="c"># Load balancer configuration (HAProxy)</span>
<span class="nb">cat</span> <span class="o">&gt;&gt;</span> /etc/haproxy/haproxy.cfg <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
listen keystone_admin_cluster
  bind 10.0.0.100:35357
  balance source
  option httpchk
  option httplog
  option httpclose
  server controller1 10.0.0.11:35357 check inter 2000 rise 2 fall 5
  server controller2 10.0.0.12:35357 check inter 2000 rise 2 fall 5
  server controller3 10.0.0.13:35357 check inter 2000 rise 2 fall 5

listen keystone_public_cluster
  bind 10.0.0.100:5000
  balance source
  option httpchk
  option httplog
  option httpclose
  server controller1 10.0.0.11:5000 check inter 2000 rise 2 fall 5
  server controller2 10.0.0.12:5000 check inter 2000 rise 2 fall 5
  server controller3 10.0.0.13:5000 check inter 2000 rise 2 fall 5
</span><span class="no">EOF

</span>systemctl restart haproxy
</code></pre></div></div>

<h3 id="federation-and-saml-integration">Federation and SAML Integration</h3>

<h4 id="saml2-federation-setup">SAML2 Federation Setup</h4>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- /etc/keystone/saml2_idp_metadata.xml --&gt;</span>
<span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;md:EntityDescriptor</span> <span class="na">xmlns:md=</span><span class="s">"urn:oasis:names:tc:SAML:2.0:metadata"</span>
                     <span class="na">entityID=</span><span class="s">"https://idp.example.com/simplesaml/saml2/idp/metadata.php"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;md:IDPSSODescriptor</span> <span class="na">WantAuthnRequestsSigned=</span><span class="s">"false"</span>
                       <span class="na">protocolSupportEnumeration=</span><span class="s">"urn:oasis:names:tc:SAML:2.0:protocol"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;md:SingleSignOnService</span> <span class="na">Binding=</span><span class="s">"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect"</span>
                            <span class="na">Location=</span><span class="s">"https://idp.example.com/simplesaml/saml2/idp/SSOService.php"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;md:SingleSignOnService</span> <span class="na">Binding=</span><span class="s">"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST"</span>
                            <span class="na">Location=</span><span class="s">"https://idp.example.com/simplesaml/saml2/idp/SSOService.php"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/md:IDPSSODescriptor&gt;</span>
<span class="nt">&lt;/md:EntityDescriptor&gt;</span>
</code></pre></div></div>

<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Federation configuration in keystone.conf
</span><span class="nn">[federation]</span>
<span class="py">driver</span> <span class="p">=</span> <span class="s">sql</span>
<span class="py">assertion_prefix</span> <span class="p">=</span> <span class="s">ADFS_</span>
<span class="py">remote_id_attribute</span> <span class="p">=</span> <span class="s">ADFS_CLAIMS</span>

<span class="nn">[saml]</span>
<span class="py">certfile</span> <span class="p">=</span> <span class="s">/etc/keystone/ssl/certs/keystone.pem</span>
<span class="py">keyfile</span> <span class="p">=</span> <span class="s">/etc/keystone/ssl/private/keystone.key</span>
<span class="py">idp_entity_id</span> <span class="p">=</span> <span class="s">https://idp.example.com/simplesaml/saml2/idp/metadata.php</span>
<span class="py">idp_sso_endpoint</span> <span class="p">=</span> <span class="s">https://idp.example.com/simplesaml/saml2/idp/SSOService.php</span>
<span class="py">idp_metadata_path</span> <span class="p">=</span> <span class="s">/etc/keystone/saml2_idp_metadata.xml</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Configure federation</span>
openstack identity provider create <span class="nt">--remote-id</span> https://idp.example.com/simplesaml/saml2/idp/metadata.php saml2_idp

openstack mapping create <span class="nt">--rules</span> mapping_rules.json saml_mapping

openstack federation protocol create <span class="nt">--identity-provider</span> saml2_idp <span class="nt">--mapping</span> saml_mapping saml2
</code></pre></div></div>

<hr />

<h2 id="access-control-and-authorization">Access Control and Authorization</h2>

<p>Keystone provides robust access control mechanisms through role-based access control (RBAC) and policy-based authorization.</p>

<p>This enables fine-grained control over resource access while maintaining security and compliance.</p>

<p><br /></p>

<h3 id="role-based-access-control">Role-Based Access Control</h3>

<div class="table-container">
  <table class="table-beauty">
    <tr>
      <th style="width: 20%;">Component</th>
      <th style="width: 40%;">Description</th>
      <th style="width: 40%;">Use Cases</th>
    </tr>
    <tr>
      <td><strong>Roles</strong></td>
      <td>Define access permissions for users and groups</td>
      <td>
        <ul>
          <li>Admin access</li>
          <li>Developer access</li>
          <li>Read-only access</li>
        </ul>
      </td>
    </tr>
    <tr>
      <td><strong>Projects</strong></td>
      <td>Isolate resources and manage access</td>
      <td>
        <ul>
          <li>Resource isolation</li>
          <li>Multi-tenant environments</li>
          <li>Project-based access</li>
        </ul>
      </td>
    </tr>
    <tr>
      <td><strong>Domains</strong></td>
      <td>Group related resources and users</td>
      <td>
        <ul>
          <li>Organization separation</li>
          <li>Department isolation</li>
          <li>Resource grouping</li>
        </ul>
      </td>
    </tr>
  </table>
</div>

<p><br /></p>

<h3 id="service-integration">Service Integration</h3>

<p>Keystone integrates with various OpenStack services:</p>

<ul>
  <li><strong>Nova Integration</strong>: Manages compute service access</li>
  <li><strong>Neutron Integration</strong>: Controls network service access</li>
  <li><strong>Glance Integration</strong>: Handles image service access</li>
  <li><strong>Cinder Integration</strong>: Manages storage service access</li>
</ul>

<p>This integration ensures consistent authentication and authorization across all OpenStack services.</p>

<p><br /></p>

<hr />

<h2 id="practical-operations-and-management">Practical Operations and Management</h2>

<p>Effective Keystone management requires understanding daily operations, troubleshooting techniques, and performance optimization strategies for production environments.</p>

<p><br /></p>

<h3 id="user-and-project-management">User and Project Management</h3>

<h4 id="command-line-administration">Command-Line Administration</h4>
<script src="https://gist.github.com/somaz94/32904ad247f236e86e460e297105e529.js"></script>

<h4 id="user-lifecycle-management">User Lifecycle Management</h4>
<script src="https://gist.github.com/somaz94/5fde353ec5b1dad8e48d8ebb9fd347cc.js"></script>

<h3 id="token-management-and-security">Token Management and Security</h3>

<h4 id="token-lifecycle-management">Token Lifecycle Management</h4>
<script src="https://gist.github.com/somaz94/976f0b27f530b771c6f3153510beeb92.js"></script>

<h3 id="performance-monitoring-and-optimization">Performance Monitoring and Optimization</h3>

<h4 id="performance-metrics-collection">Performance Metrics Collection</h4>
<script src="https://gist.github.com/somaz94/065a34c373f8863491eed2d584466339.js"></script>

<hr />

<h2 id="usage-and-best-practices">Usage and Best Practices</h2>

<p>Effective use of Keystone requires understanding its capabilities and implementing appropriate security practices.</p>

<p>Here are key considerations and best practices for utilizing Keystone effectively.</p>

<p><br /></p>

<h3 id="security-strategies">Security Strategies</h3>

<div class="table-container">
  <table class="table-beauty">
    <tr>
      <th style="width: 20%;">Strategy</th>
      <th style="width: 40%;">Description</th>
      <th style="width: 40%;">Benefits</th>
    </tr>
    <tr>
      <td><strong>Role Management</strong></td>
      <td>Implement least privilege principle</td>
      <td>
        <ul>
          <li>Enhanced security</li>
          <li>Reduced risk</li>
          <li>Better control</li>
        </ul>
      </td>
    </tr>
    <tr>
      <td><strong>Token Security</strong></td>
      <td>Manage token lifecycle and security</td>
      <td>
        <ul>
          <li>Secure access</li>
          <li>Session control</li>
          <li>Access tracking</li>
        </ul>
      </td>
    </tr>
    <tr>
      <td><strong>Policy Management</strong></td>
      <td>Define clear access policies</td>
      <td>
        <ul>
          <li>Consistent access</li>
          <li>Clear permissions</li>
          <li>Audit compliance</li>
        </ul>
      </td>
    </tr>
  </table>
</div>

<p><br /></p>

<h3 id="implementation-guidelines">Implementation Guidelines</h3>

<p>For effective Keystone implementation:</p>

<ul>
  <li><strong>Security Planning</strong>: Implement comprehensive security measures</li>
  <li><strong>Role Design</strong>: Create clear role hierarchies</li>
  <li><strong>Token Management</strong>: Configure appropriate token lifetimes</li>
  <li><strong>Monitoring</strong>: Track authentication and access patterns</li>
</ul>

<p>Following these guidelines helps ensure secure and efficient identity management.</p>

<p><br /></p>

<hr />

<h2 id="troubleshooting-and-maintenance">Troubleshooting and Maintenance</h2>

<p>Effective troubleshooting requires understanding common issues, log analysis techniques, and maintenance procedures for Keystone deployments.</p>

<p><br /></p>

<h3 id="common-issues-and-solutions">Common Issues and Solutions</h3>

<h4 id="authentication-and-token-issues">Authentication and Token Issues</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># Keystone troubleshooting toolkit</span>

<span class="c"># Diagnose authentication failures</span>
diagnose_auth_failures<span class="o">()</span> <span class="o">{</span>
    <span class="nb">local </span><span class="nv">log_file</span><span class="o">=</span><span class="s2">"/var/log/keystone/keystone.log"</span>
    <span class="nb">local </span><span class="nv">user_name</span><span class="o">=</span><span class="nv">$1</span>
    
    <span class="nb">echo</span> <span class="s2">"Diagnosing authentication issues for user: </span><span class="nv">$user_name</span><span class="s2">"</span>
    
    <span class="c"># Check recent authentication attempts</span>
    <span class="nb">echo</span> <span class="s2">"Recent authentication attempts:"</span>
    <span class="nb">grep</span> <span class="s2">"</span><span class="nv">$user_name</span><span class="s2">"</span> <span class="nv">$log_file</span> | <span class="nb">grep</span> <span class="nt">-E</span> <span class="s2">"(authentication|failed|success)"</span> | <span class="nb">tail</span> <span class="nt">-10</span>
    
    <span class="c"># Check user status</span>
    <span class="nv">user_info</span><span class="o">=</span><span class="si">$(</span>openstack user show <span class="nv">$user_name</span> <span class="nt">--format</span> json 2&gt;/dev/null<span class="si">)</span>
    <span class="k">if</span> <span class="o">[[</span> <span class="nv">$?</span> <span class="nt">-eq</span> 0 <span class="o">]]</span><span class="p">;</span> <span class="k">then
        </span><span class="nv">enabled</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="nv">$user_info</span> | jq <span class="nt">-r</span> <span class="s1">'.enabled'</span><span class="si">)</span>
        <span class="nb">echo</span> <span class="s2">"User enabled: </span><span class="nv">$enabled</span><span class="s2">"</span>
        
        <span class="k">if</span> <span class="o">[[</span> <span class="nv">$enabled</span> <span class="o">==</span> <span class="s2">"false"</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
            </span><span class="nb">echo</span> <span class="s2">"ISSUE: User account is disabled"</span>
        <span class="k">fi
    else
        </span><span class="nb">echo</span> <span class="s2">"ISSUE: User not found"</span>
    <span class="k">fi</span>
    
    <span class="c"># Check password policy violations</span>
    <span class="nb">echo</span> <span class="s2">"Checking password policy violations:"</span>
    <span class="nb">grep</span> <span class="s2">"</span><span class="nv">$user_name</span><span class="s2">"</span> <span class="nv">$log_file</span> | <span class="nb">grep</span> <span class="nt">-i</span> <span class="s2">"password"</span> | <span class="nb">grep</span> <span class="nt">-E</span> <span class="s2">"(expired|policy|violation)"</span> | <span class="nb">tail</span> <span class="nt">-5</span>
    
    <span class="c"># Check account lockout</span>
    <span class="nv">lockout_count</span><span class="o">=</span><span class="si">$(</span><span class="nb">grep</span> <span class="s2">"</span><span class="nv">$user_name</span><span class="s2">"</span> <span class="nv">$log_file</span> | <span class="nb">grep</span> <span class="s2">"lockout"</span> | <span class="nb">wc</span> <span class="nt">-l</span><span class="si">)</span>
    <span class="k">if</span> <span class="o">[[</span> <span class="nv">$lockout_count</span> <span class="nt">-gt</span> 0 <span class="o">]]</span><span class="p">;</span> <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"WARNING: Account lockout detected (</span><span class="nv">$lockout_count</span><span class="s2"> occurrences)"</span>
    <span class="k">fi</span>
<span class="o">}</span>

<span class="c"># Fix common token issues</span>
fix_token_issues<span class="o">()</span> <span class="o">{</span>
    <span class="nb">echo</span> <span class="s2">"Checking and fixing token-related issues..."</span>
    
    <span class="c"># Check Fernet key permissions</span>
    <span class="nb">echo</span> <span class="s2">"Checking Fernet key permissions:"</span>
    <span class="nb">ls</span> <span class="nt">-la</span> /etc/keystone/fernet-keys/
    
    <span class="c"># Fix permissions if needed</span>
    <span class="nb">sudo chown</span> <span class="nt">-R</span> keystone:keystone /etc/keystone/fernet-keys/
    <span class="nb">sudo chmod </span>600 /etc/keystone/fernet-keys/<span class="k">*</span>
    
    <span class="c"># Check key rotation status</span>
    <span class="nb">echo</span> <span class="s2">"Fernet key rotation status:"</span>
    <span class="nv">key_count</span><span class="o">=</span><span class="si">$(</span><span class="nb">ls</span> /etc/keystone/fernet-keys/ | <span class="nb">wc</span> <span class="nt">-l</span><span class="si">)</span>
    <span class="nb">echo</span> <span class="s2">"Number of Fernet keys: </span><span class="nv">$key_count</span><span class="s2">"</span>
    
    <span class="k">if</span> <span class="o">[[</span> <span class="nv">$key_count</span> <span class="nt">-lt</span> 2 <span class="o">]]</span><span class="p">;</span> <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"WARNING: Insufficient Fernet keys, rotating..."</span>
        <span class="nb">sudo </span>keystone-manage fernet_rotate <span class="nt">--keystone-user</span> keystone <span class="nt">--keystone-group</span> keystone
    <span class="k">fi</span>
    
    <span class="c"># Clean token cache</span>
    <span class="nb">echo</span> <span class="s2">"Cleaning token cache..."</span>
    <span class="k">if </span><span class="nb">command</span> <span class="nt">-v</span> memcached &amp;&gt; /dev/null<span class="p">;</span> <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"flush_all"</span> | nc localhost 11211
        <span class="nb">echo</span> <span class="s2">"Memcached cache cleared"</span>
    <span class="k">fi</span>
    
    <span class="c"># Restart Keystone services</span>
    <span class="nb">echo</span> <span class="s2">"Restarting Keystone services..."</span>
    <span class="nb">sudo </span>systemctl restart apache2
    <span class="nb">echo</span> <span class="s2">"Services restarted"</span>
<span class="o">}</span>

<span class="c"># Database connectivity check</span>
check_database_connectivity<span class="o">()</span> <span class="o">{</span>
    <span class="nb">local </span><span class="nv">db_host</span><span class="o">=</span><span class="s2">"localhost"</span>
    <span class="nb">local </span><span class="nv">db_user</span><span class="o">=</span><span class="s2">"keystone"</span>
    <span class="nb">local </span><span class="nv">db_pass</span><span class="o">=</span><span class="s2">"</span><span class="nv">$KEYSTONE_DB_PASS</span><span class="s2">"</span>
    <span class="nb">local </span><span class="nv">db_name</span><span class="o">=</span><span class="s2">"keystone"</span>
    
    <span class="nb">echo</span> <span class="s2">"Checking database connectivity..."</span>
    
    <span class="c"># Test connection</span>
    <span class="k">if </span>mysql <span class="nt">-h</span> <span class="nv">$db_host</span> <span class="nt">-u</span> <span class="nv">$db_user</span> <span class="nt">-p</span><span class="nv">$db_pass</span> <span class="nt">-e</span> <span class="s2">"USE </span><span class="nv">$db_name</span><span class="s2">; SELECT 1;"</span> &amp;&gt;/dev/null<span class="p">;</span> <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"Database connection: OK"</span>
        
        <span class="c"># Check table integrity</span>
        <span class="nb">echo</span> <span class="s2">"Checking table integrity:"</span>
        <span class="nv">tables</span><span class="o">=</span><span class="si">$(</span>mysql <span class="nt">-h</span> <span class="nv">$db_host</span> <span class="nt">-u</span> <span class="nv">$db_user</span> <span class="nt">-p</span><span class="nv">$db_pass</span> <span class="nv">$db_name</span> <span class="nt">-e</span> <span class="s2">"SHOW TABLES;"</span> | <span class="nb">grep</span> <span class="nt">-v</span> Tables<span class="si">)</span>
        
        <span class="k">for </span>table <span class="k">in</span> <span class="nv">$tables</span><span class="p">;</span> <span class="k">do
            </span><span class="nv">count</span><span class="o">=</span><span class="si">$(</span>mysql <span class="nt">-h</span> <span class="nv">$db_host</span> <span class="nt">-u</span> <span class="nv">$db_user</span> <span class="nt">-p</span><span class="nv">$db_pass</span> <span class="nv">$db_name</span> <span class="nt">-e</span> <span class="s2">"SELECT COUNT(*) FROM </span><span class="nv">$table</span><span class="s2">;"</span> | <span class="nb">tail</span> <span class="nt">-1</span><span class="si">)</span>
            <span class="nb">echo</span> <span class="s2">"Table </span><span class="nv">$table</span><span class="s2">: </span><span class="nv">$count</span><span class="s2"> rows"</span>
        <span class="k">done
    else
        </span><span class="nb">echo</span> <span class="s2">"ERROR: Database connection failed"</span>
        <span class="nb">echo</span> <span class="s2">"Check database credentials and network connectivity"</span>
    <span class="k">fi</span>
<span class="o">}</span>
</code></pre></div></div>

<h4 id="service-integration-problems">Service Integration Problems</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># Service integration troubleshooting</span>

<span class="c"># Check service catalog issues</span>
check_service_catalog<span class="o">()</span> <span class="o">{</span>
    <span class="nb">echo</span> <span class="s2">"Checking service catalog configuration..."</span>
    
    <span class="c"># List all services</span>
    openstack service list <span class="nt">--format</span> table
    
    <span class="c"># Check for missing endpoints</span>
    <span class="nv">services</span><span class="o">=</span><span class="si">$(</span>openstack service list <span class="nt">-f</span> value <span class="nt">-c</span> ID<span class="si">)</span>
    
    <span class="k">for </span>service_id <span class="k">in</span> <span class="nv">$services</span><span class="p">;</span> <span class="k">do
        </span><span class="nv">service_name</span><span class="o">=</span><span class="si">$(</span>openstack service show <span class="nv">$service_id</span> <span class="nt">-f</span> value <span class="nt">-c</span> name<span class="si">)</span>
        <span class="nv">endpoint_count</span><span class="o">=</span><span class="si">$(</span>openstack endpoint list <span class="nt">--service</span> <span class="nv">$service_id</span> <span class="nt">-f</span> value | <span class="nb">wc</span> <span class="nt">-l</span><span class="si">)</span>
        
        <span class="k">if</span> <span class="o">[[</span> <span class="nv">$endpoint_count</span> <span class="nt">-eq</span> 0 <span class="o">]]</span><span class="p">;</span> <span class="k">then
            </span><span class="nb">echo</span> <span class="s2">"WARNING: Service '</span><span class="nv">$service_name</span><span class="s2">' has no endpoints"</span>
        <span class="k">elif</span> <span class="o">[[</span> <span class="nv">$endpoint_count</span> <span class="nt">-lt</span> 3 <span class="o">]]</span><span class="p">;</span> <span class="k">then
            </span><span class="nb">echo</span> <span class="s2">"WARNING: Service '</span><span class="nv">$service_name</span><span class="s2">' missing some endpoint types"</span>
        <span class="k">fi
    done</span>
<span class="o">}</span>

<span class="c"># Test service connectivity</span>
test_service_connectivity<span class="o">()</span> <span class="o">{</span>
    <span class="nb">local </span><span class="nv">service_name</span><span class="o">=</span><span class="nv">$1</span>
    
    <span class="nb">echo</span> <span class="s2">"Testing connectivity to </span><span class="nv">$service_name</span><span class="s2"> service..."</span>
    
    <span class="c"># Get service endpoints</span>
    <span class="nv">endpoints</span><span class="o">=</span><span class="si">$(</span>openstack endpoint list <span class="nt">--service</span> <span class="nv">$service_name</span> <span class="nt">-f</span> value <span class="nt">-c</span> URL<span class="si">)</span>
    
    <span class="k">for </span>endpoint <span class="k">in</span> <span class="nv">$endpoints</span><span class="p">;</span> <span class="k">do
        </span><span class="nb">echo</span> <span class="s2">"Testing endpoint: </span><span class="nv">$endpoint</span><span class="s2">"</span>
        
        <span class="c"># Test HTTP connectivity</span>
        <span class="k">if </span>curl <span class="nt">-s</span> <span class="nt">--connect-timeout</span> 5 <span class="s2">"</span><span class="nv">$endpoint</span><span class="s2">/health"</span> &amp;&gt;/dev/null<span class="p">;</span> <span class="k">then
            </span><span class="nb">echo</span> <span class="s2">"  Status: OK"</span>
        <span class="k">elif </span>curl <span class="nt">-s</span> <span class="nt">--connect-timeout</span> 5 <span class="s2">"</span><span class="nv">$endpoint</span><span class="s2">"</span> &amp;&gt;/dev/null<span class="p">;</span> <span class="k">then
            </span><span class="nb">echo</span> <span class="s2">"  Status: Reachable (no health endpoint)"</span>
        <span class="k">else
            </span><span class="nb">echo</span> <span class="s2">"  Status: FAILED"</span>
        <span class="k">fi
    done</span>
<span class="o">}</span>

<span class="c"># Fix endpoint URLs</span>
fix_endpoint_urls<span class="o">()</span> <span class="o">{</span>
    <span class="nb">local </span><span class="nv">old_url</span><span class="o">=</span><span class="nv">$1</span>
    <span class="nb">local </span><span class="nv">new_url</span><span class="o">=</span><span class="nv">$2</span>
    
    <span class="nb">echo</span> <span class="s2">"Updating endpoint URLs from </span><span class="nv">$old_url</span><span class="s2"> to </span><span class="nv">$new_url</span><span class="s2">"</span>
    
    <span class="c"># Find endpoints with old URL</span>
    <span class="nv">endpoints</span><span class="o">=</span><span class="si">$(</span>openstack endpoint list <span class="nt">-f</span> value <span class="nt">-c</span> ID <span class="nt">-c</span> URL | <span class="nb">grep</span> <span class="s2">"</span><span class="nv">$old_url</span><span class="s2">"</span> | <span class="nb">cut</span> <span class="nt">-d</span><span class="s1">' '</span> <span class="nt">-f1</span><span class="si">)</span>
    
    <span class="k">for </span>endpoint_id <span class="k">in</span> <span class="nv">$endpoints</span><span class="p">;</span> <span class="k">do
        </span><span class="nv">current_url</span><span class="o">=</span><span class="si">$(</span>openstack endpoint show <span class="nv">$endpoint_id</span> <span class="nt">-f</span> value <span class="nt">-c</span> url<span class="si">)</span>
        <span class="nv">updated_url</span><span class="o">=</span><span class="k">${</span><span class="nv">current_url</span><span class="p">/</span><span class="nv">$old_url</span><span class="p">/</span><span class="nv">$new_url</span><span class="k">}</span>
        
        openstack endpoint <span class="nb">set</span> <span class="nt">--url</span> <span class="s2">"</span><span class="nv">$updated_url</span><span class="s2">"</span> <span class="nv">$endpoint_id</span>
        <span class="nb">echo</span> <span class="s2">"Updated endpoint </span><span class="nv">$endpoint_id</span><span class="s2">: </span><span class="nv">$current_url</span><span class="s2"> -&gt; </span><span class="nv">$updated_url</span><span class="s2">"</span>
    <span class="k">done</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="log-analysis-and-monitoring">Log Analysis and Monitoring</h3>

<h4 id="comprehensive-log-analysis">Comprehensive Log Analysis</h4>
<script src="https://gist.github.com/somaz94/5d525f92599dd273cc90085af3b9803f.js"></script>

<h3 id="backup-and-recovery-procedures">Backup and Recovery Procedures</h3>

<h4 id="database-backup-and-recovery">Database Backup and Recovery</h4>
<script src="https://gist.github.com/somaz94/53a0c807a58d21874e7f807530b32f94.js"></script>

<hr />

<h2 id="key-points">Key Points</h2>

<div class="info-box info-box-success-not-check">
  <strong>Keystone Essentials</strong>
  <ul>
    <li>
      <strong>Core Functionality</strong><br />
      - Centralized authentication and authorization<br />
      - Role-based access control<br />
      - Service endpoint management<br />
      - Token-based security<br />
      - Multi-domain support for organization isolation
    </li>
    <li>
      <strong>Architecture</strong><br />
      - Modular backend design<br />
      - Flexible authentication methods<br />
      - Comprehensive policy engine<br />
      - Service catalog management<br />
      - High availability clustering support
    </li>
    <li>
      <strong>Key Features</strong><br />
      - User and group management<br />
      - Project and domain isolation<br />
      - Token-based authentication<br />
      - Service endpoint discovery<br />
      - LDAP and federation integration
    </li>
    <li>
      <strong>Production Considerations</strong><br />
      - Database optimization and monitoring<br />
      - Fernet key rotation automation<br />
      - Security compliance and auditing<br />
      - Performance monitoring and tuning<br />
      - Comprehensive backup and recovery procedures
    </li>
  </ul>
</div>

<p><br /></p>

<h3 id="best-practices-summary">Best Practices Summary</h3>

<div class="quote-box">
  <strong>Enterprise Keystone Deployment Guidelines:</strong>
  
  <p><strong>Security First:</strong> Implement comprehensive security measures including strong authentication, proper access controls, and regular security audits. Use federated identity when possible to leverage existing enterprise identity systems.</p>
  
  <p><strong>High Availability:</strong> Deploy Keystone in a clustered configuration with database replication, load balancing, and proper failover mechanisms to ensure service continuity.</p>
  
  <p><strong>Performance Optimization:</strong> Monitor and optimize database performance, implement proper caching strategies, and tune token expiration policies based on your organization's security requirements.</p>
  
  <p><strong>Operational Excellence:</strong> Establish automated backup procedures, implement comprehensive monitoring, and create detailed runbooks for common operational tasks and troubleshooting scenarios.</p>
</div>

<p><br /></p>

<hr />

<h2 id="references">References</h2>

<ul>
  <li><a href="https://docs.openstack.org/keystone/latest/">OpenStack Keystone Documentation</a></li>
  <li><a href="https://docs.redhat.com/openstack/">Red Hat OpenStack Platform Documentation</a></li>
  <li><a href="https://wiki.openstack.org/wiki/Keystone">OpenStack Wiki - Keystone</a></li>
  <li><a href="https://docs.openstack.org/api-ref/identity/">Keystone API Reference</a></li>
  <li><a href="https://docs.openstack.org/keystone/latest/admin/index.html">OpenStack Identity Management Guide</a></li>
  <li><a href="https://docs.openstack.org/keystone/latest/configuration/">Keystone Configuration Reference</a></li>
  <li><a href="https://docs.openstack.org/security-guide/">OpenStack Security Guide</a></li>
  <li><a href="https://docs.openstack.org/keystone/latest/admin/federation/introduction.html">Keystone Federation Documentation</a></li>
  <li><a href="https://docs.openstack.org/keystone/latest/admin/identity-ldap.html">LDAP Integration Guide</a></li>
  <li><a href="https://docs.openstack.org/keystone/latest/admin/tokens.html">Token Management Best Practices</a></li>
</ul>

<h2 id="additional-resources">Additional Resources</h2>

<h3 id="tools-and-utilities">Tools and Utilities</h3>
<ul>
  <li><strong>OpenStack CLI</strong>: <a href="https://docs.openstack.org/python-openstackclient/latest/">python-openstackclient</a></li>
  <li><strong>Keystone Management</strong>: <a href="https://docs.openstack.org/python-keystoneclient/latest/">python-keystoneclient</a></li>
  <li><strong>Federation Tools</strong>: <a href="https://pysaml2.readthedocs.io/">pysaml2</a>, <a href="https://github.com/Uninett/mod_auth_mellon">mod_auth_mellon</a></li>
  <li><strong>Monitoring</strong>: <a href="https://docs.openstack.org/operations-guide/ops-monitoring.html">OpenStack Monitoring Guide</a></li>
</ul>

<h3 id="training-and-certification">Training and Certification</h3>
<ul>
  <li><a href="https://www.openstack.org/marketplace/training/">OpenStack Foundation Training</a></li>
  <li><a href="https://www.openstack.org/coa/">Certified OpenStack Administrator (COA)</a></li>
  <li><a href="https://www.redhat.com/en/services/training/rh124-red-hat-system-administration-i">Red Hat OpenStack Training</a></li>
  <li><a href="https://www.suse.com/training/">SUSE OpenStack Cloud Training</a></li>
</ul>

<h3 id="community-resources">Community Resources</h3>
<ul>
  <li><a href="https://lists.openstack.org/">OpenStack Mailing Lists</a></li>
  <li><a href="https://docs.openstack.org/contributors/common/irc.html">OpenStack IRC Channels</a></li>
  <li><a href="https://bugs.launchpad.net/keystone">OpenStack Bug Tracker</a></li>
  <li><a href="https://www.openstack.org/summit/">OpenStack Summit Presentations</a></li>
</ul>


                <!-- Pagination links -->


            </article>

            
                <aside class="see-also">
                    <h2>See also</h2>
                    <ul>
                        
                        
                        
                            <li>
                                <a href="/category/database/database-normalization/">
                                    
                                        <img src="https://blog.kakaocdn.net/dn/GY9Lf/btsMP5uevn7/JNMOge6dsyn4R6Lx0CbQF1/img.png">
                                    
                                    <h3>Database Normalization and Denormalization: A Complete Guide</h3>
                                </a>
                            </li>
                        
                            <li>
                                <a href="/category/storage/understanding-ceph-distributed-storage-architecture/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1755077387/ceph-1_xm8avx.png">
                                    
                                    <h3>Understanding Ceph: Comprehensive Guide to Distributed Storage Architecture</h3>
                                </a>
                            </li>
                        
                            <li>
                                <a href="/category/openstack/openstack-manila/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1756180452/openstack-manila-1_qxm1na.png">
                                    
                                    <h3>Deep Dive into OpenStack Manila</h3>
                                </a>
                            </li>
                        
                    </ul>
                </aside>
            

        </section>

        <!-- Add time bar only for pages without pagination -->
        
            <div class="time-bar" data-minutes="19">
    <span class="time-completed"></span>
    <span class="time-remaining"></span>
    <div class="bar">
        <span class="completed" style="width:0%;"></span>
        <span class="remaining" style="width:100%;"></span>
    </div>
</div>

            <button class="toggle-preview" onclick="togglePreview()">
    <span>Hide Preview ▼</span>
</button>

<div id="recommendationSection" class="recommendation">
    <div class="message">
        <strong>Why don't you read something next?</strong>
        <div>
            <button>
                <svg><use xlink:href="#icon-arrow-right"></use></svg>
                <span>Go back to top</span>
            </button>
        </div>
    </div>
    <div id="previewSection" class="preview-section">
        
        <a href="/category/cs/load-average/" class="post-preview">
            <div class="image">
                
                    <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1744340441/load-average_nqzjno.png">
                
            </div>
            <h3 class="title">Load Average in top Command - What It Really Means</h3>
        </a>
    </div>
</div>

<style>
.toggle-preview {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #333;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 4px;
    cursor: pointer;
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.toggle-preview:hover {
    background: #444;
}

.toggle-preview.visible {
    opacity: 1;
}

.recommendation {
    margin-top: 1000px;
    display: block;
    transition: all 0.3s ease;
}

.recommendation.hidden {
    display: none;
}

.hide-preview {
    margin-left: 10px;
    background: none;
    border: 1px solid #666;
    color: #666;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
}

.hide-preview:hover {
    background: #f0f0f0;
}

.preview-section {
    max-height: 1000px;
    overflow: hidden;
    transition: max-height 0.3s ease-out;
}

.preview-section.hidden {
    max-height: 0;
}
</style>

<script>
function togglePreview() {
    const recommendation = document.getElementById('recommendationSection');
    const button = document.querySelector('.toggle-preview span');
    
    if (recommendation.classList.contains('hidden')) {
        recommendation.classList.remove('hidden');
        button.textContent = 'Hide Preview ▼';
    } else {
        recommendation.classList.add('hidden');
        button.textContent = 'Show Preview ▲';
    }
}

window.addEventListener('scroll', function() {
    const toggleButton = document.querySelector('.toggle-preview');
    const recommendation = document.getElementById('recommendationSection');
    const rect = recommendation.getBoundingClientRect();
    
    if (rect.top <= window.innerHeight) {
        toggleButton.classList.add('visible');
    } else {
        toggleButton.classList.remove('visible');
    }
});
</script>

        

        <!-- Show modal if the post is the last one -->
        

        <!-- Show modal before user leaves the page -->
        

        <!-- Add your newsletter subscription form here -->

        <section class="share">
    <h3>Share</h3>
    <a aria-label="Share on Twitter" href="https://twitter.com/intent/tweet?text=&quot;A comprehensive guide to OpenStack Keystone, its architecture, and how it manages authentication and authorization in the cloud&quot;%20https://somaz.blog/category/openstack/openstack-keystone/%20via%20&#64;twitter_username&hashtags=openstack,keystone,identity,authentication,authorization,cloud"
    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Share on Twitter">
        <svg class="icon icon-twitter"><use xlink:href="#icon-twitter"></use></svg>
    </a>
    <a aria-label="Share on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://somaz.blog/category/openstack/openstack-keystone/"
    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook">
        <svg class="icon icon-facebook"><use xlink:href="#icon-facebook"></use></svg>
    </a>
</section>

        

  <section class="author">
    <div class="details">
      
        <img class="img-rounded" src="/assets/img/uploads/profile.png" alt="Somaz">
      
      <p class="def">Author</p>
      <h3 class="name">
        <a href="/authors/somaz/">Somaz</a>
      </h3>
      <p class="desc">DevOps engineer focused on cloud infrastructure and automation</p>
      <p>
        
          <a href="https://github.com/somaz94" title="Github">
            <svg><use xlink:href="#icon-github"></use></svg>
          </a>
        
        
        
        
        
        
          <a href="https://www.linkedin.com/in/somaz" title="LinkedIn">
            <svg><use xlink:href="#icon-linkedin"></use></svg>
          </a>
        
        
          <a href="https://somaz.tistory.com" title="Tistory">
            <svg><use xlink:href="#icon-tistory"></use></svg>
          </a>
        
      </p>
    </div>
  </section>

  
  
  
  
  
  
  
  

  <script type="application/ld+json">
  {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "Somaz",
      
      "image": "/assets/img/uploads/profile.png",
      
      "jobTitle": "DevOps Engineer",
      "url": "https://somaz.blog/authors/somaz/",
      "sameAs": [
        "https://github.com/somaz94","https://www.linkedin.com/in/somaz","https://{{ author.tistory_username }}.tistory.com"
      ]
  }
  </script>


        

<section class="comments">
    <h3>Comments</h3>
    <div id="disqus_thread"></div>
</section>
<script type="text/javascript">
    var disqus_loaded = false;

    function load_disqus()
    {
        disqus_loaded = true;
        var disqus_shortname = 'https-somaz94-github-io';
        var disqus_title = '';
        var disqus_url = '/category/openstack/openstack-keystone/';
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        var ldr = document.getElementById('disqus_loader');
    };
    window.onscroll = function(e) {
        if ((window.innerHeight + window.scrollY) >= (document.body.offsetHeight - 800)) {
            //hit bottom of page
            if (disqus_loaded==false)
                load_disqus()
        }
    };
</script>



        <footer>
    <p>
      
        <a href="https://github.com/somaz94" title="Github">
          <svg><use xlink:href="#icon-github"></use></svg>
        </a>
      
      
        <a href="https://www.facebook.com/facebook_username" title="Facebook">
          <svg><use xlink:href="#icon-facebook"></use></svg>
        </a>
      
      
        <a href="https://twitter.com/twitter_username" title="Twitter">
          <svg><use xlink:href="#icon-twitter"></use></svg>
        </a>
      
      
        <a href="https://medium.com/@medium_username" title="Medium">
          <svg><use xlink:href="#icon-medium"></use></svg>
        </a>
      
      
        <a href="https://www.instagram.com/instagram_username" title="Instagram">
          <svg><use xlink:href="#icon-instagram"></use></svg>
        </a>
      
      
        <a href="https://www.linkedin.com/in/somaz" title="LinkedIn">
          <svg><use xlink:href="#icon-linkedin"></use></svg>
        </a>
      
      
        <a href="https://somaz.tistory.com" title="Tistory">
          <svg><use xlink:href="#icon-tistory"></use></svg>
        </a>
      
    </p>

    <ul>
  
    
      <li>
        <a href="https://somaz.blog/">Home</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/about">About</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/category">Category</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/contact">Contact</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/feed.xml">Feed</a>
      </li>
    
  
</ul>


    <p>
      <a href="https://somaz.blog/sitemap.xml" title="sitemap">Sitemap</a> |
      <a href="https://somaz.blog/privacy-policy" title="Privacy Policy">Privacy Policy</a>
    </p>

    <p>
      <span>Somaz Tech Blog</span> <svg class="love"><use xlink:href="#icon-heart"></use></svg>
    </p>
</footer>










<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "somaz",
  "description": "DevOps engineer's tech blog.",
  "url": "https://somaz.blog/",
  "logo": {
      "@type": "ImageObject",
      "url": "https://somaz.blog/assets/img/icons/mediumtile.png",
      "width": "600",
      "height": "315"
  },
  "sameAs": [
    "https://github.com/somaz94","https://www.facebook.com/facebook_username","https://twitter.com/twitter_username","https://medium.com/@medium_username","https://www.instagram.com/instagram_username","https://www.linkedin.com/in/somaz","https://{{ site.tistory_username }}.tistory.com"
  ]
}
</script>

<!-- Include the script that allows Netlify CMS login -->
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

<!-- Include the website scripts -->
<script src="/assets/js/scripts.min.js"></script>

<!-- Include Google Analytics script -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-XXXXXXXX-X"></script>
<script>
  var host = window.location.hostname;
  if (host != 'localhost') {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-XXXXXXXX-X');
  }
</script>
  


<!-- Include extra scripts -->



        

        
        
        
        
        
        
        
        
        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "BlogPosting",
            "name": "Deep Dive into OpenStack Keystone",
            "headline": "Understanding OpenStack's Identity Service",
            "description": "A comprehensive guide to OpenStack Keystone, its architecture, and how it manages authentication and authorization in the cloud",
            "image": "https://res.cloudinary.com/dkcm26aem/image/upload/v1756113434/openstack-keystone-1_s3qt85.png",
            "url": "https://somaz.blog/category/openstack/openstack-keystone/",
            "articleBody": "



Understanding OpenStack Keystone

Keystone is OpenStack’s identity service that provides centralized authentication and authorization for all OpenStack services.

It manages users, projects, and their access to various OpenStack resources through a token-based authentication system.



What is Keystone?



The Identity Management Service

Keystone serves as the central identity service in OpenStack, providing essential functionality:


  Authentication: Verifies user identity and credentials
  Authorization: Manages access control and permissions
  Service Catalog: Maintains service endpoints and URLs
  Token Management: Issues and validates access tokens
  Multi-tenancy: Enables resource isolation through projects and domains
  Federation: Supports identity federation with external systems



  As the security backbone of OpenStack, Keystone ensures secure access to cloud resources while maintaining multi-tenancy and role-based access control.




Keystone Architecture Overview (Diagram Description)


  OpenStack Keystone
    
      Core Services: Identity Backend, Token Backend, Policy Backend, Catalog Backend
      Identity Management: Users &amp;amp; Groups, Projects, Domains
      Access Control: Roles, Permissions, Policies
      Service Integration: Service Endpoints, API Integration, Token Validation
    
  



  
    graph LR
      A[OpenStack Keystone]
      A --&amp;gt; B[Core Services]
      A --&amp;gt; C[Identity Management]
      A --&amp;gt; D[Access Control]
      A --&amp;gt; E[Service Integration]
      
      B --&amp;gt; B1[Identity Backend]
      B --&amp;gt; B2[Token Backend]
      B --&amp;gt; B3[Policy Backend]
      B --&amp;gt; B4[Catalog Backend]
      
      C --&amp;gt; C1[Users &amp;amp; Groups]
      C --&amp;gt; C2[Projects]
      C --&amp;gt; C3[Domains]
      
      D --&amp;gt; D1[Roles]
      D --&amp;gt; D2[Permissions]
      D --&amp;gt; D3[Policies]
      
      E --&amp;gt; E1[Service Endpoints]
      E --&amp;gt; E2[API Integration]
      E --&amp;gt; E3[Token Validation]

      style A stroke:#333,stroke-width:1px,fill:#f5f5f5
      style B stroke:#333,stroke-width:1px,fill:#a5d6a7
      style C stroke:#333,stroke-width:1px,fill:#64b5f6
      style D stroke:#333,stroke-width:1px,fill:#ffcc80
      style E stroke:#333,stroke-width:1px,fill:#ce93d8
  




Keystone vs Other Identity Systems


  
    
      Aspect
      OpenStack Keystone
      AWS IAM
      Azure Active Directory
    
    
      Primary Focus
      OpenStack cloud identity management
      AWS service access control
      Enterprise directory services
    
    
      Authentication
      Token-based, LDAP, Database
      Access keys, temporary credentials
      SAML, OAuth, OpenID Connect
    
    
      Multi-tenancy
      Projects and domains
      AWS accounts
      Tenants and directories
    
    
      Federation
      SAML, OIDC support
      Cross-account roles
      Native federation capabilities
    
    
      Use Case
      Private/hybrid cloud
      Public cloud services
      Enterprise applications
    
  






Keystone Architecture and Components

Keystone employs a modular architecture with multiple backend services that work together to provide comprehensive identity management.

This design enables flexible authentication methods and robust access control across the OpenStack cloud.



Core Components


  
    
      Component
      Role
      Description
    
    
      Identity Backend
      User Management
      
        
          Manages user and group authentication
          Supports LDAP and SQL database integration
          Handles user credentials and profiles
          Provides identity verification services
        
      
    
    
      Token Backend
      Session Management
      
        
          Issues temporary access tokens
          Manages token lifecycle
          Handles token validation
          Supports token revocation
        
      
    
    
      Policy Backend
      Access Control
      
        
          Manages role-based access control
          Defines access policies
          Enforces permission rules
          Handles authorization decisions
        
      
    
    
      Catalog Backend
      Service Management
      
        
          Maintains service endpoints
          Manages service URLs
          Handles service discovery
          Provides endpoint information
        
      
    
  




Authentication Flow

Sequence Diagram Description


  User/Service sends authentication request to Keystone
  Keystone validates credentials
  Keystone issues token to User/Service
  User/Service requests OpenStack service with token
  Service validates token with Keystone
  Service responds to User/Service



  
    sequenceDiagram
      participant User as &quot;User/Service&quot;
      participant Keystone as &quot;Keystone&quot;
      participant Service as &quot;OpenStack Service&quot;
      
      User-&amp;gt;&amp;gt;Keystone: Authentication Request
      Keystone-&amp;gt;&amp;gt;Keystone: Validate Credentials
      Keystone--&amp;gt;&amp;gt;User: Issue Token
      User-&amp;gt;&amp;gt;Service: Request with Token
      Service-&amp;gt;&amp;gt;Keystone: Validate Token
      Keystone--&amp;gt;&amp;gt;Service: Token Valid
      Service--&amp;gt;&amp;gt;User: Service Response
  




Key Concepts

Keystone manages several key concepts:


  Domains: Top-level containers for users, groups, and projects
  Projects: Resource isolation units (formerly tenants)
  Users &amp;amp; Groups: Individual accounts and collections
  Roles: Access control definitions
  Tokens: Temporary access credentials
  Endpoints: Service access points


These concepts work together to provide comprehensive identity and access management.





Installation and Configuration

Setting up Keystone requires careful planning and configuration.

This section covers installation methods, database setup, and initial configuration for production environments.



Prerequisites and Requirements

System Requirements


Configuration File Setup


Apache HTTP Server Configuration
# /etc/apache2/sites-available/keystone.conf
Listen 5000

&amp;lt;VirtualHost *:5000&amp;gt;
    WSGIDaemonProcess keystone-public processes=5 threads=1 user=keystone group=keystone display-name=%{GROUP}
    WSGIProcessGroup keystone-public
    WSGIScriptAlias / /usr/bin/keystone-wsgi-public
    WSGIApplicationGroup %{GLOBAL}
    WSGIPassAuthorization On
    LimitRequestBody 114688
    
    ErrorLogFormat &quot;%{cu}t %M&quot;
    ErrorLog /var/log/apache2/keystone.log
    CustomLog /var/log/apache2/keystone_access.log combined
    
    &amp;lt;Directory /usr/bin&amp;gt;
        Require all granted
    &amp;lt;/Directory&amp;gt;
&amp;lt;/VirtualHost&amp;gt;

# Enable the site and restart Apache
sudo a2ensite keystone
sudo systemctl restart apache2






Advanced Configuration and Integration

Advanced Keystone deployments require integration with external systems, high availability setup, and comprehensive security configurations.



LDAP Integration

Active Directory Integration
# /etc/keystone/keystone.conf - LDAP configuration
[identity]
driver = ldap
default_domain_id = default

[ldap]
url = ldap://ad.example.com:389
user = cn=keystone,ou=service-accounts,dc=example,dc=com
password = service_account_password
suffix = dc=example,dc=com

# User configuration
user_tree_dn = ou=users,dc=example,dc=com
user_objectclass = person
user_id_attribute = sAMAccountName
user_name_attribute = sAMAccountName
user_mail_attribute = mail
user_enabled_attribute = userAccountControl
user_enabled_mask = 2
user_enabled_default = 512

# Group configuration
group_tree_dn = ou=groups,dc=example,dc=com
group_objectclass = group
group_id_attribute = cn
group_name_attribute = cn
group_member_attribute = member
group_desc_attribute = description

# Query configuration
query_scope = sub
page_size = 1000
alias_dereferencing = never
debug_level = 0

# Connection pool
use_pool = true
pool_size = 10
pool_retry_max = 3
pool_retry_delay = 0.1
pool_connection_timeout = -1
pool_connection_lifetime = 600

# TLS configuration
use_tls = true
tls_cacertfile = /etc/ssl/certs/ca-certificates.crt
tls_req_cert = demand


Multi-Domain LDAP Setup
#!/bin/bash
# Script to configure multiple LDAP domains

# Create domain-specific configuration files
sudo mkdir -p /etc/keystone/domains

# Engineering domain
cat &amp;gt; /etc/keystone/domains/keystone.engineering.conf &amp;lt;&amp;lt; EOF
[ldap]
url = ldap://engineering.example.com:389
user = cn=keystone,ou=service,dc=engineering,dc=example,dc=com
password = eng_service_password
suffix = dc=engineering,dc=example,dc=com
user_tree_dn = ou=users,dc=engineering,dc=example,dc=com
group_tree_dn = ou=groups,dc=engineering,dc=example,dc=com
EOF

# Sales domain
cat &amp;gt; /etc/keystone/domains/keystone.sales.conf &amp;lt;&amp;lt; EOF
[ldap]
url = ldap://sales.example.com:389
user = cn=keystone,ou=service,dc=sales,dc=example,dc=com
password = sales_service_password
suffix = dc=sales,dc=example,dc=com
user_tree_dn = ou=users,dc=sales,dc=example,dc=com
group_tree_dn = ou=groups,dc=sales,dc=example,dc=com
EOF

# Set proper permissions
sudo chown keystone:keystone /etc/keystone/domains/*
sudo chmod 640 /etc/keystone/domains/*

# Create domains in Keystone
openstack domain create --description &quot;Engineering Department&quot; engineering
openstack domain create --description &quot;Sales Department&quot; sales


High Availability Configuration

Multi-Node Keystone Setup
#!/bin/bash
# High availability Keystone deployment script

# Configure shared database (Galera cluster)
# /etc/mysql/mariadb.conf.d/99-galera.cnf
cat &amp;gt; /etc/mysql/mariadb.conf.d/99-galera.cnf &amp;lt;&amp;lt; EOF
[galera]
wsrep_on=ON
wsrep_provider=/usr/lib/galera/libgalera_smm.so
wsrep_cluster_address=&quot;gcomm://controller1,controller2,controller3&quot;
wsrep_cluster_name=&quot;openstack&quot;
wsrep_node_address=&quot;$(hostname -I | awk &apos;{print $1}&apos;)&quot;
wsrep_node_name=&quot;$(hostname)&quot;
wsrep_sst_method=rsync
binlog_format=row
default_storage_engine=InnoDB
innodb_autoinc_lock_mode=2
bind-address=0.0.0.0
EOF

# Shared Fernet keys setup
# Sync Fernet keys across all nodes
rsync -av /etc/keystone/fernet-keys/ controller2:/etc/keystone/fernet-keys/
rsync -av /etc/keystone/fernet-keys/ controller3:/etc/keystone/fernet-keys/

# Load balancer configuration (HAProxy)
cat &amp;gt;&amp;gt; /etc/haproxy/haproxy.cfg &amp;lt;&amp;lt; EOF
listen keystone_admin_cluster
  bind 10.0.0.100:35357
  balance source
  option httpchk
  option httplog
  option httpclose
  server controller1 10.0.0.11:35357 check inter 2000 rise 2 fall 5
  server controller2 10.0.0.12:35357 check inter 2000 rise 2 fall 5
  server controller3 10.0.0.13:35357 check inter 2000 rise 2 fall 5

listen keystone_public_cluster
  bind 10.0.0.100:5000
  balance source
  option httpchk
  option httplog
  option httpclose
  server controller1 10.0.0.11:5000 check inter 2000 rise 2 fall 5
  server controller2 10.0.0.12:5000 check inter 2000 rise 2 fall 5
  server controller3 10.0.0.13:5000 check inter 2000 rise 2 fall 5
EOF

systemctl restart haproxy


Federation and SAML Integration

SAML2 Federation Setup
&amp;lt;!-- /etc/keystone/saml2_idp_metadata.xml --&amp;gt;
&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;
&amp;lt;md:EntityDescriptor xmlns:md=&quot;urn:oasis:names:tc:SAML:2.0:metadata&quot;
                     entityID=&quot;https://idp.example.com/simplesaml/saml2/idp/metadata.php&quot;&amp;gt;
  &amp;lt;md:IDPSSODescriptor WantAuthnRequestsSigned=&quot;false&quot;
                       protocolSupportEnumeration=&quot;urn:oasis:names:tc:SAML:2.0:protocol&quot;&amp;gt;
    &amp;lt;md:SingleSignOnService Binding=&quot;urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect&quot;
                            Location=&quot;https://idp.example.com/simplesaml/saml2/idp/SSOService.php&quot;/&amp;gt;
    &amp;lt;md:SingleSignOnService Binding=&quot;urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST&quot;
                            Location=&quot;https://idp.example.com/simplesaml/saml2/idp/SSOService.php&quot;/&amp;gt;
  &amp;lt;/md:IDPSSODescriptor&amp;gt;
&amp;lt;/md:EntityDescriptor&amp;gt;


# Federation configuration in keystone.conf
[federation]
driver = sql
assertion_prefix = ADFS_
remote_id_attribute = ADFS_CLAIMS

[saml]
certfile = /etc/keystone/ssl/certs/keystone.pem
keyfile = /etc/keystone/ssl/private/keystone.key
idp_entity_id = https://idp.example.com/simplesaml/saml2/idp/metadata.php
idp_sso_endpoint = https://idp.example.com/simplesaml/saml2/idp/SSOService.php
idp_metadata_path = /etc/keystone/saml2_idp_metadata.xml


# Configure federation
openstack identity provider create --remote-id https://idp.example.com/simplesaml/saml2/idp/metadata.php saml2_idp

openstack mapping create --rules mapping_rules.json saml_mapping

openstack federation protocol create --identity-provider saml2_idp --mapping saml_mapping saml2




Access Control and Authorization

Keystone provides robust access control mechanisms through role-based access control (RBAC) and policy-based authorization.

This enables fine-grained control over resource access while maintaining security and compliance.



Role-Based Access Control


  
    
      Component
      Description
      Use Cases
    
    
      Roles
      Define access permissions for users and groups
      
        
          Admin access
          Developer access
          Read-only access
        
      
    
    
      Projects
      Isolate resources and manage access
      
        
          Resource isolation
          Multi-tenant environments
          Project-based access
        
      
    
    
      Domains
      Group related resources and users
      
        
          Organization separation
          Department isolation
          Resource grouping
        
      
    
  




Service Integration

Keystone integrates with various OpenStack services:


  Nova Integration: Manages compute service access
  Neutron Integration: Controls network service access
  Glance Integration: Handles image service access
  Cinder Integration: Manages storage service access


This integration ensures consistent authentication and authorization across all OpenStack services.





Practical Operations and Management

Effective Keystone management requires understanding daily operations, troubleshooting techniques, and performance optimization strategies for production environments.



User and Project Management

Command-Line Administration


User Lifecycle Management


Token Management and Security

Token Lifecycle Management


Performance Monitoring and Optimization

Performance Metrics Collection




Usage and Best Practices

Effective use of Keystone requires understanding its capabilities and implementing appropriate security practices.

Here are key considerations and best practices for utilizing Keystone effectively.



Security Strategies


  
    
      Strategy
      Description
      Benefits
    
    
      Role Management
      Implement least privilege principle
      
        
          Enhanced security
          Reduced risk
          Better control
        
      
    
    
      Token Security
      Manage token lifecycle and security
      
        
          Secure access
          Session control
          Access tracking
        
      
    
    
      Policy Management
      Define clear access policies
      
        
          Consistent access
          Clear permissions
          Audit compliance
        
      
    
  




Implementation Guidelines

For effective Keystone implementation:


  Security Planning: Implement comprehensive security measures
  Role Design: Create clear role hierarchies
  Token Management: Configure appropriate token lifetimes
  Monitoring: Track authentication and access patterns


Following these guidelines helps ensure secure and efficient identity management.





Troubleshooting and Maintenance

Effective troubleshooting requires understanding common issues, log analysis techniques, and maintenance procedures for Keystone deployments.



Common Issues and Solutions

Authentication and Token Issues
#!/bin/bash
# Keystone troubleshooting toolkit

# Diagnose authentication failures
diagnose_auth_failures() {
    local log_file=&quot;/var/log/keystone/keystone.log&quot;
    local user_name=$1
    
    echo &quot;Diagnosing authentication issues for user: $user_name&quot;
    
    # Check recent authentication attempts
    echo &quot;Recent authentication attempts:&quot;
    grep &quot;$user_name&quot; $log_file | grep -E &quot;(authentication|failed|success)&quot; | tail -10
    
    # Check user status
    user_info=$(openstack user show $user_name --format json 2&amp;gt;/dev/null)
    if [[ $? -eq 0 ]]; then
        enabled=$(echo $user_info | jq -r &apos;.enabled&apos;)
        echo &quot;User enabled: $enabled&quot;
        
        if [[ $enabled == &quot;false&quot; ]]; then
            echo &quot;ISSUE: User account is disabled&quot;
        fi
    else
        echo &quot;ISSUE: User not found&quot;
    fi
    
    # Check password policy violations
    echo &quot;Checking password policy violations:&quot;
    grep &quot;$user_name&quot; $log_file | grep -i &quot;password&quot; | grep -E &quot;(expired|policy|violation)&quot; | tail -5
    
    # Check account lockout
    lockout_count=$(grep &quot;$user_name&quot; $log_file | grep &quot;lockout&quot; | wc -l)
    if [[ $lockout_count -gt 0 ]]; then
        echo &quot;WARNING: Account lockout detected ($lockout_count occurrences)&quot;
    fi
}

# Fix common token issues
fix_token_issues() {
    echo &quot;Checking and fixing token-related issues...&quot;
    
    # Check Fernet key permissions
    echo &quot;Checking Fernet key permissions:&quot;
    ls -la /etc/keystone/fernet-keys/
    
    # Fix permissions if needed
    sudo chown -R keystone:keystone /etc/keystone/fernet-keys/
    sudo chmod 600 /etc/keystone/fernet-keys/*
    
    # Check key rotation status
    echo &quot;Fernet key rotation status:&quot;
    key_count=$(ls /etc/keystone/fernet-keys/ | wc -l)
    echo &quot;Number of Fernet keys: $key_count&quot;
    
    if [[ $key_count -lt 2 ]]; then
        echo &quot;WARNING: Insufficient Fernet keys, rotating...&quot;
        sudo keystone-manage fernet_rotate --keystone-user keystone --keystone-group keystone
    fi
    
    # Clean token cache
    echo &quot;Cleaning token cache...&quot;
    if command -v memcached &amp;amp;&amp;gt; /dev/null; then
        echo &quot;flush_all&quot; | nc localhost 11211
        echo &quot;Memcached cache cleared&quot;
    fi
    
    # Restart Keystone services
    echo &quot;Restarting Keystone services...&quot;
    sudo systemctl restart apache2
    echo &quot;Services restarted&quot;
}

# Database connectivity check
check_database_connectivity() {
    local db_host=&quot;localhost&quot;
    local db_user=&quot;keystone&quot;
    local db_pass=&quot;$KEYSTONE_DB_PASS&quot;
    local db_name=&quot;keystone&quot;
    
    echo &quot;Checking database connectivity...&quot;
    
    # Test connection
    if mysql -h $db_host -u $db_user -p$db_pass -e &quot;USE $db_name; SELECT 1;&quot; &amp;amp;&amp;gt;/dev/null; then
        echo &quot;Database connection: OK&quot;
        
        # Check table integrity
        echo &quot;Checking table integrity:&quot;
        tables=$(mysql -h $db_host -u $db_user -p$db_pass $db_name -e &quot;SHOW TABLES;&quot; | grep -v Tables)
        
        for table in $tables; do
            count=$(mysql -h $db_host -u $db_user -p$db_pass $db_name -e &quot;SELECT COUNT(*) FROM $table;&quot; | tail -1)
            echo &quot;Table $table: $count rows&quot;
        done
    else
        echo &quot;ERROR: Database connection failed&quot;
        echo &quot;Check database credentials and network connectivity&quot;
    fi
}


Service Integration Problems
#!/bin/bash
# Service integration troubleshooting

# Check service catalog issues
check_service_catalog() {
    echo &quot;Checking service catalog configuration...&quot;
    
    # List all services
    openstack service list --format table
    
    # Check for missing endpoints
    services=$(openstack service list -f value -c ID)
    
    for service_id in $services; do
        service_name=$(openstack service show $service_id -f value -c name)
        endpoint_count=$(openstack endpoint list --service $service_id -f value | wc -l)
        
        if [[ $endpoint_count -eq 0 ]]; then
            echo &quot;WARNING: Service &apos;$service_name&apos; has no endpoints&quot;
        elif [[ $endpoint_count -lt 3 ]]; then
            echo &quot;WARNING: Service &apos;$service_name&apos; missing some endpoint types&quot;
        fi
    done
}

# Test service connectivity
test_service_connectivity() {
    local service_name=$1
    
    echo &quot;Testing connectivity to $service_name service...&quot;
    
    # Get service endpoints
    endpoints=$(openstack endpoint list --service $service_name -f value -c URL)
    
    for endpoint in $endpoints; do
        echo &quot;Testing endpoint: $endpoint&quot;
        
        # Test HTTP connectivity
        if curl -s --connect-timeout 5 &quot;$endpoint/health&quot; &amp;amp;&amp;gt;/dev/null; then
            echo &quot;  Status: OK&quot;
        elif curl -s --connect-timeout 5 &quot;$endpoint&quot; &amp;amp;&amp;gt;/dev/null; then
            echo &quot;  Status: Reachable (no health endpoint)&quot;
        else
            echo &quot;  Status: FAILED&quot;
        fi
    done
}

# Fix endpoint URLs
fix_endpoint_urls() {
    local old_url=$1
    local new_url=$2
    
    echo &quot;Updating endpoint URLs from $old_url to $new_url&quot;
    
    # Find endpoints with old URL
    endpoints=$(openstack endpoint list -f value -c ID -c URL | grep &quot;$old_url&quot; | cut -d&apos; &apos; -f1)
    
    for endpoint_id in $endpoints; do
        current_url=$(openstack endpoint show $endpoint_id -f value -c url)
        updated_url=${current_url/$old_url/$new_url}
        
        openstack endpoint set --url &quot;$updated_url&quot; $endpoint_id
        echo &quot;Updated endpoint $endpoint_id: $current_url -&amp;gt; $updated_url&quot;
    done
}


Log Analysis and Monitoring

Comprehensive Log Analysis


Backup and Recovery Procedures

Database Backup and Recovery




Key Points


  Keystone Essentials
  
    
      Core Functionality
      - Centralized authentication and authorization
      - Role-based access control
      - Service endpoint management
      - Token-based security
      - Multi-domain support for organization isolation
    
    
      Architecture
      - Modular backend design
      - Flexible authentication methods
      - Comprehensive policy engine
      - Service catalog management
      - High availability clustering support
    
    
      Key Features
      - User and group management
      - Project and domain isolation
      - Token-based authentication
      - Service endpoint discovery
      - LDAP and federation integration
    
    
      Production Considerations
      - Database optimization and monitoring
      - Fernet key rotation automation
      - Security compliance and auditing
      - Performance monitoring and tuning
      - Comprehensive backup and recovery procedures
    
  




Best Practices Summary


  Enterprise Keystone Deployment Guidelines:
  
  Security First: Implement comprehensive security measures including strong authentication, proper access controls, and regular security audits. Use federated identity when possible to leverage existing enterprise identity systems.
  
  High Availability: Deploy Keystone in a clustered configuration with database replication, load balancing, and proper failover mechanisms to ensure service continuity.
  
  Performance Optimization: Monitor and optimize database performance, implement proper caching strategies, and tune token expiration policies based on your organization&apos;s security requirements.
  
  Operational Excellence: Establish automated backup procedures, implement comprehensive monitoring, and create detailed runbooks for common operational tasks and troubleshooting scenarios.






References


  OpenStack Keystone Documentation
  Red Hat OpenStack Platform Documentation
  OpenStack Wiki - Keystone
  Keystone API Reference
  OpenStack Identity Management Guide
  Keystone Configuration Reference
  OpenStack Security Guide
  Keystone Federation Documentation
  LDAP Integration Guide
  Token Management Best Practices


Additional Resources

Tools and Utilities

  OpenStack CLI: python-openstackclient
  Keystone Management: python-keystoneclient
  Federation Tools: pysaml2, mod_auth_mellon
  Monitoring: OpenStack Monitoring Guide


Training and Certification

  OpenStack Foundation Training
  Certified OpenStack Administrator (COA)
  Red Hat OpenStack Training
  SUSE OpenStack Cloud Training


Community Resources

  OpenStack Mailing Lists
  OpenStack IRC Channels
  OpenStack Bug Tracker
  OpenStack Summit Presentations

",
            "wordcount": "3447",
            "inLanguage": "en",
            "dateCreated": "2025-06-21/",
            "datePublished": "2025-06-21/",
            "dateModified": "2025-06-21/",
            "author": {
                "@type": "Person",
                "name": "Somaz",
                
                "image": "/assets/img/uploads/profile.png",
                
                "jobTitle": "DevOps Engineer",
                "url": "https://somaz.blog/authors/somaz/",
                "sameAs": [
                    "https://github.com/somaz94","https://www.linkedin.com/in/somaz"
                ]
            },
            "publisher": {
                "@type": "Organization",
                "name": "somaz",
                "url": "https://somaz.blog/",
                "logo": {
                    "@type": "ImageObject",
                    "url": "https://somaz.blog/assets/img/blog-image.png",
                    "width": "600",
                    "height": "315"
                }
            },
            "mainEntityOfPage": "True",
            "genre": "OPENSTACK",
            "articleSection": "OPENSTACK",
            "keywords": ["openstack","keystone","identity","authentication","authorization","cloud"]
        }
        </script>
    </body>
</html>
