<!DOCTYPE html>
<html lang="en" class="no-js">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    

    
    

    
    

    
    

    <!-- ✅ Google Tag Manager 추가 -->
    <script>
        (function(w,d,s,l,i){
            w[l]=w[l]||[];
            w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
            var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
            j.async=true;
            j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
            f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-MBP83N4Q');
    </script>
      <!-- ✅ End Google Tag Manager -->

    <!-- Mermaid.js 직접 로드 -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>

    <title>Installing and Configuring HashiCorp Vault on Kubernetes | somaz</title>
    <meta name="description" content="Learn how to install, initialize, and configure HashiCorp Vault on Kubernetes using Kind">
    
        <meta name="keywords" content="vault, kubernetes, security, kind">
    

    <!-- Social: Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Installing and Configuring HashiCorp Vault on Kubernetes | somaz">
    <meta name="twitter:description" content="Learn how to install, initialize, and configure HashiCorp Vault on Kubernetes using Kind">

    
        <meta property="twitter:image" content="https://res.cloudinary.com/dkcm26aem/image/upload/v1737704919/vault_i9zrin.png">
    
    
    
        <meta name="twitter:site" content="@twitter_username">
    

    <!-- Social: Facebook / Open Graph -->
    <meta property="og:url" content="https://somaz.blog/category/security/vault-install-configure/">
    <meta property="og:title" content="Installing and Configuring HashiCorp Vault on Kubernetes | somaz">
    <meta property="og:image" content="https://res.cloudinary.com/dkcm26aem/image/upload/v1737704919/vault_i9zrin.png">
    <meta property="og:description" content="Learn how to install, initialize, and configure HashiCorp Vault on Kubernetes using Kind">
    <meta property="og:site_name" content="Somaz Tech Blog">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/assets/img/icons/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/img/icons/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/img/icons/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/img/icons/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/img/icons/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/img/icons/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/img/icons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/icons/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/img/icons/apple-touch-icon-152x152.png" />

    <!-- Windows 8 Tile Icons -->
    <meta name="application-name" content="somaz">
    <meta name="msapplication-TileColor" content="#141414">
    <meta name="msapplication-square70x70logo" content="smalltile.png" />
    <meta name="msapplication-square150x150logo" content="mediumtile.png" />
    <meta name="msapplication-wide310x150logo" content="widetile.png" />
    <meta name="msapplication-square310x310logo" content="largetile.png" />
    
    <!-- Android Lolipop Theme Color -->
    <meta name="theme-color" content="#141414">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Titillium+Web:300,400,700" rel="stylesheet">

    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="canonical" href="https://somaz.blog/category/security/vault-install-configure/">
    <link rel="alternate" type="application/rss+xml" title="Somaz Tech Blog" href="https://somaz.blog/feed.xml" />

    <!-- Include extra styles -->
    

    <!-- JavaScript enabled/disabled -->
    <script>
        document.querySelector('html').classList.remove('no-js');
    </script>

    <!-- Google Adsense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8725590811736154"
        crossorigin="anonymous"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"> -->
    <!-- <link href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/variable/woff2/SUIT-Variable.css" rel="stylesheet"> -->
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- <link href="https://fonts.googleapis.com/css2?family=Albert+Sans:wght@400;500;700&display=swap" rel="stylesheet"> -->

    <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml" />

</head>
<!-- ✅ Google Tag Manager (noscript) -->
<noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MBP83N4Q"
            height="0" width="0" style="display:none;visibility:hidden">
    </iframe>
</noscript>
<!-- ✅ End Google Tag Manager (noscript) -->
    <body class="has-push-menu">
        





        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" display="none" version="1.1"><defs><symbol id="icon-menu" viewBox="0 0 1024 1024"><path class="path1" d="M128 213.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 725.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 469.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5z"/></symbol><symbol id="icon-search" viewBox="0 0 951 1024"><path class="path1" d="M658.286 475.429q0-105.714-75.143-180.857t-180.857-75.143-180.857 75.143-75.143 180.857 75.143 180.857 180.857 75.143 180.857-75.143 75.143-180.857zM950.857 950.857q0 29.714-21.714 51.429t-51.429 21.714q-30.857 0-51.429-21.714l-196-195.429q-102.286 70.857-228 70.857-81.714 0-156.286-31.714t-128.571-85.714-85.714-128.571-31.714-156.286 31.714-156.286 85.714-128.571 128.571-85.714 156.286-31.714 156.286 31.714 128.571 85.714 85.714 128.571 31.714 156.286q0 125.714-70.857 228l196 196q21.143 21.143 21.143 51.429z"/></symbol><symbol id="icon-close" viewBox="0 0 1000 1000"><path d="M969.8,870.3c27,27.7,27,71.8,0,99.1C955.7,983,937.9,990,920,990c-17.9,0-35.7-7-49.7-20.7L500,599L129.6,969.4C115.6,983,97.8,990,79.9,990s-35.7-7-49.7-20.7c-27-27.3-27-71.4,0-99.1L400.9,500L30.3,129.3c-27-27.3-27-71.4,0-99.1c27.3-27,71.8-27,99.4,0L500,400.9L870.4,30.2c27.7-27,71.8-27,99.4,0c27,27.7,27,71.8,0,99.1L599.1,500L969.8,870.3z"/></symbol><symbol id="icon-twitter" viewBox="0 0 951 1024"><path class="path1" d="M925.714 233.143q-38.286 56-92.571 95.429 0.571 8 0.571 24 0 74.286-21.714 148.286t-66 142-105.429 120.286-147.429 83.429-184.571 31.143q-154.857 0-283.429-82.857 20 2.286 44.571 2.286 128.571 0 229.143-78.857-60-1.143-107.429-36.857t-65.143-91.143q18.857 2.857 34.857 2.857 24.571 0 48.571-6.286-64-13.143-106-63.714t-42-117.429v-2.286q38.857 21.714 83.429 23.429-37.714-25.143-60-65.714t-22.286-88q0-50.286 25.143-93.143 69.143 85.143 168.286 136.286t212.286 56.857q-4.571-21.714-4.571-42.286 0-76.571 54-130.571t130.571-54q80 0 134.857 58.286 62.286-12 117.143-44.571-21.143 65.714-81.143 101.714 53.143-5.714 106.286-28.571z"/></symbol><symbol id="icon-facebook" viewBox="0 0 585 1024"><path class="path1" d="M548 6.857v150.857h-89.714q-49.143 0-66.286 20.571t-17.143 61.714v108h167.429l-22.286 169.143h-145.143v433.714h-174.857v-433.714h-145.714v-169.143h145.714v-124.571q0-106.286 59.429-164.857t158.286-58.571q84 0 130.286 6.857z"/></symbol><symbol id="icon-clock" viewBox="0 0 1000 1000"><path d="M500,10C229.8,10,10,229.8,10,500c0,270.2,219.8,490,490,490c270.2,0,490-219.8,490-490C990,229.8,770.2,10,500,10z M500,910.2c-226.2,0-410.2-184-410.2-410.2c0-226.2,184-410.2,410.2-410.2c226.2,0,410.2,184,410.2,410.2C910.2,726.1,726.2,910.2,500,910.2z M753.1,374c8.2,11.9,5.2,28.1-6.6,36.3L509.9,573.7c-4.4,3.1-9.6,4.6-14.8,4.6c-4.1,0-8.3-1-12.1-3c-8.6-4.5-14-13.4-14-23.1V202.5c0-14.4,11.7-26.1,26.1-26.1c14.4,0,26.1,11.7,26.1,26.1v300l195.6-135.1C728.7,359.2,744.9,362.1,753.1,374z"/></symbol><symbol id="icon-calendar" viewBox="0 0 1000 1000"><path d="M920,500v420H80V500H920 M990,430H10v490c0,38.7,31.3,70,70,70h840c38.7,0,70-31.3,70-70V430L990,430z"/><path d="M850,80v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80H360v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80C72.8,80,10,142.7,10,220v140h980V220C990,142.7,927.2,80,850,80z"/><path d="M255,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C290,25.8,274.3,10,255,10z"/><path d="M745,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C780,25.8,764.3,10,745,10z"/></symbol><symbol id="icon-github" viewBox="0 0 12 14"><path d="M6 1q1.633 0 3.012 0.805t2.184 2.184 0.805 3.012q0 1.961-1.145 3.527t-2.957 2.168q-0.211 0.039-0.312-0.055t-0.102-0.234q0-0.023 0.004-0.598t0.004-1.051q0-0.758-0.406-1.109 0.445-0.047 0.801-0.141t0.734-0.305 0.633-0.52 0.414-0.82 0.16-1.176q0-0.93-0.617-1.609 0.289-0.711-0.062-1.594-0.219-0.070-0.633 0.086t-0.719 0.344l-0.297 0.187q-0.727-0.203-1.5-0.203t-1.5 0.203q-0.125-0.086-0.332-0.211t-0.652-0.301-0.664-0.105q-0.352 0.883-0.062 1.594-0.617 0.68-0.617 1.609 0 0.664 0.16 1.172t0.41 0.82 0.629 0.523 0.734 0.305 0.801 0.141q-0.305 0.281-0.383 0.805-0.164 0.078-0.352 0.117t-0.445 0.039-0.512-0.168-0.434-0.488q-0.148-0.25-0.379-0.406t-0.387-0.187l-0.156-0.023q-0.164 0-0.227 0.035t-0.039 0.090 0.070 0.109 0.102 0.094l0.055 0.039q0.172 0.078 0.34 0.297t0.246 0.398l0.078 0.18q0.102 0.297 0.344 0.48t0.523 0.234 0.543 0.055 0.434-0.027l0.18-0.031q0 0.297 0.004 0.691t0.004 0.426q0 0.141-0.102 0.234t-0.312 0.055q-1.812-0.602-2.957-2.168t-1.145-3.527q0-1.633 0.805-3.012t2.184-2.184 3.012-0.805zM2.273 9.617q0.023-0.055-0.055-0.094-0.078-0.023-0.102 0.016-0.023 0.055 0.055 0.094 0.070 0.047 0.102-0.016zM2.516 9.883q0.055-0.039-0.016-0.125-0.078-0.070-0.125-0.023-0.055 0.039 0.016 0.125 0.078 0.078 0.125 0.023zM2.75 10.234q0.070-0.055 0-0.148-0.062-0.102-0.133-0.047-0.070 0.039 0 0.141t0.133 0.055zM3.078 10.562q0.062-0.062-0.031-0.148-0.094-0.094-0.156-0.023-0.070 0.062 0.031 0.148 0.094 0.094 0.156 0.023zM3.523 10.758q0.023-0.086-0.102-0.125-0.117-0.031-0.148 0.055t0.102 0.117q0.117 0.047 0.148-0.047zM4.016 10.797q0-0.102-0.133-0.086-0.125 0-0.125 0.086 0 0.102 0.133 0.086 0.125 0 0.125-0.086zM4.469 10.719q-0.016-0.086-0.141-0.070-0.125 0.023-0.109 0.117t0.141 0.062 0.109-0.109z"></path></symbol><symbol id="icon-medium" viewBox="0 0 1000 1000"><path d="M336.5,240.2v641.5c0,9.1-2.3,16.9-6.8,23.2s-11.2,9.6-20,9.6c-6.2,0-12.2-1.5-18-4.4L37.3,782.7c-7.7-3.6-14.1-9.8-19.4-18.3S10,747.4,10,739V115.5c0-7.3,1.8-13.5,5.5-18.6c3.6-5.1,8.9-7.7,15.9-7.7c5.1,0,13.1,2.7,24.1,8.2l279.5,140C335.9,238.6,336.5,239.5,336.5,240.2L336.5,240.2z M371.5,295.5l292,473.6l-292-145.5V295.5z M990,305.3v576.4c0,9.1-2.6,16.5-7.7,22.1c-5.1,5.7-12,8.5-20.8,8.5s-17.3-2.4-25.7-7.1L694.7,784.9L990,305.3z M988.4,239.7c0,1.1-46.8,77.6-140.3,229.4C754.6,621,699.8,709.8,683.8,735.7L470.5,389l177.2-288.2c6.2-10.2,15.7-15.3,28.4-15.3c5.1,0,9.8,1.1,14.2,3.3l295.9,147.7C987.6,237.1,988.4,238.2,988.4,239.7L988.4,239.7z"/></symbol><symbol id="icon-instagram" viewBox="0 0 489.84 489.84"><path d="M249.62,50.46c65.4,0,73.14.25,99,1.43C372.47,53,385.44,57,394.07,60.32a75.88,75.88,0,0,1,28.16,18.32,75.88,75.88,0,0,1,18.32,28.16c3.35,8.63,7.34,21.6,8.43,45.48,1.18,25.83,1.43,33.57,1.43,99s-0.25,73.14-1.43,99c-1.09,23.88-5.08,36.85-8.43,45.48a81.11,81.11,0,0,1-46.48,46.48c-8.63,3.35-21.6,7.34-45.48,8.43-25.82,1.18-33.57,1.43-99,1.43s-73.15-.25-99-1.43c-23.88-1.09-36.85-5.08-45.48-8.43A75.88,75.88,0,0,1,77,423.86,75.88,75.88,0,0,1,58.69,395.7c-3.35-8.63-7.34-21.6-8.43-45.48-1.18-25.83-1.43-33.57-1.43-99s0.25-73.14,1.43-99c1.09-23.88,5.08-36.85,8.43-45.48A75.88,75.88,0,0,1,77,78.64a75.88,75.88,0,0,1,28.16-18.32c8.63-3.35,21.6-7.34,45.48-8.43,25.83-1.18,33.57-1.43,99-1.43m0-44.13c-66.52,0-74.86.28-101,1.47s-43.87,5.33-59.45,11.38A120.06,120.06,0,0,0,45.81,47.44,120.06,120.06,0,0,0,17.56,90.82C11.5,106.4,7.36,124.2,6.17,150.27s-1.47,34.46-1.47,101,0.28,74.86,1.47,101,5.33,43.87,11.38,59.45a120.06,120.06,0,0,0,28.25,43.38,120.06,120.06,0,0,0,43.38,28.25c15.58,6.05,33.38,10.19,59.45,11.38s34.46,1.47,101,1.47,74.86-.28,101-1.47,43.87-5.33,59.45-11.38a125.24,125.24,0,0,0,71.63-71.63c6.05-15.58,10.19-33.38,11.38-59.45s1.47-34.46,1.47-101-0.28-74.86-1.47-101-5.33-43.87-11.38-59.45a120.06,120.06,0,0,0-28.25-43.38,120.06,120.06,0,0,0-43.38-28.25C394.47,13.13,376.67,9,350.6,7.8s-34.46-1.47-101-1.47h0Z" transform="translate(-4.7 -6.33)" /><path d="M249.62,125.48A125.77,125.77,0,1,0,375.39,251.25,125.77,125.77,0,0,0,249.62,125.48Zm0,207.41a81.64,81.64,0,1,1,81.64-81.64A81.64,81.64,0,0,1,249.62,332.89Z" transform="translate(-4.7 -6.33)"/><circle cx="375.66" cy="114.18" r="29.39" /></symbol><symbol id="icon-linkedin" viewBox="0 0 12 14"><path d="M2.727 4.883v7.742h-2.578v-7.742h2.578zM2.891 2.492q0.008 0.57-0.395 0.953t-1.059 0.383h-0.016q-0.641 0-1.031-0.383t-0.391-0.953q0-0.578 0.402-0.957t1.051-0.379 1.039 0.379 0.398 0.957zM12 8.187v4.437h-2.57v-4.141q0-0.82-0.316-1.285t-0.988-0.465q-0.492 0-0.824 0.27t-0.496 0.668q-0.086 0.234-0.086 0.633v4.32h-2.57q0.016-3.117 0.016-5.055t-0.008-2.313l-0.008-0.375h2.57v1.125h-0.016q0.156-0.25 0.32-0.438t0.441-0.406 0.68-0.34 0.895-0.121q1.336 0 2.148 0.887t0.813 2.598z"></path></symbol><symbol id="icon-heart" viewBox="0 0 34 30"><path d="M17,29.7 L16.4,29.2 C3.5,18.7 0,15 0,9 C0,4 4,0 9,0 C13.1,0 15.4,2.3 17,4.1 C18.6,2.3 20.9,0 25,0 C30,0 34,4 34,9 C34,15 30.5,18.7 17.6,29.2 L17,29.7 Z M9,2 C5.1,2 2,5.1 2,9 C2,14.1 5.2,17.5 17,27.1 C28.8,17.5 32,14.1 32,9 C32,5.1 28.9,2 25,2 C21.5,2 19.6,4.1 18.1,5.8 L17,7.1 L15.9,5.8 C14.4,4.1 12.5,2 9,2 Z" id="Shape"></path></symbol><symbol id="icon-arrow-right" viewBox="0 0 25.452 25.452"><path d="M4.471,24.929v-2.004l12.409-9.788c0.122-0.101,0.195-0.251,0.195-0.411c0-0.156-0.073-0.31-0.195-0.409L4.471,2.526V0.522c0-0.2,0.115-0.384,0.293-0.469c0.18-0.087,0.396-0.066,0.552,0.061l15.47,12.202c0.123,0.1,0.195,0.253,0.195,0.409c0,0.16-0.072,0.311-0.195,0.411L5.316,25.34c-0.155,0.125-0.372,0.147-0.552,0.061C4.586,25.315,4.471,25.13,4.471,24.929z"/></symbol><symbol id="icon-star" viewBox="0 0 48 48"><path fill="currentColor" d="M44,24c0,11.045-8.955,20-20,20S4,35.045,4,24S12.955,4,24,4S44,12.955,44,24z"/><path fill="#ffffff" d="M24,11l3.898,7.898l8.703,1.301l-6.301,6.102l1.5,8.699L24,30.898L16.199,35l1.5-8.699l-6.301-6.102  l8.703-1.301L24,11z"/></symbol><symbol id="icon-read" viewBox="0 0 32 32"><path fill="currentColor" d="M29,4H3C1.343,4,0,5.343,0,7v18c0,1.657,1.343,3,3,3h10c0,0.552,0.448,1,1,1h4c0.552,0,1-0.448,1-1h10  c1.657,0,3-1.343,3-3V7C32,5.343,30.657,4,29,4z M29,5v20H18.708c-0.618,0-1.236,0.146-1.789,0.422l-0.419,0.21V5H29z M15.5,5  v20.632l-0.419-0.21C14.528,25.146,13.91,25,13.292,25H3V5H15.5z M31,25c0,1.103-0.897,2-2,2H18v1h-4v-1H3c-1.103,0-2-0.897-2-2V7  c0-0.737,0.405-1.375,1-1.722V25c0,0.552,0.448,1,1,1h10.292c0.466,0,0.925,0.108,1.342,0.317l0.919,0.46  c0.141,0.07,0.294,0.106,0.447,0.106c0.153,0,0.306-0.035,0.447-0.106l0.919-0.46C17.783,26.108,18.242,26,18.708,26H29  c0.552,0,1-0.448,1-1V5.278C30.595,5.625,31,6.263,31,7V25z M6,12.5C6,12.224,6.224,12,6.5,12h5c0.276,0,0.5,0.224,0.5,0.5  S11.776,13,11.5,13h-5C6.224,13,6,12.776,6,12.5z M6,14.5C6,14.224,6.224,14,6.5,14h5c0.276,0,0.5,0.224,0.5,0.5S11.776,15,11.5,15  h-5C6.224,15,6,14.776,6,14.5z M6,16.5C6,16.224,6.224,16,6.5,16h5c0.276,0,0.5,0.224,0.5,0.5S11.776,17,11.5,17h-5  C6.224,17,6,16.776,6,16.5z M20,12.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,13,25.5,13h-5  C20.224,13,20,12.776,20,12.5z M20,14.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,15,25.5,15h-5  C20.224,15,20,14.776,20,14.5z M20,16.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,17,25.5,17h-5  C20.224,17,20,16.776,20,16.5z"></path></symbol><symbol id="icon-tistory" viewBox="0 0 24 24"><path d="M4 4h16v3h-6v13h-4V7H4V4z"/></symbol></defs></svg>

        <header class="bar-header">
    <a id="menu" role="button">
        <svg id="open" class="icon-menu"><use xlink:href="#icon-menu"></use></svg>
    </a>
    <h1 class="logo">
        <a href="/">
            
                somaz <span class="version">v3.1.2</span>
            
        </a>
    </h1>
    <a id="search" class="dosearch" role="button">
        <svg class="icon-search"><use xlink:href="#icon-search"></use></svg>
    </a>
    
        <a href="https://github.com/thiagorossener/jekflix-template" class="get-theme" role="button">
            Get this theme!
        </a>
    
</header>

<div id="mask" class="overlay"></div>

<aside class="sidebar" id="sidebar">
    <nav id="navigation">
      <h2>Menu</h2>
      <ul>
  
    
      <li>
        <a href="https://somaz.blog/">Home</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/about">About</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/category">Category</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/contact">Contact</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/feed.xml">Feed</a>
      </li>
    
  
</ul>

    </nav>
</aside>

<div class="search-wrapper">
    <div class="search-form">
        <input type="text" class="search-field" placeholder="Search">
        <svg class="icon-remove-sign"><use xlink:href="#icon-close"></use></svg>
        <ul class="search-results search-list"></ul>
    </div>
</div>



        <section class="post two-columns">
            <article role="article" class="post-content">
                <p class="post-info">
                    
                        <svg class="icon-calendar" id="date"><use xlink:href="#icon-calendar"></use></svg>
                        <time class="date" datetime="2025-05-27T00:00:00+00:00">
                            


May 27, 2025

                        </time>
                    
                    <svg id="clock" class="icon-clock"><use xlink:href="#icon-clock"></use></svg>
                    <span>17 min to read</span>
                </p>
                <h1 class="post-title">Installing and Configuring HashiCorp Vault on Kubernetes</h1>
                <p class="post-subtitle">A step-by-step guide to deploying Vault on Kind cluster</p>

                
                    <img src="https://res.cloudinary.com/dkcm26aem/image/upload/v1737704919/vault_i9zrin.png" alt="Featured image" class="post-cover">
                

                <!-- Pagination links -->



                <!-- Add your table of contents here -->


                <p><br /></p>

<hr />

<h2 id="understanding-hashicorp-vault-on-kubernetes">Understanding HashiCorp Vault on Kubernetes</h2>

<p>HashiCorp Vault is a secrets management tool that provides a secure way to store and access sensitive data. Deploying Vault on Kubernetes combines the power of a leading secrets management solution with the flexibility of container orchestration, enabling dynamic secrets delivery to applications in a cloud-native environment.</p>

<p><br /></p>

<h3 id="prerequisites-and-environment-setup">Prerequisites and Environment Setup</h3>

<h4 id="before-you-begin">Before You Begin</h4>

<p>To successfully complete this guide, you’ll need:</p>

<ul>
  <li><strong>Kind</strong>: A tool for running Kubernetes clusters locally using Docker containers</li>
  <li><strong>kubectl</strong>: The Kubernetes command-line tool</li>
  <li><strong>Helm</strong>: The package manager for Kubernetes</li>
  <li><strong>jq</strong>: A lightweight command-line JSON processor</li>
</ul>

<p>Make sure all these tools are installed on your system before proceeding.</p>

<p><br /></p>

<h4 id="setting-up-kind-cluster">Setting up Kind Cluster</h4>

<div class="table-container">
  <table class="table-beauty">
    <tr>
      <th style="width: 30%;">Component</th>
      <th style="width: 70%;">Purpose</th>
    </tr>
    <tr>
      <td><strong>Control Plane</strong></td>
      <td>Hosts the Kubernetes API server and manages the cluster state</td>
    </tr>
    <tr>
      <td><strong>Worker Nodes (2)</strong></td>
      <td>Run application workloads and provide compute resources</td>
    </tr>
    <tr>
      <td><strong>Port Forwarding</strong></td>
      <td>Exposes Vault UI on port 30000 for external access</td>
    </tr>
  </table>
</div>

<p>Create a Kind cluster with port forwarding for Vault UI access:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># cluster-3nodes.yaml</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Cluster</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">kind.x-k8s.io/v1alpha4</span>
<span class="na">nodes</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">role</span><span class="pi">:</span> <span class="s">control-plane</span>
  <span class="na">extraPortMappings</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">30000</span>
    <span class="na">hostPort</span><span class="pi">:</span> <span class="m">30000</span>
    <span class="na">listenAddress</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0.0.0.0"</span>
    <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
<span class="pi">-</span> <span class="na">role</span><span class="pi">:</span> <span class="s">worker</span>
<span class="pi">-</span> <span class="na">role</span><span class="pi">:</span> <span class="s">worker</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Create cluster</span>
kind create cluster <span class="nt">--name</span> somaz-3nodes-kubernetes <span class="nt">--config</span> ./cluster-3nodes.yaml

<span class="c"># Verify nodes</span>
kubectl get nodes
</code></pre></div></div>

<p><br /></p>

<h3 id="vault-architecture-and-concepts">Vault Architecture and Concepts</h3>

<p>Before installation, it’s important to understand Vault’s initialization process and how it manages secrets. A properly configured Vault deployment follows security best practices, including initialization, unsealing, and authentication.</p>

<h4 id="vault-deployment-process">Vault Deployment Process:</h4>

<ul>
  <li>Installation (Helm, HA setup, storage backend)</li>
  <li>Initialization (Unseal keys, root token)</li>
  <li>Unsealing (Raft join, unseal process)</li>
  <li>Configuration (Secret engines, auth methods, policies)</li>
</ul>

<div style="width: 100%; margin: 20px auto;">
  <div class="mermaid">
    graph TD
      A[Vault Deployment] --&gt; B[Installation]
      A --&gt; C[Initialization]
      A --&gt; D[Unsealing]
      A --&gt; E[Configuration]

      B --&gt; B1[Helm Repository]
      B --&gt; B2[HA Setup]
      B --&gt; B3[Storage Backend]

      C --&gt; C1[Unseal Keys]
      C --&gt; C2[Root Token]

      D --&gt; D1[Raft Join]
      D --&gt; D2[Unseal Process]

      E --&gt; E1[Secret Engines]
      E --&gt; E2[Auth Methods]
      E --&gt; E3[Policies]

      style A stroke:#333,stroke-width:1px,fill:#f5f5f5
      style B stroke:#333,stroke-width:1px,fill:#a5d6a7
      style C stroke:#333,stroke-width:1px,fill:#64b5f6
      style D stroke:#333,stroke-width:1px,fill:#ffcc80
      style E stroke:#333,stroke-width:1px,fill:#ce93d8
  </div>
</div>

<p><br /></p>

<h4 id="vault-initialization-process">Vault Initialization Process</h4>

<p>Vault initialization generates two critical security elements:</p>

<ul>
  <li><strong>Unseal Keys</strong>: Used to unlock Vault’s encrypted data</li>
  <li><strong>Root Token</strong>: Provides initial administrative access</li>
</ul>

<p>In production environments, these should be securely distributed among trusted operators. For this guide, we use a simplified setup with a single unseal key.</p>

<div class="table-container">
  <table class="table-beauty">
    <tr>
      <th style="width: 25%;">Component</th>
      <th style="width: 35%;">Description</th>
      <th style="width: 40%;">Security Implications</th>
    </tr>
    <tr>
      <td><strong>Unseal Keys</strong></td>
      <td>
        <ul>
          <li>Base64-encoded keys used for unsealing</li>
          <li>Can be split into multiple shares (Shamir's Secret Sharing)</li>
          <li>Required number (threshold) needed to unseal</li>
        </ul>
      </td>
      <td>
        <ul>
          <li>Protects data at rest encryption key</li>
          <li>Loss of keys means permanent data loss</li>
          <li>Compromise of threshold keys compromises all secrets</li>
        </ul>
      </td>
    </tr>
    <tr>
      <td><strong>Root Token</strong></td>
      <td>
        <ul>
          <li>Initial super-admin token</li>
          <li>Format: "hvs.xxxx"</li>
          <li>Has unrestricted access to all paths</li>
        </ul>
      </td>
      <td>
        <ul>
          <li>Should be revoked after creating restricted admin users</li>
          <li>Compromise grants complete access to Vault</li>
          <li>Should be securely stored if needed for recovery</li>
        </ul>
      </td>
    </tr>
  </table>
</div>

<p><br /></p>

<h3 id="installing-vault-on-kubernetes">Installing Vault on Kubernetes</h3>

<p>We’ll install Vault using Helm, configuring it with high availability (HA) and Raft storage backend for resilience. This deployment creates a three-node Vault cluster to provide redundancy and fault tolerance.</p>

<p><br /></p>

<h4 id="adding-the-hashicorp-helm-repository">Adding the HashiCorp Helm Repository</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Add HashiCorp helm repo</span>
helm repo add hashicorp https://helm.releases.hashicorp.com
helm repo update

<span class="c"># Verify repository</span>
helm repo list
</code></pre></div></div>

<h4 id="installing-vault-with-ha-configuration">Installing Vault with HA Configuration</h4>

<script src="https://gist.github.com/somaz94/5e5d9d2fda06665aead713f9199145d6.js"></script>

<p><br /></p>

<h4 id="high-availability-configuration">High Availability Configuration</h4>

<ul>
  <li><strong>HA Mode</strong>: Enables redundant Vault servers for failover</li>
  <li><strong>Raft Storage</strong>: Integrated storage backend that replicates data across nodes</li>
  <li><strong>Dedicated Namespace</strong>: Isolates Vault resources for better security and management</li>
</ul>

<p>After installation, all Vault pods will start in an uninitialized, sealed state.</p>

<h4 id="verifying-the-installation">Verifying the Installation</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get pods <span class="nt">-n</span> vault
NAME                                    READY   STATUS    RESTARTS   AGE
vault-0                                 0/1     Running   0          82s
vault-1                                 0/1     Running   0          82s
vault-2                                 0/1     Running   0          82s
vault-agent-injector-7f7f68d457-kqlsh   1/1     Running   0          83s
</code></pre></div></div>

<div style="width: 90%; margin: 20px auto;">
  <div class="mermaid">
    graph LR
      A[Client] --&gt; B[Vault Agent Injector]
      B --&gt; C[Vault Server Cluster]
      C --- D[vault-0]
      C --- E[vault-1]
      C --- F[vault-2]
      
      D --- G[Raft Storage]
      E --- G
      F --- G
      
      style A stroke:#333,stroke-width:1px,fill:#f5f5f5
      style B stroke:#333,stroke-width:1px,fill:#a5d6a7
      style C stroke:#333,stroke-width:1px,fill:#64b5f6
      style D stroke:#333,stroke-width:1px,fill:#ffcc80
      style E stroke:#333,stroke-width:1px,fill:#ffcc80
      style F stroke:#333,stroke-width:1px,fill:#ffcc80
      style G stroke:#333,stroke-width:1px,fill:#ce93d8
  </div>
</div>

<p><br /></p>

<h3 id="initializing-and-unsealing-vault">Initializing and Unsealing Vault</h3>

<p>Initialization is a one-time process that generates the encryption keys used to protect data. After initialization, Vault starts in a sealed state and must be unsealed before it can process requests.</p>

<p><br /></p>

<h4 id="initializing-the-vault-cluster">Initializing the Vault Cluster</h4>

<script src="https://gist.github.com/somaz94/7212a13efcdb620c885f775bf5bcf875.js"></script>

<p><br /></p>

<div class="info-box info-box-warning-not-check">
  <strong>⚠️ Production Security Note</strong>
  <p>For this demo, we're using a single unseal key (key-shares=1, key-threshold=1). In production environments, you should:</p>
  <ul>
    <li>Use multiple key shares (typically 5)</li>
    <li>Set a threshold requiring multiple operators (typically 3)</li>
    <li>Distribute keys to different trusted individuals</li>
    <li>Consider using auto-unseal with a cloud KMS for automated operations</li>
  </ul>
</div>

<h4 id="extracting-the-keys-for-unsealing">Extracting the Keys for Unsealing</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Store unseal key and root token</span>
<span class="nv">VAULT_UNSEAL_KEY</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat </span>cluster-keys.json | jq <span class="nt">-r</span> <span class="s2">".unseal_keys_b64[]"</span><span class="si">)</span>
<span class="nv">CLUSTER_ROOT_TOKEN</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat </span>cluster-keys.json | jq <span class="nt">-r</span> <span class="s2">".root_token"</span><span class="si">)</span>
</code></pre></div></div>

<h4 id="unsealing-the-vault-cluster">Unsealing the Vault Cluster</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Unseal vault-0</span>
kubectl <span class="nb">exec </span>vault-0 <span class="nt">-n</span> vault <span class="nt">--</span> vault operator unseal <span class="nv">$VAULT_UNSEAL_KEY</span>

<span class="c"># Join and unseal vault-1</span>
kubectl <span class="nb">exec </span>vault-1 <span class="nt">-n</span> vault <span class="nt">--</span> vault operator raft <span class="nb">join </span>http://vault-0.vault-internal:8200
kubectl <span class="nb">exec </span>vault-1 <span class="nt">-n</span> vault <span class="nt">--</span> vault operator unseal <span class="nv">$VAULT_UNSEAL_KEY</span>

<span class="c"># Repeat for vault-2</span>
kubectl <span class="nb">exec </span>vault-2 <span class="nt">-n</span> vault <span class="nt">--</span> vault operator raft <span class="nb">join </span>http://vault-0.vault-internal:8200
kubectl <span class="nb">exec </span>vault-2 <span class="nt">-n</span> vault <span class="nt">--</span> vault operator unseal <span class="nv">$VAULT_UNSEAL_KEY</span>
</code></pre></div></div>

<p><br /></p>

<h4 id="understanding-the-unsealing-process">Understanding the Unsealing Process</h4>

<ul>
  <li>Raft Join: Secondary nodes connect to the primary node</li>
  <li>Unsealing: Providing the unseal key to decrypt the master key</li>
  <li>Cluster Formation: Nodes form a cohesive HA cluster</li>
</ul>

<p>After unsealing, Vault can process requests and serve secrets.</p>

<div style="width: 90%; margin: 20px auto;">
  <div class="mermaid">
    sequenceDiagram
      participant Admin
      participant Vault0 as Vault-0
      participant Vault1 as Vault-1
      participant Vault2 as Vault-2
      
      Admin-&gt;&gt;Vault0: Initialize
      Vault0--&gt;&gt;Admin: Unseal Keys + Root Token
      
      Admin-&gt;&gt;Vault0: Unseal
      Vault0--&gt;&gt;Vault0: Decrypt Master Key
      
      Admin-&gt;&gt;Vault1: Join Raft (vault-0)
      Admin-&gt;&gt;Vault1: Unseal
      Vault1--&gt;&gt;Vault1: Decrypt Master Key
      
      Admin-&gt;&gt;Vault2: Join Raft (vault-0)
      Admin-&gt;&gt;Vault2: Unseal
      Vault2--&gt;&gt;Vault2: Decrypt Master Key
      
      Vault0-&gt;&gt;Vault1: Replicate Data
      Vault0-&gt;&gt;Vault2: Replicate Data
  </div>
</div>

<p><br /></p>

<h3 id="accessing-the-vault-ui">Accessing the Vault UI</h3>

<p>Vault provides a web-based UI for managing secrets, policies, and authentication methods. We’ll configure a NodePort service to make the UI accessible from outside the cluster.</p>

<h4 id="configuring-nodeport-service">Configuring NodePort Service</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl patch svc vault <span class="nt">-n</span> vault <span class="nt">-p</span> <span class="s1">'{"spec": {"type": "NodePort", "ports": [{"nodePort": 30000, "port": 8200, "protocol": "TCP"}]}}'</span>
</code></pre></div></div>

<h4 id="accessing-ui-with-root-token">Accessing UI with Root Token</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">CLUSTER_ROOT_TOKEN</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat </span>cluster-keys.json | jq <span class="nt">-r</span> <span class="s2">".root_token"</span><span class="si">)</span>

<span class="nb">echo</span> <span class="nv">$CLUSTER_ROOT_TOKEN</span>
hvs.bOXica9b3vWqfBaiZWfASOC1
</code></pre></div></div>

<h4 id="ui-access-and-authentication">UI Access and Authentication</h4>

<ul>
  <li>URL: http://localhost:30000 (if running locally)</li>
  <li>Authentication: Use the root token for initial login</li>
  <li>Security Note: In production, configure TLS and restrict access</li>
</ul>

<p><img src="https://res.cloudinary.com/dkcm26aem/image/upload/v1737705692/vault-web-console_qbv90l.png" alt="Vault Web Console" style="width: 100%;" /></p>

<p><br /></p>

<h4 id="creating-a-regular-user">Creating a Regular User</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl <span class="nb">exec</span> <span class="nt">--stdin</span><span class="o">=</span><span class="nb">true</span> <span class="nt">--tty</span><span class="o">=</span><span class="nb">true </span>vault-0 <span class="nt">-n</span> vault <span class="nt">--</span> /bin/sh

<span class="c"># activate userpass authentication</span>
vault auth <span class="nb">enable </span>userpass

<span class="c"># create user</span>
vault write auth/userpass/users/somaz <span class="nv">password</span><span class="o">=</span>&lt;password&gt; <span class="nv">policies</span><span class="o">=</span>&lt;policies&gt;

<span class="c"># login with user</span>
vault login <span class="nt">-method</span><span class="o">=</span>userpass <span class="nv">username</span><span class="o">=</span>somaz <span class="nv">password</span><span class="o">=</span>&lt;password&gt;
</code></pre></div></div>

<p><br /></p>

<h3 id="configuring-vault-secret-engines">Configuring Vault Secret Engines</h3>

<p>Secret engines are components within Vault that store, generate, or encrypt data. Vault treats these engines as a virtual filesystem, where each engine is mounted at a specific path and provides access to secrets through that path.</p>

<p><br /></p>

<h4 id="enabling-the-kv-secrets-engine">Enabling the KV Secrets Engine</h4>

<h4 id="understanding-kv-secrets-engine">Understanding KV Secrets Engine</h4>

<ul>
  <li><strong>Version 2 (KV-v2)</strong>: Provides versioning, metadata, and soft delete capabilities</li>
  <li><strong>Path-Based Access</strong>: Secrets are organized in a hierarchical structure</li>
  <li><strong>Use Cases</strong>: Ideal for storing configuration data, API keys, passwords, and other static secrets</li>
</ul>

<p>We’ll mount the KV-v2 engine at the “secret/” path, which is a common convention.</p>

<p><br /></p>

<script src="https://gist.github.com/somaz94/48921e5eb52e33014751da6db8289384.js"></script>

<p><br /></p>

<div style="width: 90%; margin: 20px auto;">
  <div class="mermaid">
    graph TD
      A[Vault Secret Engines] --&gt; B[KV v2]
      A --&gt; C[Database]
      A --&gt; D[PKI]
      A --&gt; E[Transit]
      
      B --&gt; B1[secret/devdb/config]
      B --&gt; B2[Other KV Secrets]
      
      style A stroke:#333,stroke-width:1px,fill:#f5f5f5
      style B stroke:#333,stroke-width:1px,fill:#a5d6a7
      style C stroke:#333,stroke-width:1px,fill:#64b5f6
      style D stroke:#333,stroke-width:1px,fill:#ffcc80
      style E stroke:#333,stroke-width:1px,fill:#ce93d8
  </div>
</div>

<p><br /></p>

<h3 id="implementing-access-control-with-policies">Implementing Access Control with Policies</h3>

<p>Policies in Vault define the capabilities (permissions) a token has for accessing specific paths. They follow the principle of least privilege, allowing precise control over who can access what within Vault.</p>

<h4 id="creating-a-read-only-policy">Creating a Read-Only Policy</h4>

<div class="table-container">
  <table class="table-beauty">
    <tr>
      <th style="width: 30%;">Policy Element</th>
      <th style="width: 70%;">Description</th>
    </tr>
    <tr>
      <td><strong>Path</strong></td>
      <td>Specifies the secret path this policy applies to</td>
    </tr>
    <tr>
      <td><strong>Capabilities</strong></td>
      <td>Defines allowed operations (create, read, update, delete, list, deny)</td>
    </tr>
    <tr>
      <td><strong>Scope</strong></td>
      <td>Limited to the specific path and does not extend to sub-paths unless specified</td>
    </tr>
  </table>
</div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Create read-only policy</span>
kubectl <span class="nb">exec</span> <span class="nt">-it</span> vault-0 <span class="nt">-n</span> vault <span class="nt">--</span> vault policy write devdb - <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
path "secret/data/devdb/config" {
  capabilities = ["read"]
}
</span><span class="no">EOF
</span></code></pre></div></div>

<h4 id="policy-best-practices">Policy Best Practices</h4>

<ul>
  <li>Least Privilege: Grant only the minimum permissions needed</li>
  <li>Path Specificity: Be as specific as possible with paths</li>
  <li>Policy Granularity: Create focused policies that can be combined</li>
  <li>Naming Conventions: Use clear, consistent naming patterns</li>
</ul>

<p><br /></p>

<h3 id="integrating-with-kubernetes-authentication">Integrating with Kubernetes Authentication</h3>

<p>Vault’s Kubernetes authentication method enables pods to authenticate with Vault using their Kubernetes service account tokens. This allows for a secure, automated authentication flow without managing additional credentials.</p>

<h4 id="configuring-kubernetes-authentication">Configuring Kubernetes Authentication</h4>

<div style="width: 90%; margin: 20px auto;">
  <div class="mermaid">
    sequenceDiagram
      participant Pod as Application Pod
      participant SA as Service Account
      participant K8s as Kubernetes API
      participant Vault
      
      Pod-&gt;&gt;Vault: Auth with SA token
      Vault-&gt;&gt;K8s: Validate token
      K8s--&gt;&gt;Vault: Token valid, confirm SA/NS
      Vault-&gt;&gt;Vault: Check role bindings
      Vault--&gt;&gt;Pod: Issue limited Vault token
  </div>
</div>

<p><br /></p>

<script src="https://gist.github.com/somaz94/1ddf6b767bcc310f427f1d3d674c7dd2.js"></script>

<p><br /></p>

<div class="info-box info-box-default-not-check">
  <strong>Understanding the Authentication Flow</strong>
  <p>The Kubernetes authentication process works as follows:</p>
  <ul>
    <li><strong>Token Verification</strong>: Vault validates the service account token with Kubernetes API</li>
    <li><strong>Role Binding</strong>: Vault checks if the service account is allowed to assume the requested role</li>
    <li><strong>Policy Application</strong>: If authorized, Vault issues a token with policies attached to that role</li>
    <li><strong>Automatic Renewal</strong>: Vault Agent can automatically renew the token before expiration</li>
  </ul>
  <p>This mechanism provides secure, identity-based access without sharing long-lived credentials.</p>
</div>

<h4 id="creating-authentication-roles">Creating Authentication Roles</h4>

<div class="table-container">
  <table class="table-beauty">
    <tr>
      <th style="width: 30%;">Parameter</th>
      <th style="width: 70%;">Purpose</th>
    </tr>
    <tr>
      <td><strong>bound_service_account_names</strong></td>
      <td>Specifies which service accounts can authenticate</td>
    </tr>
    <tr>
      <td><strong>bound_service_account_namespaces</strong></td>
      <td>Limits authentication to pods in specific namespaces</td>
    </tr>
    <tr>
      <td><strong>policies</strong></td>
      <td>Policies to attach to tokens issued by this role</td>
    </tr>
    <tr>
      <td><strong>ttl</strong></td>
      <td>Maximum lifetime of tokens issued by this role</td>
    </tr>
  </table>
</div>

<p><br /></p>

<script src="https://gist.github.com/somaz94/882f9a73132420a9d0c79bbf516f0578.js"></script>

<p><br /></p>

<h3 id="deploying-applications-with-vault-integration">Deploying Applications with Vault Integration</h3>

<p>The Vault Agent Injector automatically injects secrets into pods at runtime. This approach eliminates the need to store secrets in ConfigMaps, environment variables, or the application code itself.</p>

<h4 id="preparing-the-kubernetes-environment">Preparing the Kubernetes Environment</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Create namespace</span>
kubectl create namespace somaz

<span class="c"># Create service account</span>
kubectl create serviceaccount somaz-app <span class="nt">-n</span> somaz
</code></pre></div></div>

<h4 id="deploying-a-pod-with-vault-integration">Deploying a Pod with Vault Integration</h4>

<div style="width: 90%; margin: 20px auto;">
  <div class="mermaid">
    graph TD
      A[Pod Creation] --&gt; B[Admission Controller]
      B --&gt; C[Vault Agent Injector]
      C --&gt; D[Pod Mutation]
      D --&gt; E[Add Init Container]
      D --&gt; F[Add Agent Container]
      E --&gt; G[Fetch Secrets]
      G --&gt; H[Write to Volume]
      F --&gt; I[Auto Renew Tokens]
      
      style A stroke:#333,stroke-width:1px,fill:#f5f5f5
      style B stroke:#333,stroke-width:1px,fill:#a5d6a7
      style C stroke:#333,stroke-width:1px,fill:#64b5f6
      style D stroke:#333,stroke-width:1px,fill:#ffcc80
      style E stroke:#333,stroke-width:1px,fill:#ce93d8
      style F stroke:#333,stroke-width:1px,fill:#ce93d8
      style G stroke:#333,stroke-width:1px,fill:#81c784
      style H stroke:#333,stroke-width:1px,fill:#81c784
      style I stroke:#333,stroke-width:1px,fill:#81c784
  </div>
</div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Application Pod with Vault annotations</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">devsomazapp</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">devsomazapp</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="na">vault.hashicorp.com/agent-inject</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
    <span class="na">vault.hashicorp.com/role</span><span class="pi">:</span> <span class="s2">"</span><span class="s">db-app"</span>
    <span class="na">vault.hashicorp.com/agent-inject-secret-credentials.txt</span><span class="pi">:</span> <span class="s2">"</span><span class="s">secret/data/devdb/config"</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">serviceAccountName</span><span class="pi">:</span> <span class="s">somaz-app</span>
  <span class="na">containers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">devsomazapp</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">jweissig/app:0.0.1</span>
</code></pre></div></div>

<div class="info-box info-box-default-not-check">
  <strong>Understanding Vault Annotations</strong>
  <p>The annotations in the pod specification control how Vault Agent injects secrets:</p>
  <ul>
    <li><strong>agent-inject</strong>: Enables the injection feature</li>
    <li><strong>role</strong>: Specifies which Vault role to authenticate as</li>
    <li><strong>agent-inject-secret-[filename]</strong>: Defines which secret to inject and where</li>
    <li><strong>agent-inject-template-[filename]</strong> (optional): Provides a template for formatting the secret</li>
  </ul>
  <p>When the pod is created, the Vault Agent Injector automatically adds the necessary containers to fetch and manage secrets.</p>
</div>

<h4 id="deploying-and-verifying">Deploying and Verifying</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Apply the pod definition</span>
kubectl apply <span class="nt">-f</span> devsomazapp.yaml <span class="nt">-n</span> somaz

<span class="c"># Check the secret has been injected</span>
kubectl <span class="nb">exec</span> <span class="nt">-it</span> devsomazapp <span class="nt">-c</span> devsomazapp <span class="nt">-n</span> somaz <span class="nt">--</span> <span class="nb">cat</span> /vault/secrets/credentials.txt
</code></pre></div></div>

<p><br /></p>

<h3 id="working-with-multiple-secrets">Working with Multiple Secrets</h3>

<p>Applications often need access to multiple secrets. Vault makes it easy to inject multiple secrets into the same pod, each with its own path and access controls.</p>

<h4 id="adding-another-secret">Adding Another Secret</h4>

<script src="https://gist.github.com/somaz94/e780facb6ac2b6e59b5d3d9cbe3b9786.js"></script>

<p><br /></p>

<h4 id="updating-the-pod-definition">Updating the Pod Definition</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Updated pod with multiple secrets</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">devsomazapp</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">devsomazapp</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="na">vault.hashicorp.com/agent-inject</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
    <span class="na">vault.hashicorp.com/role</span><span class="pi">:</span> <span class="s2">"</span><span class="s">db-app"</span>
    <span class="na">vault.hashicorp.com/agent-inject-secret-devdb.txt</span><span class="pi">:</span> <span class="s2">"</span><span class="s">secret/data/devdb/config"</span>
    <span class="na">vault.hashicorp.com/agent-inject-secret-qadb.txt</span><span class="pi">:</span> <span class="s2">"</span><span class="s">secret/data/qadb/config"</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">serviceAccountName</span><span class="pi">:</span> <span class="s">somaz-app</span>
  <span class="na">containers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">devsomazapp</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">jweissig/app:0.0.1</span>
</code></pre></div></div>

<div class="table-container">
  <table class="table-beauty">
    <tr>
      <th style="width: 30%;">Secret Path</th>
      <th style="width: 30%;">Mount Location</th>
      <th style="width: 40%;">Content</th>
    </tr>
    <tr>
      <td><strong>secret/data/devdb/config</strong></td>
      <td>/vault/secrets/devdb.txt</td>
      <td>Development database credentials</td>
    </tr>
    <tr>
      <td><strong>secret/data/qadb/config</strong></td>
      <td>/vault/secrets/qadb.txt</td>
      <td>QA database credentials</td>
    </tr>
  </table>
</div>

<h4 id="verifying-multiple-secrets">Verifying Multiple Secrets</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Recreate the pod with updated annotations</span>
kubectl delete pod devsomazapp <span class="nt">-n</span> somaz
kubectl apply <span class="nt">-f</span> devsomazapp.yaml <span class="nt">-n</span> somaz

<span class="c"># Check for injected secrets</span>
kubectl <span class="nb">exec</span> <span class="nt">-it</span> devsomazapp <span class="nt">-c</span> devsomazapp <span class="nt">-n</span> somaz <span class="nt">--</span> <span class="nb">ls</span> /vault/secrets/
devdb.txt  qadb.txt

<span class="c"># View the content of each secret</span>
kubectl <span class="nb">exec</span> <span class="nt">-it</span> devsomazapp <span class="nt">-c</span> devsomazapp <span class="nt">-n</span> somaz <span class="nt">--</span> <span class="nb">cat</span> /vault/secrets/devdb.txt
kubectl <span class="nb">exec</span> <span class="nt">-it</span> devsomazapp <span class="nt">-c</span> devsomazapp <span class="nt">-n</span> somaz <span class="nt">--</span> <span class="nb">cat</span> /vault/secrets/qadb.txt
</code></pre></div></div>

<p><br /></p>

<h3 id="managing-user-permissions">Managing User Permissions</h3>

<div class="info-box info-box-modern">
Beyond service accounts, Vault also supports human users with different levels of access. Proper user management is critical for maintaining security while enabling administrative tasks.
</div>

<h4 id="understanding-user-policies">Understanding User Policies</h4>

<div style="width: 90%; margin: 20px auto;">
  <div class="mermaid">
    graph TD
      A[Vault Policies] --&gt; B[Root]
      A --&gt; C[Admin]
      A --&gt; D[DevDB]
      A --&gt; E[QADB]
      
      B --&gt; B1[All Paths]
      C --&gt; C1[Limited Admin]
      D --&gt; D1[Dev Secrets]
      E --&gt; E1[QA Secrets]
      
      style A stroke:#333,stroke-width:1px,fill:#f5f5f5
      style B stroke:#333,stroke-width:1px,fill:#a5d6a7
      style C stroke:#333,stroke-width:1px,fill:#64b5f6
      style D stroke:#333,stroke-width:1px,fill:#ffcc80
      style E stroke:#333,stroke-width:1px,fill:#ce93d8
  </div>
</div>

<div class="info-box info-box-warning-not-check">
  <strong>Root Token Security</strong>
  <p>The root token has unlimited access to all Vault resources. For security reasons:</p>
  <ul>
    <li><strong>Avoid Regular Use</strong>: Don't use the root token for daily operations</li>
    <li><strong>Create Admin Users</strong>: Set up users with appropriate permissions</li>
    <li><strong>Revoke After Setup</strong>: Consider revoking the root token after initial setup</li>
    <li><strong>Regenerate When Needed</strong>: Root tokens can be recreated with unseal keys if needed</li>
  </ul>
  <p>Using properly scoped tokens reduces the risk of accidental or malicious damage.</p>
</div>

<h4 id="creating-an-admin-policy">Creating an Admin Policy</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Login with root token</span>
kubectl <span class="nb">exec</span> <span class="nt">-it</span> vault-0 <span class="nt">-n</span> vault <span class="nt">--</span> vault login <span class="nv">$CLUSTER_ROOT_TOKEN</span>

<span class="c"># Create admin policy</span>
kubectl <span class="nb">exec</span> <span class="nt">-it</span> vault-0 <span class="nt">-n</span> vault <span class="nt">--</span> vault policy write admin - <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
path "*" {
  capabilities = ["create", "read", "update", "delete", "list", "sudo"]
}
</span><span class="no">EOF

</span><span class="c"># Assign admin policy to a user</span>
kubectl <span class="nb">exec</span> <span class="nt">-it</span> vault-0 <span class="nt">-n</span> vault <span class="nt">--</span> vault write auth/userpass/users/somaz <span class="nv">policies</span><span class="o">=</span>admin

<span class="c"># Verify user policies</span>
kubectl <span class="nb">exec</span> <span class="nt">-it</span> vault-0 <span class="nt">-n</span> vault <span class="nt">--</span> vault <span class="nb">read </span>auth/userpass/users/somaz
</code></pre></div></div>

<div class="table-container">
  <table class="table-beauty">
    <tr>
      <th style="width: 30%;">Policy Name</th>
      <th style="width: 20%;">Scope</th>
      <th style="width: 50%;">Typical User</th>
    </tr>
    <tr>
      <td><strong>root</strong></td>
      <td>Unlimited access</td>
      <td>Initial setup only, emergency access</td>
    </tr>
    <tr>
      <td><strong>admin</strong></td>
      <td>Full system control</td>
      <td>Vault administrators</td>
    </tr>
    <tr>
      <td><strong>devdb</strong></td>
      <td>Read dev secrets</td>
      <td>Development applications</td>
    </tr>
    <tr>
      <td><strong>qadb</strong></td>
      <td>Read QA secrets</td>
      <td>QA applications</td>
    </tr>
  </table>
</div>

<p><br /></p>

<h3 id="key-points-and-best-practices">Key Points and Best Practices</h3>

<div class="info-box info-box-success-not-check">
  <strong>💡 Vault Security Essentials</strong>
  <ul>
    <li>
      <strong>Initialization and Unsealing</strong><br />
      - Store unseal keys securely and separately<br />
      - Consider using auto-unseal for production<br />
      - Revoke the root token after initial configuration
    </li>
    <li>
      <strong>Authentication and Authorization</strong><br />
      - Use the Kubernetes auth method for applications<br />
      - Implement fine-grained policies following least privilege<br />
      - Prefer short-lived tokens with automatic renewal
    </li>
    <li>
      <strong>Secret Injection</strong><br />
      - Use the Vault Agent Injector for Kubernetes integration<br />
      - Template secrets to match application requirements<br />
      - Implement secret rotation for sensitive credentials
    </li>
    <li>
      <strong>Operational Readiness</strong><br />
      - Set up monitoring and alerting for Vault status<br />
      - Configure regular backups of Vault data<br />
      - Implement proper audit logging
    </li>
  </ul>
</div>

<p><br /></p>

<hr />

<h2 id="references">References</h2>
<ul>
  <li><a href="https://developer.hashicorp.com/vault/tutorials/kubernetes/kubernetes-raft-deployment-guide">Vault Kubernetes Deployment Guide</a></li>
  <li><a href="https://github.com/hashicorp/vault-helm">Vault Helm Chart</a></li>
  <li><a href="https://developer.hashicorp.com/vault/tutorials/kubernetes/kubernetes-google-cloud-gke">Vault on GKE Guide</a></li>
  <li><a href="https://developer.hashicorp.com/vault/docs/concepts/policies">Vault Policy Documentation</a></li>
  <li><a href="https://developer.hashicorp.com/vault/docs/platform/k8s/injector">Vault Agent Injector Documentation</a></li>
  <li><a href="https://developer.hashicorp.com/vault/docs/auth">Vault Authentication Methods</a></li>
</ul>


                <!-- Pagination links -->


            </article>

            
                <aside class="see-also">
                    <h2>See also</h2>
                    <ul>
                        
                        
                        
                            <li>
                                <a href="/category/database/acid-cap-theory/">
                                    
                                        <img src="https://blog.kakaocdn.net/dn/VDDO9/btsMRQChoDD/cEqm5BJuB0tQTS9Imr22fK/img.png">
                                    
                                    <h3>Understanding ACID and CAP: Database Design Principles</h3>
                                </a>
                            </li>
                        
                            <li>
                                <a href="/category/troubleshooting/db-connection-econnreset-resolution/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1757928232/db-connection-econnreset-1_odeqhz.png">
                                    
                                    <h3>Resolving DB Connection Error (ECONNRESET) Issues</h3>
                                </a>
                            </li>
                        
                            <li>
                                <a href="/category/openstack/openstack-trove/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1756185482/openstack-trove-1_ggheju.png">
                                    
                                    <h3>Deep Dive into OpenStack Trove</h3>
                                </a>
                            </li>
                        
                    </ul>
                </aside>
            

        </section>

        <!-- Add time bar only for pages without pagination -->
        
            <div class="time-bar" data-minutes="17">
    <span class="time-completed"></span>
    <span class="time-remaining"></span>
    <div class="bar">
        <span class="completed" style="width:0%;"></span>
        <span class="remaining" style="width:100%;"></span>
    </div>
</div>

            <button class="toggle-preview" onclick="togglePreview()">
    <span>Hide Preview ▼</span>
</button>

<div id="recommendationSection" class="recommendation">
    <div class="message">
        <strong>Why don't you read something next?</strong>
        <div>
            <button>
                <svg><use xlink:href="#icon-arrow-right"></use></svg>
                <span>Go back to top</span>
            </button>
        </div>
    </div>
    <div id="previewSection" class="preview-section">
        
        <a href="/category/security/vaultwarden/" class="post-preview">
            <div class="image">
                
                    <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1737709321/vaultwarden_wjis4z.png">
                
            </div>
            <h3 class="title">Understanding and Installing Vaultwarden - A Self-Hosted Password Manager</h3>
        </a>
    </div>
</div>

<style>
.toggle-preview {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #333;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 4px;
    cursor: pointer;
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.toggle-preview:hover {
    background: #444;
}

.toggle-preview.visible {
    opacity: 1;
}

.recommendation {
    margin-top: 1000px;
    display: block;
    transition: all 0.3s ease;
}

.recommendation.hidden {
    display: none;
}

.hide-preview {
    margin-left: 10px;
    background: none;
    border: 1px solid #666;
    color: #666;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
}

.hide-preview:hover {
    background: #f0f0f0;
}

.preview-section {
    max-height: 1000px;
    overflow: hidden;
    transition: max-height 0.3s ease-out;
}

.preview-section.hidden {
    max-height: 0;
}
</style>

<script>
function togglePreview() {
    const recommendation = document.getElementById('recommendationSection');
    const button = document.querySelector('.toggle-preview span');
    
    if (recommendation.classList.contains('hidden')) {
        recommendation.classList.remove('hidden');
        button.textContent = 'Hide Preview ▼';
    } else {
        recommendation.classList.add('hidden');
        button.textContent = 'Show Preview ▲';
    }
}

window.addEventListener('scroll', function() {
    const toggleButton = document.querySelector('.toggle-preview');
    const recommendation = document.getElementById('recommendationSection');
    const rect = recommendation.getBoundingClientRect();
    
    if (rect.top <= window.innerHeight) {
        toggleButton.classList.add('visible');
    } else {
        toggleButton.classList.remove('visible');
    }
});
</script>

        

        <!-- Show modal if the post is the last one -->
        

        <!-- Show modal before user leaves the page -->
        

        <!-- Add your newsletter subscription form here -->

        <section class="share">
    <h3>Share</h3>
    <a aria-label="Share on Twitter" href="https://twitter.com/intent/tweet?text=&quot;Learn how to install, initialize, and configure HashiCorp Vault on Kubernetes using Kind&quot;%20https://somaz.blog/category/security/vault-install-configure/%20via%20&#64;twitter_username&hashtags=vault,kubernetes,security,kind"
    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Share on Twitter">
        <svg class="icon icon-twitter"><use xlink:href="#icon-twitter"></use></svg>
    </a>
    <a aria-label="Share on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://somaz.blog/category/security/vault-install-configure/"
    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook">
        <svg class="icon icon-facebook"><use xlink:href="#icon-facebook"></use></svg>
    </a>
</section>

        

  <section class="author">
    <div class="details">
      
        <img class="img-rounded" src="/assets/img/uploads/profile.png" alt="Somaz">
      
      <p class="def">Author</p>
      <h3 class="name">
        <a href="/authors/somaz/">Somaz</a>
      </h3>
      <p class="desc">DevOps engineer focused on cloud infrastructure and automation</p>
      <p>
        
          <a href="https://github.com/somaz94" title="Github">
            <svg><use xlink:href="#icon-github"></use></svg>
          </a>
        
        
        
        
        
        
          <a href="https://www.linkedin.com/in/somaz" title="LinkedIn">
            <svg><use xlink:href="#icon-linkedin"></use></svg>
          </a>
        
        
          <a href="https://somaz.tistory.com" title="Tistory">
            <svg><use xlink:href="#icon-tistory"></use></svg>
          </a>
        
      </p>
    </div>
  </section>

  
  
  
  
  
  
  
  

  <script type="application/ld+json">
  {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "Somaz",
      
      "image": "/assets/img/uploads/profile.png",
      
      "jobTitle": "DevOps Engineer",
      "url": "https://somaz.blog/authors/somaz/",
      "sameAs": [
        "https://github.com/somaz94","https://www.linkedin.com/in/somaz","https://{{ author.tistory_username }}.tistory.com"
      ]
  }
  </script>


        

<section class="comments">
    <h3>Comments</h3>
    <div id="disqus_thread"></div>
</section>
<script type="text/javascript">
    var disqus_loaded = false;

    function load_disqus()
    {
        disqus_loaded = true;
        var disqus_shortname = 'https-somaz94-github-io';
        var disqus_title = '';
        var disqus_url = '/category/security/vault-install-configure/';
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        var ldr = document.getElementById('disqus_loader');
    };
    window.onscroll = function(e) {
        if ((window.innerHeight + window.scrollY) >= (document.body.offsetHeight - 800)) {
            //hit bottom of page
            if (disqus_loaded==false)
                load_disqus()
        }
    };
</script>



        <footer>
    <p>
      
        <a href="https://github.com/somaz94" title="Github">
          <svg><use xlink:href="#icon-github"></use></svg>
        </a>
      
      
        <a href="https://www.facebook.com/facebook_username" title="Facebook">
          <svg><use xlink:href="#icon-facebook"></use></svg>
        </a>
      
      
        <a href="https://twitter.com/twitter_username" title="Twitter">
          <svg><use xlink:href="#icon-twitter"></use></svg>
        </a>
      
      
        <a href="https://medium.com/@medium_username" title="Medium">
          <svg><use xlink:href="#icon-medium"></use></svg>
        </a>
      
      
        <a href="https://www.instagram.com/instagram_username" title="Instagram">
          <svg><use xlink:href="#icon-instagram"></use></svg>
        </a>
      
      
        <a href="https://www.linkedin.com/in/somaz" title="LinkedIn">
          <svg><use xlink:href="#icon-linkedin"></use></svg>
        </a>
      
      
        <a href="https://somaz.tistory.com" title="Tistory">
          <svg><use xlink:href="#icon-tistory"></use></svg>
        </a>
      
    </p>

    <ul>
  
    
      <li>
        <a href="https://somaz.blog/">Home</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/about">About</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/category">Category</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/contact">Contact</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/feed.xml">Feed</a>
      </li>
    
  
</ul>


    <p>
      <a href="https://somaz.blog/sitemap.xml" title="sitemap">Sitemap</a> |
      <a href="https://somaz.blog/privacy-policy" title="Privacy Policy">Privacy Policy</a>
    </p>

    <p>
      <span>Somaz Tech Blog</span> <svg class="love"><use xlink:href="#icon-heart"></use></svg>
    </p>
</footer>










<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "somaz",
  "description": "DevOps engineer's tech blog.",
  "url": "https://somaz.blog/",
  "logo": {
      "@type": "ImageObject",
      "url": "https://somaz.blog/assets/img/icons/mediumtile.png",
      "width": "600",
      "height": "315"
  },
  "sameAs": [
    "https://github.com/somaz94","https://www.facebook.com/facebook_username","https://twitter.com/twitter_username","https://medium.com/@medium_username","https://www.instagram.com/instagram_username","https://www.linkedin.com/in/somaz","https://{{ site.tistory_username }}.tistory.com"
  ]
}
</script>

<!-- Include the script that allows Netlify CMS login -->
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

<!-- Include the website scripts -->
<script src="/assets/js/scripts.min.js"></script>

<!-- Include Google Analytics script -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-XXXXXXXX-X"></script>
<script>
  var host = window.location.hostname;
  if (host != 'localhost') {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-XXXXXXXX-X');
  }
</script>
  


<!-- Include extra scripts -->



        

        
        
        
        
        
        
        
        
        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "BlogPosting",
            "name": "Installing and Configuring HashiCorp Vault on Kubernetes",
            "headline": "A step-by-step guide to deploying Vault on Kind cluster",
            "description": "Learn how to install, initialize, and configure HashiCorp Vault on Kubernetes using Kind",
            "image": "https://res.cloudinary.com/dkcm26aem/image/upload/v1737704919/vault_i9zrin.png",
            "url": "https://somaz.blog/category/security/vault-install-configure/",
            "articleBody": "



Understanding HashiCorp Vault on Kubernetes

HashiCorp Vault is a secrets management tool that provides a secure way to store and access sensitive data. Deploying Vault on Kubernetes combines the power of a leading secrets management solution with the flexibility of container orchestration, enabling dynamic secrets delivery to applications in a cloud-native environment.



Prerequisites and Environment Setup

Before You Begin

To successfully complete this guide, you’ll need:


  Kind: A tool for running Kubernetes clusters locally using Docker containers
  kubectl: The Kubernetes command-line tool
  Helm: The package manager for Kubernetes
  jq: A lightweight command-line JSON processor


Make sure all these tools are installed on your system before proceeding.



Setting up Kind Cluster


  
    
      Component
      Purpose
    
    
      Control Plane
      Hosts the Kubernetes API server and manages the cluster state
    
    
      Worker Nodes (2)
      Run application workloads and provide compute resources
    
    
      Port Forwarding
      Exposes Vault UI on port 30000 for external access
    
  


Create a Kind cluster with port forwarding for Vault UI access:

# cluster-3nodes.yaml
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
  extraPortMappings:
  - containerPort: 30000
    hostPort: 30000
    listenAddress: &quot;0.0.0.0&quot;
    protocol: TCP
- role: worker
- role: worker


# Create cluster
kind create cluster --name somaz-3nodes-kubernetes --config ./cluster-3nodes.yaml

# Verify nodes
kubectl get nodes




Vault Architecture and Concepts

Before installation, it’s important to understand Vault’s initialization process and how it manages secrets. A properly configured Vault deployment follows security best practices, including initialization, unsealing, and authentication.

Vault Deployment Process:


  Installation (Helm, HA setup, storage backend)
  Initialization (Unseal keys, root token)
  Unsealing (Raft join, unseal process)
  Configuration (Secret engines, auth methods, policies)



  
    graph TD
      A[Vault Deployment] --&amp;gt; B[Installation]
      A --&amp;gt; C[Initialization]
      A --&amp;gt; D[Unsealing]
      A --&amp;gt; E[Configuration]

      B --&amp;gt; B1[Helm Repository]
      B --&amp;gt; B2[HA Setup]
      B --&amp;gt; B3[Storage Backend]

      C --&amp;gt; C1[Unseal Keys]
      C --&amp;gt; C2[Root Token]

      D --&amp;gt; D1[Raft Join]
      D --&amp;gt; D2[Unseal Process]

      E --&amp;gt; E1[Secret Engines]
      E --&amp;gt; E2[Auth Methods]
      E --&amp;gt; E3[Policies]

      style A stroke:#333,stroke-width:1px,fill:#f5f5f5
      style B stroke:#333,stroke-width:1px,fill:#a5d6a7
      style C stroke:#333,stroke-width:1px,fill:#64b5f6
      style D stroke:#333,stroke-width:1px,fill:#ffcc80
      style E stroke:#333,stroke-width:1px,fill:#ce93d8
  




Vault Initialization Process

Vault initialization generates two critical security elements:


  Unseal Keys: Used to unlock Vault’s encrypted data
  Root Token: Provides initial administrative access


In production environments, these should be securely distributed among trusted operators. For this guide, we use a simplified setup with a single unseal key.


  
    
      Component
      Description
      Security Implications
    
    
      Unseal Keys
      
        
          Base64-encoded keys used for unsealing
          Can be split into multiple shares (Shamir&apos;s Secret Sharing)
          Required number (threshold) needed to unseal
        
      
      
        
          Protects data at rest encryption key
          Loss of keys means permanent data loss
          Compromise of threshold keys compromises all secrets
        
      
    
    
      Root Token
      
        
          Initial super-admin token
          Format: &quot;hvs.xxxx&quot;
          Has unrestricted access to all paths
        
      
      
        
          Should be revoked after creating restricted admin users
          Compromise grants complete access to Vault
          Should be securely stored if needed for recovery
        
      
    
  




Installing Vault on Kubernetes

We’ll install Vault using Helm, configuring it with high availability (HA) and Raft storage backend for resilience. This deployment creates a three-node Vault cluster to provide redundancy and fault tolerance.



Adding the HashiCorp Helm Repository

# Add HashiCorp helm repo
helm repo add hashicorp https://helm.releases.hashicorp.com
helm repo update

# Verify repository
helm repo list


Installing Vault with HA Configuration





High Availability Configuration


  HA Mode: Enables redundant Vault servers for failover
  Raft Storage: Integrated storage backend that replicates data across nodes
  Dedicated Namespace: Isolates Vault resources for better security and management


After installation, all Vault pods will start in an uninitialized, sealed state.

Verifying the Installation

kubectl get pods -n vault
NAME                                    READY   STATUS    RESTARTS   AGE
vault-0                                 0/1     Running   0          82s
vault-1                                 0/1     Running   0          82s
vault-2                                 0/1     Running   0          82s
vault-agent-injector-7f7f68d457-kqlsh   1/1     Running   0          83s



  
    graph LR
      A[Client] --&amp;gt; B[Vault Agent Injector]
      B --&amp;gt; C[Vault Server Cluster]
      C --- D[vault-0]
      C --- E[vault-1]
      C --- F[vault-2]
      
      D --- G[Raft Storage]
      E --- G
      F --- G
      
      style A stroke:#333,stroke-width:1px,fill:#f5f5f5
      style B stroke:#333,stroke-width:1px,fill:#a5d6a7
      style C stroke:#333,stroke-width:1px,fill:#64b5f6
      style D stroke:#333,stroke-width:1px,fill:#ffcc80
      style E stroke:#333,stroke-width:1px,fill:#ffcc80
      style F stroke:#333,stroke-width:1px,fill:#ffcc80
      style G stroke:#333,stroke-width:1px,fill:#ce93d8
  




Initializing and Unsealing Vault

Initialization is a one-time process that generates the encryption keys used to protect data. After initialization, Vault starts in a sealed state and must be unsealed before it can process requests.



Initializing the Vault Cluster






  ⚠️ Production Security Note
  For this demo, we&apos;re using a single unseal key (key-shares=1, key-threshold=1). In production environments, you should:
  
    Use multiple key shares (typically 5)
    Set a threshold requiring multiple operators (typically 3)
    Distribute keys to different trusted individuals
    Consider using auto-unseal with a cloud KMS for automated operations
  


Extracting the Keys for Unsealing

# Store unseal key and root token
VAULT_UNSEAL_KEY=$(cat cluster-keys.json | jq -r &quot;.unseal_keys_b64[]&quot;)
CLUSTER_ROOT_TOKEN=$(cat cluster-keys.json | jq -r &quot;.root_token&quot;)


Unsealing the Vault Cluster

# Unseal vault-0
kubectl exec vault-0 -n vault -- vault operator unseal $VAULT_UNSEAL_KEY

# Join and unseal vault-1
kubectl exec vault-1 -n vault -- vault operator raft join http://vault-0.vault-internal:8200
kubectl exec vault-1 -n vault -- vault operator unseal $VAULT_UNSEAL_KEY

# Repeat for vault-2
kubectl exec vault-2 -n vault -- vault operator raft join http://vault-0.vault-internal:8200
kubectl exec vault-2 -n vault -- vault operator unseal $VAULT_UNSEAL_KEY




Understanding the Unsealing Process


  Raft Join: Secondary nodes connect to the primary node
  Unsealing: Providing the unseal key to decrypt the master key
  Cluster Formation: Nodes form a cohesive HA cluster


After unsealing, Vault can process requests and serve secrets.


  
    sequenceDiagram
      participant Admin
      participant Vault0 as Vault-0
      participant Vault1 as Vault-1
      participant Vault2 as Vault-2
      
      Admin-&amp;gt;&amp;gt;Vault0: Initialize
      Vault0--&amp;gt;&amp;gt;Admin: Unseal Keys + Root Token
      
      Admin-&amp;gt;&amp;gt;Vault0: Unseal
      Vault0--&amp;gt;&amp;gt;Vault0: Decrypt Master Key
      
      Admin-&amp;gt;&amp;gt;Vault1: Join Raft (vault-0)
      Admin-&amp;gt;&amp;gt;Vault1: Unseal
      Vault1--&amp;gt;&amp;gt;Vault1: Decrypt Master Key
      
      Admin-&amp;gt;&amp;gt;Vault2: Join Raft (vault-0)
      Admin-&amp;gt;&amp;gt;Vault2: Unseal
      Vault2--&amp;gt;&amp;gt;Vault2: Decrypt Master Key
      
      Vault0-&amp;gt;&amp;gt;Vault1: Replicate Data
      Vault0-&amp;gt;&amp;gt;Vault2: Replicate Data
  




Accessing the Vault UI

Vault provides a web-based UI for managing secrets, policies, and authentication methods. We’ll configure a NodePort service to make the UI accessible from outside the cluster.

Configuring NodePort Service

kubectl patch svc vault -n vault -p &apos;{&quot;spec&quot;: {&quot;type&quot;: &quot;NodePort&quot;, &quot;ports&quot;: [{&quot;nodePort&quot;: 30000, &quot;port&quot;: 8200, &quot;protocol&quot;: &quot;TCP&quot;}]}}&apos;


Accessing UI with Root Token

CLUSTER_ROOT_TOKEN=$(cat cluster-keys.json | jq -r &quot;.root_token&quot;)

echo $CLUSTER_ROOT_TOKEN
hvs.bOXica9b3vWqfBaiZWfASOC1


UI Access and Authentication


  URL: http://localhost:30000 (if running locally)
  Authentication: Use the root token for initial login
  Security Note: In production, configure TLS and restrict access






Creating a Regular User

kubectl exec --stdin=true --tty=true vault-0 -n vault -- /bin/sh

# activate userpass authentication
vault auth enable userpass

# create user
vault write auth/userpass/users/somaz password=&amp;lt;password&amp;gt; policies=&amp;lt;policies&amp;gt;

# login with user
vault login -method=userpass username=somaz password=&amp;lt;password&amp;gt;




Configuring Vault Secret Engines

Secret engines are components within Vault that store, generate, or encrypt data. Vault treats these engines as a virtual filesystem, where each engine is mounted at a specific path and provides access to secrets through that path.



Enabling the KV Secrets Engine

Understanding KV Secrets Engine


  Version 2 (KV-v2): Provides versioning, metadata, and soft delete capabilities
  Path-Based Access: Secrets are organized in a hierarchical structure
  Use Cases: Ideal for storing configuration data, API keys, passwords, and other static secrets


We’ll mount the KV-v2 engine at the “secret/” path, which is a common convention.








  
    graph TD
      A[Vault Secret Engines] --&amp;gt; B[KV v2]
      A --&amp;gt; C[Database]
      A --&amp;gt; D[PKI]
      A --&amp;gt; E[Transit]
      
      B --&amp;gt; B1[secret/devdb/config]
      B --&amp;gt; B2[Other KV Secrets]
      
      style A stroke:#333,stroke-width:1px,fill:#f5f5f5
      style B stroke:#333,stroke-width:1px,fill:#a5d6a7
      style C stroke:#333,stroke-width:1px,fill:#64b5f6
      style D stroke:#333,stroke-width:1px,fill:#ffcc80
      style E stroke:#333,stroke-width:1px,fill:#ce93d8
  




Implementing Access Control with Policies

Policies in Vault define the capabilities (permissions) a token has for accessing specific paths. They follow the principle of least privilege, allowing precise control over who can access what within Vault.

Creating a Read-Only Policy


  
    
      Policy Element
      Description
    
    
      Path
      Specifies the secret path this policy applies to
    
    
      Capabilities
      Defines allowed operations (create, read, update, delete, list, deny)
    
    
      Scope
      Limited to the specific path and does not extend to sub-paths unless specified
    
  


# Create read-only policy
kubectl exec -it vault-0 -n vault -- vault policy write devdb - &amp;lt;&amp;lt;EOF
path &quot;secret/data/devdb/config&quot; {
  capabilities = [&quot;read&quot;]
}
EOF


Policy Best Practices


  Least Privilege: Grant only the minimum permissions needed
  Path Specificity: Be as specific as possible with paths
  Policy Granularity: Create focused policies that can be combined
  Naming Conventions: Use clear, consistent naming patterns




Integrating with Kubernetes Authentication

Vault’s Kubernetes authentication method enables pods to authenticate with Vault using their Kubernetes service account tokens. This allows for a secure, automated authentication flow without managing additional credentials.

Configuring Kubernetes Authentication


  
    sequenceDiagram
      participant Pod as Application Pod
      participant SA as Service Account
      participant K8s as Kubernetes API
      participant Vault
      
      Pod-&amp;gt;&amp;gt;Vault: Auth with SA token
      Vault-&amp;gt;&amp;gt;K8s: Validate token
      K8s--&amp;gt;&amp;gt;Vault: Token valid, confirm SA/NS
      Vault-&amp;gt;&amp;gt;Vault: Check role bindings
      Vault--&amp;gt;&amp;gt;Pod: Issue limited Vault token
  









  Understanding the Authentication Flow
  The Kubernetes authentication process works as follows:
  
    Token Verification: Vault validates the service account token with Kubernetes API
    Role Binding: Vault checks if the service account is allowed to assume the requested role
    Policy Application: If authorized, Vault issues a token with policies attached to that role
    Automatic Renewal: Vault Agent can automatically renew the token before expiration
  
  This mechanism provides secure, identity-based access without sharing long-lived credentials.


Creating Authentication Roles


  
    
      Parameter
      Purpose
    
    
      bound_service_account_names
      Specifies which service accounts can authenticate
    
    
      bound_service_account_namespaces
      Limits authentication to pods in specific namespaces
    
    
      policies
      Policies to attach to tokens issued by this role
    
    
      ttl
      Maximum lifetime of tokens issued by this role
    
  








Deploying Applications with Vault Integration

The Vault Agent Injector automatically injects secrets into pods at runtime. This approach eliminates the need to store secrets in ConfigMaps, environment variables, or the application code itself.

Preparing the Kubernetes Environment

# Create namespace
kubectl create namespace somaz

# Create service account
kubectl create serviceaccount somaz-app -n somaz


Deploying a Pod with Vault Integration


  
    graph TD
      A[Pod Creation] --&amp;gt; B[Admission Controller]
      B --&amp;gt; C[Vault Agent Injector]
      C --&amp;gt; D[Pod Mutation]
      D --&amp;gt; E[Add Init Container]
      D --&amp;gt; F[Add Agent Container]
      E --&amp;gt; G[Fetch Secrets]
      G --&amp;gt; H[Write to Volume]
      F --&amp;gt; I[Auto Renew Tokens]
      
      style A stroke:#333,stroke-width:1px,fill:#f5f5f5
      style B stroke:#333,stroke-width:1px,fill:#a5d6a7
      style C stroke:#333,stroke-width:1px,fill:#64b5f6
      style D stroke:#333,stroke-width:1px,fill:#ffcc80
      style E stroke:#333,stroke-width:1px,fill:#ce93d8
      style F stroke:#333,stroke-width:1px,fill:#ce93d8
      style G stroke:#333,stroke-width:1px,fill:#81c784
      style H stroke:#333,stroke-width:1px,fill:#81c784
      style I stroke:#333,stroke-width:1px,fill:#81c784
  


# Application Pod with Vault annotations
apiVersion: v1
kind: Pod
metadata:
  name: devsomazapp
  labels:
    app: devsomazapp
  annotations:
    vault.hashicorp.com/agent-inject: &quot;true&quot;
    vault.hashicorp.com/role: &quot;db-app&quot;
    vault.hashicorp.com/agent-inject-secret-credentials.txt: &quot;secret/data/devdb/config&quot;
spec:
  serviceAccountName: somaz-app
  containers:
    - name: devsomazapp
      image: jweissig/app:0.0.1



  Understanding Vault Annotations
  The annotations in the pod specification control how Vault Agent injects secrets:
  
    agent-inject: Enables the injection feature
    role: Specifies which Vault role to authenticate as
    agent-inject-secret-[filename]: Defines which secret to inject and where
    agent-inject-template-[filename] (optional): Provides a template for formatting the secret
  
  When the pod is created, the Vault Agent Injector automatically adds the necessary containers to fetch and manage secrets.


Deploying and Verifying

# Apply the pod definition
kubectl apply -f devsomazapp.yaml -n somaz

# Check the secret has been injected
kubectl exec -it devsomazapp -c devsomazapp -n somaz -- cat /vault/secrets/credentials.txt




Working with Multiple Secrets

Applications often need access to multiple secrets. Vault makes it easy to inject multiple secrets into the same pod, each with its own path and access controls.

Adding Another Secret





Updating the Pod Definition

# Updated pod with multiple secrets
apiVersion: v1
kind: Pod
metadata:
  name: devsomazapp
  labels:
    app: devsomazapp
  annotations:
    vault.hashicorp.com/agent-inject: &quot;true&quot;
    vault.hashicorp.com/role: &quot;db-app&quot;
    vault.hashicorp.com/agent-inject-secret-devdb.txt: &quot;secret/data/devdb/config&quot;
    vault.hashicorp.com/agent-inject-secret-qadb.txt: &quot;secret/data/qadb/config&quot;
spec:
  serviceAccountName: somaz-app
  containers:
    - name: devsomazapp
      image: jweissig/app:0.0.1



  
    
      Secret Path
      Mount Location
      Content
    
    
      secret/data/devdb/config
      /vault/secrets/devdb.txt
      Development database credentials
    
    
      secret/data/qadb/config
      /vault/secrets/qadb.txt
      QA database credentials
    
  


Verifying Multiple Secrets

# Recreate the pod with updated annotations
kubectl delete pod devsomazapp -n somaz
kubectl apply -f devsomazapp.yaml -n somaz

# Check for injected secrets
kubectl exec -it devsomazapp -c devsomazapp -n somaz -- ls /vault/secrets/
devdb.txt  qadb.txt

# View the content of each secret
kubectl exec -it devsomazapp -c devsomazapp -n somaz -- cat /vault/secrets/devdb.txt
kubectl exec -it devsomazapp -c devsomazapp -n somaz -- cat /vault/secrets/qadb.txt




Managing User Permissions


Beyond service accounts, Vault also supports human users with different levels of access. Proper user management is critical for maintaining security while enabling administrative tasks.


Understanding User Policies


  
    graph TD
      A[Vault Policies] --&amp;gt; B[Root]
      A --&amp;gt; C[Admin]
      A --&amp;gt; D[DevDB]
      A --&amp;gt; E[QADB]
      
      B --&amp;gt; B1[All Paths]
      C --&amp;gt; C1[Limited Admin]
      D --&amp;gt; D1[Dev Secrets]
      E --&amp;gt; E1[QA Secrets]
      
      style A stroke:#333,stroke-width:1px,fill:#f5f5f5
      style B stroke:#333,stroke-width:1px,fill:#a5d6a7
      style C stroke:#333,stroke-width:1px,fill:#64b5f6
      style D stroke:#333,stroke-width:1px,fill:#ffcc80
      style E stroke:#333,stroke-width:1px,fill:#ce93d8
  



  Root Token Security
  The root token has unlimited access to all Vault resources. For security reasons:
  
    Avoid Regular Use: Don&apos;t use the root token for daily operations
    Create Admin Users: Set up users with appropriate permissions
    Revoke After Setup: Consider revoking the root token after initial setup
    Regenerate When Needed: Root tokens can be recreated with unseal keys if needed
  
  Using properly scoped tokens reduces the risk of accidental or malicious damage.


Creating an Admin Policy

# Login with root token
kubectl exec -it vault-0 -n vault -- vault login $CLUSTER_ROOT_TOKEN

# Create admin policy
kubectl exec -it vault-0 -n vault -- vault policy write admin - &amp;lt;&amp;lt;EOF
path &quot;*&quot; {
  capabilities = [&quot;create&quot;, &quot;read&quot;, &quot;update&quot;, &quot;delete&quot;, &quot;list&quot;, &quot;sudo&quot;]
}
EOF

# Assign admin policy to a user
kubectl exec -it vault-0 -n vault -- vault write auth/userpass/users/somaz policies=admin

# Verify user policies
kubectl exec -it vault-0 -n vault -- vault read auth/userpass/users/somaz



  
    
      Policy Name
      Scope
      Typical User
    
    
      root
      Unlimited access
      Initial setup only, emergency access
    
    
      admin
      Full system control
      Vault administrators
    
    
      devdb
      Read dev secrets
      Development applications
    
    
      qadb
      Read QA secrets
      QA applications
    
  




Key Points and Best Practices


  💡 Vault Security Essentials
  
    
      Initialization and Unsealing
      - Store unseal keys securely and separately
      - Consider using auto-unseal for production
      - Revoke the root token after initial configuration
    
    
      Authentication and Authorization
      - Use the Kubernetes auth method for applications
      - Implement fine-grained policies following least privilege
      - Prefer short-lived tokens with automatic renewal
    
    
      Secret Injection
      - Use the Vault Agent Injector for Kubernetes integration
      - Template secrets to match application requirements
      - Implement secret rotation for sensitive credentials
    
    
      Operational Readiness
      - Set up monitoring and alerting for Vault status
      - Configure regular backups of Vault data
      - Implement proper audit logging
    
  






References

  Vault Kubernetes Deployment Guide
  Vault Helm Chart
  Vault on GKE Guide
  Vault Policy Documentation
  Vault Agent Injector Documentation
  Vault Authentication Methods

",
            "wordcount": "3077",
            "inLanguage": "en",
            "dateCreated": "2025-05-27/",
            "datePublished": "2025-05-27/",
            "dateModified": "2025-05-27/",
            "author": {
                "@type": "Person",
                "name": "Somaz",
                
                "image": "/assets/img/uploads/profile.png",
                
                "jobTitle": "DevOps Engineer",
                "url": "https://somaz.blog/authors/somaz/",
                "sameAs": [
                    "https://github.com/somaz94","https://www.linkedin.com/in/somaz"
                ]
            },
            "publisher": {
                "@type": "Organization",
                "name": "somaz",
                "url": "https://somaz.blog/",
                "logo": {
                    "@type": "ImageObject",
                    "url": "https://somaz.blog/assets/img/blog-image.png",
                    "width": "600",
                    "height": "315"
                }
            },
            "mainEntityOfPage": "True",
            "genre": "SECURITY",
            "articleSection": "SECURITY",
            "keywords": ["vault","kubernetes","security","kind"]
        }
        </script>
    </body>
</html>
