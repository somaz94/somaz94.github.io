<!DOCTYPE html>
<html lang="en" class="no-js">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    

    
    

    
    

    
    

    <!-- âœ… Google Tag Manager ì¶”ê°€ -->
    <script>
        (function(w,d,s,l,i){
            w[l]=w[l]||[];
            w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
            var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
            j.async=true;
            j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
            f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-MBP83N4Q');
    </script>
      <!-- âœ… End Google Tag Manager -->

    <!-- Mermaid.js ì§ì ‘ ë¡œë“œ -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>

    <title>What is Loki? | somaz</title>
    <meta name="description" content="Learn about Grafana Loki, its architecture, components, and how it works with Promtail for efficient log aggregation">
    
        <meta name="keywords" content="loki, promtail, logging, kubernetes">
    

    <!-- Social: Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="What is Loki? | somaz">
    <meta name="twitter:description" content="Learn about Grafana Loki, its architecture, components, and how it works with Promtail for efficient log aggregation">

    
        <meta property="twitter:image" content="https://res.cloudinary.com/dkcm26aem/image/upload/v1738641136/loki_anz45n.png">
    
    
    
        <meta name="twitter:site" content="@twitter_username">
    

    <!-- Social: Facebook / Open Graph -->
    <meta property="og:url" content="https://somaz.blog/category/monitoring/loki/">
    <meta property="og:title" content="What is Loki? | somaz">
    <meta property="og:image" content="https://res.cloudinary.com/dkcm26aem/image/upload/v1738641136/loki_anz45n.png">
    <meta property="og:description" content="Learn about Grafana Loki, its architecture, components, and how it works with Promtail for efficient log aggregation">
    <meta property="og:site_name" content="Somaz Tech Blog">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/assets/img/icons/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/img/icons/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/img/icons/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/img/icons/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/img/icons/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/img/icons/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/img/icons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/icons/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/img/icons/apple-touch-icon-152x152.png" />

    <!-- Windows 8 Tile Icons -->
    <meta name="application-name" content="somaz">
    <meta name="msapplication-TileColor" content="#141414">
    <meta name="msapplication-square70x70logo" content="smalltile.png" />
    <meta name="msapplication-square150x150logo" content="mediumtile.png" />
    <meta name="msapplication-wide310x150logo" content="widetile.png" />
    <meta name="msapplication-square310x310logo" content="largetile.png" />
    
    <!-- Android Lolipop Theme Color -->
    <meta name="theme-color" content="#141414">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Titillium+Web:300,400,700" rel="stylesheet">

    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="canonical" href="https://somaz.blog/category/monitoring/loki/">
    <link rel="alternate" type="application/rss+xml" title="Somaz Tech Blog" href="https://somaz.blog/feed.xml" />

    <!-- Include extra styles -->
    

    <!-- JavaScript enabled/disabled -->
    <script>
        document.querySelector('html').classList.remove('no-js');
    </script>

    <!-- Google Adsense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8725590811736154"
        crossorigin="anonymous"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"> -->
    <!-- <link href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/variable/woff2/SUIT-Variable.css" rel="stylesheet"> -->
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- <link href="https://fonts.googleapis.com/css2?family=Albert+Sans:wght@400;500;700&display=swap" rel="stylesheet"> -->

    <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml" />

</head>
<!-- âœ… Google Tag Manager (noscript) -->
<noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MBP83N4Q"
            height="0" width="0" style="display:none;visibility:hidden">
    </iframe>
</noscript>
<!-- âœ… End Google Tag Manager (noscript) -->
    <body class="has-push-menu">
        





        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" display="none" version="1.1"><defs><symbol id="icon-menu" viewBox="0 0 1024 1024"><path class="path1" d="M128 213.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 725.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 469.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5z"/></symbol><symbol id="icon-search" viewBox="0 0 951 1024"><path class="path1" d="M658.286 475.429q0-105.714-75.143-180.857t-180.857-75.143-180.857 75.143-75.143 180.857 75.143 180.857 180.857 75.143 180.857-75.143 75.143-180.857zM950.857 950.857q0 29.714-21.714 51.429t-51.429 21.714q-30.857 0-51.429-21.714l-196-195.429q-102.286 70.857-228 70.857-81.714 0-156.286-31.714t-128.571-85.714-85.714-128.571-31.714-156.286 31.714-156.286 85.714-128.571 128.571-85.714 156.286-31.714 156.286 31.714 128.571 85.714 85.714 128.571 31.714 156.286q0 125.714-70.857 228l196 196q21.143 21.143 21.143 51.429z"/></symbol><symbol id="icon-close" viewBox="0 0 1000 1000"><path d="M969.8,870.3c27,27.7,27,71.8,0,99.1C955.7,983,937.9,990,920,990c-17.9,0-35.7-7-49.7-20.7L500,599L129.6,969.4C115.6,983,97.8,990,79.9,990s-35.7-7-49.7-20.7c-27-27.3-27-71.4,0-99.1L400.9,500L30.3,129.3c-27-27.3-27-71.4,0-99.1c27.3-27,71.8-27,99.4,0L500,400.9L870.4,30.2c27.7-27,71.8-27,99.4,0c27,27.7,27,71.8,0,99.1L599.1,500L969.8,870.3z"/></symbol><symbol id="icon-twitter" viewBox="0 0 951 1024"><path class="path1" d="M925.714 233.143q-38.286 56-92.571 95.429 0.571 8 0.571 24 0 74.286-21.714 148.286t-66 142-105.429 120.286-147.429 83.429-184.571 31.143q-154.857 0-283.429-82.857 20 2.286 44.571 2.286 128.571 0 229.143-78.857-60-1.143-107.429-36.857t-65.143-91.143q18.857 2.857 34.857 2.857 24.571 0 48.571-6.286-64-13.143-106-63.714t-42-117.429v-2.286q38.857 21.714 83.429 23.429-37.714-25.143-60-65.714t-22.286-88q0-50.286 25.143-93.143 69.143 85.143 168.286 136.286t212.286 56.857q-4.571-21.714-4.571-42.286 0-76.571 54-130.571t130.571-54q80 0 134.857 58.286 62.286-12 117.143-44.571-21.143 65.714-81.143 101.714 53.143-5.714 106.286-28.571z"/></symbol><symbol id="icon-facebook" viewBox="0 0 585 1024"><path class="path1" d="M548 6.857v150.857h-89.714q-49.143 0-66.286 20.571t-17.143 61.714v108h167.429l-22.286 169.143h-145.143v433.714h-174.857v-433.714h-145.714v-169.143h145.714v-124.571q0-106.286 59.429-164.857t158.286-58.571q84 0 130.286 6.857z"/></symbol><symbol id="icon-clock" viewBox="0 0 1000 1000"><path d="M500,10C229.8,10,10,229.8,10,500c0,270.2,219.8,490,490,490c270.2,0,490-219.8,490-490C990,229.8,770.2,10,500,10z M500,910.2c-226.2,0-410.2-184-410.2-410.2c0-226.2,184-410.2,410.2-410.2c226.2,0,410.2,184,410.2,410.2C910.2,726.1,726.2,910.2,500,910.2z M753.1,374c8.2,11.9,5.2,28.1-6.6,36.3L509.9,573.7c-4.4,3.1-9.6,4.6-14.8,4.6c-4.1,0-8.3-1-12.1-3c-8.6-4.5-14-13.4-14-23.1V202.5c0-14.4,11.7-26.1,26.1-26.1c14.4,0,26.1,11.7,26.1,26.1v300l195.6-135.1C728.7,359.2,744.9,362.1,753.1,374z"/></symbol><symbol id="icon-calendar" viewBox="0 0 1000 1000"><path d="M920,500v420H80V500H920 M990,430H10v490c0,38.7,31.3,70,70,70h840c38.7,0,70-31.3,70-70V430L990,430z"/><path d="M850,80v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80H360v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80C72.8,80,10,142.7,10,220v140h980V220C990,142.7,927.2,80,850,80z"/><path d="M255,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C290,25.8,274.3,10,255,10z"/><path d="M745,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C780,25.8,764.3,10,745,10z"/></symbol><symbol id="icon-github" viewBox="0 0 12 14"><path d="M6 1q1.633 0 3.012 0.805t2.184 2.184 0.805 3.012q0 1.961-1.145 3.527t-2.957 2.168q-0.211 0.039-0.312-0.055t-0.102-0.234q0-0.023 0.004-0.598t0.004-1.051q0-0.758-0.406-1.109 0.445-0.047 0.801-0.141t0.734-0.305 0.633-0.52 0.414-0.82 0.16-1.176q0-0.93-0.617-1.609 0.289-0.711-0.062-1.594-0.219-0.070-0.633 0.086t-0.719 0.344l-0.297 0.187q-0.727-0.203-1.5-0.203t-1.5 0.203q-0.125-0.086-0.332-0.211t-0.652-0.301-0.664-0.105q-0.352 0.883-0.062 1.594-0.617 0.68-0.617 1.609 0 0.664 0.16 1.172t0.41 0.82 0.629 0.523 0.734 0.305 0.801 0.141q-0.305 0.281-0.383 0.805-0.164 0.078-0.352 0.117t-0.445 0.039-0.512-0.168-0.434-0.488q-0.148-0.25-0.379-0.406t-0.387-0.187l-0.156-0.023q-0.164 0-0.227 0.035t-0.039 0.090 0.070 0.109 0.102 0.094l0.055 0.039q0.172 0.078 0.34 0.297t0.246 0.398l0.078 0.18q0.102 0.297 0.344 0.48t0.523 0.234 0.543 0.055 0.434-0.027l0.18-0.031q0 0.297 0.004 0.691t0.004 0.426q0 0.141-0.102 0.234t-0.312 0.055q-1.812-0.602-2.957-2.168t-1.145-3.527q0-1.633 0.805-3.012t2.184-2.184 3.012-0.805zM2.273 9.617q0.023-0.055-0.055-0.094-0.078-0.023-0.102 0.016-0.023 0.055 0.055 0.094 0.070 0.047 0.102-0.016zM2.516 9.883q0.055-0.039-0.016-0.125-0.078-0.070-0.125-0.023-0.055 0.039 0.016 0.125 0.078 0.078 0.125 0.023zM2.75 10.234q0.070-0.055 0-0.148-0.062-0.102-0.133-0.047-0.070 0.039 0 0.141t0.133 0.055zM3.078 10.562q0.062-0.062-0.031-0.148-0.094-0.094-0.156-0.023-0.070 0.062 0.031 0.148 0.094 0.094 0.156 0.023zM3.523 10.758q0.023-0.086-0.102-0.125-0.117-0.031-0.148 0.055t0.102 0.117q0.117 0.047 0.148-0.047zM4.016 10.797q0-0.102-0.133-0.086-0.125 0-0.125 0.086 0 0.102 0.133 0.086 0.125 0 0.125-0.086zM4.469 10.719q-0.016-0.086-0.141-0.070-0.125 0.023-0.109 0.117t0.141 0.062 0.109-0.109z"></path></symbol><symbol id="icon-medium" viewBox="0 0 1000 1000"><path d="M336.5,240.2v641.5c0,9.1-2.3,16.9-6.8,23.2s-11.2,9.6-20,9.6c-6.2,0-12.2-1.5-18-4.4L37.3,782.7c-7.7-3.6-14.1-9.8-19.4-18.3S10,747.4,10,739V115.5c0-7.3,1.8-13.5,5.5-18.6c3.6-5.1,8.9-7.7,15.9-7.7c5.1,0,13.1,2.7,24.1,8.2l279.5,140C335.9,238.6,336.5,239.5,336.5,240.2L336.5,240.2z M371.5,295.5l292,473.6l-292-145.5V295.5z M990,305.3v576.4c0,9.1-2.6,16.5-7.7,22.1c-5.1,5.7-12,8.5-20.8,8.5s-17.3-2.4-25.7-7.1L694.7,784.9L990,305.3z M988.4,239.7c0,1.1-46.8,77.6-140.3,229.4C754.6,621,699.8,709.8,683.8,735.7L470.5,389l177.2-288.2c6.2-10.2,15.7-15.3,28.4-15.3c5.1,0,9.8,1.1,14.2,3.3l295.9,147.7C987.6,237.1,988.4,238.2,988.4,239.7L988.4,239.7z"/></symbol><symbol id="icon-instagram" viewBox="0 0 489.84 489.84"><path d="M249.62,50.46c65.4,0,73.14.25,99,1.43C372.47,53,385.44,57,394.07,60.32a75.88,75.88,0,0,1,28.16,18.32,75.88,75.88,0,0,1,18.32,28.16c3.35,8.63,7.34,21.6,8.43,45.48,1.18,25.83,1.43,33.57,1.43,99s-0.25,73.14-1.43,99c-1.09,23.88-5.08,36.85-8.43,45.48a81.11,81.11,0,0,1-46.48,46.48c-8.63,3.35-21.6,7.34-45.48,8.43-25.82,1.18-33.57,1.43-99,1.43s-73.15-.25-99-1.43c-23.88-1.09-36.85-5.08-45.48-8.43A75.88,75.88,0,0,1,77,423.86,75.88,75.88,0,0,1,58.69,395.7c-3.35-8.63-7.34-21.6-8.43-45.48-1.18-25.83-1.43-33.57-1.43-99s0.25-73.14,1.43-99c1.09-23.88,5.08-36.85,8.43-45.48A75.88,75.88,0,0,1,77,78.64a75.88,75.88,0,0,1,28.16-18.32c8.63-3.35,21.6-7.34,45.48-8.43,25.83-1.18,33.57-1.43,99-1.43m0-44.13c-66.52,0-74.86.28-101,1.47s-43.87,5.33-59.45,11.38A120.06,120.06,0,0,0,45.81,47.44,120.06,120.06,0,0,0,17.56,90.82C11.5,106.4,7.36,124.2,6.17,150.27s-1.47,34.46-1.47,101,0.28,74.86,1.47,101,5.33,43.87,11.38,59.45a120.06,120.06,0,0,0,28.25,43.38,120.06,120.06,0,0,0,43.38,28.25c15.58,6.05,33.38,10.19,59.45,11.38s34.46,1.47,101,1.47,74.86-.28,101-1.47,43.87-5.33,59.45-11.38a125.24,125.24,0,0,0,71.63-71.63c6.05-15.58,10.19-33.38,11.38-59.45s1.47-34.46,1.47-101-0.28-74.86-1.47-101-5.33-43.87-11.38-59.45a120.06,120.06,0,0,0-28.25-43.38,120.06,120.06,0,0,0-43.38-28.25C394.47,13.13,376.67,9,350.6,7.8s-34.46-1.47-101-1.47h0Z" transform="translate(-4.7 -6.33)" /><path d="M249.62,125.48A125.77,125.77,0,1,0,375.39,251.25,125.77,125.77,0,0,0,249.62,125.48Zm0,207.41a81.64,81.64,0,1,1,81.64-81.64A81.64,81.64,0,0,1,249.62,332.89Z" transform="translate(-4.7 -6.33)"/><circle cx="375.66" cy="114.18" r="29.39" /></symbol><symbol id="icon-linkedin" viewBox="0 0 12 14"><path d="M2.727 4.883v7.742h-2.578v-7.742h2.578zM2.891 2.492q0.008 0.57-0.395 0.953t-1.059 0.383h-0.016q-0.641 0-1.031-0.383t-0.391-0.953q0-0.578 0.402-0.957t1.051-0.379 1.039 0.379 0.398 0.957zM12 8.187v4.437h-2.57v-4.141q0-0.82-0.316-1.285t-0.988-0.465q-0.492 0-0.824 0.27t-0.496 0.668q-0.086 0.234-0.086 0.633v4.32h-2.57q0.016-3.117 0.016-5.055t-0.008-2.313l-0.008-0.375h2.57v1.125h-0.016q0.156-0.25 0.32-0.438t0.441-0.406 0.68-0.34 0.895-0.121q1.336 0 2.148 0.887t0.813 2.598z"></path></symbol><symbol id="icon-heart" viewBox="0 0 34 30"><path d="M17,29.7 L16.4,29.2 C3.5,18.7 0,15 0,9 C0,4 4,0 9,0 C13.1,0 15.4,2.3 17,4.1 C18.6,2.3 20.9,0 25,0 C30,0 34,4 34,9 C34,15 30.5,18.7 17.6,29.2 L17,29.7 Z M9,2 C5.1,2 2,5.1 2,9 C2,14.1 5.2,17.5 17,27.1 C28.8,17.5 32,14.1 32,9 C32,5.1 28.9,2 25,2 C21.5,2 19.6,4.1 18.1,5.8 L17,7.1 L15.9,5.8 C14.4,4.1 12.5,2 9,2 Z" id="Shape"></path></symbol><symbol id="icon-arrow-right" viewBox="0 0 25.452 25.452"><path d="M4.471,24.929v-2.004l12.409-9.788c0.122-0.101,0.195-0.251,0.195-0.411c0-0.156-0.073-0.31-0.195-0.409L4.471,2.526V0.522c0-0.2,0.115-0.384,0.293-0.469c0.18-0.087,0.396-0.066,0.552,0.061l15.47,12.202c0.123,0.1,0.195,0.253,0.195,0.409c0,0.16-0.072,0.311-0.195,0.411L5.316,25.34c-0.155,0.125-0.372,0.147-0.552,0.061C4.586,25.315,4.471,25.13,4.471,24.929z"/></symbol><symbol id="icon-star" viewBox="0 0 48 48"><path fill="currentColor" d="M44,24c0,11.045-8.955,20-20,20S4,35.045,4,24S12.955,4,24,4S44,12.955,44,24z"/><path fill="#ffffff" d="M24,11l3.898,7.898l8.703,1.301l-6.301,6.102l1.5,8.699L24,30.898L16.199,35l1.5-8.699l-6.301-6.102  l8.703-1.301L24,11z"/></symbol><symbol id="icon-read" viewBox="0 0 32 32"><path fill="currentColor" d="M29,4H3C1.343,4,0,5.343,0,7v18c0,1.657,1.343,3,3,3h10c0,0.552,0.448,1,1,1h4c0.552,0,1-0.448,1-1h10  c1.657,0,3-1.343,3-3V7C32,5.343,30.657,4,29,4z M29,5v20H18.708c-0.618,0-1.236,0.146-1.789,0.422l-0.419,0.21V5H29z M15.5,5  v20.632l-0.419-0.21C14.528,25.146,13.91,25,13.292,25H3V5H15.5z M31,25c0,1.103-0.897,2-2,2H18v1h-4v-1H3c-1.103,0-2-0.897-2-2V7  c0-0.737,0.405-1.375,1-1.722V25c0,0.552,0.448,1,1,1h10.292c0.466,0,0.925,0.108,1.342,0.317l0.919,0.46  c0.141,0.07,0.294,0.106,0.447,0.106c0.153,0,0.306-0.035,0.447-0.106l0.919-0.46C17.783,26.108,18.242,26,18.708,26H29  c0.552,0,1-0.448,1-1V5.278C30.595,5.625,31,6.263,31,7V25z M6,12.5C6,12.224,6.224,12,6.5,12h5c0.276,0,0.5,0.224,0.5,0.5  S11.776,13,11.5,13h-5C6.224,13,6,12.776,6,12.5z M6,14.5C6,14.224,6.224,14,6.5,14h5c0.276,0,0.5,0.224,0.5,0.5S11.776,15,11.5,15  h-5C6.224,15,6,14.776,6,14.5z M6,16.5C6,16.224,6.224,16,6.5,16h5c0.276,0,0.5,0.224,0.5,0.5S11.776,17,11.5,17h-5  C6.224,17,6,16.776,6,16.5z M20,12.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,13,25.5,13h-5  C20.224,13,20,12.776,20,12.5z M20,14.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,15,25.5,15h-5  C20.224,15,20,14.776,20,14.5z M20,16.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,17,25.5,17h-5  C20.224,17,20,16.776,20,16.5z"></path></symbol><symbol id="icon-tistory" viewBox="0 0 24 24"><path d="M4 4h16v3h-6v13h-4V7H4V4z"/></symbol></defs></svg>

        <header class="bar-header">
    <a id="menu" role="button">
        <svg id="open" class="icon-menu"><use xlink:href="#icon-menu"></use></svg>
    </a>
    <h1 class="logo">
        <a href="/">
            
                somaz <span class="version">v3.1.2</span>
            
        </a>
    </h1>
    <a id="search" class="dosearch" role="button">
        <svg class="icon-search"><use xlink:href="#icon-search"></use></svg>
    </a>
    
        <a href="https://github.com/thiagorossener/jekflix-template" class="get-theme" role="button">
            Get this theme!
        </a>
    
</header>

<div id="mask" class="overlay"></div>

<aside class="sidebar" id="sidebar">
    <nav id="navigation">
      <h2>Menu</h2>
      <ul>
  
    
      <li>
        <a href="https://somaz.blog/">Home</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/about">About</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/category">Category</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/contact">Contact</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/feed.xml">Feed</a>
      </li>
    
  
</ul>

    </nav>
</aside>

<div class="search-wrapper">
    <div class="search-form">
        <input type="text" class="search-field" placeholder="Search">
        <svg class="icon-remove-sign"><use xlink:href="#icon-close"></use></svg>
        <ul class="search-results search-list"></ul>
    </div>
</div>



        <section class="post two-columns">
            <article role="article" class="post-content">
                <p class="post-info">
                    
                        <svg class="icon-calendar" id="date"><use xlink:href="#icon-calendar"></use></svg>
                        <time class="date" datetime="2025-02-03T16:00:00+00:00">
                            


February 3, 2025

                        </time>
                    
                    <svg id="clock" class="icon-clock"><use xlink:href="#icon-clock"></use></svg>
                    <span>13 min to read</span>
                </p>
                <h1 class="post-title">What is Loki?</h1>
                <p class="post-subtitle">A comprehensive guide to Grafana Loki and its components</p>

                
                    <img src="https://res.cloudinary.com/dkcm26aem/image/upload/v1738641136/loki_anz45n.png" alt="Featured image" class="post-cover">
                

                <!-- Pagination links -->



                <!-- Add your table of contents here -->


                <p><a href="https://github.com/grafana/loki">Image Reference</a></p>

<p><br /></p>

<hr />

<h2 id="what-is-loki">What is Loki?</h2>

<div class="info-box info-box-modern">
Grafana Loki is a horizontally-scalable, highly-available log aggregation system designed specifically for cloud-native environments. Unlike traditional logging solutions, Loki indexes metadata rather than log content, resulting in a cost-effective, efficient logging platform that integrates seamlessly with Prometheus and Grafana.
</div>

<h3 id="introduction-to-loki">Introduction to Loki</h3>

<div class="info-box info-box-default-not-check">
  <strong>The Log Aggregation Challenge</strong>
  <p>Modern cloud-native environments generate vast amounts of log data that need to be collected, stored, and analyzed efficiently. Traditional logging solutions often become prohibitively expensive at scale due to their approach of indexing the entire log content.</p>
  
  <p>Grafana Labs developed Loki to address these challenges by taking a different approach:</p>
  <ul>
    <li><strong>Label-Based Indexing</strong>: Indexes metadata (labels) instead of log content</li>
    <li><strong>Prometheus-Inspired</strong>: Uses the same label selector approach as Prometheus</li>
    <li><strong>Cloud-Native Design</strong>: Built for containerized environments from the ground up</li>
    <li><strong>Resource Efficient</strong>: Significantly lower resource requirements compared to traditional solutions</li>
    <li><strong>Cost-Effective</strong>: Designed to keep operational costs manageable even at scale</li>
  </ul>
  
  <p>This innovative approach allows organizations to collect and retain more logs for longer periods without exponential cost increases.</p>
</div>

<h3 id="key-features-and-benefits">Key Features and Benefits</h3>

<div style="width: 100%; margin: 20px auto;">
  <div class="mermaid">
    graph LR
      A[Loki Key Features]
      
      A --&gt; B[Cost Efficiency]
      B --&gt; B1[Lower storage requirements]
      B --&gt; B2[Less CPU and memory usage]
      
      A --&gt; C[Seamless Integration]
      C --&gt; C1[Native Grafana integration]
      C --&gt; C2[Prometheus-compatible labels]
      C --&gt; C3[Works with existing log formats]
      
      A --&gt; D[Operational Simplicity]
      D --&gt; D1[Single binary deployment option]
      D --&gt; D2[Horizontally scalable components]
      D --&gt; D3[Cloud storage compatibility]
      
      A --&gt; E[Advanced Capabilities]
      E --&gt; E1[LogQL query language]
      E --&gt; E2[Metrics extraction from logs]
      E --&gt; E3[Real-time log tailing]
      
      style A fill:#f5f5f5,stroke:#333,stroke-width:1px
      style B fill:#a5d6a7,stroke:#333,stroke-width:1px
      style C fill:#64b5f6,stroke:#333,stroke-width:1px
      style D fill:#ffcc80,stroke:#333,stroke-width:1px
      style E fill:#ce93d8,stroke:#333,stroke-width:1px
  </div>
</div>

<div class="table-container">
  <table class="table-beauty">
    <tr>
      <th style="width: 20%;">Feature</th>
      <th style="width: 80%;">Description</th>
    </tr>
    <tr>
      <td><strong>Label-Based Indexing</strong></td>
      <td>
        <ul>
          <li>Indexes metadata (labels) instead of full log content</li>
          <li>Significantly reduces storage and computational requirements</li>
          <li>Enables efficient querying using familiar Prometheus-style label selectors</li>
        </ul>
      </td>
    </tr>
    <tr>
      <td><strong>LogQL</strong></td>
      <td>
        <ul>
          <li>Dedicated query language inspired by PromQL</li>
          <li>Supports both label filtering and log content searching</li>
          <li>Enables complex expressions and log aggregations</li>
          <li>Can extract metrics from logs for visualization and alerting</li>
        </ul>
      </td>
    </tr>
    <tr>
      <td><strong>Multi-Tenancy</strong></td>
      <td>
        <ul>
          <li>Built-in support for multiple tenants within a single Loki cluster</li>
          <li>Strict data isolation between tenants</li>
          <li>Enables shared infrastructure with logical separation</li>
        </ul>
      </td>
    </tr>
    <tr>
      <td><strong>Storage Flexibility</strong></td>
      <td>
        <ul>
          <li>Supports various object storage backends (S3, GCS, Azure Blob, etc.)</li>
          <li>Can use local file system for smaller deployments</li>
          <li>Separation of index and chunks for optimized performance</li>
        </ul>
      </td>
    </tr>
    <tr>
      <td><strong>Integration Ecosystem</strong></td>
      <td>
        <ul>
          <li>Native integration with Grafana for visualization</li>
          <li>Compatible with Prometheus for unified observability</li>
          <li>Wide range of log shippers and forwarders (Promtail, Fluentd, Logstash, etc.)</li>
        </ul>
      </td>
    </tr>
  </table>
</div>

<p><br /></p>

<hr />

<h2 id="loki-architecture">Loki Architecture</h2>

<div class="info-box info-box-modern">
Loki's architecture is designed for horizontal scalability and high availability, with components that can be deployed either as a monolith for simplicity or as separate microservices for production environments. This section explores the architecture and interactions between Loki's components.
</div>

<h3 id="deployment-models">Deployment Models</h3>

<div style="width: 100%; margin: 20px auto;">
  <div class="mermaid">
    graph LR
      subgraph "Monolithic Deployment"
        A1[Loki Binary]
        A1 --&gt;|Contains| B1[Distributor]
        A1 --&gt;|Contains| C1[Ingester]
        A1 --&gt;|Contains| D1[Querier]
        A1 --&gt;|Contains| E1[Query Frontend]
      end
      
      subgraph "Microservices Deployment"
        B2[Distributor]
        C2[Ingester]
        D2[Querier]
        E2[Query Frontend]
        F2[Compactor]
      end
      
      style A1 fill:#a5d6a7,stroke:#333,stroke-width:1px
      style B1 fill:#64b5f6,stroke:#333,stroke-width:1px
      style C1 fill:#ffcc80,stroke:#333,stroke-width:1px
      style D1 fill:#ce93d8,stroke:#333,stroke-width:1px
      style E1 fill:#ef9a9a,stroke:#333,stroke-width:1px
      style B2 fill:#64b5f6,stroke:#333,stroke-width:1px
      style C2 fill:#ffcc80,stroke:#333,stroke-width:1px
      style D2 fill:#ce93d8,stroke:#333,stroke-width:1px
      style E2 fill:#ef9a9a,stroke:#333,stroke-width:1px
      style F2 fill:#9fa8da,stroke:#333,stroke-width:1px
  </div>
</div>

<p><br /></p>

<div class="info-box info-box-default-not-check">
  <strong>Deployment Options</strong>
  <p>Loki offers flexible deployment models to accommodate different requirements:</p>
  
  <ol>
    <li><strong>Monolithic Mode</strong>
      <ul>
        <li>Single binary containing all components</li>
        <li>Ideal for small to medium deployments</li>
        <li>Simpler to deploy and manage</li>
        <li>Lower operational overhead</li>
      </ul>
    </li>
    <li><strong>Microservices Mode</strong>
      <ul>
        <li>Components deployed as separate services</li>
        <li>Higher scalability and resilience</li>
        <li>Independent scaling of components based on workload</li>
        <li>Recommended for production and large-scale deployments</li>
      </ul>
    </li>
    <li><strong>Simple Scalable Mode</strong>
      <ul>
        <li>A middle ground between monolithic and microservices</li>
        <li>Groups compatible components together</li>
        <li>Reduces operational complexity while providing scalability</li>
      </ul>
    </li>
  </ol>
</div>

<h3 id="core-components">Core Components</h3>

<div style="width: 100%; margin: 20px auto;">
  <div class="mermaid">
    graph TD
      A[Promtail/Log Sources] --&gt;|Push logs| B[Distributor]
      B --&gt;|Distribute logs| C[Ingester]
      C --&gt;|Write| D1[Index Store]
      C --&gt;|Write| D2[Chunk Store]
      E[Querier] --&gt;|Read| C
      E --&gt;|Read| D1
      E --&gt;|Read| D2
      F[Query Frontend] --&gt;|Route queries| E
      G[Grafana/HTTP API] --&gt;|Query| F
      H[Compactor] --&gt;|Optimize| D1
      
      style A fill:#f5f5f5,stroke:#333,stroke-width:1px
      style B fill:#a5d6a7,stroke:#333,stroke-width:1px
      style C fill:#64b5f6,stroke:#333,stroke-width:1px
      style D1 fill:#ffcc80,stroke:#333,stroke-width:1px
      style D2 fill:#ffcc80,stroke:#333,stroke-width:1px
      style E fill:#ce93d8,stroke:#333,stroke-width:1px
      style F fill:#ef9a9a,stroke:#333,stroke-width:1px
      style G fill:#f5f5f5,stroke:#333,stroke-width:1px
      style H fill:#9fa8da,stroke:#333,stroke-width:1px
  </div>
</div>

<div class="table-container">
  <table class="table-beauty">
    <tr>
      <th style="width: 20%;">Component</th>
      <th style="width: 80%;">Description</th>
    </tr>
    <tr>
      <td><strong>Distributor</strong></td>
      <td>
        <ul>
          <li>Acts as the initial entry point for logs</li>
          <li>Validates incoming logs and ensures they have the correct format and labels</li>
          <li>Distributes log data across ingesters using consistent hashing</li>
          <li>Provides tenant isolation in multi-tenant setups</li>
          <li>Implements rate limiting to protect the system from overload</li>
  </ul>
      </td>
    </tr>
    <tr>
      <td><strong>Ingester</strong></td>
      <td>
        <ul>
          <li>Receives log data from distributors</li>
          <li>Batches and compresses logs in memory</li>
          <li>Writes compressed log chunks to object storage</li>
          <li>Updates the index with label-to-chunk mappings</li>
          <li>Manages the Write-Ahead Log (WAL) for data durability</li>
  </ul>
      </td>
    </tr>
    <tr>
      <td><strong>Querier</strong></td>
      <td>
        <ul>
          <li>Processes LogQL queries from clients</li>
          <li>Retrieves logs from both ingesters (recent data) and storage (historical data)</li>
          <li>Merges, deduplicates, and filters results</li>
          <li>Executes log filtering and metric extraction operations</li>
  </ul>
      </td>
    </tr>
    <tr>
      <td><strong>Query Frontend</strong></td>
      <td>
        <ul>
          <li>Optimizes and parallelizes queries for better performance</li>
          <li>Implements query caching to reduce duplicate processing</li>
          <li>Manages query scheduling and retries</li>
          <li>Provides query sharding for improved scalability</li>
  </ul>
      </td>
    </tr>
    <tr>
      <td><strong>Compactor</strong></td>
      <td>
        <ul>
          <li>Optimizes index storage by compacting and deduplicating index entries</li>
          <li>Improves query performance by creating more efficient index structures</li>
          <li>Runs as a background process with configurable intervals</li>
  </ul>
      </td>
    </tr>
  </table>
</div>

<h3 id="storage-architecture">Storage Architecture</h3>

<div class="info-box info-box-default">
  <strong>Loki's Storage Layers</strong>
  <p>Loki separates storage concerns into distinct components:</p>
  
  <ol>
    <li><strong>Index Store</strong>
      <ul>
        <li>Contains mappings of labels to log chunks</li>
        <li>Optimized for fast lookups during queries</li>
        <li>Typically stored in a database (BoltDB, Cassandra, BigTable, etc.)</li>
      </ul>
    </li>
    <li><strong>Chunk Store</strong>
      <ul>
        <li>Stores the actual compressed log data</li>
        <li>Optimized for space efficiency</li>
        <li>Typically stored in object storage (S3, GCS, Azure Blob, etc.)</li>
        <li>Uses content-addressable storage for deduplication</li>
      </ul>
    </li>
    <li><strong>Write-Ahead Log (WAL)</strong>
      <ul>
        <li>Ensures data durability during ingester failures</li>
        <li>Temporary storage before data is committed to long-term storage</li>
        <li>Allows ingesters to recover their state after restarts</li>
      </ul>
    </li>
  </ol>
</div>

<p><br /></p>

<hr />

<h2 id="promtail-lokis-log-collection-agent">Promtail: Lokiâ€™s Log Collection Agent</h2>

<div class="info-box info-box-modern">
Promtail is Loki's purpose-built log collection agent, designed to discover, process, and ship logs to Loki with minimal overhead. It extracts relevant metadata from logs and attaches them as labels, enabling Loki's efficient index-based log retrieval.
</div>

<h3 id="how-promtail-works">How Promtail Works</h3>

<div style="width: 100%; margin: 20px auto;">
  <div class="mermaid">
    sequenceDiagram
        participant FS as File System
        participant Promtail
        participant K8s as Kubernetes API
        participant Loki
        
        Note over Promtail: Startup and Discovery
        Promtail-&gt;&gt;FS: Scan configured paths
        Promtail-&gt;&gt;K8s: Query pod metadata
        
        Note over Promtail: Collection and Processing
        FS-&gt;&gt;Promtail: Read log files
        K8s-&gt;&gt;Promtail: Pod metadata (namespace, pod, container)
        Promtail-&gt;&gt;Promtail: Apply relabeling rules
        Promtail-&gt;&gt;Promtail: Process log lines
        
        Note over Promtail: Shipping
        Promtail-&gt;&gt;Loki: Batch and ship logs with labels
        Loki-&gt;&gt;Promtail: Acknowledge receipt
        
        Note over Promtail: Positions Tracking
        Promtail-&gt;&gt;FS: Update positions file
  </div>
</div>

<div class="info-box info-box-default-not-check">
  <strong>Promtail Workflow</strong>
  <p>Promtail's operation follows a systematic process:</p>
  
  <ol>
    <li><strong>Log Discovery</strong>
      <ul>
        <li>Scans file system for logs based on configured path patterns</li>
        <li>Uses inotify (Linux) or similar mechanisms to detect file changes</li>
        <li>Tracks file positions to ensure logs are read only once</li>
        <li>In Kubernetes, discovers pods and their log locations automatically</li>
      </ul>
    </li>
    <li><strong>Metadata Extraction</strong>
      <ul>
        <li>Extracts context information from file paths and names</li>
        <li>In Kubernetes, queries the API server for pod metadata</li>
        <li>Adds labels like namespace, pod_name, container_name, and application</li>
        <li>Applies custom relabeling rules to modify or add labels</li>
      </ul>
    </li>
    <li><strong>Processing Pipeline</strong>
      <ul>
        <li>Applies optional transformations to log content</li>
        <li>Parses structured logs (JSON, logfmt) into labels</li>
        <li>Extracts additional labels from log content using regex patterns</li>
        <li>Filters logs based on configured criteria</li>
      </ul>
    </li>
    <li><strong>Batching and Shipping</strong>
      <ul>
        <li>Groups logs by stream (unique label set)</li>
        <li>Batches logs for efficient transmission</li>
        <li>Compresses batches to reduce network bandwidth</li>
        <li>Ships logs to Loki's distributor component</li>
      </ul>
    </li>
    <li><strong>Reliability Mechanisms</strong>
      <ul>
        <li>Implements backoff and retry logic for network issues</li>
        <li>Maintains buffer in case of Loki unavailability</li>
        <li>Updates position file after successful transmission</li>
        <li>Handles log rotation and file truncation</li>
      </ul>
    </li>
  </ol>
</div>

<h3 id="promtail-configuration">Promtail Configuration</h3>

<div class="info-box info-box-default">
  <strong>Key Configuration Areas</strong>
  <p>Promtail's behavior is controlled through several configuration sections:</p>
</div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Basic Promtail configuration example</span>
<span class="na">server</span><span class="pi">:</span>
  <span class="na">http_listen_port</span><span class="pi">:</span> <span class="m">9080</span>

<span class="na">positions</span><span class="pi">:</span>
  <span class="na">filename</span><span class="pi">:</span> <span class="s">/run/promtail/positions.yaml</span>

<span class="na">clients</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">url</span><span class="pi">:</span> <span class="s">http://loki:3100/loki/api/v1/push</span>

<span class="na">scrape_configs</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">job_name</span><span class="pi">:</span> <span class="s">kubernetes-pods</span>
    <span class="na">kubernetes_sd_configs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">role</span><span class="pi">:</span> <span class="s">pod</span>
    <span class="na">relabel_configs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">source_labels</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">__meta_kubernetes_pod_label_app</span><span class="pi">]</span>
        <span class="na">target_label</span><span class="pi">:</span> <span class="s">app</span>
      <span class="pi">-</span> <span class="na">source_labels</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">__meta_kubernetes_pod_container_name</span><span class="pi">]</span>
        <span class="na">target_label</span><span class="pi">:</span> <span class="s">container</span>
      <span class="pi">-</span> <span class="na">source_labels</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">__meta_kubernetes_namespace</span><span class="pi">]</span>
        <span class="na">target_label</span><span class="pi">:</span> <span class="s">namespace</span>
      <span class="pi">-</span> <span class="na">source_labels</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">__meta_kubernetes_pod_name</span><span class="pi">]</span>
        <span class="na">target_label</span><span class="pi">:</span> <span class="s">pod</span>
</code></pre></div></div>

<div class="info-box info-box-default-not-check">
  <strong>Advanced Configuration Options</strong>
  <p>Promtail provides advanced options for complex log processing needs:</p>
  
  <ul>
    <li><strong>Pipeline Stages</strong>: A series of transformations applied to logs
      <ul>
        <li><strong>json</strong>: Parse JSON logs and extract fields as labels</li>
        <li><strong>regex</strong>: Extract fields using regular expressions</li>
        <li><strong>timestamp</strong>: Parse and normalize log timestamps</li>
        <li><strong>template</strong>: Create new labels or values using Go templates</li>
        <li><strong>match</strong>: Conditionally apply stages based on log content</li>
        <li><strong>drop</strong>: Filter out logs that match certain criteria</li>
      </ul>
    </li>
    <li><strong>Kubernetes Integration</strong>
      <ul>
        <li>Automatic service discovery for pods and their logs</li>
        <li>Label extraction from pod metadata, annotations, and labels</li>
        <li>Filtering based on namespaces or pod labels</li>
      </ul>
    </li>
    <li><strong>Multi-tenancy Support</strong>
      <ul>
        <li>Configure tenant ID for logs sent to Loki</li>
        <li>Support different tenants based on log source</li>
      </ul>
    </li>
  </ul>
</div>

<p><br /></p>

<hr />

<h2 id="logql-lokis-query-language">LogQL: Lokiâ€™s Query Language</h2>

<div class="info-box info-box-modern">
LogQL is Loki's query language, designed to be familiar to PromQL users while providing powerful capabilities for log filtering, processing, and metric extraction. It combines the simplicity of label selectors with the power of log content filtering and aggregation.
</div>

<h3 id="basic-query-structure">Basic Query Structure</h3>

<div class="info-box info-box-default">
  <strong>LogQL Query Components</strong>
  <p>LogQL queries typically consist of two parts:</p>
  <ol>
    <li><strong>Log Stream Selector</strong>: Uses label matchers to select the log streams</li>
    <li><strong>Log Pipeline</strong>: Optional set of operations to filter, parse, or transform the selected logs</li>
  </ol>
</div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">{</span><span class="nv">app</span><span class="o">=</span><span class="s2">"frontend"</span>, <span class="nv">namespace</span><span class="o">=</span><span class="s2">"production"</span><span class="o">}</span> |<span class="o">=</span> <span class="s2">"error"</span> | json | line_format <span class="s2">"{message}"</span>
</code></pre></div></div>

<div class="table-container">
  <table class="table-beauty">
    <tr>
      <th style="width: 30%;">Query Type</th>
      <th style="width: 70%;">Examples</th>
    </tr>
    <tr>
      <td><strong>Basic Label Selection</strong></td>
      <td>
        <code>{app="frontend"}</code> - Select logs with app label "frontend"<br />
        <code>{namespace="production", container="api"}</code> - Select logs from the "api" container in "production" namespace
      </td>
    </tr>
    <tr>
      <td><strong>Text Filtering</strong></td>
      <td>
        <code>{app="frontend"} |= "error"</code> - Logs containing "error"<br />
        <code>{app="frontend"} |~ "error|warning"</code> - Logs matching regex "error|warning"<br />
        <code>{app="frontend"} != "debug"</code> - Logs not containing "debug"
      </td>
    </tr>
    <tr>
      <td><strong>Structured Log Parsing</strong></td>
      <td>
        <code>{app="frontend"} | json</code> - Parse logs as JSON<br />
        <code>{app="frontend"} | logfmt</code> - Parse logs in logfmt format<br />
        <code>{app="frontend"} | pattern</code> - Extract fields using pattern
      </td>
    </tr>
    <tr>
      <td><strong>Metric Queries</strong></td>
      <td>
        <code>rate({app="frontend"} |= "error" [5m])</code> - Error rate per second over 5 minutes<br />
        <code>count_over_time({app="frontend"} [1h])</code> - Log count over 1 hour<br />
        <code>sum by (container) (rate({namespace="production"} |= "error" [5m]))</code> - Error rate aggregated by container
      </td>
    </tr>
  </table>
</div>

<p><br /></p>

<hr />

<h2 id="using-loki-in-kubernetes">Using Loki in Kubernetes</h2>

<div class="info-box info-box-modern">
Loki is particularly well-suited for Kubernetes environments, providing efficient log collection and analysis with minimal resource overhead. This section covers practical aspects of deploying and using Loki in Kubernetes clusters.
</div>

<h3 id="deployment-recommendations">Deployment Recommendations</h3>

<div class="info-box info-box-default-not-check">
  <strong>Kubernetes Deployment Best Practices</strong>
  <p>For effective Loki deployment in Kubernetes:</p>
  
  <ol>
    <li><strong>Resource Planning</strong>
      <ul>
        <li>Ingesters require the most memory (start with 2-4GB per replica)</li>
        <li>Scale the number of distributor replicas based on log volume</li>
        <li>Start with 3 replicas of each component for high availability</li>
      </ul>
    </li>
    <li><strong>Storage Configuration</strong>
      <ul>
        <li>Use object storage (S3, GCS) for chunks in production environments</li>
        <li>Use a database (Cassandra, DynamoDB) or clustered file system for index</li>
        <li>Configure appropriate retention periods based on compliance needs</li>
      </ul>
    </li>
    <li><strong>Promtail Setup</strong>
      <ul>
        <li>Deploy as a DaemonSet to ensure coverage on all nodes</li>
        <li>Mount <code>/var/log</code> and <code>/var/lib/docker/containers</code> for complete log access</li>
        <li>Configure service account with permissions to query the Kubernetes API</li>
      </ul>
    </li>
    <li><strong>Security Considerations</strong>
      <ul>
        <li>Use network policies to restrict communication between components</li>
        <li>Configure authentication for Loki API access</li>
        <li>Implement multi-tenancy if multiple teams share the cluster</li>
      </ul>
    </li>
  </ol>
</div>

<h3 id="installation-with-helm">Installation with Helm</h3>

<div class="info-box info-box-default">
  <strong>Using Helm for Deployment</strong>
  <p>Helm provides a convenient way to deploy Loki and Promtail:</p>
</div>

<p><br /></p>

<script src="https://gist.github.com/somaz94/867ea1f2761f0823d48a38f1cb2d69cd.js"></script>

<p><br /></p>

<div class="info-box info-box-default-not-check">
  <strong>Integration with Existing Monitoring Stack</strong>
  <p>To integrate Loki with an existing Prometheus and Grafana setup:</p>
  
  <ol>
    <li>Deploy only Loki and Promtail components</li>
    <li>Configure Grafana data source for Loki</li>
    <li>Use Explore view in Grafana to query logs</li>
    <li>Create dashboards combining metrics and logs</li>
  </ol>
</div>

<p><br /></p>

<hr />

<h2 id="key-points">Key Points</h2>

<div class="info-box info-box-success-not-check">
  <strong>ðŸ’¡ Loki Summary</strong>
  <ul>
    <li>
      <strong>Architecture Approach</strong><br />
      - Label-based indexing instead of full-text indexing<br />
      - Significantly more efficient resource utilization<br />
      - Horizontal scalability with microservices architecture<br />
      - Seamless integration with Prometheus and Grafana
    </li>
    <li>
      <strong>Core Components</strong><br />
      - Promtail: Efficient log collection agent<br />
      - Distributor: Log ingestion and validation<br />
      - Ingester: Log buffering and storage<br />
      - Querier: Log retrieval and processing<br />
      - Query Frontend: Query optimization and caching
    </li>
    <li>
      <strong>Practical Benefits</strong><br />
      - Cost-effective logging at scale<br />
      - Familiar query language for Prometheus users<br />
      - Native Kubernetes integration<br />
      - Unified observability with metrics and logs<br />
      - Simple deployment and maintenance
    </li>
  </ul>
</div>

<p><br /></p>

<hr />

<h2 id="references">References</h2>
<ul>
  <li><a href="https://grafana.com/docs/loki/latest/">Grafana Loki Documentation</a></li>
  <li><a href="https://grafana.com/docs/loki/latest/send-data/promtail/">Promtail Documentation</a></li>
  <li><a href="https://grafana.com/oss/loki/">Loki Architecture</a></li>
  <li><a href="https://grafana.com/docs/loki/latest/logql/">LogQL Query Language</a></li>
  <li><a href="https://grafana.com/docs/loki/latest/best-practices/">Loki Best Practices</a></li>
  <li><a href="https://github.com/grafana/helm-charts/tree/main/charts/loki-stack">Loki Helm Chart</a></li>
  <li><a href="https://grafana.com/docs/loki/latest/installation/kubernetes/">Kubernetes Logging with Loki</a></li>
</ul>


                <!-- Pagination links -->


            </article>

            
                <aside class="see-also">
                    <h2>See also</h2>
                    <ul>
                        
                        
                        
                            <li>
                                <a href="/category/troubleshooting/terraform-state-debugging/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1745823546/terraform-error_duccgn.png">
                                    
                                    <h3>Debugging Terraform State Errors</h3>
                                </a>
                            </li>
                        
                            <li>
                                <a href="/category/openstack/openstack-keystone/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1742267532/openstack_t2tmoc.png">
                                    
                                    <h3>Deep Dive into OpenStack Keystone</h3>
                                </a>
                            </li>
                        
                            <li>
                                <a href="/category/monitoring/what-is-grafana-installation/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1745822693/grafana-install_sqrar1.png">
                                    
                                    <h3>Grafana Installation Guide (Helm-based)</h3>
                                </a>
                            </li>
                        
                    </ul>
                </aside>
            

        </section>

        <!-- Add time bar only for pages without pagination -->
        
            <div class="time-bar" data-minutes="13">
    <span class="time-completed"></span>
    <span class="time-remaining"></span>
    <div class="bar">
        <span class="completed" style="width:0%;"></span>
        <span class="remaining" style="width:100%;"></span>
    </div>
</div>

            <button class="toggle-preview" onclick="togglePreview()">
    <span>Hide Preview â–¼</span>
</button>

<div id="recommendationSection" class="recommendation">
    <div class="message">
        <strong>Why don't you read something next?</strong>
        <div>
            <button>
                <svg><use xlink:href="#icon-arrow-right"></use></svg>
                <span>Go back to top</span>
            </button>
        </div>
    </div>
    <div id="previewSection" class="preview-section">
        
        <a href="/category/monitoring/loki-promtail-install/" class="post-preview">
            <div class="image">
                
                    <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1738641555/loki-promtail-install_t7caxs.png">
                
            </div>
            <h3 class="title">How to install Loki and Promtail with Helm</h3>
        </a>
    </div>
</div>

<style>
.toggle-preview {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #333;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 4px;
    cursor: pointer;
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.toggle-preview:hover {
    background: #444;
}

.toggle-preview.visible {
    opacity: 1;
}

.recommendation {
    margin-top: 1000px;
    display: block;
    transition: all 0.3s ease;
}

.recommendation.hidden {
    display: none;
}

.hide-preview {
    margin-left: 10px;
    background: none;
    border: 1px solid #666;
    color: #666;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
}

.hide-preview:hover {
    background: #f0f0f0;
}

.preview-section {
    max-height: 1000px;
    overflow: hidden;
    transition: max-height 0.3s ease-out;
}

.preview-section.hidden {
    max-height: 0;
}
</style>

<script>
function togglePreview() {
    const recommendation = document.getElementById('recommendationSection');
    const button = document.querySelector('.toggle-preview span');
    
    if (recommendation.classList.contains('hidden')) {
        recommendation.classList.remove('hidden');
        button.textContent = 'Hide Preview â–¼';
    } else {
        recommendation.classList.add('hidden');
        button.textContent = 'Show Preview â–²';
    }
}

window.addEventListener('scroll', function() {
    const toggleButton = document.querySelector('.toggle-preview');
    const recommendation = document.getElementById('recommendationSection');
    const rect = recommendation.getBoundingClientRect();
    
    if (rect.top <= window.innerHeight) {
        toggleButton.classList.add('visible');
    } else {
        toggleButton.classList.remove('visible');
    }
});
</script>

        

        <!-- Show modal if the post is the last one -->
        

        <!-- Show modal before user leaves the page -->
        

        <!-- Add your newsletter subscription form here -->

        <section class="share">
    <h3>Share</h3>
    <a aria-label="Share on Twitter" href="https://twitter.com/intent/tweet?text=&quot;Learn about Grafana Loki, its architecture, components, and how it works with Promtail for efficient log aggregation&quot;%20https://somaz.blog/category/monitoring/loki/%20via%20&#64;twitter_username&hashtags=loki,promtail,logging,kubernetes"
    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Share on Twitter">
        <svg class="icon icon-twitter"><use xlink:href="#icon-twitter"></use></svg>
    </a>
    <a aria-label="Share on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://somaz.blog/category/monitoring/loki/"
    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook">
        <svg class="icon icon-facebook"><use xlink:href="#icon-facebook"></use></svg>
    </a>
</section>

        

  <section class="author">
    <div class="details">
      
        <img class="img-rounded" src="/assets/img/uploads/profile.png" alt="Somaz">
      
      <p class="def">Author</p>
      <h3 class="name">
        <a href="/authors/somaz/">Somaz</a>
      </h3>
      <p class="desc">DevOps engineer focused on cloud infrastructure and automation</p>
      <p>
        
          <a href="https://github.com/somaz94" title="Github">
            <svg><use xlink:href="#icon-github"></use></svg>
          </a>
        
        
        
        
        
        
          <a href="https://www.linkedin.com/in/somaz" title="LinkedIn">
            <svg><use xlink:href="#icon-linkedin"></use></svg>
          </a>
        
        
          <a href="https://somaz.tistory.com" title="Tistory">
            <svg><use xlink:href="#icon-tistory"></use></svg>
          </a>
        
      </p>
    </div>
  </section>

  
  
  
  
  
  
  
  

  <script type="application/ld+json">
  {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "Somaz",
      
      "image": "/assets/img/uploads/profile.png",
      
      "jobTitle": "DevOps Engineer",
      "url": "https://somaz.blog/authors/somaz/",
      "sameAs": [
        "https://github.com/somaz94","https://www.linkedin.com/in/somaz","https://{{ author.tistory_username }}.tistory.com"
      ]
  }
  </script>


        

<section class="comments">
    <h3>Comments</h3>
    <div id="disqus_thread"></div>
</section>
<script type="text/javascript">
    var disqus_loaded = false;

    function load_disqus()
    {
        disqus_loaded = true;
        var disqus_shortname = 'https-somaz94-github-io';
        var disqus_title = '';
        var disqus_url = '/category/monitoring/loki/';
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        var ldr = document.getElementById('disqus_loader');
    };
    window.onscroll = function(e) {
        if ((window.innerHeight + window.scrollY) >= (document.body.offsetHeight - 800)) {
            //hit bottom of page
            if (disqus_loaded==false)
                load_disqus()
        }
    };
</script>



        <footer>
    <p>
      
        <a href="https://github.com/somaz94" title="Github">
          <svg><use xlink:href="#icon-github"></use></svg>
        </a>
      
      
        <a href="https://www.facebook.com/facebook_username" title="Facebook">
          <svg><use xlink:href="#icon-facebook"></use></svg>
        </a>
      
      
        <a href="https://twitter.com/twitter_username" title="Twitter">
          <svg><use xlink:href="#icon-twitter"></use></svg>
        </a>
      
      
        <a href="https://medium.com/@medium_username" title="Medium">
          <svg><use xlink:href="#icon-medium"></use></svg>
        </a>
      
      
        <a href="https://www.instagram.com/instagram_username" title="Instagram">
          <svg><use xlink:href="#icon-instagram"></use></svg>
        </a>
      
      
        <a href="https://www.linkedin.com/in/somaz" title="LinkedIn">
          <svg><use xlink:href="#icon-linkedin"></use></svg>
        </a>
      
      
        <a href="https://somaz.tistory.com" title="Tistory">
          <svg><use xlink:href="#icon-tistory"></use></svg>
        </a>
      
    </p>

    <ul>
  
    
      <li>
        <a href="https://somaz.blog/">Home</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/about">About</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/category">Category</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/contact">Contact</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/feed.xml">Feed</a>
      </li>
    
  
</ul>


    <p>
      <a href="https://somaz.blog/sitemap.xml" title="sitemap">Sitemap</a> |
      <a href="https://somaz.blog/privacy-policy.html" title="Privacy Policy">Privacy Policy</a>
    </p>

    <p>
      <span>Somaz Tech Blog</span> <svg class="love"><use xlink:href="#icon-heart"></use></svg>
    </p>
</footer>










<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "somaz",
  "description": "DevOps engineer's tech blog.",
  "url": "https://somaz.blog/",
  "logo": {
      "@type": "ImageObject",
      "url": "https://somaz.blog/assets/img/icons/mediumtile.png",
      "width": "600",
      "height": "315"
  },
  "sameAs": [
    "https://github.com/somaz94","https://www.facebook.com/facebook_username","https://twitter.com/twitter_username","https://medium.com/@medium_username","https://www.instagram.com/instagram_username","https://www.linkedin.com/in/somaz","https://{{ site.tistory_username }}.tistory.com"
  ]
}
</script>

<!-- Include the script that allows Netlify CMS login -->
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

<!-- Include the website scripts -->
<script src="/assets/js/scripts.min.js"></script>

<!-- Include Google Analytics script -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-XXXXXXXX-X"></script>
<script>
  var host = window.location.hostname;
  if (host != 'localhost') {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-XXXXXXXX-X');
  }
</script>
  


<!-- Include extra scripts -->



        

        
        
        
        
        
        
        
        
        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "BlogPosting",
            "name": "What is Loki?",
            "headline": "A comprehensive guide to Grafana Loki and its components",
            "description": "Learn about Grafana Loki, its architecture, components, and how it works with Promtail for efficient log aggregation",
            "image": "https://res.cloudinary.com/dkcm26aem/image/upload/v1738641136/loki_anz45n.png",
            "url": "https://somaz.blog/category/monitoring/loki/",
            "articleBody": "Image Reference





What is Loki?


Grafana Loki is a horizontally-scalable, highly-available log aggregation system designed specifically for cloud-native environments. Unlike traditional logging solutions, Loki indexes metadata rather than log content, resulting in a cost-effective, efficient logging platform that integrates seamlessly with Prometheus and Grafana.


Introduction to Loki


  The Log Aggregation Challenge
  Modern cloud-native environments generate vast amounts of log data that need to be collected, stored, and analyzed efficiently. Traditional logging solutions often become prohibitively expensive at scale due to their approach of indexing the entire log content.
  
  Grafana Labs developed Loki to address these challenges by taking a different approach:
  
    Label-Based Indexing: Indexes metadata (labels) instead of log content
    Prometheus-Inspired: Uses the same label selector approach as Prometheus
    Cloud-Native Design: Built for containerized environments from the ground up
    Resource Efficient: Significantly lower resource requirements compared to traditional solutions
    Cost-Effective: Designed to keep operational costs manageable even at scale
  
  
  This innovative approach allows organizations to collect and retain more logs for longer periods without exponential cost increases.


Key Features and Benefits


  
    graph LR
      A[Loki Key Features]
      
      A --&amp;gt; B[Cost Efficiency]
      B --&amp;gt; B1[Lower storage requirements]
      B --&amp;gt; B2[Less CPU and memory usage]
      
      A --&amp;gt; C[Seamless Integration]
      C --&amp;gt; C1[Native Grafana integration]
      C --&amp;gt; C2[Prometheus-compatible labels]
      C --&amp;gt; C3[Works with existing log formats]
      
      A --&amp;gt; D[Operational Simplicity]
      D --&amp;gt; D1[Single binary deployment option]
      D --&amp;gt; D2[Horizontally scalable components]
      D --&amp;gt; D3[Cloud storage compatibility]
      
      A --&amp;gt; E[Advanced Capabilities]
      E --&amp;gt; E1[LogQL query language]
      E --&amp;gt; E2[Metrics extraction from logs]
      E --&amp;gt; E3[Real-time log tailing]
      
      style A fill:#f5f5f5,stroke:#333,stroke-width:1px
      style B fill:#a5d6a7,stroke:#333,stroke-width:1px
      style C fill:#64b5f6,stroke:#333,stroke-width:1px
      style D fill:#ffcc80,stroke:#333,stroke-width:1px
      style E fill:#ce93d8,stroke:#333,stroke-width:1px
  



  
    
      Feature
      Description
    
    
      Label-Based Indexing
      
        
          Indexes metadata (labels) instead of full log content
          Significantly reduces storage and computational requirements
          Enables efficient querying using familiar Prometheus-style label selectors
        
      
    
    
      LogQL
      
        
          Dedicated query language inspired by PromQL
          Supports both label filtering and log content searching
          Enables complex expressions and log aggregations
          Can extract metrics from logs for visualization and alerting
        
      
    
    
      Multi-Tenancy
      
        
          Built-in support for multiple tenants within a single Loki cluster
          Strict data isolation between tenants
          Enables shared infrastructure with logical separation
        
      
    
    
      Storage Flexibility
      
        
          Supports various object storage backends (S3, GCS, Azure Blob, etc.)
          Can use local file system for smaller deployments
          Separation of index and chunks for optimized performance
        
      
    
    
      Integration Ecosystem
      
        
          Native integration with Grafana for visualization
          Compatible with Prometheus for unified observability
          Wide range of log shippers and forwarders (Promtail, Fluentd, Logstash, etc.)
        
      
    
  






Loki Architecture


Loki&apos;s architecture is designed for horizontal scalability and high availability, with components that can be deployed either as a monolith for simplicity or as separate microservices for production environments. This section explores the architecture and interactions between Loki&apos;s components.


Deployment Models


  
    graph LR
      subgraph &quot;Monolithic Deployment&quot;
        A1[Loki Binary]
        A1 --&amp;gt;|Contains| B1[Distributor]
        A1 --&amp;gt;|Contains| C1[Ingester]
        A1 --&amp;gt;|Contains| D1[Querier]
        A1 --&amp;gt;|Contains| E1[Query Frontend]
      end
      
      subgraph &quot;Microservices Deployment&quot;
        B2[Distributor]
        C2[Ingester]
        D2[Querier]
        E2[Query Frontend]
        F2[Compactor]
      end
      
      style A1 fill:#a5d6a7,stroke:#333,stroke-width:1px
      style B1 fill:#64b5f6,stroke:#333,stroke-width:1px
      style C1 fill:#ffcc80,stroke:#333,stroke-width:1px
      style D1 fill:#ce93d8,stroke:#333,stroke-width:1px
      style E1 fill:#ef9a9a,stroke:#333,stroke-width:1px
      style B2 fill:#64b5f6,stroke:#333,stroke-width:1px
      style C2 fill:#ffcc80,stroke:#333,stroke-width:1px
      style D2 fill:#ce93d8,stroke:#333,stroke-width:1px
      style E2 fill:#ef9a9a,stroke:#333,stroke-width:1px
      style F2 fill:#9fa8da,stroke:#333,stroke-width:1px
  





  Deployment Options
  Loki offers flexible deployment models to accommodate different requirements:
  
  
    Monolithic Mode
      
        Single binary containing all components
        Ideal for small to medium deployments
        Simpler to deploy and manage
        Lower operational overhead
      
    
    Microservices Mode
      
        Components deployed as separate services
        Higher scalability and resilience
        Independent scaling of components based on workload
        Recommended for production and large-scale deployments
      
    
    Simple Scalable Mode
      
        A middle ground between monolithic and microservices
        Groups compatible components together
        Reduces operational complexity while providing scalability
      
    
  


Core Components


  
    graph TD
      A[Promtail/Log Sources] --&amp;gt;|Push logs| B[Distributor]
      B --&amp;gt;|Distribute logs| C[Ingester]
      C --&amp;gt;|Write| D1[Index Store]
      C --&amp;gt;|Write| D2[Chunk Store]
      E[Querier] --&amp;gt;|Read| C
      E --&amp;gt;|Read| D1
      E --&amp;gt;|Read| D2
      F[Query Frontend] --&amp;gt;|Route queries| E
      G[Grafana/HTTP API] --&amp;gt;|Query| F
      H[Compactor] --&amp;gt;|Optimize| D1
      
      style A fill:#f5f5f5,stroke:#333,stroke-width:1px
      style B fill:#a5d6a7,stroke:#333,stroke-width:1px
      style C fill:#64b5f6,stroke:#333,stroke-width:1px
      style D1 fill:#ffcc80,stroke:#333,stroke-width:1px
      style D2 fill:#ffcc80,stroke:#333,stroke-width:1px
      style E fill:#ce93d8,stroke:#333,stroke-width:1px
      style F fill:#ef9a9a,stroke:#333,stroke-width:1px
      style G fill:#f5f5f5,stroke:#333,stroke-width:1px
      style H fill:#9fa8da,stroke:#333,stroke-width:1px
  



  
    
      Component
      Description
    
    
      Distributor
      
        
          Acts as the initial entry point for logs
          Validates incoming logs and ensures they have the correct format and labels
          Distributes log data across ingesters using consistent hashing
          Provides tenant isolation in multi-tenant setups
          Implements rate limiting to protect the system from overload
  
      
    
    
      Ingester
      
        
          Receives log data from distributors
          Batches and compresses logs in memory
          Writes compressed log chunks to object storage
          Updates the index with label-to-chunk mappings
          Manages the Write-Ahead Log (WAL) for data durability
  
      
    
    
      Querier
      
        
          Processes LogQL queries from clients
          Retrieves logs from both ingesters (recent data) and storage (historical data)
          Merges, deduplicates, and filters results
          Executes log filtering and metric extraction operations
  
      
    
    
      Query Frontend
      
        
          Optimizes and parallelizes queries for better performance
          Implements query caching to reduce duplicate processing
          Manages query scheduling and retries
          Provides query sharding for improved scalability
  
      
    
    
      Compactor
      
        
          Optimizes index storage by compacting and deduplicating index entries
          Improves query performance by creating more efficient index structures
          Runs as a background process with configurable intervals
  
      
    
  


Storage Architecture


  Loki&apos;s Storage Layers
  Loki separates storage concerns into distinct components:
  
  
    Index Store
      
        Contains mappings of labels to log chunks
        Optimized for fast lookups during queries
        Typically stored in a database (BoltDB, Cassandra, BigTable, etc.)
      
    
    Chunk Store
      
        Stores the actual compressed log data
        Optimized for space efficiency
        Typically stored in object storage (S3, GCS, Azure Blob, etc.)
        Uses content-addressable storage for deduplication
      
    
    Write-Ahead Log (WAL)
      
        Ensures data durability during ingester failures
        Temporary storage before data is committed to long-term storage
        Allows ingesters to recover their state after restarts
      
    
  






Promtail: Lokiâ€™s Log Collection Agent


Promtail is Loki&apos;s purpose-built log collection agent, designed to discover, process, and ship logs to Loki with minimal overhead. It extracts relevant metadata from logs and attaches them as labels, enabling Loki&apos;s efficient index-based log retrieval.


How Promtail Works


  
    sequenceDiagram
        participant FS as File System
        participant Promtail
        participant K8s as Kubernetes API
        participant Loki
        
        Note over Promtail: Startup and Discovery
        Promtail-&amp;gt;&amp;gt;FS: Scan configured paths
        Promtail-&amp;gt;&amp;gt;K8s: Query pod metadata
        
        Note over Promtail: Collection and Processing
        FS-&amp;gt;&amp;gt;Promtail: Read log files
        K8s-&amp;gt;&amp;gt;Promtail: Pod metadata (namespace, pod, container)
        Promtail-&amp;gt;&amp;gt;Promtail: Apply relabeling rules
        Promtail-&amp;gt;&amp;gt;Promtail: Process log lines
        
        Note over Promtail: Shipping
        Promtail-&amp;gt;&amp;gt;Loki: Batch and ship logs with labels
        Loki-&amp;gt;&amp;gt;Promtail: Acknowledge receipt
        
        Note over Promtail: Positions Tracking
        Promtail-&amp;gt;&amp;gt;FS: Update positions file
  



  Promtail Workflow
  Promtail&apos;s operation follows a systematic process:
  
  
    Log Discovery
      
        Scans file system for logs based on configured path patterns
        Uses inotify (Linux) or similar mechanisms to detect file changes
        Tracks file positions to ensure logs are read only once
        In Kubernetes, discovers pods and their log locations automatically
      
    
    Metadata Extraction
      
        Extracts context information from file paths and names
        In Kubernetes, queries the API server for pod metadata
        Adds labels like namespace, pod_name, container_name, and application
        Applies custom relabeling rules to modify or add labels
      
    
    Processing Pipeline
      
        Applies optional transformations to log content
        Parses structured logs (JSON, logfmt) into labels
        Extracts additional labels from log content using regex patterns
        Filters logs based on configured criteria
      
    
    Batching and Shipping
      
        Groups logs by stream (unique label set)
        Batches logs for efficient transmission
        Compresses batches to reduce network bandwidth
        Ships logs to Loki&apos;s distributor component
      
    
    Reliability Mechanisms
      
        Implements backoff and retry logic for network issues
        Maintains buffer in case of Loki unavailability
        Updates position file after successful transmission
        Handles log rotation and file truncation
      
    
  


Promtail Configuration


  Key Configuration Areas
  Promtail&apos;s behavior is controlled through several configuration sections:


# Basic Promtail configuration example
server:
  http_listen_port: 9080

positions:
  filename: /run/promtail/positions.yaml

clients:
  - url: http://loki:3100/loki/api/v1/push

scrape_configs:
  - job_name: kubernetes-pods
    kubernetes_sd_configs:
      - role: pod
    relabel_configs:
      - source_labels: [__meta_kubernetes_pod_label_app]
        target_label: app
      - source_labels: [__meta_kubernetes_pod_container_name]
        target_label: container
      - source_labels: [__meta_kubernetes_namespace]
        target_label: namespace
      - source_labels: [__meta_kubernetes_pod_name]
        target_label: pod



  Advanced Configuration Options
  Promtail provides advanced options for complex log processing needs:
  
  
    Pipeline Stages: A series of transformations applied to logs
      
        json: Parse JSON logs and extract fields as labels
        regex: Extract fields using regular expressions
        timestamp: Parse and normalize log timestamps
        template: Create new labels or values using Go templates
        match: Conditionally apply stages based on log content
        drop: Filter out logs that match certain criteria
      
    
    Kubernetes Integration
      
        Automatic service discovery for pods and their logs
        Label extraction from pod metadata, annotations, and labels
        Filtering based on namespaces or pod labels
      
    
    Multi-tenancy Support
      
        Configure tenant ID for logs sent to Loki
        Support different tenants based on log source
      
    
  






LogQL: Lokiâ€™s Query Language


LogQL is Loki&apos;s query language, designed to be familiar to PromQL users while providing powerful capabilities for log filtering, processing, and metric extraction. It combines the simplicity of label selectors with the power of log content filtering and aggregation.


Basic Query Structure


  LogQL Query Components
  LogQL queries typically consist of two parts:
  
    Log Stream Selector: Uses label matchers to select the log streams
    Log Pipeline: Optional set of operations to filter, parse, or transform the selected logs
  


{app=&quot;frontend&quot;, namespace=&quot;production&quot;} |= &quot;error&quot; | json | line_format &quot;{message}&quot;



  
    
      Query Type
      Examples
    
    
      Basic Label Selection
      
        {app=&quot;frontend&quot;} - Select logs with app label &quot;frontend&quot;
        {namespace=&quot;production&quot;, container=&quot;api&quot;} - Select logs from the &quot;api&quot; container in &quot;production&quot; namespace
      
    
    
      Text Filtering
      
        {app=&quot;frontend&quot;} |= &quot;error&quot; - Logs containing &quot;error&quot;
        {app=&quot;frontend&quot;} |~ &quot;error|warning&quot; - Logs matching regex &quot;error|warning&quot;
        {app=&quot;frontend&quot;} != &quot;debug&quot; - Logs not containing &quot;debug&quot;
      
    
    
      Structured Log Parsing
      
        {app=&quot;frontend&quot;} | json - Parse logs as JSON
        {app=&quot;frontend&quot;} | logfmt - Parse logs in logfmt format
        {app=&quot;frontend&quot;} | pattern - Extract fields using pattern
      
    
    
      Metric Queries
      
        rate({app=&quot;frontend&quot;} |= &quot;error&quot; [5m]) - Error rate per second over 5 minutes
        count_over_time({app=&quot;frontend&quot;} [1h]) - Log count over 1 hour
        sum by (container) (rate({namespace=&quot;production&quot;} |= &quot;error&quot; [5m])) - Error rate aggregated by container
      
    
  






Using Loki in Kubernetes


Loki is particularly well-suited for Kubernetes environments, providing efficient log collection and analysis with minimal resource overhead. This section covers practical aspects of deploying and using Loki in Kubernetes clusters.


Deployment Recommendations


  Kubernetes Deployment Best Practices
  For effective Loki deployment in Kubernetes:
  
  
    Resource Planning
      
        Ingesters require the most memory (start with 2-4GB per replica)
        Scale the number of distributor replicas based on log volume
        Start with 3 replicas of each component for high availability
      
    
    Storage Configuration
      
        Use object storage (S3, GCS) for chunks in production environments
        Use a database (Cassandra, DynamoDB) or clustered file system for index
        Configure appropriate retention periods based on compliance needs
      
    
    Promtail Setup
      
        Deploy as a DaemonSet to ensure coverage on all nodes
        Mount /var/log and /var/lib/docker/containers for complete log access
        Configure service account with permissions to query the Kubernetes API
      
    
    Security Considerations
      
        Use network policies to restrict communication between components
        Configure authentication for Loki API access
        Implement multi-tenancy if multiple teams share the cluster
      
    
  


Installation with Helm


  Using Helm for Deployment
  Helm provides a convenient way to deploy Loki and Promtail:









  Integration with Existing Monitoring Stack
  To integrate Loki with an existing Prometheus and Grafana setup:
  
  
    Deploy only Loki and Promtail components
    Configure Grafana data source for Loki
    Use Explore view in Grafana to query logs
    Create dashboards combining metrics and logs
  






Key Points


  ðŸ’¡ Loki Summary
  
    
      Architecture Approach
      - Label-based indexing instead of full-text indexing
      - Significantly more efficient resource utilization
      - Horizontal scalability with microservices architecture
      - Seamless integration with Prometheus and Grafana
    
    
      Core Components
      - Promtail: Efficient log collection agent
      - Distributor: Log ingestion and validation
      - Ingester: Log buffering and storage
      - Querier: Log retrieval and processing
      - Query Frontend: Query optimization and caching
    
    
      Practical Benefits
      - Cost-effective logging at scale
      - Familiar query language for Prometheus users
      - Native Kubernetes integration
      - Unified observability with metrics and logs
      - Simple deployment and maintenance
    
  






References

  Grafana Loki Documentation
  Promtail Documentation
  Loki Architecture
  LogQL Query Language
  Loki Best Practices
  Loki Helm Chart
  Kubernetes Logging with Loki

",
            "wordcount": "2363",
            "inLanguage": "en",
            "dateCreated": "2025-02-03/",
            "datePublished": "2025-02-03/",
            "dateModified": "2025-02-03/",
            "author": {
                "@type": "Person",
                "name": "Somaz",
                
                "image": "/assets/img/uploads/profile.png",
                
                "jobTitle": "DevOps Engineer",
                "url": "https://somaz.blog/authors/somaz/",
                "sameAs": [
                    "https://github.com/somaz94","https://www.linkedin.com/in/somaz"
                ]
            },
            "publisher": {
                "@type": "Organization",
                "name": "somaz",
                "url": "https://somaz.blog/",
                "logo": {
                    "@type": "ImageObject",
                    "url": "https://somaz.blog/assets/img/blog-image.png",
                    "width": "600",
                    "height": "315"
                }
            },
            "mainEntityOfPage": "True",
            "genre": "MONITORING",
            "articleSection": "MONITORING",
            "keywords": ["loki","promtail","logging","kubernetes"]
        }
        </script>
    </body>
</html>
