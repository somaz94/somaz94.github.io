<!DOCTYPE html>
<html lang="en" class="no-js">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    

    
    

    
    

    
    

    <!-- ✅ Google Tag Manager 추가 -->
    <script>
        (function(w,d,s,l,i){
            w[l]=w[l]||[];
            w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
            var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
            j.async=true;
            j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
            f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-MBP83N4Q');
    </script>
      <!-- ✅ End Google Tag Manager -->

    <!-- Mermaid.js 직접 로드 -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>

    <title>Installing Prometheus and Thanos with Helm | somaz</title>
    <meta name="description" content="Learn how to install and configure Prometheus and Thanos using Helm charts for scalable monitoring">
    
        <meta name="keywords" content="prometheus, thanos, helm, kubernetes">
    

    <!-- Social: Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Installing Prometheus and Thanos with Helm | somaz">
    <meta name="twitter:description" content="Learn how to install and configure Prometheus and Thanos using Helm charts for scalable monitoring">

    
        <meta property="twitter:image" content="https://res.cloudinary.com/dkcm26aem/image/upload/v1738640346/prometheus-thans-archi_zfo72f.png">
    
    
    
        <meta name="twitter:site" content="@twitter_username">
    

    <!-- Social: Facebook / Open Graph -->
    <meta property="og:url" content="https://somaz.blog/category/monitoring/prometheus-thanos-install/">
    <meta property="og:title" content="Installing Prometheus and Thanos with Helm | somaz">
    <meta property="og:image" content="https://res.cloudinary.com/dkcm26aem/image/upload/v1738640346/prometheus-thans-archi_zfo72f.png">
    <meta property="og:description" content="Learn how to install and configure Prometheus and Thanos using Helm charts for scalable monitoring">
    <meta property="og:site_name" content="Somaz Tech Blog">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/assets/img/icons/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/img/icons/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/img/icons/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/img/icons/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/img/icons/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/img/icons/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/img/icons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/icons/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/img/icons/apple-touch-icon-152x152.png" />

    <!-- Windows 8 Tile Icons -->
    <meta name="application-name" content="somaz">
    <meta name="msapplication-TileColor" content="#141414">
    <meta name="msapplication-square70x70logo" content="smalltile.png" />
    <meta name="msapplication-square150x150logo" content="mediumtile.png" />
    <meta name="msapplication-wide310x150logo" content="widetile.png" />
    <meta name="msapplication-square310x310logo" content="largetile.png" />
    
    <!-- Android Lolipop Theme Color -->
    <meta name="theme-color" content="#141414">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Titillium+Web:300,400,700" rel="stylesheet">

    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="canonical" href="https://somaz.blog/category/monitoring/prometheus-thanos-install/">
    <link rel="alternate" type="application/rss+xml" title="Somaz Tech Blog" href="https://somaz.blog/feed.xml" />

    <!-- Include extra styles -->
    

    <!-- JavaScript enabled/disabled -->
    <script>
        document.querySelector('html').classList.remove('no-js');
    </script>

    <!-- Google Adsense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8725590811736154"
        crossorigin="anonymous"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"> -->
    <!-- <link href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/variable/woff2/SUIT-Variable.css" rel="stylesheet"> -->
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- <link href="https://fonts.googleapis.com/css2?family=Albert+Sans:wght@400;500;700&display=swap" rel="stylesheet"> -->

    <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml" />

</head>
<!-- ✅ Google Tag Manager (noscript) -->
<noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MBP83N4Q"
            height="0" width="0" style="display:none;visibility:hidden">
    </iframe>
</noscript>
<!-- ✅ End Google Tag Manager (noscript) -->
    <body class="has-push-menu">
        





        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" display="none" version="1.1"><defs><symbol id="icon-menu" viewBox="0 0 1024 1024"><path class="path1" d="M128 213.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 725.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 469.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5z"/></symbol><symbol id="icon-search" viewBox="0 0 951 1024"><path class="path1" d="M658.286 475.429q0-105.714-75.143-180.857t-180.857-75.143-180.857 75.143-75.143 180.857 75.143 180.857 180.857 75.143 180.857-75.143 75.143-180.857zM950.857 950.857q0 29.714-21.714 51.429t-51.429 21.714q-30.857 0-51.429-21.714l-196-195.429q-102.286 70.857-228 70.857-81.714 0-156.286-31.714t-128.571-85.714-85.714-128.571-31.714-156.286 31.714-156.286 85.714-128.571 128.571-85.714 156.286-31.714 156.286 31.714 128.571 85.714 85.714 128.571 31.714 156.286q0 125.714-70.857 228l196 196q21.143 21.143 21.143 51.429z"/></symbol><symbol id="icon-close" viewBox="0 0 1000 1000"><path d="M969.8,870.3c27,27.7,27,71.8,0,99.1C955.7,983,937.9,990,920,990c-17.9,0-35.7-7-49.7-20.7L500,599L129.6,969.4C115.6,983,97.8,990,79.9,990s-35.7-7-49.7-20.7c-27-27.3-27-71.4,0-99.1L400.9,500L30.3,129.3c-27-27.3-27-71.4,0-99.1c27.3-27,71.8-27,99.4,0L500,400.9L870.4,30.2c27.7-27,71.8-27,99.4,0c27,27.7,27,71.8,0,99.1L599.1,500L969.8,870.3z"/></symbol><symbol id="icon-twitter" viewBox="0 0 951 1024"><path class="path1" d="M925.714 233.143q-38.286 56-92.571 95.429 0.571 8 0.571 24 0 74.286-21.714 148.286t-66 142-105.429 120.286-147.429 83.429-184.571 31.143q-154.857 0-283.429-82.857 20 2.286 44.571 2.286 128.571 0 229.143-78.857-60-1.143-107.429-36.857t-65.143-91.143q18.857 2.857 34.857 2.857 24.571 0 48.571-6.286-64-13.143-106-63.714t-42-117.429v-2.286q38.857 21.714 83.429 23.429-37.714-25.143-60-65.714t-22.286-88q0-50.286 25.143-93.143 69.143 85.143 168.286 136.286t212.286 56.857q-4.571-21.714-4.571-42.286 0-76.571 54-130.571t130.571-54q80 0 134.857 58.286 62.286-12 117.143-44.571-21.143 65.714-81.143 101.714 53.143-5.714 106.286-28.571z"/></symbol><symbol id="icon-facebook" viewBox="0 0 585 1024"><path class="path1" d="M548 6.857v150.857h-89.714q-49.143 0-66.286 20.571t-17.143 61.714v108h167.429l-22.286 169.143h-145.143v433.714h-174.857v-433.714h-145.714v-169.143h145.714v-124.571q0-106.286 59.429-164.857t158.286-58.571q84 0 130.286 6.857z"/></symbol><symbol id="icon-clock" viewBox="0 0 1000 1000"><path d="M500,10C229.8,10,10,229.8,10,500c0,270.2,219.8,490,490,490c270.2,0,490-219.8,490-490C990,229.8,770.2,10,500,10z M500,910.2c-226.2,0-410.2-184-410.2-410.2c0-226.2,184-410.2,410.2-410.2c226.2,0,410.2,184,410.2,410.2C910.2,726.1,726.2,910.2,500,910.2z M753.1,374c8.2,11.9,5.2,28.1-6.6,36.3L509.9,573.7c-4.4,3.1-9.6,4.6-14.8,4.6c-4.1,0-8.3-1-12.1-3c-8.6-4.5-14-13.4-14-23.1V202.5c0-14.4,11.7-26.1,26.1-26.1c14.4,0,26.1,11.7,26.1,26.1v300l195.6-135.1C728.7,359.2,744.9,362.1,753.1,374z"/></symbol><symbol id="icon-calendar" viewBox="0 0 1000 1000"><path d="M920,500v420H80V500H920 M990,430H10v490c0,38.7,31.3,70,70,70h840c38.7,0,70-31.3,70-70V430L990,430z"/><path d="M850,80v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80H360v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80C72.8,80,10,142.7,10,220v140h980V220C990,142.7,927.2,80,850,80z"/><path d="M255,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C290,25.8,274.3,10,255,10z"/><path d="M745,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C780,25.8,764.3,10,745,10z"/></symbol><symbol id="icon-github" viewBox="0 0 12 14"><path d="M6 1q1.633 0 3.012 0.805t2.184 2.184 0.805 3.012q0 1.961-1.145 3.527t-2.957 2.168q-0.211 0.039-0.312-0.055t-0.102-0.234q0-0.023 0.004-0.598t0.004-1.051q0-0.758-0.406-1.109 0.445-0.047 0.801-0.141t0.734-0.305 0.633-0.52 0.414-0.82 0.16-1.176q0-0.93-0.617-1.609 0.289-0.711-0.062-1.594-0.219-0.070-0.633 0.086t-0.719 0.344l-0.297 0.187q-0.727-0.203-1.5-0.203t-1.5 0.203q-0.125-0.086-0.332-0.211t-0.652-0.301-0.664-0.105q-0.352 0.883-0.062 1.594-0.617 0.68-0.617 1.609 0 0.664 0.16 1.172t0.41 0.82 0.629 0.523 0.734 0.305 0.801 0.141q-0.305 0.281-0.383 0.805-0.164 0.078-0.352 0.117t-0.445 0.039-0.512-0.168-0.434-0.488q-0.148-0.25-0.379-0.406t-0.387-0.187l-0.156-0.023q-0.164 0-0.227 0.035t-0.039 0.090 0.070 0.109 0.102 0.094l0.055 0.039q0.172 0.078 0.34 0.297t0.246 0.398l0.078 0.18q0.102 0.297 0.344 0.48t0.523 0.234 0.543 0.055 0.434-0.027l0.18-0.031q0 0.297 0.004 0.691t0.004 0.426q0 0.141-0.102 0.234t-0.312 0.055q-1.812-0.602-2.957-2.168t-1.145-3.527q0-1.633 0.805-3.012t2.184-2.184 3.012-0.805zM2.273 9.617q0.023-0.055-0.055-0.094-0.078-0.023-0.102 0.016-0.023 0.055 0.055 0.094 0.070 0.047 0.102-0.016zM2.516 9.883q0.055-0.039-0.016-0.125-0.078-0.070-0.125-0.023-0.055 0.039 0.016 0.125 0.078 0.078 0.125 0.023zM2.75 10.234q0.070-0.055 0-0.148-0.062-0.102-0.133-0.047-0.070 0.039 0 0.141t0.133 0.055zM3.078 10.562q0.062-0.062-0.031-0.148-0.094-0.094-0.156-0.023-0.070 0.062 0.031 0.148 0.094 0.094 0.156 0.023zM3.523 10.758q0.023-0.086-0.102-0.125-0.117-0.031-0.148 0.055t0.102 0.117q0.117 0.047 0.148-0.047zM4.016 10.797q0-0.102-0.133-0.086-0.125 0-0.125 0.086 0 0.102 0.133 0.086 0.125 0 0.125-0.086zM4.469 10.719q-0.016-0.086-0.141-0.070-0.125 0.023-0.109 0.117t0.141 0.062 0.109-0.109z"></path></symbol><symbol id="icon-medium" viewBox="0 0 1000 1000"><path d="M336.5,240.2v641.5c0,9.1-2.3,16.9-6.8,23.2s-11.2,9.6-20,9.6c-6.2,0-12.2-1.5-18-4.4L37.3,782.7c-7.7-3.6-14.1-9.8-19.4-18.3S10,747.4,10,739V115.5c0-7.3,1.8-13.5,5.5-18.6c3.6-5.1,8.9-7.7,15.9-7.7c5.1,0,13.1,2.7,24.1,8.2l279.5,140C335.9,238.6,336.5,239.5,336.5,240.2L336.5,240.2z M371.5,295.5l292,473.6l-292-145.5V295.5z M990,305.3v576.4c0,9.1-2.6,16.5-7.7,22.1c-5.1,5.7-12,8.5-20.8,8.5s-17.3-2.4-25.7-7.1L694.7,784.9L990,305.3z M988.4,239.7c0,1.1-46.8,77.6-140.3,229.4C754.6,621,699.8,709.8,683.8,735.7L470.5,389l177.2-288.2c6.2-10.2,15.7-15.3,28.4-15.3c5.1,0,9.8,1.1,14.2,3.3l295.9,147.7C987.6,237.1,988.4,238.2,988.4,239.7L988.4,239.7z"/></symbol><symbol id="icon-instagram" viewBox="0 0 489.84 489.84"><path d="M249.62,50.46c65.4,0,73.14.25,99,1.43C372.47,53,385.44,57,394.07,60.32a75.88,75.88,0,0,1,28.16,18.32,75.88,75.88,0,0,1,18.32,28.16c3.35,8.63,7.34,21.6,8.43,45.48,1.18,25.83,1.43,33.57,1.43,99s-0.25,73.14-1.43,99c-1.09,23.88-5.08,36.85-8.43,45.48a81.11,81.11,0,0,1-46.48,46.48c-8.63,3.35-21.6,7.34-45.48,8.43-25.82,1.18-33.57,1.43-99,1.43s-73.15-.25-99-1.43c-23.88-1.09-36.85-5.08-45.48-8.43A75.88,75.88,0,0,1,77,423.86,75.88,75.88,0,0,1,58.69,395.7c-3.35-8.63-7.34-21.6-8.43-45.48-1.18-25.83-1.43-33.57-1.43-99s0.25-73.14,1.43-99c1.09-23.88,5.08-36.85,8.43-45.48A75.88,75.88,0,0,1,77,78.64a75.88,75.88,0,0,1,28.16-18.32c8.63-3.35,21.6-7.34,45.48-8.43,25.83-1.18,33.57-1.43,99-1.43m0-44.13c-66.52,0-74.86.28-101,1.47s-43.87,5.33-59.45,11.38A120.06,120.06,0,0,0,45.81,47.44,120.06,120.06,0,0,0,17.56,90.82C11.5,106.4,7.36,124.2,6.17,150.27s-1.47,34.46-1.47,101,0.28,74.86,1.47,101,5.33,43.87,11.38,59.45a120.06,120.06,0,0,0,28.25,43.38,120.06,120.06,0,0,0,43.38,28.25c15.58,6.05,33.38,10.19,59.45,11.38s34.46,1.47,101,1.47,74.86-.28,101-1.47,43.87-5.33,59.45-11.38a125.24,125.24,0,0,0,71.63-71.63c6.05-15.58,10.19-33.38,11.38-59.45s1.47-34.46,1.47-101-0.28-74.86-1.47-101-5.33-43.87-11.38-59.45a120.06,120.06,0,0,0-28.25-43.38,120.06,120.06,0,0,0-43.38-28.25C394.47,13.13,376.67,9,350.6,7.8s-34.46-1.47-101-1.47h0Z" transform="translate(-4.7 -6.33)" /><path d="M249.62,125.48A125.77,125.77,0,1,0,375.39,251.25,125.77,125.77,0,0,0,249.62,125.48Zm0,207.41a81.64,81.64,0,1,1,81.64-81.64A81.64,81.64,0,0,1,249.62,332.89Z" transform="translate(-4.7 -6.33)"/><circle cx="375.66" cy="114.18" r="29.39" /></symbol><symbol id="icon-linkedin" viewBox="0 0 12 14"><path d="M2.727 4.883v7.742h-2.578v-7.742h2.578zM2.891 2.492q0.008 0.57-0.395 0.953t-1.059 0.383h-0.016q-0.641 0-1.031-0.383t-0.391-0.953q0-0.578 0.402-0.957t1.051-0.379 1.039 0.379 0.398 0.957zM12 8.187v4.437h-2.57v-4.141q0-0.82-0.316-1.285t-0.988-0.465q-0.492 0-0.824 0.27t-0.496 0.668q-0.086 0.234-0.086 0.633v4.32h-2.57q0.016-3.117 0.016-5.055t-0.008-2.313l-0.008-0.375h2.57v1.125h-0.016q0.156-0.25 0.32-0.438t0.441-0.406 0.68-0.34 0.895-0.121q1.336 0 2.148 0.887t0.813 2.598z"></path></symbol><symbol id="icon-heart" viewBox="0 0 34 30"><path d="M17,29.7 L16.4,29.2 C3.5,18.7 0,15 0,9 C0,4 4,0 9,0 C13.1,0 15.4,2.3 17,4.1 C18.6,2.3 20.9,0 25,0 C30,0 34,4 34,9 C34,15 30.5,18.7 17.6,29.2 L17,29.7 Z M9,2 C5.1,2 2,5.1 2,9 C2,14.1 5.2,17.5 17,27.1 C28.8,17.5 32,14.1 32,9 C32,5.1 28.9,2 25,2 C21.5,2 19.6,4.1 18.1,5.8 L17,7.1 L15.9,5.8 C14.4,4.1 12.5,2 9,2 Z" id="Shape"></path></symbol><symbol id="icon-arrow-right" viewBox="0 0 25.452 25.452"><path d="M4.471,24.929v-2.004l12.409-9.788c0.122-0.101,0.195-0.251,0.195-0.411c0-0.156-0.073-0.31-0.195-0.409L4.471,2.526V0.522c0-0.2,0.115-0.384,0.293-0.469c0.18-0.087,0.396-0.066,0.552,0.061l15.47,12.202c0.123,0.1,0.195,0.253,0.195,0.409c0,0.16-0.072,0.311-0.195,0.411L5.316,25.34c-0.155,0.125-0.372,0.147-0.552,0.061C4.586,25.315,4.471,25.13,4.471,24.929z"/></symbol><symbol id="icon-star" viewBox="0 0 48 48"><path fill="currentColor" d="M44,24c0,11.045-8.955,20-20,20S4,35.045,4,24S12.955,4,24,4S44,12.955,44,24z"/><path fill="#ffffff" d="M24,11l3.898,7.898l8.703,1.301l-6.301,6.102l1.5,8.699L24,30.898L16.199,35l1.5-8.699l-6.301-6.102  l8.703-1.301L24,11z"/></symbol><symbol id="icon-read" viewBox="0 0 32 32"><path fill="currentColor" d="M29,4H3C1.343,4,0,5.343,0,7v18c0,1.657,1.343,3,3,3h10c0,0.552,0.448,1,1,1h4c0.552,0,1-0.448,1-1h10  c1.657,0,3-1.343,3-3V7C32,5.343,30.657,4,29,4z M29,5v20H18.708c-0.618,0-1.236,0.146-1.789,0.422l-0.419,0.21V5H29z M15.5,5  v20.632l-0.419-0.21C14.528,25.146,13.91,25,13.292,25H3V5H15.5z M31,25c0,1.103-0.897,2-2,2H18v1h-4v-1H3c-1.103,0-2-0.897-2-2V7  c0-0.737,0.405-1.375,1-1.722V25c0,0.552,0.448,1,1,1h10.292c0.466,0,0.925,0.108,1.342,0.317l0.919,0.46  c0.141,0.07,0.294,0.106,0.447,0.106c0.153,0,0.306-0.035,0.447-0.106l0.919-0.46C17.783,26.108,18.242,26,18.708,26H29  c0.552,0,1-0.448,1-1V5.278C30.595,5.625,31,6.263,31,7V25z M6,12.5C6,12.224,6.224,12,6.5,12h5c0.276,0,0.5,0.224,0.5,0.5  S11.776,13,11.5,13h-5C6.224,13,6,12.776,6,12.5z M6,14.5C6,14.224,6.224,14,6.5,14h5c0.276,0,0.5,0.224,0.5,0.5S11.776,15,11.5,15  h-5C6.224,15,6,14.776,6,14.5z M6,16.5C6,16.224,6.224,16,6.5,16h5c0.276,0,0.5,0.224,0.5,0.5S11.776,17,11.5,17h-5  C6.224,17,6,16.776,6,16.5z M20,12.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,13,25.5,13h-5  C20.224,13,20,12.776,20,12.5z M20,14.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,15,25.5,15h-5  C20.224,15,20,14.776,20,14.5z M20,16.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,17,25.5,17h-5  C20.224,17,20,16.776,20,16.5z"></path></symbol><symbol id="icon-tistory" viewBox="0 0 24 24"><path d="M4 4h16v3h-6v13h-4V7H4V4z"/></symbol></defs></svg>

        <header class="bar-header">
    <a id="menu" role="button">
        <svg id="open" class="icon-menu"><use xlink:href="#icon-menu"></use></svg>
    </a>
    <h1 class="logo">
        <a href="/">
            
                somaz <span class="version">v3.1.2</span>
            
        </a>
    </h1>
    <a id="search" class="dosearch" role="button">
        <svg class="icon-search"><use xlink:href="#icon-search"></use></svg>
    </a>
    
        <a href="https://github.com/thiagorossener/jekflix-template" class="get-theme" role="button">
            Get this theme!
        </a>
    
</header>

<div id="mask" class="overlay"></div>

<aside class="sidebar" id="sidebar">
    <nav id="navigation">
      <h2>Menu</h2>
      <ul>
  
    
      <li>
        <a href="https://somaz.blog/">Home</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/about">About</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/category">Category</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/contact">Contact</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/feed.xml">Feed</a>
      </li>
    
  
</ul>

    </nav>
</aside>

<div class="search-wrapper">
    <div class="search-form">
        <input type="text" class="search-field" placeholder="Search">
        <svg class="icon-remove-sign"><use xlink:href="#icon-close"></use></svg>
        <ul class="search-results search-list"></ul>
    </div>
</div>



        <section class="post two-columns">
            <article role="article" class="post-content">
                <p class="post-info">
                    
                        <svg class="icon-calendar" id="date"><use xlink:href="#icon-calendar"></use></svg>
                        <time class="date" datetime="2025-06-04T00:00:00+00:00">
                            


June 4, 2025

                        </time>
                    
                    <svg id="clock" class="icon-clock"><use xlink:href="#icon-clock"></use></svg>
                    <span>13 min to read</span>
                </p>
                <h1 class="post-title">Installing Prometheus and Thanos with Helm</h1>
                <p class="post-subtitle">A step-by-step guide to setting up Prometheus and Thanos monitoring stack</p>

                
                    <img src="https://res.cloudinary.com/dkcm26aem/image/upload/v1738640346/prometheus-thans-archi_zfo72f.png" alt="Featured image" class="post-cover">
                

                <!-- Pagination links -->



                <!-- Add your table of contents here -->


                <p><a href="https://particule.io/en/blog/thanos-monitoring/">Image Reference</a></p>

<p><br /></p>

<hr />

<h2 id="installation-guide-for-prometheus-and-thanos">Installation Guide for Prometheus and Thanos</h2>

<p>This guide provides detailed, step-by-step instructions for installing and configuring Prometheus and Thanos using Helm charts in Kubernetes environments. Learn how to set up a scalable monitoring infrastructure for both single-cluster and multi-cluster deployments with long-term metrics storage and unified querying capabilities.</p>

<p><br /></p>

<h3 id="introduction-and-prerequisites">Introduction and Prerequisites</h3>

<div class="info-box info-box-default-not-check">
  <strong>Before You Begin</strong>
  <p>This guide follows our <a href="https://somaz94.github.io/category/monitoring/prometheus-thanos/">previous post about Prometheus and Thanos</a>, focusing on the practical implementation aspects. Before proceeding with the installation, ensure you have the following prerequisites in place:</p>
  
  <ul>
    <li><strong>Kubernetes Cluster</strong>: Running cluster with proper networking configuration</li>
    <li><strong>Storage</strong>: Storage provisioner configured for persistent volumes</li>
    <li><strong>Object Storage</strong>: Access to S3, GCS, MinIO, or other compatible object storage for Thanos</li>
    <li><strong>Helm</strong>: Helm 3.x installed and configured</li>
    <li><strong>kubectl</strong>: Properly configured with access to your cluster</li>
    <li><strong>Namespace</strong>: A namespace for your monitoring stack (we'll use "monitoring" in this guide)</li>
  </ul>
  
  <p>If you're setting up a multi-cluster configuration, ensure you have network connectivity between clusters and the proper DNS configuration in place.</p>
</div>

<p><br /></p>

<hr />

<h2 id="installing-prometheus">Installing Prometheus</h2>

<p>Prometheus can be installed using different Helm charts depending on your requirements. This section covers two popular approaches: using the prometheus-community chart for basic installations and kube-prometheus-stack for a more comprehensive monitoring solution with additional components.</p>

<p><br /></p>

<h3 id="available-installation-methods">Available Installation Methods</h3>

<div style="width: 100%; margin: 20px auto;">
  <div class="mermaid">
    graph LR
      A[Prometheus Installation Methods] --&gt; B[prometheus-community Chart]
      A --&gt; C[kube-prometheus-stack Chart]
      
      B --&gt; D[Basic Prometheus installation]
      B --&gt; E[Customizable components]
      B --&gt; F[Lighter weight]
      
      C --&gt; G[Complete monitoring solution]
      C --&gt; H[Includes Grafana, Alertmanager]
      C --&gt; I[Pre-configured alerts and dashboards]
      C --&gt; J[Uses Prometheus Operator CRDs]
      
      style A fill:#f5f5f5,stroke:#333,stroke-width:1px
      style B fill:#a5d6a7,stroke:#333,stroke-width:1px
      style C fill:#64b5f6,stroke:#333,stroke-width:1px
      style D fill:#ffcc80,stroke:#333,stroke-width:1px
      style E fill:#ffcc80,stroke:#333,stroke-width:1px
      style F fill:#ffcc80,stroke:#333,stroke-width:1px
      style G fill:#ce93d8,stroke:#333,stroke-width:1px
      style H fill:#ce93d8,stroke:#333,stroke-width:1px
      style I fill:#ce93d8,stroke:#333,stroke-width:1px
      style J fill:#ce93d8,stroke:#333,stroke-width:1px
  </div>
</div>

<p><br /></p>

<div class="table-container">
  <table class="table-beauty">
    <tr>
      <th style="width: 30%;">Chart</th>
      <th style="width: 70%;">Description</th>
    </tr>
    <tr>
      <td><strong>prometheus-community</strong></td>
      <td>
        <ul>
          <li>Basic Prometheus installation with core components</li>
          <li>More granular control over individual components</li>
          <li>Good for specific use cases with custom requirements</li>
          <li>Lighter weight with less resource consumption</li>
        </ul>
      </td>
    </tr>
    <tr>
      <td><strong>kube-prometheus-stack</strong></td>
      <td>
        <ul>
          <li>Comprehensive monitoring solution using the Prometheus Operator</li>
          <li>Includes Grafana, Alertmanager, and various exporters</li>
          <li>Pre-configured alerts and dashboards for Kubernetes monitoring</li>
          <li>Better integration with Thanos for scalable monitoring</li>
          <li>Uses Custom Resource Definitions for declarative configuration</li>
        </ul>
      </td>
    </tr>
  </table>
</div>

<h3 id="installing-prometheus-crds">Installing Prometheus CRDs</h3>

<p>Before installing Prometheus with the operator-based approach, you need to install the required Custom Resource Definitions (CRDs):</p>

<div class="info-box info-box-default">
  <strong>Installing Required CRDs</strong>
  <p>Execute these commands to install the Prometheus Operator CRDs:</p>
</div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Add the Prometheus community repository</span>
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm repo update

<span class="c"># Install CRDs in the monitoring namespace</span>
helm <span class="nb">install </span>prometheus-operator-crds <span class="nt">-n</span> monitoring prometheus-community/prometheus-operator-crds

<span class="c"># Verify the installation</span>
kubectl get crd | <span class="nb">grep </span>monitoring
</code></pre></div></div>

<h4 id="why-crds-first">Why CRDs First?</h4>

<p>Installing CRDs separately before the main chart ensures:</p>
<ul>
  <li>Clean upgrades without CRD-related conflicts</li>
  <li>Better management of CRD lifecycle</li>
  <li>Prevention of accidental CRD deletion during chart uninstallation</li>
</ul>

<p><br /></p>

<h3 id="option-1-installing-prometheus-community-chart">Option 1: Installing Prometheus Community Chart</h3>

<h4 id="configuring-prometheus-community-chart">Configuring Prometheus Community Chart</h4>

<p>Create a values file (<code class="language-plaintext highlighter-rouge">values/somaz.yaml</code>) with the following configuration:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">server</span>
  <span class="na">image</span><span class="pi">:</span>
    <span class="na">repository</span><span class="pi">:</span> <span class="s">quay.io/prometheus/prometheus</span>
  <span class="na">persistentVolume</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">accessModes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">ReadWriteOnce</span>
    <span class="na">storageClass</span><span class="pi">:</span> <span class="s2">"</span><span class="s">default"</span>
  <span class="na">replicaCount</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">statefulSet</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">false</span>
  <span class="na">service</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">NodePort</span>

<span class="na">alertmanager</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">persistence</span><span class="pi">:</span>
    <span class="na">size</span><span class="pi">:</span> <span class="s">2Gi</span>

<span class="na">kube-state-metrics</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>

<span class="na">prometheus-node-exporter</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>

<span class="na">prometheus-pushgateway</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">serviceAnnotations</span><span class="pi">:</span>
    <span class="na">prometheus.io/probe</span><span class="pi">:</span> <span class="s">pushgateway</span>
</code></pre></div></div>

<p><br /></p>

<h4 id="installation-commands">Installation Commands</h4>

<p>Install Prometheus using these commands:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Install Prometheus</span>
helm <span class="nb">install </span>prometheus-community prometheus-community/prometheus <span class="nt">-n</span> monitoring <span class="nt">-f</span> ./values/somaz.yaml <span class="nt">--create-namespace</span>

<span class="c"># Upgrade if needed</span>
helm upgrade prometheus-community prometheus-community/prometheus <span class="nt">-n</span> monitoring <span class="nt">-f</span> ./values/somaz.yaml
</code></pre></div></div>

<p><br /></p>

<h3 id="option-2-installing-kube-prometheus-stack">Option 2: Installing Kube-Prometheus-Stack</h3>

<h4 id="configuring-kube-prometheus-stack">Configuring Kube-Prometheus-Stack</h4>

<p>Create a values file (<code class="language-plaintext highlighter-rouge">values/somaz.yaml</code>) with this configuration for Thanos integration:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">alertmanager</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">config</span><span class="pi">:</span>
    <span class="na">global</span><span class="pi">:</span>
      <span class="na">resolve_timeout</span><span class="pi">:</span> <span class="s">5m</span>
  <span class="na">service</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">NodePort</span>

<span class="na">grafana</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="no">false</span>

<span class="na">prometheus</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">thanosService</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">thanosServiceMonitor</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">thanosServiceExternal</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">NodePort</span>
  <span class="na">ingress</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">ingressClassName</span><span class="pi">:</span> <span class="s">nginx</span>
    <span class="na">hosts</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">prometheus.somaz.link</span>
  <span class="na">prometheusSpec</span><span class="pi">:</span>
    <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
    <span class="na">thanos</span><span class="pi">:</span>
      <span class="na">baseImage</span><span class="pi">:</span> <span class="s">quay.io/thanos/thanos</span>
      <span class="na">version</span><span class="pi">:</span> <span class="s">v0.36.1</span>
      <span class="na">objectStorageConfig</span><span class="pi">:</span>
        <span class="na">existingSecret</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">thanos-objstore</span>
          <span class="na">key</span><span class="pi">:</span> <span class="s">objstore.yml</span>
    <span class="na">storageSpec</span><span class="pi">:</span> 
      <span class="na">volumeClaimTemplate</span><span class="pi">:</span>
        <span class="na">spec</span><span class="pi">:</span>
          <span class="na">storageClassName</span><span class="pi">:</span> <span class="s">default</span>
          <span class="na">accessModes</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">ReadWriteOnce"</span><span class="pi">]</span>
          <span class="na">resources</span><span class="pi">:</span>
            <span class="na">requests</span><span class="pi">:</span>
              <span class="na">storage</span><span class="pi">:</span> <span class="s">100Gi</span>
    <span class="na">externalLabels</span><span class="pi">:</span>
      <span class="na">provider</span><span class="pi">:</span> <span class="s">somaz</span>
      <span class="na">region</span><span class="pi">:</span> <span class="s">seoul</span>
      <span class="na">cluster</span><span class="pi">:</span> <span class="s">mgmt</span>
</code></pre></div></div>

<div class="info-box info-box-default-not-check">
  <strong>Key Configuration Points</strong>
  <p>This configuration:</p>
  <ul>
    <li>Enables the Thanos sidecar for long-term storage integration</li>
    <li>References a secret (<code>thanos-objstore</code>) containing object storage configuration</li>
    <li>Adds external labels to identify metrics from this cluster</li>
    <li>Configures ingress for accessing Prometheus UI</li>
    <li>Sets up persistent storage for metrics data</li>
  </ul>
</div>

<p><br /></p>

<h4 id="installation-commands-1">Installation Commands</h4>

<p>Install the Kube-Prometheus-Stack using these commands:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Verify the configuration</span>
helm lint <span class="nt">--values</span> ./values/somaz.yaml

<span class="c"># Install the stack</span>
helm <span class="nb">install </span>kube-prometheus-stack prometheus-community/kube-prometheus-stack <span class="nt">-n</span> monitoring <span class="nt">-f</span> ./values/somaz.yaml <span class="nt">--create-namespace</span>

<span class="c"># Upgrade if needed</span>
helm upgrade kube-prometheus-stack prometheus-community/kube-prometheus-stack <span class="nt">-n</span> monitoring <span class="nt">-f</span> ./values/somaz.yaml
</code></pre></div></div>

<p><br /></p>

<div style="width: 100%; margin: 20px auto;">
  <div class="mermaid">
    sequenceDiagram
        participant User as You
        participant Helm as Helm
        participant K8s as Kubernetes API
        participant Operator as Prometheus Operator
        participant Prometheus as Prometheus Pods
        
        User-&gt;&gt;Helm: helm install kube-prometheus-stack
        Helm-&gt;&gt;K8s: Apply CRDs and resources
        K8s-&gt;&gt;Operator: Create Operator Pod
        Operator-&gt;&gt;K8s: Prometheus CR created
        Operator-&gt;&gt;Prometheus: Create and configure Prometheus
        Prometheus-&gt;&gt;User: Ready for monitoring
  </div>
</div>

<p><br /></p>

<hr />

<h2 id="thanos-object-storage-configuration">Thanos Object Storage Configuration</h2>

<p>Thanos requires object storage for long-term metrics retention. This section explains how to configure the object storage secret that both Prometheus and Thanos components will use.</p>

<p><br /></p>

<h3 id="creating-the-object-storage-secret">Creating the Object Storage Secret</h3>

<h4 id="object-storage-configuration">Object Storage Configuration</h4>

<p>Create a file named <code class="language-plaintext highlighter-rouge">objstore.yml</code> with your storage provider configuration:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">type</span><span class="pi">:</span> <span class="s">s3</span>
<span class="na">config</span><span class="pi">:</span>
  <span class="na">bucket</span><span class="pi">:</span> <span class="s">thanos</span>
  <span class="na">endpoint</span><span class="pi">:</span> <span class="s">minio.storage.svc.cluster.local:9000</span>
  <span class="na">access_key</span><span class="pi">:</span> <span class="s">minioadmin</span>
  <span class="na">secret_key</span><span class="pi">:</span> <span class="s">minioadmin</span>
  <span class="na">insecure</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<div class="info-box info-box-default-not-check">
  <strong>Storage Provider Options</strong>
  <p>Thanos supports various object storage providers:</p>
  <ul>
    <li><strong>AWS S3</strong>: For production environments in AWS</li>
    <li><strong>Google Cloud Storage</strong>: For GCP deployments</li>
    <li><strong>Azure Blob Storage</strong>: For Azure environments</li>
    <li><strong>MinIO</strong>: For on-premises or testing (as shown in example)</li>
    <li><strong>Others</strong>: Alibaba OSS, Tencent COS, OpenStack Swift, etc.</li>
  </ul>
  <p>Adjust the configuration according to your chosen provider.</p>
</div>

<p><br /></p>

<h4 id="creating-the-kubernetes-secret">Creating the Kubernetes Secret</h4>

<p>Create a Kubernetes secret with your object storage configuration:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Create the secret in the monitoring namespace</span>
kubectl create secret generic thanos-objstore <span class="nt">-n</span> monitoring <span class="nt">--from-file</span><span class="o">=</span>objstore.yml
</code></pre></div></div>

<p><br /></p>

<hr />

<h2 id="installing-thanos">Installing Thanos</h2>

<p>Thanos extends Prometheus with long-term storage, high availability, and global query capabilities. This section covers deploying Thanos components using the Bitnami Helm chart for both single-cluster and multi-cluster scenarios.</p>

<p><br /></p>

<h3 id="single-cluster-thanos-configuration">Single-Cluster Thanos Configuration</h3>

<h4 id="internal-cluster-setup">Internal Cluster Setup</h4>

<p>Create a values file (<code class="language-plaintext highlighter-rouge">values/somaz.yaml</code>) for a single-cluster Thanos deployment:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">global</span><span class="pi">:</span>
  <span class="na">defaultStorageClass</span><span class="pi">:</span> <span class="s2">"</span><span class="s">default"</span>

<span class="na">fullnameOverride</span><span class="pi">:</span> <span class="s2">"</span><span class="s">thanos"</span>
<span class="na">clusterDomain</span><span class="pi">:</span> <span class="s">somaz-cluster.local</span>

<span class="na">existingObjstoreSecret</span><span class="pi">:</span> <span class="s2">"</span><span class="s">thanos-objstore"</span>

<span class="na">query</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">logLevel</span><span class="pi">:</span> <span class="s">debug</span>
  <span class="na">replicaLabel</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">prometheus_replica</span>
  <span class="na">stores</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">dnssrv+_grpc._tcp.kube-prometheus-stack-thanos-discovery.monitoring.svc.somaz-cluster.local</span>
  <span class="na">ingress</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">hostname</span><span class="pi">:</span> <span class="s">thanos-query.somaz.link</span>
    <span class="na">ingressClassName</span><span class="pi">:</span> <span class="s">nginx</span>

<span class="na">queryFrontend</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">ingress</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">hostname</span><span class="pi">:</span> <span class="s">thanos.somaz.link</span>

<span class="na">compactor</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">retentionResolutionRaw</span><span class="pi">:</span> <span class="s">60d</span>
  <span class="na">retentionResolution5m</span><span class="pi">:</span> <span class="s">60d</span>
  <span class="na">retentionResolution1h</span><span class="pi">:</span> <span class="s">1y</span>
  <span class="na">persistence</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">size</span><span class="pi">:</span> <span class="s">10Gi</span>

<span class="na">storegateway</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">persistence</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">size</span><span class="pi">:</span> <span class="s">10Gi</span>
</code></pre></div></div>

<p><br /></p>

<div class="info-box info-box-default-not-check">
  <strong>Component Explanations</strong>
  <p>This configuration sets up the following Thanos components:</p>
  <ul>
    <li><strong>Query</strong>: The frontend for querying metrics from both local Prometheus and object storage</li>
    <li><strong>Query Frontend</strong>: Provides advanced query optimization and caching</li>
    <li><strong>Compactor</strong>: Handles data compaction and downsampling in object storage</li>
    <li><strong>Store Gateway</strong>: Accesses historical metrics in object storage</li>
  </ul>
  <p>The <code>stores</code> configuration connects to your Prometheus Thanos sidecar using DNS service discovery.</p>
</div>

<p><br /></p>

<div style="width: 100%; margin: 20px auto;">
  <div class="mermaid">
    graph TD
      A[Prometheus + Thanos Sidecar] --&gt;|Upload metrics| B[Object Storage]
      A --&gt;|Serve real-time metrics| C[Thanos Query]
      D[Thanos Store Gateway] --&gt;|Fetch historical data| B
      D --&gt;|Serve historical metrics| C
      E[Thanos Compactor] --&gt;|Compact &amp; downsample| B
      C --&gt;|Serve metrics API| F[Thanos Query Frontend]
      F --&gt;|Expose UI &amp; API| G[Users/Grafana]
      
      style A fill:#a5d6a7,stroke:#333,stroke-width:1px
      style B fill:#64b5f6,stroke:#333,stroke-width:1px
      style C fill:#ffcc80,stroke:#333,stroke-width:1px
      style D fill:#ce93d8,stroke:#333,stroke-width:1px
      style E fill:#ef9a9a,stroke:#333,stroke-width:1px
      style F fill:#9fa8da,stroke:#333,stroke-width:1px
      style G fill:#f5f5f5,stroke:#333,stroke-width:1px
  </div>
</div>

<p><br /></p>

<h3 id="multi-cluster-thanos-configuration">Multi-Cluster Thanos Configuration</h3>

<h4 id="external-cluster-setup">External Cluster Setup</h4>
<p>For external clusters, create a values file (<code class="language-plaintext highlighter-rouge">values/somaz-externalcluster.yaml</code>):</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">query</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">stores</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">dnssrv+_grpc._tcp.kube-prometheus-stack-thanos-discovery.monitoring.svc.external-cluster.local</span>
  <span class="na">ingress</span><span class="pi">:</span>
    <span class="na">grpc</span><span class="pi">:</span>
      <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">hostname</span><span class="pi">:</span> <span class="s">external-cluster-thanos-query.somaz.link</span>
      <span class="na">ingressClassName</span><span class="pi">:</span> <span class="s2">"</span><span class="s">nginx"</span>
      <span class="na">annotations</span><span class="pi">:</span>
        <span class="na">nginx.ingress.kubernetes.io/backend-protocol</span><span class="pi">:</span> <span class="s2">"</span><span class="s">GRPC"</span>
</code></pre></div></div>

<h4 id="primary-cluster-with-multi-cluster-configuration">Primary Cluster with Multi-Cluster Configuration</h4>

<p>Update the main Thanos Query configuration to include the external cluster:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">query</span><span class="pi">:</span>
  <span class="na">stores</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">dnssrv+_grpc._tcp.kube-prometheus-stack-thanos-discovery.monitoring.svc.somaz-cluster.local</span>
    <span class="pi">-</span> <span class="s">dnssrv+_grpc._tcp.thanos-multicluster-query-grpc.monitoring.svc.somaz-cluster.local</span>
</code></pre></div></div>

<p><br /></p>

<div class="info-box info-box-default-not-check">
  <strong>Multi-Cluster Architecture</strong>
  <p>In this setup:</p>
  <ul>
    <li>Each cluster runs Prometheus with Thanos sidecar uploading to shared object storage</li>
    <li>External clusters expose their Thanos Query endpoints via gRPC</li>
    <li>The primary cluster's Thanos Query connects to both local and external endpoints</li>
    <li>All metrics are deduplicated and unified in the primary Thanos Query Frontend</li>
  </ul>
</div>

<div style="width: 100%; margin: 20px auto;">
  <div class="mermaid">
    graph TD
      subgraph "Cluster 1 (Primary)"
        A1[Prometheus] --&gt;|Upload| B[Object Storage]
        A1 --&gt;|Serve| C1[Thanos Query 1]
        D1[Store Gateway] --&gt;|Fetch| B
        D1 --&gt;|Serve| C1
        C1 --&gt;|Query| F[Query Frontend]
      end
      
      subgraph "Cluster 2 (External)"
        A2[Prometheus] --&gt;|Upload| B
        A2 --&gt;|Serve| C2[Thanos Query 2]
      end
      
      C1 -.-&gt;|Connect| C2
      F --&gt;|Serve| G[Users/Grafana]
      
      style A1 fill:#a5d6a7,stroke:#333,stroke-width:1px
      style A2 fill:#a5d6a7,stroke:#333,stroke-width:1px
      style B fill:#64b5f6,stroke:#333,stroke-width:1px
      style C1 fill:#ffcc80,stroke:#333,stroke-width:1px
      style C2 fill:#ffcc80,stroke:#333,stroke-width:1px
      style D1 fill:#ce93d8,stroke:#333,stroke-width:1px
      style F fill:#9fa8da,stroke:#333,stroke-width:1px
      style G fill:#f5f5f5,stroke:#333,stroke-width:1px
  </div>
</div>

<h3 id="installing-thanos-components">Installing Thanos Components</h3>

<h4 id="installation-commands-2">Installation Commands</h4>
<p>Install Thanos using the Bitnami Helm chart:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Add the Bitnami repository</span>
helm repo add bitnami https://charts.bitnami.com/bitnami
helm repo update

<span class="c"># Verify the configuration</span>
helm lint <span class="nt">--values</span> ./values/somaz.yaml

<span class="c"># Install Thanos</span>
helm <span class="nb">install </span>thanos bitnami/thanos <span class="nt">-n</span> monitoring <span class="nt">-f</span> ./values/somaz.yaml <span class="nt">--create-namespace</span>

<span class="c"># Upgrade if needed</span>
helm upgrade thanos bitnami/thanos <span class="nt">-n</span> monitoring <span class="nt">-f</span> ./values/somaz.yaml
</code></pre></div></div>

<p><br /></p>

<hr />

<h2 id="verification-and-troubleshooting">Verification and Troubleshooting</h2>

<p>After installation, verify that all components are working correctly and troubleshoot any issues that may arise. This section provides guidance on common verification steps and troubleshooting techniques.</p>

<p><br /></p>

<h3 id="verifying-the-installation">Verifying the Installation</h3>

<h4 id="check-components-status">Check Components Status</h4>
<p>Verify that all pods are running correctly:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Check Prometheus and related components</span>
kubectl get pods <span class="nt">-n</span> monitoring <span class="nt">-l</span> <span class="nv">app</span><span class="o">=</span>prometheus

<span class="c"># Check Thanos components</span>
kubectl get pods <span class="nt">-n</span> monitoring <span class="nt">-l</span> app.kubernetes.io/name<span class="o">=</span>thanos

<span class="c"># Check service endpoints</span>
kubectl get svc <span class="nt">-n</span> monitoring
</code></pre></div></div>

<h3 id="dns-and-connectivity-troubleshooting">DNS and Connectivity Troubleshooting</h3>

<h4 id="testing-dns-resolution">Testing DNS Resolution</h4>
<p>Verify DNS resolution for service discovery:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Check DNS resolution for Thanos discovery endpoints</span>
kubectl run <span class="nt">-it</span> <span class="nt">--rm</span> <span class="nt">--image</span><span class="o">=</span>nicolaka/netshoot dns-test <span class="nt">--restart</span><span class="o">=</span>Never <span class="nt">--</span> dig _grpc._tcp.kube-prometheus-stack-thanos-discovery.monitoring.svc.somaz-cluster.local

<span class="c"># Verify endpoints are registered</span>
kubectl get ep <span class="nt">-n</span> monitoring | <span class="nb">grep </span>thanos-discovery
</code></pre></div></div>

<p><br /></p>

<div class="info-box info-box-default-not-check">
  <strong>Common Issues and Solutions</strong>
  <ul>
    <li><strong>DNS Resolution Failures</strong>: Ensure CoreDNS is working correctly and service names are accurate</li>
    <li><strong>Thanos Query Cannot Find Stores</strong>: Verify store endpoints and network connectivity</li>
    <li><strong>Object Storage Access Issues</strong>: Check credentials and endpoint configuration</li>
    <li><strong>No Metrics in Thanos Query</strong>: Verify Prometheus external labels and proper sidecar configuration</li>
    <li><strong>Ingress Connectivity Problems</strong>: Check ingress controller logs and annotations</li>
  </ul>
</div>

<p><br /></p>

<h3 id="accessing-user-interfaces">Accessing User Interfaces</h3>

<h4 id="component-uis">Component UIs</h4>
<p>Access the following UIs to verify your installation:</p>
<ul>
  <li><strong>Prometheus UI:</strong> http://prometheus.somaz.link</li>
  <li><strong>Thanos Query UI:</strong> http://thanos-query.somaz.link</li>
  <li><strong>Thanos Frontend UI:</strong> http://thanos.somaz.link</li>
</ul>

<p><br /></p>

<hr />

<h2 id="next-steps-and-advanced-topics">Next Steps and Advanced Topics</h2>

<p>Once your Prometheus and Thanos installation is complete and verified, you can expand your monitoring infrastructure with additional components and integrations.</p>

<p><br /></p>

<h3 id="upcoming-content">Upcoming Content</h3>

<h4 id="in-our-next-post">In Our Next Post</h4>
<p>We’ll explore additional monitoring capabilities including:</p>
<ul>
  <li>Loki with Promtail: Logging solution that integrates with your monitoring stack</li>
  <li>Node Feature Discovery: Enhancing Kubernetes node capabilities detection</li>
  <li>Grafana Dashboards: Creating comprehensive visualization dashboards</li>
</ul>

<p><br /></p>

<h3 id="advanced-configuration-options">Advanced Configuration Options</h3>

<h4 id="fine-tuning-your-installation">Fine-tuning Your Installation</h4>
<p>Consider these advanced configurations for production environments:</p>
<ul>
  <li>Setting up high availability for Prometheus and Thanos components</li>
  <li>Configuring detailed alert rules and notification channels</li>
  <li>Implementing retention policies and downsampling strategies</li>
  <li>Adding custom exporters for application-specific metrics</li>
  <li>Integrating with existing notification systems (PagerDuty, Slack, etc.)</li>
</ul>

<p><br /></p>

<hr />

<h2 id="key-points">Key Points</h2>

<div class="info-box info-box-success-not-check">
  <ul>
    <li>
      <strong>Installation Approach</strong><br />
      - kube-prometheus-stack for comprehensive monitoring with Operator<br />
      - prometheus-community chart for lightweight, customizable setups<br />
      - Bitnami Thanos chart for long-term storage and multi-cluster capabilities
    </li>
    <li>
      <strong>Key Components</strong><br />
      - Prometheus with Thanos sidecar for metrics collection<br />
      - Object storage backend for long-term metrics retention<br />
      - Thanos Query for unified metric access<br />
      - Thanos Store Gateway for historical data access
    </li>
    <li>
      <strong>Multi-Cluster Setup</strong><br />
      - Shared object storage between clusters<br />
      - Federated query across cluster boundaries<br />
      - Centralized view of all metrics<br />
      - Seamless scaling as your infrastructure grows
    </li>
  </ul>
</div>

<p><br /></p>

<hr />

<h2 id="references">References</h2>
<ul>
  <li><a href="https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-prometheus-stack">Kube-Prometheus-Stack</a></li>
  <li><a href="https://github.com/prometheus-community/helm-charts/tree/main/charts/prometheus">Prometheus Helm Chart</a></li>
  <li><a href="https://thanos.io/v0.8/thanos/storage.md/">Thanos Storage Configuration</a></li>
  <li><a href="https://github.com/bitnami/charts/tree/main/bitnami/thanos">Bitnami Thanos Chart</a></li>
  <li><a href="https://particule.io/en/blog/thanos-monitoring/">Thanos Monitoring Guide</a></li>
  <li><a href="https://thanos.io/tip/components/query.md/">Thanos Query Documentation</a></li>
  <li><a href="https://github.com/prometheus-operator/prometheus-operator/blob/main/Documentation/user-guides/getting-started.md">Prometheus Operator User Guide</a></li>
  <li><a href="https://www.infracloud.io/blogs/multicluster-monitoring-thanos/">Multi-cluster Monitoring with Thanos</a></li>
</ul>


                <!-- Pagination links -->


            </article>

            
                <aside class="see-also">
                    <h2>See also</h2>
                    <ul>
                        
                        
                        
                            <li>
                                <a href="/category/network/bgp-border-gateway-protocol-complete-guide/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1755074091/bgp-1_i4oqyf.png">
                                    
                                    <h3>BGP (Border Gateway Protocol) Complete Guide - Internet's Core Routing Protocol</h3>
                                </a>
                            </li>
                        
                            <li>
                                <a href="/category/database/database-schema/">
                                    
                                        <img src="https://blog.kakaocdn.net/dn/cUXbGh/btsbAXsA8cu/4XbbgRPEFkWTQ8MVeMuTeK/img.png">
                                    
                                    <h3>Understanding Database Schema</h3>
                                </a>
                            </li>
                        
                            <li>
                                <a href="/category/network/what-is-ssid-complete-guide/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1755067573/ssid-1_gp9ncy.png">
                                    
                                    <h3>What is SSID? Complete Guide to Service Set Identifier</h3>
                                </a>
                            </li>
                        
                    </ul>
                </aside>
            

        </section>

        <!-- Add time bar only for pages without pagination -->
        
            <div class="time-bar" data-minutes="13">
    <span class="time-completed"></span>
    <span class="time-remaining"></span>
    <div class="bar">
        <span class="completed" style="width:0%;"></span>
        <span class="remaining" style="width:100%;"></span>
    </div>
</div>

            <button class="toggle-preview" onclick="togglePreview()">
    <span>Hide Preview ▼</span>
</button>

<div id="recommendationSection" class="recommendation">
    <div class="message">
        <strong>Why don't you read something next?</strong>
        <div>
            <button>
                <svg><use xlink:href="#icon-arrow-right"></use></svg>
                <span>Go back to top</span>
            </button>
        </div>
    </div>
    <div id="previewSection" class="preview-section">
        
        <a href="/category/openstack/openstack-placement/" class="post-preview">
            <div class="image">
                
                    <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1742267532/openstack_t2tmoc.png">
                
            </div>
            <h3 class="title">Deep Dive into OpenStack Placement</h3>
        </a>
    </div>
</div>

<style>
.toggle-preview {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #333;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 4px;
    cursor: pointer;
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.toggle-preview:hover {
    background: #444;
}

.toggle-preview.visible {
    opacity: 1;
}

.recommendation {
    margin-top: 1000px;
    display: block;
    transition: all 0.3s ease;
}

.recommendation.hidden {
    display: none;
}

.hide-preview {
    margin-left: 10px;
    background: none;
    border: 1px solid #666;
    color: #666;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
}

.hide-preview:hover {
    background: #f0f0f0;
}

.preview-section {
    max-height: 1000px;
    overflow: hidden;
    transition: max-height 0.3s ease-out;
}

.preview-section.hidden {
    max-height: 0;
}
</style>

<script>
function togglePreview() {
    const recommendation = document.getElementById('recommendationSection');
    const button = document.querySelector('.toggle-preview span');
    
    if (recommendation.classList.contains('hidden')) {
        recommendation.classList.remove('hidden');
        button.textContent = 'Hide Preview ▼';
    } else {
        recommendation.classList.add('hidden');
        button.textContent = 'Show Preview ▲';
    }
}

window.addEventListener('scroll', function() {
    const toggleButton = document.querySelector('.toggle-preview');
    const recommendation = document.getElementById('recommendationSection');
    const rect = recommendation.getBoundingClientRect();
    
    if (rect.top <= window.innerHeight) {
        toggleButton.classList.add('visible');
    } else {
        toggleButton.classList.remove('visible');
    }
});
</script>

        

        <!-- Show modal if the post is the last one -->
        

        <!-- Show modal before user leaves the page -->
        

        <!-- Add your newsletter subscription form here -->

        <section class="share">
    <h3>Share</h3>
    <a aria-label="Share on Twitter" href="https://twitter.com/intent/tweet?text=&quot;Learn how to install and configure Prometheus and Thanos using Helm charts for scalable monitoring&quot;%20https://somaz.blog/category/monitoring/prometheus-thanos-install/%20via%20&#64;twitter_username&hashtags=prometheus,thanos,helm,kubernetes"
    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Share on Twitter">
        <svg class="icon icon-twitter"><use xlink:href="#icon-twitter"></use></svg>
    </a>
    <a aria-label="Share on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://somaz.blog/category/monitoring/prometheus-thanos-install/"
    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook">
        <svg class="icon icon-facebook"><use xlink:href="#icon-facebook"></use></svg>
    </a>
</section>

        

  <section class="author">
    <div class="details">
      
        <img class="img-rounded" src="/assets/img/uploads/profile.png" alt="Somaz">
      
      <p class="def">Author</p>
      <h3 class="name">
        <a href="/authors/somaz/">Somaz</a>
      </h3>
      <p class="desc">DevOps engineer focused on cloud infrastructure and automation</p>
      <p>
        
          <a href="https://github.com/somaz94" title="Github">
            <svg><use xlink:href="#icon-github"></use></svg>
          </a>
        
        
        
        
        
        
          <a href="https://www.linkedin.com/in/somaz" title="LinkedIn">
            <svg><use xlink:href="#icon-linkedin"></use></svg>
          </a>
        
        
          <a href="https://somaz.tistory.com" title="Tistory">
            <svg><use xlink:href="#icon-tistory"></use></svg>
          </a>
        
      </p>
    </div>
  </section>

  
  
  
  
  
  
  
  

  <script type="application/ld+json">
  {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "Somaz",
      
      "image": "/assets/img/uploads/profile.png",
      
      "jobTitle": "DevOps Engineer",
      "url": "https://somaz.blog/authors/somaz/",
      "sameAs": [
        "https://github.com/somaz94","https://www.linkedin.com/in/somaz","https://{{ author.tistory_username }}.tistory.com"
      ]
  }
  </script>


        

<section class="comments">
    <h3>Comments</h3>
    <div id="disqus_thread"></div>
</section>
<script type="text/javascript">
    var disqus_loaded = false;

    function load_disqus()
    {
        disqus_loaded = true;
        var disqus_shortname = 'https-somaz94-github-io';
        var disqus_title = '';
        var disqus_url = '/category/monitoring/prometheus-thanos-install/';
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        var ldr = document.getElementById('disqus_loader');
    };
    window.onscroll = function(e) {
        if ((window.innerHeight + window.scrollY) >= (document.body.offsetHeight - 800)) {
            //hit bottom of page
            if (disqus_loaded==false)
                load_disqus()
        }
    };
</script>



        <footer>
    <p>
      
        <a href="https://github.com/somaz94" title="Github">
          <svg><use xlink:href="#icon-github"></use></svg>
        </a>
      
      
        <a href="https://www.facebook.com/facebook_username" title="Facebook">
          <svg><use xlink:href="#icon-facebook"></use></svg>
        </a>
      
      
        <a href="https://twitter.com/twitter_username" title="Twitter">
          <svg><use xlink:href="#icon-twitter"></use></svg>
        </a>
      
      
        <a href="https://medium.com/@medium_username" title="Medium">
          <svg><use xlink:href="#icon-medium"></use></svg>
        </a>
      
      
        <a href="https://www.instagram.com/instagram_username" title="Instagram">
          <svg><use xlink:href="#icon-instagram"></use></svg>
        </a>
      
      
        <a href="https://www.linkedin.com/in/somaz" title="LinkedIn">
          <svg><use xlink:href="#icon-linkedin"></use></svg>
        </a>
      
      
        <a href="https://somaz.tistory.com" title="Tistory">
          <svg><use xlink:href="#icon-tistory"></use></svg>
        </a>
      
    </p>

    <ul>
  
    
      <li>
        <a href="https://somaz.blog/">Home</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/about">About</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/category">Category</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/contact">Contact</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/feed.xml">Feed</a>
      </li>
    
  
</ul>


    <p>
      <a href="https://somaz.blog/sitemap.xml" title="sitemap">Sitemap</a> |
      <a href="https://somaz.blog/privacy-policy.html" title="Privacy Policy">Privacy Policy</a>
    </p>

    <p>
      <span>Somaz Tech Blog</span> <svg class="love"><use xlink:href="#icon-heart"></use></svg>
    </p>
</footer>










<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "somaz",
  "description": "DevOps engineer's tech blog.",
  "url": "https://somaz.blog/",
  "logo": {
      "@type": "ImageObject",
      "url": "https://somaz.blog/assets/img/icons/mediumtile.png",
      "width": "600",
      "height": "315"
  },
  "sameAs": [
    "https://github.com/somaz94","https://www.facebook.com/facebook_username","https://twitter.com/twitter_username","https://medium.com/@medium_username","https://www.instagram.com/instagram_username","https://www.linkedin.com/in/somaz","https://{{ site.tistory_username }}.tistory.com"
  ]
}
</script>

<!-- Include the script that allows Netlify CMS login -->
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

<!-- Include the website scripts -->
<script src="/assets/js/scripts.min.js"></script>

<!-- Include Google Analytics script -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-XXXXXXXX-X"></script>
<script>
  var host = window.location.hostname;
  if (host != 'localhost') {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-XXXXXXXX-X');
  }
</script>
  


<!-- Include extra scripts -->



        

        
        
        
        
        
        
        
        
        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "BlogPosting",
            "name": "Installing Prometheus and Thanos with Helm",
            "headline": "A step-by-step guide to setting up Prometheus and Thanos monitoring stack",
            "description": "Learn how to install and configure Prometheus and Thanos using Helm charts for scalable monitoring",
            "image": "https://res.cloudinary.com/dkcm26aem/image/upload/v1738640346/prometheus-thans-archi_zfo72f.png",
            "url": "https://somaz.blog/category/monitoring/prometheus-thanos-install/",
            "articleBody": "Image Reference





Installation Guide for Prometheus and Thanos

This guide provides detailed, step-by-step instructions for installing and configuring Prometheus and Thanos using Helm charts in Kubernetes environments. Learn how to set up a scalable monitoring infrastructure for both single-cluster and multi-cluster deployments with long-term metrics storage and unified querying capabilities.



Introduction and Prerequisites


  Before You Begin
  This guide follows our previous post about Prometheus and Thanos, focusing on the practical implementation aspects. Before proceeding with the installation, ensure you have the following prerequisites in place:
  
  
    Kubernetes Cluster: Running cluster with proper networking configuration
    Storage: Storage provisioner configured for persistent volumes
    Object Storage: Access to S3, GCS, MinIO, or other compatible object storage for Thanos
    Helm: Helm 3.x installed and configured
    kubectl: Properly configured with access to your cluster
    Namespace: A namespace for your monitoring stack (we&apos;ll use &quot;monitoring&quot; in this guide)
  
  
  If you&apos;re setting up a multi-cluster configuration, ensure you have network connectivity between clusters and the proper DNS configuration in place.






Installing Prometheus

Prometheus can be installed using different Helm charts depending on your requirements. This section covers two popular approaches: using the prometheus-community chart for basic installations and kube-prometheus-stack for a more comprehensive monitoring solution with additional components.



Available Installation Methods


  
    graph LR
      A[Prometheus Installation Methods] --&amp;gt; B[prometheus-community Chart]
      A --&amp;gt; C[kube-prometheus-stack Chart]
      
      B --&amp;gt; D[Basic Prometheus installation]
      B --&amp;gt; E[Customizable components]
      B --&amp;gt; F[Lighter weight]
      
      C --&amp;gt; G[Complete monitoring solution]
      C --&amp;gt; H[Includes Grafana, Alertmanager]
      C --&amp;gt; I[Pre-configured alerts and dashboards]
      C --&amp;gt; J[Uses Prometheus Operator CRDs]
      
      style A fill:#f5f5f5,stroke:#333,stroke-width:1px
      style B fill:#a5d6a7,stroke:#333,stroke-width:1px
      style C fill:#64b5f6,stroke:#333,stroke-width:1px
      style D fill:#ffcc80,stroke:#333,stroke-width:1px
      style E fill:#ffcc80,stroke:#333,stroke-width:1px
      style F fill:#ffcc80,stroke:#333,stroke-width:1px
      style G fill:#ce93d8,stroke:#333,stroke-width:1px
      style H fill:#ce93d8,stroke:#333,stroke-width:1px
      style I fill:#ce93d8,stroke:#333,stroke-width:1px
      style J fill:#ce93d8,stroke:#333,stroke-width:1px
  





  
    
      Chart
      Description
    
    
      prometheus-community
      
        
          Basic Prometheus installation with core components
          More granular control over individual components
          Good for specific use cases with custom requirements
          Lighter weight with less resource consumption
        
      
    
    
      kube-prometheus-stack
      
        
          Comprehensive monitoring solution using the Prometheus Operator
          Includes Grafana, Alertmanager, and various exporters
          Pre-configured alerts and dashboards for Kubernetes monitoring
          Better integration with Thanos for scalable monitoring
          Uses Custom Resource Definitions for declarative configuration
        
      
    
  


Installing Prometheus CRDs

Before installing Prometheus with the operator-based approach, you need to install the required Custom Resource Definitions (CRDs):


  Installing Required CRDs
  Execute these commands to install the Prometheus Operator CRDs:


# Add the Prometheus community repository
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm repo update

# Install CRDs in the monitoring namespace
helm install prometheus-operator-crds -n monitoring prometheus-community/prometheus-operator-crds

# Verify the installation
kubectl get crd | grep monitoring


Why CRDs First?

Installing CRDs separately before the main chart ensures:

  Clean upgrades without CRD-related conflicts
  Better management of CRD lifecycle
  Prevention of accidental CRD deletion during chart uninstallation




Option 1: Installing Prometheus Community Chart

Configuring Prometheus Community Chart

Create a values file (values/somaz.yaml) with the following configuration:

server:
  name: server
  image:
    repository: quay.io/prometheus/prometheus
  persistentVolume:
    enabled: true
    accessModes:
      - ReadWriteOnce
    storageClass: &quot;default&quot;
  replicaCount: 1
  statefulSet:
    enabled: false
  service:
    enabled: true
    type: NodePort

alertmanager:
  enabled: true
  persistence:
    size: 2Gi

kube-state-metrics:
  enabled: true

prometheus-node-exporter:
  enabled: true

prometheus-pushgateway:
  enabled: true
  serviceAnnotations:
    prometheus.io/probe: pushgateway




Installation Commands

Install Prometheus using these commands:

# Install Prometheus
helm install prometheus-community prometheus-community/prometheus -n monitoring -f ./values/somaz.yaml --create-namespace

# Upgrade if needed
helm upgrade prometheus-community prometheus-community/prometheus -n monitoring -f ./values/somaz.yaml




Option 2: Installing Kube-Prometheus-Stack

Configuring Kube-Prometheus-Stack

Create a values file (values/somaz.yaml) with this configuration for Thanos integration:

alertmanager:
  enabled: true
  config:
    global:
      resolve_timeout: 5m
  service:
    type: NodePort

grafana:
  enabled: false

prometheus:
  enabled: true
  thanosService:
    enabled: true
  thanosServiceMonitor:
    enabled: true
  thanosServiceExternal:
    enabled: true
    type: NodePort
  ingress:
    enabled: true
    ingressClassName: nginx
    hosts:
      - prometheus.somaz.link
  prometheusSpec:
    replicas: 1
    thanos:
      baseImage: quay.io/thanos/thanos
      version: v0.36.1
      objectStorageConfig:
        existingSecret:
          name: thanos-objstore
          key: objstore.yml
    storageSpec: 
      volumeClaimTemplate:
        spec:
          storageClassName: default
          accessModes: [&quot;ReadWriteOnce&quot;]
          resources:
            requests:
              storage: 100Gi
    externalLabels:
      provider: somaz
      region: seoul
      cluster: mgmt



  Key Configuration Points
  This configuration:
  
    Enables the Thanos sidecar for long-term storage integration
    References a secret (thanos-objstore) containing object storage configuration
    Adds external labels to identify metrics from this cluster
    Configures ingress for accessing Prometheus UI
    Sets up persistent storage for metrics data
  




Installation Commands

Install the Kube-Prometheus-Stack using these commands:

# Verify the configuration
helm lint --values ./values/somaz.yaml

# Install the stack
helm install kube-prometheus-stack prometheus-community/kube-prometheus-stack -n monitoring -f ./values/somaz.yaml --create-namespace

# Upgrade if needed
helm upgrade kube-prometheus-stack prometheus-community/kube-prometheus-stack -n monitoring -f ./values/somaz.yaml





  
    sequenceDiagram
        participant User as You
        participant Helm as Helm
        participant K8s as Kubernetes API
        participant Operator as Prometheus Operator
        participant Prometheus as Prometheus Pods
        
        User-&amp;gt;&amp;gt;Helm: helm install kube-prometheus-stack
        Helm-&amp;gt;&amp;gt;K8s: Apply CRDs and resources
        K8s-&amp;gt;&amp;gt;Operator: Create Operator Pod
        Operator-&amp;gt;&amp;gt;K8s: Prometheus CR created
        Operator-&amp;gt;&amp;gt;Prometheus: Create and configure Prometheus
        Prometheus-&amp;gt;&amp;gt;User: Ready for monitoring
  






Thanos Object Storage Configuration

Thanos requires object storage for long-term metrics retention. This section explains how to configure the object storage secret that both Prometheus and Thanos components will use.



Creating the Object Storage Secret

Object Storage Configuration

Create a file named objstore.yml with your storage provider configuration:

type: s3
config:
  bucket: thanos
  endpoint: minio.storage.svc.cluster.local:9000
  access_key: minioadmin
  secret_key: minioadmin
  insecure: true



  Storage Provider Options
  Thanos supports various object storage providers:
  
    AWS S3: For production environments in AWS
    Google Cloud Storage: For GCP deployments
    Azure Blob Storage: For Azure environments
    MinIO: For on-premises or testing (as shown in example)
    Others: Alibaba OSS, Tencent COS, OpenStack Swift, etc.
  
  Adjust the configuration according to your chosen provider.




Creating the Kubernetes Secret

Create a Kubernetes secret with your object storage configuration:

# Create the secret in the monitoring namespace
kubectl create secret generic thanos-objstore -n monitoring --from-file=objstore.yml






Installing Thanos

Thanos extends Prometheus with long-term storage, high availability, and global query capabilities. This section covers deploying Thanos components using the Bitnami Helm chart for both single-cluster and multi-cluster scenarios.



Single-Cluster Thanos Configuration

Internal Cluster Setup

Create a values file (values/somaz.yaml) for a single-cluster Thanos deployment:

global:
  defaultStorageClass: &quot;default&quot;

fullnameOverride: &quot;thanos&quot;
clusterDomain: somaz-cluster.local

existingObjstoreSecret: &quot;thanos-objstore&quot;

query:
  enabled: true
  logLevel: debug
  replicaLabel:
    - prometheus_replica
  stores:
    - dnssrv+_grpc._tcp.kube-prometheus-stack-thanos-discovery.monitoring.svc.somaz-cluster.local
  ingress:
    enabled: true
    hostname: thanos-query.somaz.link
    ingressClassName: nginx

queryFrontend:
  enabled: true
  ingress:
    enabled: true
    hostname: thanos.somaz.link

compactor:
  enabled: true
  retentionResolutionRaw: 60d
  retentionResolution5m: 60d
  retentionResolution1h: 1y
  persistence:
    enabled: true
    size: 10Gi

storegateway:
  enabled: true
  persistence:
    enabled: true
    size: 10Gi





  Component Explanations
  This configuration sets up the following Thanos components:
  
    Query: The frontend for querying metrics from both local Prometheus and object storage
    Query Frontend: Provides advanced query optimization and caching
    Compactor: Handles data compaction and downsampling in object storage
    Store Gateway: Accesses historical metrics in object storage
  
  The stores configuration connects to your Prometheus Thanos sidecar using DNS service discovery.





  
    graph TD
      A[Prometheus + Thanos Sidecar] --&amp;gt;|Upload metrics| B[Object Storage]
      A --&amp;gt;|Serve real-time metrics| C[Thanos Query]
      D[Thanos Store Gateway] --&amp;gt;|Fetch historical data| B
      D --&amp;gt;|Serve historical metrics| C
      E[Thanos Compactor] --&amp;gt;|Compact &amp;amp; downsample| B
      C --&amp;gt;|Serve metrics API| F[Thanos Query Frontend]
      F --&amp;gt;|Expose UI &amp;amp; API| G[Users/Grafana]
      
      style A fill:#a5d6a7,stroke:#333,stroke-width:1px
      style B fill:#64b5f6,stroke:#333,stroke-width:1px
      style C fill:#ffcc80,stroke:#333,stroke-width:1px
      style D fill:#ce93d8,stroke:#333,stroke-width:1px
      style E fill:#ef9a9a,stroke:#333,stroke-width:1px
      style F fill:#9fa8da,stroke:#333,stroke-width:1px
      style G fill:#f5f5f5,stroke:#333,stroke-width:1px
  




Multi-Cluster Thanos Configuration

External Cluster Setup
For external clusters, create a values file (values/somaz-externalcluster.yaml):

query:
  enabled: true
  stores:
    - dnssrv+_grpc._tcp.kube-prometheus-stack-thanos-discovery.monitoring.svc.external-cluster.local
  ingress:
    grpc:
      enabled: true
      hostname: external-cluster-thanos-query.somaz.link
      ingressClassName: &quot;nginx&quot;
      annotations:
        nginx.ingress.kubernetes.io/backend-protocol: &quot;GRPC&quot;


Primary Cluster with Multi-Cluster Configuration

Update the main Thanos Query configuration to include the external cluster:

query:
  stores:
    - dnssrv+_grpc._tcp.kube-prometheus-stack-thanos-discovery.monitoring.svc.somaz-cluster.local
    - dnssrv+_grpc._tcp.thanos-multicluster-query-grpc.monitoring.svc.somaz-cluster.local





  Multi-Cluster Architecture
  In this setup:
  
    Each cluster runs Prometheus with Thanos sidecar uploading to shared object storage
    External clusters expose their Thanos Query endpoints via gRPC
    The primary cluster&apos;s Thanos Query connects to both local and external endpoints
    All metrics are deduplicated and unified in the primary Thanos Query Frontend
  



  
    graph TD
      subgraph &quot;Cluster 1 (Primary)&quot;
        A1[Prometheus] --&amp;gt;|Upload| B[Object Storage]
        A1 --&amp;gt;|Serve| C1[Thanos Query 1]
        D1[Store Gateway] --&amp;gt;|Fetch| B
        D1 --&amp;gt;|Serve| C1
        C1 --&amp;gt;|Query| F[Query Frontend]
      end
      
      subgraph &quot;Cluster 2 (External)&quot;
        A2[Prometheus] --&amp;gt;|Upload| B
        A2 --&amp;gt;|Serve| C2[Thanos Query 2]
      end
      
      C1 -.-&amp;gt;|Connect| C2
      F --&amp;gt;|Serve| G[Users/Grafana]
      
      style A1 fill:#a5d6a7,stroke:#333,stroke-width:1px
      style A2 fill:#a5d6a7,stroke:#333,stroke-width:1px
      style B fill:#64b5f6,stroke:#333,stroke-width:1px
      style C1 fill:#ffcc80,stroke:#333,stroke-width:1px
      style C2 fill:#ffcc80,stroke:#333,stroke-width:1px
      style D1 fill:#ce93d8,stroke:#333,stroke-width:1px
      style F fill:#9fa8da,stroke:#333,stroke-width:1px
      style G fill:#f5f5f5,stroke:#333,stroke-width:1px
  


Installing Thanos Components

Installation Commands
Install Thanos using the Bitnami Helm chart:

# Add the Bitnami repository
helm repo add bitnami https://charts.bitnami.com/bitnami
helm repo update

# Verify the configuration
helm lint --values ./values/somaz.yaml

# Install Thanos
helm install thanos bitnami/thanos -n monitoring -f ./values/somaz.yaml --create-namespace

# Upgrade if needed
helm upgrade thanos bitnami/thanos -n monitoring -f ./values/somaz.yaml






Verification and Troubleshooting

After installation, verify that all components are working correctly and troubleshoot any issues that may arise. This section provides guidance on common verification steps and troubleshooting techniques.



Verifying the Installation

Check Components Status
Verify that all pods are running correctly:

# Check Prometheus and related components
kubectl get pods -n monitoring -l app=prometheus

# Check Thanos components
kubectl get pods -n monitoring -l app.kubernetes.io/name=thanos

# Check service endpoints
kubectl get svc -n monitoring


DNS and Connectivity Troubleshooting

Testing DNS Resolution
Verify DNS resolution for service discovery:

# Check DNS resolution for Thanos discovery endpoints
kubectl run -it --rm --image=nicolaka/netshoot dns-test --restart=Never -- dig _grpc._tcp.kube-prometheus-stack-thanos-discovery.monitoring.svc.somaz-cluster.local

# Verify endpoints are registered
kubectl get ep -n monitoring | grep thanos-discovery





  Common Issues and Solutions
  
    DNS Resolution Failures: Ensure CoreDNS is working correctly and service names are accurate
    Thanos Query Cannot Find Stores: Verify store endpoints and network connectivity
    Object Storage Access Issues: Check credentials and endpoint configuration
    No Metrics in Thanos Query: Verify Prometheus external labels and proper sidecar configuration
    Ingress Connectivity Problems: Check ingress controller logs and annotations
  




Accessing User Interfaces

Component UIs
Access the following UIs to verify your installation:

  Prometheus UI: http://prometheus.somaz.link
  Thanos Query UI: http://thanos-query.somaz.link
  Thanos Frontend UI: http://thanos.somaz.link






Next Steps and Advanced Topics

Once your Prometheus and Thanos installation is complete and verified, you can expand your monitoring infrastructure with additional components and integrations.



Upcoming Content

In Our Next Post
We’ll explore additional monitoring capabilities including:

  Loki with Promtail: Logging solution that integrates with your monitoring stack
  Node Feature Discovery: Enhancing Kubernetes node capabilities detection
  Grafana Dashboards: Creating comprehensive visualization dashboards




Advanced Configuration Options

Fine-tuning Your Installation
Consider these advanced configurations for production environments:

  Setting up high availability for Prometheus and Thanos components
  Configuring detailed alert rules and notification channels
  Implementing retention policies and downsampling strategies
  Adding custom exporters for application-specific metrics
  Integrating with existing notification systems (PagerDuty, Slack, etc.)






Key Points


  
    
      Installation Approach
      - kube-prometheus-stack for comprehensive monitoring with Operator
      - prometheus-community chart for lightweight, customizable setups
      - Bitnami Thanos chart for long-term storage and multi-cluster capabilities
    
    
      Key Components
      - Prometheus with Thanos sidecar for metrics collection
      - Object storage backend for long-term metrics retention
      - Thanos Query for unified metric access
      - Thanos Store Gateway for historical data access
    
    
      Multi-Cluster Setup
      - Shared object storage between clusters
      - Federated query across cluster boundaries
      - Centralized view of all metrics
      - Seamless scaling as your infrastructure grows
    
  






References

  Kube-Prometheus-Stack
  Prometheus Helm Chart
  Thanos Storage Configuration
  Bitnami Thanos Chart
  Thanos Monitoring Guide
  Thanos Query Documentation
  Prometheus Operator User Guide
  Multi-cluster Monitoring with Thanos

",
            "wordcount": "2510",
            "inLanguage": "en",
            "dateCreated": "2025-06-04/",
            "datePublished": "2025-06-04/",
            "dateModified": "2025-06-04/",
            "author": {
                "@type": "Person",
                "name": "Somaz",
                
                "image": "/assets/img/uploads/profile.png",
                
                "jobTitle": "DevOps Engineer",
                "url": "https://somaz.blog/authors/somaz/",
                "sameAs": [
                    "https://github.com/somaz94","https://www.linkedin.com/in/somaz"
                ]
            },
            "publisher": {
                "@type": "Organization",
                "name": "somaz",
                "url": "https://somaz.blog/",
                "logo": {
                    "@type": "ImageObject",
                    "url": "https://somaz.blog/assets/img/blog-image.png",
                    "width": "600",
                    "height": "315"
                }
            },
            "mainEntityOfPage": "True",
            "genre": "MONITORING",
            "articleSection": "MONITORING",
            "keywords": ["prometheus","thanos","helm","kubernetes"]
        }
        </script>
    </body>
</html>
