<!DOCTYPE html>
<html lang="en" class="no-js">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    

    
    

    
    

    
    

    <!-- ‚úÖ Google Tag Manager Ï∂îÍ∞Ä -->
    <script>
        (function(w,d,s,l,i){
            w[l]=w[l]||[];
            w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
            var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
            j.async=true;
            j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
            f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-MBP83N4Q');
    </script>
      <!-- ‚úÖ End Google Tag Manager -->

    <!-- Mermaid.js ÏßÅÏ†ë Î°úÎìú -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>

    <title>How to install Loki and Promtail with Helm | somaz</title>
    <meta name="description" content="Learn how to install and configure Loki and Promtail using Helm charts for log aggregation">
    
        <meta name="keywords" content="loki, promtail, helm, kubernetes">
    

    <!-- Social: Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="How to install Loki and Promtail with Helm | somaz">
    <meta name="twitter:description" content="Learn how to install and configure Loki and Promtail using Helm charts for log aggregation">

    
        <meta property="twitter:image" content="https://res.cloudinary.com/dkcm26aem/image/upload/v1738641555/loki-promtail-install_t7caxs.png">
    
    
    
        <meta name="twitter:site" content="@twitter_username">
    

    <!-- Social: Facebook / Open Graph -->
    <meta property="og:url" content="https://somaz.blog/category/monitoring/loki-promtail-install/">
    <meta property="og:title" content="How to install Loki and Promtail with Helm | somaz">
    <meta property="og:image" content="https://res.cloudinary.com/dkcm26aem/image/upload/v1738641555/loki-promtail-install_t7caxs.png">
    <meta property="og:description" content="Learn how to install and configure Loki and Promtail using Helm charts for log aggregation">
    <meta property="og:site_name" content="Somaz Tech Blog">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/assets/img/icons/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/img/icons/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/img/icons/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/img/icons/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/img/icons/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/img/icons/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/img/icons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/icons/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/img/icons/apple-touch-icon-152x152.png" />

    <!-- Windows 8 Tile Icons -->
    <meta name="application-name" content="somaz">
    <meta name="msapplication-TileColor" content="#141414">
    <meta name="msapplication-square70x70logo" content="smalltile.png" />
    <meta name="msapplication-square150x150logo" content="mediumtile.png" />
    <meta name="msapplication-wide310x150logo" content="widetile.png" />
    <meta name="msapplication-square310x310logo" content="largetile.png" />
    
    <!-- Android Lolipop Theme Color -->
    <meta name="theme-color" content="#141414">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Titillium+Web:300,400,700" rel="stylesheet">

    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="canonical" href="https://somaz.blog/category/monitoring/loki-promtail-install/">
    <link rel="alternate" type="application/rss+xml" title="Somaz Tech Blog" href="https://somaz.blog/feed.xml" />

    <!-- Include extra styles -->
    

    <!-- JavaScript enabled/disabled -->
    <script>
        document.querySelector('html').classList.remove('no-js');
    </script>

    <!-- Google Adsense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8725590811736154"
        crossorigin="anonymous"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"> -->
    <!-- <link href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/variable/woff2/SUIT-Variable.css" rel="stylesheet"> -->
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- <link href="https://fonts.googleapis.com/css2?family=Albert+Sans:wght@400;500;700&display=swap" rel="stylesheet"> -->

    <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml" />

</head>
<!-- ‚úÖ Google Tag Manager (noscript) -->
<noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MBP83N4Q"
            height="0" width="0" style="display:none;visibility:hidden">
    </iframe>
</noscript>
<!-- ‚úÖ End Google Tag Manager (noscript) -->
    <body class="has-push-menu">
        





        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" display="none" version="1.1"><defs><symbol id="icon-menu" viewBox="0 0 1024 1024"><path class="path1" d="M128 213.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 725.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 469.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5z"/></symbol><symbol id="icon-search" viewBox="0 0 951 1024"><path class="path1" d="M658.286 475.429q0-105.714-75.143-180.857t-180.857-75.143-180.857 75.143-75.143 180.857 75.143 180.857 180.857 75.143 180.857-75.143 75.143-180.857zM950.857 950.857q0 29.714-21.714 51.429t-51.429 21.714q-30.857 0-51.429-21.714l-196-195.429q-102.286 70.857-228 70.857-81.714 0-156.286-31.714t-128.571-85.714-85.714-128.571-31.714-156.286 31.714-156.286 85.714-128.571 128.571-85.714 156.286-31.714 156.286 31.714 128.571 85.714 85.714 128.571 31.714 156.286q0 125.714-70.857 228l196 196q21.143 21.143 21.143 51.429z"/></symbol><symbol id="icon-close" viewBox="0 0 1000 1000"><path d="M969.8,870.3c27,27.7,27,71.8,0,99.1C955.7,983,937.9,990,920,990c-17.9,0-35.7-7-49.7-20.7L500,599L129.6,969.4C115.6,983,97.8,990,79.9,990s-35.7-7-49.7-20.7c-27-27.3-27-71.4,0-99.1L400.9,500L30.3,129.3c-27-27.3-27-71.4,0-99.1c27.3-27,71.8-27,99.4,0L500,400.9L870.4,30.2c27.7-27,71.8-27,99.4,0c27,27.7,27,71.8,0,99.1L599.1,500L969.8,870.3z"/></symbol><symbol id="icon-twitter" viewBox="0 0 951 1024"><path class="path1" d="M925.714 233.143q-38.286 56-92.571 95.429 0.571 8 0.571 24 0 74.286-21.714 148.286t-66 142-105.429 120.286-147.429 83.429-184.571 31.143q-154.857 0-283.429-82.857 20 2.286 44.571 2.286 128.571 0 229.143-78.857-60-1.143-107.429-36.857t-65.143-91.143q18.857 2.857 34.857 2.857 24.571 0 48.571-6.286-64-13.143-106-63.714t-42-117.429v-2.286q38.857 21.714 83.429 23.429-37.714-25.143-60-65.714t-22.286-88q0-50.286 25.143-93.143 69.143 85.143 168.286 136.286t212.286 56.857q-4.571-21.714-4.571-42.286 0-76.571 54-130.571t130.571-54q80 0 134.857 58.286 62.286-12 117.143-44.571-21.143 65.714-81.143 101.714 53.143-5.714 106.286-28.571z"/></symbol><symbol id="icon-facebook" viewBox="0 0 585 1024"><path class="path1" d="M548 6.857v150.857h-89.714q-49.143 0-66.286 20.571t-17.143 61.714v108h167.429l-22.286 169.143h-145.143v433.714h-174.857v-433.714h-145.714v-169.143h145.714v-124.571q0-106.286 59.429-164.857t158.286-58.571q84 0 130.286 6.857z"/></symbol><symbol id="icon-clock" viewBox="0 0 1000 1000"><path d="M500,10C229.8,10,10,229.8,10,500c0,270.2,219.8,490,490,490c270.2,0,490-219.8,490-490C990,229.8,770.2,10,500,10z M500,910.2c-226.2,0-410.2-184-410.2-410.2c0-226.2,184-410.2,410.2-410.2c226.2,0,410.2,184,410.2,410.2C910.2,726.1,726.2,910.2,500,910.2z M753.1,374c8.2,11.9,5.2,28.1-6.6,36.3L509.9,573.7c-4.4,3.1-9.6,4.6-14.8,4.6c-4.1,0-8.3-1-12.1-3c-8.6-4.5-14-13.4-14-23.1V202.5c0-14.4,11.7-26.1,26.1-26.1c14.4,0,26.1,11.7,26.1,26.1v300l195.6-135.1C728.7,359.2,744.9,362.1,753.1,374z"/></symbol><symbol id="icon-calendar" viewBox="0 0 1000 1000"><path d="M920,500v420H80V500H920 M990,430H10v490c0,38.7,31.3,70,70,70h840c38.7,0,70-31.3,70-70V430L990,430z"/><path d="M850,80v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80H360v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80C72.8,80,10,142.7,10,220v140h980V220C990,142.7,927.2,80,850,80z"/><path d="M255,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C290,25.8,274.3,10,255,10z"/><path d="M745,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C780,25.8,764.3,10,745,10z"/></symbol><symbol id="icon-github" viewBox="0 0 12 14"><path d="M6 1q1.633 0 3.012 0.805t2.184 2.184 0.805 3.012q0 1.961-1.145 3.527t-2.957 2.168q-0.211 0.039-0.312-0.055t-0.102-0.234q0-0.023 0.004-0.598t0.004-1.051q0-0.758-0.406-1.109 0.445-0.047 0.801-0.141t0.734-0.305 0.633-0.52 0.414-0.82 0.16-1.176q0-0.93-0.617-1.609 0.289-0.711-0.062-1.594-0.219-0.070-0.633 0.086t-0.719 0.344l-0.297 0.187q-0.727-0.203-1.5-0.203t-1.5 0.203q-0.125-0.086-0.332-0.211t-0.652-0.301-0.664-0.105q-0.352 0.883-0.062 1.594-0.617 0.68-0.617 1.609 0 0.664 0.16 1.172t0.41 0.82 0.629 0.523 0.734 0.305 0.801 0.141q-0.305 0.281-0.383 0.805-0.164 0.078-0.352 0.117t-0.445 0.039-0.512-0.168-0.434-0.488q-0.148-0.25-0.379-0.406t-0.387-0.187l-0.156-0.023q-0.164 0-0.227 0.035t-0.039 0.090 0.070 0.109 0.102 0.094l0.055 0.039q0.172 0.078 0.34 0.297t0.246 0.398l0.078 0.18q0.102 0.297 0.344 0.48t0.523 0.234 0.543 0.055 0.434-0.027l0.18-0.031q0 0.297 0.004 0.691t0.004 0.426q0 0.141-0.102 0.234t-0.312 0.055q-1.812-0.602-2.957-2.168t-1.145-3.527q0-1.633 0.805-3.012t2.184-2.184 3.012-0.805zM2.273 9.617q0.023-0.055-0.055-0.094-0.078-0.023-0.102 0.016-0.023 0.055 0.055 0.094 0.070 0.047 0.102-0.016zM2.516 9.883q0.055-0.039-0.016-0.125-0.078-0.070-0.125-0.023-0.055 0.039 0.016 0.125 0.078 0.078 0.125 0.023zM2.75 10.234q0.070-0.055 0-0.148-0.062-0.102-0.133-0.047-0.070 0.039 0 0.141t0.133 0.055zM3.078 10.562q0.062-0.062-0.031-0.148-0.094-0.094-0.156-0.023-0.070 0.062 0.031 0.148 0.094 0.094 0.156 0.023zM3.523 10.758q0.023-0.086-0.102-0.125-0.117-0.031-0.148 0.055t0.102 0.117q0.117 0.047 0.148-0.047zM4.016 10.797q0-0.102-0.133-0.086-0.125 0-0.125 0.086 0 0.102 0.133 0.086 0.125 0 0.125-0.086zM4.469 10.719q-0.016-0.086-0.141-0.070-0.125 0.023-0.109 0.117t0.141 0.062 0.109-0.109z"></path></symbol><symbol id="icon-medium" viewBox="0 0 1000 1000"><path d="M336.5,240.2v641.5c0,9.1-2.3,16.9-6.8,23.2s-11.2,9.6-20,9.6c-6.2,0-12.2-1.5-18-4.4L37.3,782.7c-7.7-3.6-14.1-9.8-19.4-18.3S10,747.4,10,739V115.5c0-7.3,1.8-13.5,5.5-18.6c3.6-5.1,8.9-7.7,15.9-7.7c5.1,0,13.1,2.7,24.1,8.2l279.5,140C335.9,238.6,336.5,239.5,336.5,240.2L336.5,240.2z M371.5,295.5l292,473.6l-292-145.5V295.5z M990,305.3v576.4c0,9.1-2.6,16.5-7.7,22.1c-5.1,5.7-12,8.5-20.8,8.5s-17.3-2.4-25.7-7.1L694.7,784.9L990,305.3z M988.4,239.7c0,1.1-46.8,77.6-140.3,229.4C754.6,621,699.8,709.8,683.8,735.7L470.5,389l177.2-288.2c6.2-10.2,15.7-15.3,28.4-15.3c5.1,0,9.8,1.1,14.2,3.3l295.9,147.7C987.6,237.1,988.4,238.2,988.4,239.7L988.4,239.7z"/></symbol><symbol id="icon-instagram" viewBox="0 0 489.84 489.84"><path d="M249.62,50.46c65.4,0,73.14.25,99,1.43C372.47,53,385.44,57,394.07,60.32a75.88,75.88,0,0,1,28.16,18.32,75.88,75.88,0,0,1,18.32,28.16c3.35,8.63,7.34,21.6,8.43,45.48,1.18,25.83,1.43,33.57,1.43,99s-0.25,73.14-1.43,99c-1.09,23.88-5.08,36.85-8.43,45.48a81.11,81.11,0,0,1-46.48,46.48c-8.63,3.35-21.6,7.34-45.48,8.43-25.82,1.18-33.57,1.43-99,1.43s-73.15-.25-99-1.43c-23.88-1.09-36.85-5.08-45.48-8.43A75.88,75.88,0,0,1,77,423.86,75.88,75.88,0,0,1,58.69,395.7c-3.35-8.63-7.34-21.6-8.43-45.48-1.18-25.83-1.43-33.57-1.43-99s0.25-73.14,1.43-99c1.09-23.88,5.08-36.85,8.43-45.48A75.88,75.88,0,0,1,77,78.64a75.88,75.88,0,0,1,28.16-18.32c8.63-3.35,21.6-7.34,45.48-8.43,25.83-1.18,33.57-1.43,99-1.43m0-44.13c-66.52,0-74.86.28-101,1.47s-43.87,5.33-59.45,11.38A120.06,120.06,0,0,0,45.81,47.44,120.06,120.06,0,0,0,17.56,90.82C11.5,106.4,7.36,124.2,6.17,150.27s-1.47,34.46-1.47,101,0.28,74.86,1.47,101,5.33,43.87,11.38,59.45a120.06,120.06,0,0,0,28.25,43.38,120.06,120.06,0,0,0,43.38,28.25c15.58,6.05,33.38,10.19,59.45,11.38s34.46,1.47,101,1.47,74.86-.28,101-1.47,43.87-5.33,59.45-11.38a125.24,125.24,0,0,0,71.63-71.63c6.05-15.58,10.19-33.38,11.38-59.45s1.47-34.46,1.47-101-0.28-74.86-1.47-101-5.33-43.87-11.38-59.45a120.06,120.06,0,0,0-28.25-43.38,120.06,120.06,0,0,0-43.38-28.25C394.47,13.13,376.67,9,350.6,7.8s-34.46-1.47-101-1.47h0Z" transform="translate(-4.7 -6.33)" /><path d="M249.62,125.48A125.77,125.77,0,1,0,375.39,251.25,125.77,125.77,0,0,0,249.62,125.48Zm0,207.41a81.64,81.64,0,1,1,81.64-81.64A81.64,81.64,0,0,1,249.62,332.89Z" transform="translate(-4.7 -6.33)"/><circle cx="375.66" cy="114.18" r="29.39" /></symbol><symbol id="icon-linkedin" viewBox="0 0 12 14"><path d="M2.727 4.883v7.742h-2.578v-7.742h2.578zM2.891 2.492q0.008 0.57-0.395 0.953t-1.059 0.383h-0.016q-0.641 0-1.031-0.383t-0.391-0.953q0-0.578 0.402-0.957t1.051-0.379 1.039 0.379 0.398 0.957zM12 8.187v4.437h-2.57v-4.141q0-0.82-0.316-1.285t-0.988-0.465q-0.492 0-0.824 0.27t-0.496 0.668q-0.086 0.234-0.086 0.633v4.32h-2.57q0.016-3.117 0.016-5.055t-0.008-2.313l-0.008-0.375h2.57v1.125h-0.016q0.156-0.25 0.32-0.438t0.441-0.406 0.68-0.34 0.895-0.121q1.336 0 2.148 0.887t0.813 2.598z"></path></symbol><symbol id="icon-heart" viewBox="0 0 34 30"><path d="M17,29.7 L16.4,29.2 C3.5,18.7 0,15 0,9 C0,4 4,0 9,0 C13.1,0 15.4,2.3 17,4.1 C18.6,2.3 20.9,0 25,0 C30,0 34,4 34,9 C34,15 30.5,18.7 17.6,29.2 L17,29.7 Z M9,2 C5.1,2 2,5.1 2,9 C2,14.1 5.2,17.5 17,27.1 C28.8,17.5 32,14.1 32,9 C32,5.1 28.9,2 25,2 C21.5,2 19.6,4.1 18.1,5.8 L17,7.1 L15.9,5.8 C14.4,4.1 12.5,2 9,2 Z" id="Shape"></path></symbol><symbol id="icon-arrow-right" viewBox="0 0 25.452 25.452"><path d="M4.471,24.929v-2.004l12.409-9.788c0.122-0.101,0.195-0.251,0.195-0.411c0-0.156-0.073-0.31-0.195-0.409L4.471,2.526V0.522c0-0.2,0.115-0.384,0.293-0.469c0.18-0.087,0.396-0.066,0.552,0.061l15.47,12.202c0.123,0.1,0.195,0.253,0.195,0.409c0,0.16-0.072,0.311-0.195,0.411L5.316,25.34c-0.155,0.125-0.372,0.147-0.552,0.061C4.586,25.315,4.471,25.13,4.471,24.929z"/></symbol><symbol id="icon-star" viewBox="0 0 48 48"><path fill="currentColor" d="M44,24c0,11.045-8.955,20-20,20S4,35.045,4,24S12.955,4,24,4S44,12.955,44,24z"/><path fill="#ffffff" d="M24,11l3.898,7.898l8.703,1.301l-6.301,6.102l1.5,8.699L24,30.898L16.199,35l1.5-8.699l-6.301-6.102  l8.703-1.301L24,11z"/></symbol><symbol id="icon-read" viewBox="0 0 32 32"><path fill="currentColor" d="M29,4H3C1.343,4,0,5.343,0,7v18c0,1.657,1.343,3,3,3h10c0,0.552,0.448,1,1,1h4c0.552,0,1-0.448,1-1h10  c1.657,0,3-1.343,3-3V7C32,5.343,30.657,4,29,4z M29,5v20H18.708c-0.618,0-1.236,0.146-1.789,0.422l-0.419,0.21V5H29z M15.5,5  v20.632l-0.419-0.21C14.528,25.146,13.91,25,13.292,25H3V5H15.5z M31,25c0,1.103-0.897,2-2,2H18v1h-4v-1H3c-1.103,0-2-0.897-2-2V7  c0-0.737,0.405-1.375,1-1.722V25c0,0.552,0.448,1,1,1h10.292c0.466,0,0.925,0.108,1.342,0.317l0.919,0.46  c0.141,0.07,0.294,0.106,0.447,0.106c0.153,0,0.306-0.035,0.447-0.106l0.919-0.46C17.783,26.108,18.242,26,18.708,26H29  c0.552,0,1-0.448,1-1V5.278C30.595,5.625,31,6.263,31,7V25z M6,12.5C6,12.224,6.224,12,6.5,12h5c0.276,0,0.5,0.224,0.5,0.5  S11.776,13,11.5,13h-5C6.224,13,6,12.776,6,12.5z M6,14.5C6,14.224,6.224,14,6.5,14h5c0.276,0,0.5,0.224,0.5,0.5S11.776,15,11.5,15  h-5C6.224,15,6,14.776,6,14.5z M6,16.5C6,16.224,6.224,16,6.5,16h5c0.276,0,0.5,0.224,0.5,0.5S11.776,17,11.5,17h-5  C6.224,17,6,16.776,6,16.5z M20,12.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,13,25.5,13h-5  C20.224,13,20,12.776,20,12.5z M20,14.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,15,25.5,15h-5  C20.224,15,20,14.776,20,14.5z M20,16.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,17,25.5,17h-5  C20.224,17,20,16.776,20,16.5z"></path></symbol><symbol id="icon-tistory" viewBox="0 0 24 24"><path d="M4 4h16v3h-6v13h-4V7H4V4z"/></symbol></defs></svg>

        <header class="bar-header">
    <a id="menu" role="button">
        <svg id="open" class="icon-menu"><use xlink:href="#icon-menu"></use></svg>
    </a>
    <h1 class="logo">
        <a href="/">
            
                somaz <span class="version">v3.1.2</span>
            
        </a>
    </h1>
    <a id="search" class="dosearch" role="button">
        <svg class="icon-search"><use xlink:href="#icon-search"></use></svg>
    </a>
    
        <a href="https://github.com/thiagorossener/jekflix-template" class="get-theme" role="button">
            Get this theme!
        </a>
    
</header>

<div id="mask" class="overlay"></div>

<aside class="sidebar" id="sidebar">
    <nav id="navigation">
      <h2>Menu</h2>
      <ul>
  
    
      <li>
        <a href="https://somaz.blog/">Home</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/about">About</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/category">Category</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/contact">Contact</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/feed.xml">Feed</a>
      </li>
    
  
</ul>

    </nav>
</aside>

<div class="search-wrapper">
    <div class="search-form">
        <input type="text" class="search-field" placeholder="Search">
        <svg class="icon-remove-sign"><use xlink:href="#icon-close"></use></svg>
        <ul class="search-results search-list"></ul>
    </div>
</div>



        <section class="post two-columns">
            <article role="article" class="post-content">
                <p class="post-info">
                    
                        <svg class="icon-calendar" id="date"><use xlink:href="#icon-calendar"></use></svg>
                        <time class="date" datetime="2025-01-23T00:00:00+00:00">
                            


January 23, 2025

                        </time>
                    
                    <svg id="clock" class="icon-clock"><use xlink:href="#icon-clock"></use></svg>
                    <span>12 min to read</span>
                </p>
                <h1 class="post-title">How to install Loki and Promtail with Helm</h1>
                <p class="post-subtitle">A guide to deploying Loki and Promtail on Kubernetes</p>

                
                    <img src="https://res.cloudinary.com/dkcm26aem/image/upload/v1738641555/loki-promtail-install_t7caxs.png" alt="Featured image" class="post-cover">
                

                <!-- Pagination links -->



                <!-- Add your table of contents here -->


                <p><a href="https://hackernoon.com/grafana-loki-architecture-summary-and-running-in-kubernetes">Image Reference</a></p>

<p><br /></p>

<hr />

<h2 id="installing-loki-and-promtail-on-kubernetes">Installing Loki and Promtail on Kubernetes</h2>

<p>Loki and Promtail provide a powerful, resource-efficient logging stack for Kubernetes environments. This guide offers a step-by-step approach to installing and configuring both components using Helm charts, with a focus on optimizing for production use while minimizing resource consumption.</p>

<p><br /></p>

<h3 id="introduction-and-prerequisites">Introduction and Prerequisites</h3>

<div class="info-box info-box-default-not-check">
  <strong>Before You Begin</strong>
  <p>This guide follows our <a href="https://somaz94.github.io/category/monitoring/loki/">previous post about Loki architecture and components</a>. Before proceeding with the installation, ensure you have the following prerequisites in place:</p>
  
  <ul>
    <li><strong>Kubernetes Cluster</strong>: A running Kubernetes cluster with proper networking</li>
    <li><strong>Storage</strong>: Storage provisioner configured for persistent volumes (default StorageClass)</li>
    <li><strong>Helm</strong>: Helm 3.x installed and configured to work with your cluster</li>
    <li><strong>kubectl</strong>: Properly configured with access to your cluster</li>
    <li><strong>Namespace</strong>: A namespace for your monitoring stack (we'll use "monitoring" in this guide)</li>
  </ul>
  
  <p>This guide uses a single-binary deployment mode for Loki, which is suitable for most small to medium deployments. For larger environments, you might want to consider the microservices deployment model.</p>
</div>

<h4 id="note">Note:</h4>

<p>We‚Äôre not using Loki-Stack due to version compatibility issues with recent Grafana query features. Instead, we‚Äôll install Loki and Promtail separately using their dedicated Helm charts.</p>

<p><br /></p>

<hr />

<h2 id="loki-deployment-approaches">Loki Deployment Approaches</h2>

<p>Loki can be deployed in different operational modes, each with its own advantages and resource requirements. This section explains the available deployment options and why we‚Äôve chosen the single binary approach for this guide.</p>

<div style="width: 100%; margin: 20px auto;">
  <div class="mermaid">
    graph LR
      A[Loki Deployment Models] --&gt; B[Single Binary]
      A --&gt; C[Microservices]
      A --&gt; D[Simple Scalable]
      
      B --&gt; B1[All components in one process]
      B --&gt; B2[Easiest to deploy]
      B --&gt; B3[Lowest resource overhead]
      B --&gt; B4[Limited horizontal scalability]
      
      C --&gt; C1[Components as separate services]
      C --&gt; C2[Maximum scalability]
      C --&gt; C3[Independent component scaling]
      C --&gt; C4[Higher complexity]
      
      D --&gt; D1[Middle ground approach]
      D --&gt; D2[Groups related components]
      D --&gt; D3[Better than Single Binary for scale]
      D --&gt; D4[Simpler than full Microservices]
      
      style A fill:#f5f5f5,stroke:#333,stroke-width:1px
      style B fill:#a5d6a7,stroke:#333,stroke-width:1px
      style C fill:#64b5f6,stroke:#333,stroke-width:1px
      style D fill:#ffcc80,stroke:#333,stroke-width:1px
  </div>
</div>

<div class="table-container">
  <table class="table-beauty">
    <tr>
      <th style="width: 20%;">Deployment Model</th>
      <th style="width: 25%;">Best For</th>
      <th style="width: 55%;">Characteristics</th>
    </tr>
    <tr>
      <td><strong>Single Binary</strong></td>
      <td>
        Small to medium environments<br />
        Testing and development<br />
        Resource-constrained clusters
      </td>
      <td>
        <ul>
          <li>All Loki components run in a single process</li>
          <li>Simplest deployment and maintenance</li>
          <li>Lowest resource consumption</li>
          <li>Limited horizontal scalability</li>
          <li>Suitable for log volumes up to ~100GB/day</li>
        </ul>
      </td>
    </tr>
    <tr>
      <td><strong>Microservices</strong></td>
      <td>
        Large production environments<br />
        High log volumes<br />
        Multi-tenant deployments
      </td>
      <td>
        <ul>
          <li>Each component deployed separately</li>
          <li>Maximum scalability and resilience</li>
          <li>Independent scaling of components</li>
          <li>Higher operational complexity</li>
          <li>Suitable for log volumes &gt;100GB/day</li>
        </ul>
      </td>
    </tr>
    <tr>
      <td><strong>Simple Scalable</strong></td>
      <td>
        Medium production environments<br />
        Growing environments<br />
        Balance of simplicity and scale
      </td>
      <td>
        <ul>
          <li>Components grouped by function</li>
          <li>Better scalability than Single Binary</li>
          <li>Simpler than full Microservices</li>
          <li>Good starting point for production</li>
        </ul>
      </td>
    </tr>
  </table>
</div>

<p><br /></p>

<hr />

<h2 id="installing-loki">Installing Loki</h2>

<p>We‚Äôll deploy Loki in SingleBinary mode, which offers a good balance of simplicity and functionality for small to medium deployments. This approach bundles all Loki components into a single process, making it easier to manage while still providing all core capabilities.</p>

<p><br /></p>

<h3 id="preparing-for-installation">Preparing for Installation</h3>

<p><br /></p>

<div class="info-box info-box-default">
  <strong>Step 1: Adding the Grafana Helm Repository</strong>
  <p>First, add the Grafana Helm repository and update your local Helm charts:</p>
</div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Add the Grafana Helm repository</span>
helm repo add grafana https://grafana.github.io/helm-charts

<span class="c"># Update Helm repositories</span>
helm repo update
</code></pre></div></div>

<p><br /></p>

<div class="info-box info-box-default">
  <strong>Step 2: Clone the Repository and Prepare Configuration</strong>
  <p>To access the latest charts and configurations, clone the Loki repository:</p>
</div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Clone the Loki repository</span>
git clone https://github.com/grafana/loki.git

<span class="c"># Navigate to the Helm chart directory</span>
<span class="nb">cd </span>loki/production/helm/loki/

<span class="c"># Update chart dependencies</span>
helm dependency update

<span class="c"># Create directory for custom values</span>
<span class="nb">mkdir </span>values
<span class="nb">cp </span>values.yaml values/somaz.yaml
</code></pre></div></div>

<p><br /></p>

<h3 id="loki-configuration">Loki Configuration</h3>

<h4 id="configuration-parameters-explained">Configuration Parameters Explained</h4>
<p>Here are the key parameters in our configuration:</p>
<ul>
  <li><strong>global.clusterDomain:</strong> Your Kubernetes cluster domain (default: cluster.local)</li>
  <li><strong>deploymentMode:</strong> Mode of deployment (SingleBinary for this guide)</li>
  <li><strong>loki.storage.type:</strong> Storage type for logs (filesystem for simplicity)</li>
  <li><strong>persistence:</strong> Configuration for persistent volume claims</li>
  <li><strong>gateway:</strong> Ingress settings for accessing Loki API</li>
</ul>

<p><br /></p>

<div style="width: 100%; margin: 20px auto;">
  <div class="mermaid">
    graph TD
      A[Loki Storage Configuration] --&gt;|Schema| B[Schema Configuration]
      A --&gt;|Store| C[Store Selection]
      B --&gt; B1[from: date]
      B --&gt; B2[store: type]
      B --&gt; B3[schema: version]
      C --&gt; C1[filesystem]
      C --&gt; C2[object storage]
      C --&gt; C3[chunk stores]
      
      style A fill:#f5f5f5,stroke:#333,stroke-width:1px
      style B fill:#a5d6a7,stroke:#333,stroke-width:1px
      style C fill:#64b5f6,stroke:#333,stroke-width:1px
  </div>
</div>

<p><br /></p>

<h4 id="custom-configuration-file-valuessomazyaml">Custom Configuration File (<code class="language-plaintext highlighter-rouge">values/somaz.yaml</code>)</h4>
<p>Create a custom values file with the following configuration:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">global</span><span class="pi">:</span>
  <span class="na">clusterDomain</span><span class="pi">:</span> <span class="s2">"</span><span class="s">somaz-cluster.local"</span>
  <span class="na">dnsService</span><span class="pi">:</span> <span class="s2">"</span><span class="s">coredns"</span>
  <span class="na">dnsNamespace</span><span class="pi">:</span> <span class="s2">"</span><span class="s">kube-system"</span>
<span class="na">deploymentMode</span><span class="pi">:</span> <span class="s">SingleBinary</span>
<span class="na">loki</span><span class="pi">:</span>
  <span class="na">commonConfig</span><span class="pi">:</span>
    <span class="na">replication_factor</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">storage</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">filesystem</span>
  <span class="na">schemaConfig</span><span class="pi">:</span>
    <span class="na">configs</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">from</span><span class="pi">:</span> <span class="s2">"</span><span class="s">2024-01-01"</span>
      <span class="na">store</span><span class="pi">:</span> <span class="s">tsdb</span>
      <span class="na">index</span><span class="pi">:</span>
        <span class="na">prefix</span><span class="pi">:</span> <span class="s">loki_index_</span>
        <span class="na">period</span><span class="pi">:</span> <span class="s">24h</span>
      <span class="na">object_store</span><span class="pi">:</span> <span class="s">filesystem</span>
      <span class="na">schema</span><span class="pi">:</span> <span class="s">v13</span>
<span class="na">singleBinary</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">persistence</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">storageClass</span><span class="pi">:</span> <span class="s2">"</span><span class="s">default"</span>
    <span class="na">accessModes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">ReadWriteOnce</span>
    <span class="na">size</span><span class="pi">:</span> <span class="s">10Gi</span>
<span class="na">gateway</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">service</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">NodePort</span>
    <span class="na">nodePort</span><span class="pi">:</span> <span class="m">31400</span>
<span class="c1"># Disable unnecessary components for single binary mode</span>
<span class="na">chunksCache</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="no">false</span>
<span class="na">resultsCache</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="no">false</span>
<span class="c1"># ... (other components disabled)</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="installation-process">Installation Process</h3>

<h4 id="installing-loki-with-helm">Installing Loki with Helm</h4>

<p>Now we‚Äôre ready to install Loki using our custom configuration:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Verify configuration syntax</span>
helm lint <span class="nt">--values</span> ./values/somaz.yaml

<span class="c"># Optional: Generate and review the installation manifest</span>
helm <span class="nb">install </span>loki <span class="nb">.</span> <span class="nt">-n</span> monitoring <span class="nt">-f</span> ./values/somaz.yaml <span class="nt">--create-namespace</span> <span class="nt">--dry-run</span> <span class="o">&gt;&gt;</span> output.yaml

<span class="c"># Install Loki</span>
helm <span class="nb">install </span>loki <span class="nb">.</span> <span class="nt">-n</span> monitoring <span class="nt">-f</span> ./values/somaz.yaml <span class="nt">--create-namespace</span>

<span class="c"># If you need to upgrade later</span>
helm upgrade loki <span class="nb">.</span> <span class="nt">-n</span> monitoring <span class="nt">-f</span> ./values/somaz.yaml
</code></pre></div></div>

<div style="width: 90%; margin: 20px auto;">
  <div class="mermaid">
    sequenceDiagram
        participant User as You
        participant Helm as Helm
        participant K8s as Kubernetes
        participant Loki as Loki Pod
        participant PV as Persistent Volume
        
        User-&gt;&gt;Helm: helm install loki
        Helm-&gt;&gt;K8s: Create namespace if needed
        Helm-&gt;&gt;K8s: Apply ConfigMaps and Secrets
        Helm-&gt;&gt;K8s: Create PVC
        K8s-&gt;&gt;PV: Provision storage
        Helm-&gt;&gt;K8s: Deploy Loki StatefulSet/Deployment
        K8s-&gt;&gt;Loki: Create Loki container
        Loki-&gt;&gt;PV: Mount storage
        Loki-&gt;&gt;User: Ready for log ingestion
  </div>
</div>

<p><br /></p>

<h3 id="verifying-the-installation">Verifying the Installation</h3>

<h4 id="check-loki-components">Check Loki Components</h4>
<p>Verify that all Loki components are running correctly:</p>

<p><br /></p>

<script src="https://gist.github.com/somaz94/7ce87cc7995e30c1239afe1af4158276.js"></script>

<p><br /></p>

<h3 id="troubleshooting-tips">Troubleshooting Tips</h3>

<p>If you encounter issues with Loki deployment:</p>

<h4 id="check-pod-status">Check Pod Status</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get pods <span class="nt">-n</span> monitoring
</code></pre></div></div>

<h4 id="view-logs">View Logs</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl logs <span class="nt">-n</span> monitoring deployment/loki
</code></pre></div></div>

<h4 id="verify-pvcs">Verify PVCs</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get pvc <span class="nt">-n</span> monitoring
</code></pre></div></div>

<h4 id="check-services">Check Services</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get svc <span class="nt">-n</span> monitoring
</code></pre></div></div>

<h4 id="common-issues">Common Issues</h4>
<ul>
  <li>Storage provisioning failures (check StorageClass)</li>
  <li>Insufficient resources (check resource limits/requests)</li>
  <li>Service connectivity issues (check services and endpoints)</li>
</ul>

<p><br /></p>

<hr />

<h2 id="installing-promtail">Installing Promtail</h2>

<p>Promtail is Loki‚Äôs log collection agent, designed to discover and forward logs from Kubernetes pods and containers. It runs as a DaemonSet, ensuring coverage across all nodes in your cluster and automatically labels logs with metadata from Kubernetes.</p>

<p><br /></p>

<h3 id="preparing-for-installation-1">Preparing for Installation</h3>

<h4 id="obtaining-and-configuring-the-promtail-chart">Obtaining and Configuring the Promtail Chart</h4>
<p>Clone the Grafana Helm charts repository to access the Promtail chart:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Clone the Grafana Helm charts repository</span>
git clone https://github.com/grafana/helm-charts.git

<span class="c"># Navigate to the Promtail chart directory</span>
<span class="nb">cd </span>helm-charts/charts/promtail

<span class="c"># Update chart dependencies</span>
helm dependency update

<span class="c"># Create directory for custom values</span>
<span class="nb">mkdir </span>values
<span class="nb">cp </span>values.yaml values/somaz.yaml
</code></pre></div></div>

<p><br /></p>

<h3 id="promtail-configuration">Promtail Configuration</h3>

<div class="info-box info-box-default-not-check">
  <strong>Configuration Parameters Explained</strong>
  <p>Key parameters in the Promtail configuration:</p>
  
  <ul>
    <li><strong>daemonset.enabled</strong>: Deploys Promtail as a DaemonSet on all nodes</li>
    <li><strong>serviceMonitor.enabled</strong>: Creates ServiceMonitor for Prometheus to scrape Promtail metrics</li>
    <li><strong>config.logLevel</strong>: Log verbosity level (info, debug, etc.)</li>
    <li><strong>config.serverPort</strong>: Port for Promtail's HTTP server</li>
    <li><strong>config.clients</strong>: List of Loki instances to push logs to</li>
  </ul>
  
  <p>The client URL points to the Loki Gateway service, which provides a centralized entry point to Loki.</p>
</div>

<div style="width: 90%; margin: 20px auto;">
  <div class="mermaid">
    graph TD
      A[Kubernetes Pods] --&gt;|Generate Logs| B[Container Log Files]
      B --&gt;|Read| C[Promtail DaemonSet]
      C --&gt;|Query| D[Kubernetes API]
      D --&gt;|Pod Metadata| C
      C --&gt;|Add Labels| C
      C --&gt;|Push Logs| E[Loki Gateway]
      E --&gt;|Forward| F[Loki Service]
      
      style A fill:#f5f5f5,stroke:#333,stroke-width:1px
      style B fill:#a5d6a7,stroke:#333,stroke-width:1px
      style C fill:#64b5f6,stroke:#333,stroke-width:1px
      style D fill:#ffcc80,stroke:#333,stroke-width:1px
      style E fill:#ce93d8,stroke:#333,stroke-width:1px
      style F fill:#ef9a9a,stroke:#333,stroke-width:1px
  </div>
</div>

<p><br /></p>

<h4 id="custom-configuration-file-valuessomazyaml-1">Custom Configuration File (<code class="language-plaintext highlighter-rouge">values/somaz.yaml</code>)</h4>
<p>Create a custom values file for Promtail with the following configuration:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">daemonset</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">serviceMonitor</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">config</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">logLevel</span><span class="pi">:</span> <span class="s">info</span>
  <span class="na">logFormat</span><span class="pi">:</span> <span class="s">logfmt</span>
  <span class="na">serverPort</span><span class="pi">:</span> <span class="m">3101</span>
  <span class="na">clients</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">url</span><span class="pi">:</span> <span class="s">http://loki-gateway/loki/api/v1/push</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="installation-process-1">Installation Process</h3>

<h4 id="installing-promtail-with-helm">Installing Promtail with Helm</h4>

<p>Now we can install Promtail using our custom configuration:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Verify configuration syntax</span>
helm lint <span class="nt">--values</span> ./values/somaz.yaml

<span class="c"># Optional: Generate and review the installation manifest</span>
helm <span class="nb">install </span>promtail <span class="nb">.</span> <span class="nt">-n</span> monitoring <span class="nt">-f</span> ./values/somaz.yaml <span class="nt">--create-namespace</span> <span class="nt">--dry-run</span> <span class="o">&gt;&gt;</span> output.yaml

<span class="c"># Install Promtail</span>
helm <span class="nb">install </span>promtail <span class="nb">.</span> <span class="nt">-n</span> monitoring <span class="nt">-f</span> ./values/somaz.yaml <span class="nt">--create-namespace</span>

<span class="c"># If you need to upgrade later</span>
helm upgrade promtail <span class="nb">.</span> <span class="nt">-n</span> monitoring <span class="nt">-f</span> ./values/somaz.yaml
</code></pre></div></div>

<div class="info-box info-box-default-not-check">
  <strong>Additional Configuration Options</strong>
  <p>Advanced Promtail configurations you might consider for production:</p>
  
  <ul>
    <li><strong>Resource Limits</strong>: Set appropriate CPU and memory limits</li>
    <li><strong>Tolerations</strong>: Enable Promtail to run on tainted nodes</li>
    <li><strong>extraVolumes</strong>: Mount additional log locations beyond standard paths</li>
    <li><strong>extraScrapeConfigs</strong>: Add custom scrape configurations for non-standard log formats</li>
    <li><strong>pipelineStages</strong>: Configure log processing pipelines to extract fields, add labels, etc.</li>
  </ul>
</div>

<p><br /></p>

<hr />

<h2 id="accessing-and-using-your-logging-stack">Accessing and Using Your Logging Stack</h2>

<p>With Loki and Promtail installed, you now have a powerful logging infrastructure for your Kubernetes cluster. This section covers how to access logs and integrate with other components of your monitoring stack.</p>

<p><br /></p>

<h3 id="accessing-logs">Accessing Logs</h3>

<h4 id="querying-logs-through-loki-api">Querying Logs Through Loki API</h4>

<p>Loki provides a REST API for querying logs. You can access it directly:</p>

<p><br /></p>

<script src="https://gist.github.com/somaz94/b5c38950402f82fc3d58f74e5b312cd1.js"></script>

<p><br /></p>

<h3 id="integrating-with-grafana">Integrating with Grafana</h3>

<h4 id="adding-loki-as-a-grafana-data-source">Adding Loki as a Grafana Data Source</h4>
<p>To visualize logs in Grafana:</p>
<ul>
  <li>Open your Grafana instance</li>
  <li>Go to Configuration &gt; Data Sources</li>
  <li>Click ‚ÄúAdd data source‚Äù and select ‚ÄúLoki‚Äù</li>
  <li>Set the URL to <code class="language-plaintext highlighter-rouge">http://loki-gateway.monitoring.svc.cluster.local</code></li>
  <li>Save and test the connection</li>
</ul>

<p>Once connected, you can use Grafana‚Äôs Explore view to query logs and create dashboards that combine logs with metrics from Prometheus.</p>

<div style="width: 90%; margin: 20px auto;">
  <div class="mermaid">
    graph TD
      A[Promtail] --&gt;|Push Logs| B[Loki]
      C[Prometheus] --&gt;|Scrape Metrics| D[Targets]
      E[Grafana] --&gt;|Query Logs| B
      E --&gt;|Query Metrics| C
      E --&gt;|Visualize| F[Dashboards]
      
      style A fill:#f5f5f5,stroke:#333,stroke-width:1px
      style B fill:#a5d6a7,stroke:#333,stroke-width:1px
      style C fill:#64b5f6,stroke:#333,stroke-width:1px
      style D fill:#ffcc80,stroke:#333,stroke-width:1px
      style E fill:#ce93d8,stroke:#333,stroke-width:1px
      style F fill:#ef9a9a,stroke:#333,stroke-width:1px
  </div>
</div>

<p><br /></p>

<h3 id="sample-logql-queries">Sample LogQL Queries</h3>

<h4 id="useful-logql-queries-for-kubernetes">Useful LogQL Queries for Kubernetes</h4>

<p>Try these queries in Grafana‚Äôs Explore view to get started with Loki:</p>

<p><br /></p>

<script src="https://gist.github.com/somaz94/2dd74afe2c2cb403831f7c2c88bdb1bb.js"></script>

<p><br /></p>

<hr />

<h2 id="next-steps">Next Steps</h2>

<div class="info-box info-box-success-not-check">
  <strong>Upcoming Configuration Tasks</strong>
  <p>In our next post, we'll explore:</p>
  
  <ul>
    <li><strong>Setting up Grafana</strong>: Install and configure Grafana for visualization</li>
    <li><strong>Creating Dashboards</strong>: Build comprehensive dashboards combining metrics and logs</li>
    <li><strong>Alert Configuration</strong>: Set up alerts based on log patterns and metrics</li>
    <li><strong>Log Integration</strong>: Correlate logs with metrics from Prometheus and Thanos</li>
    <li><strong>Advanced LogQL</strong>: Advanced query techniques for log analysis</li>
  </ul>
</div>

<p><br /></p>

<hr />

<h2 id="key-points">Key Points</h2>

<div class="info-box info-box-success-not-check">
  <strong>üí° Installation Summary</strong>
  <ul>
    <li>
      <strong>Deployment Approach</strong><br />
      - Single Binary mode for Loki simplifies deployment<br />
      - DaemonSet deployment for Promtail ensures coverage on all nodes<br />
      - Persistent storage for Loki ensures log durability
    </li>
    <li>
      <strong>Configuration Highlights</strong><br />
      - Filesystem storage used for simplicity (switch to object storage for production)<br />
      - NodePort service type enables external access<br />
      - ServiceMonitor integration for Prometheus metrics collection<br />
      - Simple client configuration for Promtail
    </li>
    <li>
      <strong>Usage Patterns</strong><br />
      - Access logs via Loki API or Grafana<br />
      - Use LogQL for powerful querying capabilities<br />
      - Integrate with existing monitoring infrastructure<br />
      - Consider multi-tenancy for team isolation in larger environments
    </li>
  </ul>
</div>

<p><br /></p>

<hr />

<h2 id="references">References</h2>
<ul>
  <li><a href="https://github.com/grafana/loki/tree/main/production/helm/loki">Loki Helm Chart</a></li>
  <li><a href="https://github.com/grafana/helm-charts/tree/main/charts/promtail">Promtail Helm Chart</a></li>
  <li><a href="https://grafana.com/docs/loki/latest/setup/install/helm/install-monolithic/">Loki Installation Guide</a></li>
  <li><a href="https://hackernoon.com/grafana-loki-architecture-summary-and-running-in-kubernetes">Grafana Loki Architecture</a></li>
  <li><a href="https://grafana.com/docs/loki/latest/logql/">LogQL Query Language Reference</a></li>
  <li><a href="https://grafana.com/docs/loki/latest/best-practices/">Loki Best Practices</a></li>
  <li><a href="https://grafana.com/docs/loki/latest/send-data/promtail/configuration/">Promtail Configuration</a></li>
  <li><a href="https://grafana.com/docs/loki/latest/installation/kubernetes/">Kubernetes Logging with Loki</a></li>
</ul>


                <!-- Pagination links -->


            </article>

            
                <aside class="see-also">
                    <h2>See also</h2>
                    <ul>
                        
                        
                        
                            <li>
                                <a href="/category/storage/understanding-ceph-distributed-storage-architecture/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1755077387/ceph-1_xm8avx.png">
                                    
                                    <h3>Understanding Ceph: Comprehensive Guide to Distributed Storage Architecture</h3>
                                </a>
                            </li>
                        
                            <li>
                                <a href="/category/openstack/openstack-manila/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1756180452/openstack-manila-1_qxm1na.png">
                                    
                                    <h3>Deep Dive into OpenStack Manila</h3>
                                </a>
                            </li>
                        
                            <li>
                                <a href="/category/troubleshooting/terraform-state-debugging/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1745823546/terraform-error_duccgn.png">
                                    
                                    <h3>Complete Terraform State Management Troubleshooting Guide</h3>
                                </a>
                            </li>
                        
                    </ul>
                </aside>
            

        </section>

        <!-- Add time bar only for pages without pagination -->
        
            <div class="time-bar" data-minutes="12">
    <span class="time-completed"></span>
    <span class="time-remaining"></span>
    <div class="bar">
        <span class="completed" style="width:0%;"></span>
        <span class="remaining" style="width:100%;"></span>
    </div>
</div>

            <button class="toggle-preview" onclick="togglePreview()">
    <span>Hide Preview ‚ñº</span>
</button>

<div id="recommendationSection" class="recommendation">
    <div class="message">
        <strong>Why don't you read something next?</strong>
        <div>
            <button>
                <svg><use xlink:href="#icon-arrow-right"></use></svg>
                <span>Go back to top</span>
            </button>
        </div>
    </div>
    <div id="previewSection" class="preview-section">
        
        <a href="/category/cs/kubernetes-components-and-work/" class="post-preview">
            <div class="image">
                
                    <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1737013175/kubernetes-component_ouhblg.png">
                
            </div>
            <h3 class="title">Understanding Kubernetes Components and Pod Creation</h3>
        </a>
    </div>
</div>

<style>
.toggle-preview {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #333;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 4px;
    cursor: pointer;
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.toggle-preview:hover {
    background: #444;
}

.toggle-preview.visible {
    opacity: 1;
}

.recommendation {
    margin-top: 1000px;
    display: block;
    transition: all 0.3s ease;
}

.recommendation.hidden {
    display: none;
}

.hide-preview {
    margin-left: 10px;
    background: none;
    border: 1px solid #666;
    color: #666;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
}

.hide-preview:hover {
    background: #f0f0f0;
}

.preview-section {
    max-height: 1000px;
    overflow: hidden;
    transition: max-height 0.3s ease-out;
}

.preview-section.hidden {
    max-height: 0;
}
</style>

<script>
function togglePreview() {
    const recommendation = document.getElementById('recommendationSection');
    const button = document.querySelector('.toggle-preview span');
    
    if (recommendation.classList.contains('hidden')) {
        recommendation.classList.remove('hidden');
        button.textContent = 'Hide Preview ‚ñº';
    } else {
        recommendation.classList.add('hidden');
        button.textContent = 'Show Preview ‚ñ≤';
    }
}

window.addEventListener('scroll', function() {
    const toggleButton = document.querySelector('.toggle-preview');
    const recommendation = document.getElementById('recommendationSection');
    const rect = recommendation.getBoundingClientRect();
    
    if (rect.top <= window.innerHeight) {
        toggleButton.classList.add('visible');
    } else {
        toggleButton.classList.remove('visible');
    }
});
</script>

        

        <!-- Show modal if the post is the last one -->
        

        <!-- Show modal before user leaves the page -->
        

        <!-- Add your newsletter subscription form here -->

        <section class="share">
    <h3>Share</h3>
    <a aria-label="Share on Twitter" href="https://twitter.com/intent/tweet?text=&quot;Learn how to install and configure Loki and Promtail using Helm charts for log aggregation&quot;%20https://somaz.blog/category/monitoring/loki-promtail-install/%20via%20&#64;twitter_username&hashtags=loki,promtail,helm,kubernetes"
    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Share on Twitter">
        <svg class="icon icon-twitter"><use xlink:href="#icon-twitter"></use></svg>
    </a>
    <a aria-label="Share on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://somaz.blog/category/monitoring/loki-promtail-install/"
    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook">
        <svg class="icon icon-facebook"><use xlink:href="#icon-facebook"></use></svg>
    </a>
</section>

        

  <section class="author">
    <div class="details">
      
        <img class="img-rounded" src="/assets/img/uploads/profile.png" alt="Somaz">
      
      <p class="def">Author</p>
      <h3 class="name">
        <a href="/authors/somaz/">Somaz</a>
      </h3>
      <p class="desc">DevOps engineer focused on cloud infrastructure and automation</p>
      <p>
        
          <a href="https://github.com/somaz94" title="Github">
            <svg><use xlink:href="#icon-github"></use></svg>
          </a>
        
        
        
        
        
        
          <a href="https://www.linkedin.com/in/somaz" title="LinkedIn">
            <svg><use xlink:href="#icon-linkedin"></use></svg>
          </a>
        
        
          <a href="https://somaz.tistory.com" title="Tistory">
            <svg><use xlink:href="#icon-tistory"></use></svg>
          </a>
        
      </p>
    </div>
  </section>

  
  
  
  
  
  
  
  

  <script type="application/ld+json">
  {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "Somaz",
      
      "image": "/assets/img/uploads/profile.png",
      
      "jobTitle": "DevOps Engineer",
      "url": "https://somaz.blog/authors/somaz/",
      "sameAs": [
        "https://github.com/somaz94","https://www.linkedin.com/in/somaz","https://{{ author.tistory_username }}.tistory.com"
      ]
  }
  </script>


        

<section class="comments">
    <h3>Comments</h3>
    <div id="disqus_thread"></div>
</section>
<script type="text/javascript">
    var disqus_loaded = false;

    function load_disqus()
    {
        disqus_loaded = true;
        var disqus_shortname = 'https-somaz94-github-io';
        var disqus_title = '';
        var disqus_url = '/category/monitoring/loki-promtail-install/';
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        var ldr = document.getElementById('disqus_loader');
    };
    window.onscroll = function(e) {
        if ((window.innerHeight + window.scrollY) >= (document.body.offsetHeight - 800)) {
            //hit bottom of page
            if (disqus_loaded==false)
                load_disqus()
        }
    };
</script>



        <footer>
    <p>
      
        <a href="https://github.com/somaz94" title="Github">
          <svg><use xlink:href="#icon-github"></use></svg>
        </a>
      
      
        <a href="https://www.facebook.com/facebook_username" title="Facebook">
          <svg><use xlink:href="#icon-facebook"></use></svg>
        </a>
      
      
        <a href="https://twitter.com/twitter_username" title="Twitter">
          <svg><use xlink:href="#icon-twitter"></use></svg>
        </a>
      
      
        <a href="https://medium.com/@medium_username" title="Medium">
          <svg><use xlink:href="#icon-medium"></use></svg>
        </a>
      
      
        <a href="https://www.instagram.com/instagram_username" title="Instagram">
          <svg><use xlink:href="#icon-instagram"></use></svg>
        </a>
      
      
        <a href="https://www.linkedin.com/in/somaz" title="LinkedIn">
          <svg><use xlink:href="#icon-linkedin"></use></svg>
        </a>
      
      
        <a href="https://somaz.tistory.com" title="Tistory">
          <svg><use xlink:href="#icon-tistory"></use></svg>
        </a>
      
    </p>

    <ul>
  
    
      <li>
        <a href="https://somaz.blog/">Home</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/about">About</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/category">Category</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/contact">Contact</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/feed.xml">Feed</a>
      </li>
    
  
</ul>


    <p>
      <a href="https://somaz.blog/sitemap.xml" title="sitemap">Sitemap</a> |
      <a href="https://somaz.blog/privacy-policy" title="Privacy Policy">Privacy Policy</a>
    </p>

    <p>
      <span>Somaz Tech Blog</span> <svg class="love"><use xlink:href="#icon-heart"></use></svg>
    </p>
</footer>










<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "somaz",
  "description": "DevOps engineer's tech blog.",
  "url": "https://somaz.blog/",
  "logo": {
      "@type": "ImageObject",
      "url": "https://somaz.blog/assets/img/icons/mediumtile.png",
      "width": "600",
      "height": "315"
  },
  "sameAs": [
    "https://github.com/somaz94","https://www.facebook.com/facebook_username","https://twitter.com/twitter_username","https://medium.com/@medium_username","https://www.instagram.com/instagram_username","https://www.linkedin.com/in/somaz","https://{{ site.tistory_username }}.tistory.com"
  ]
}
</script>

<!-- Include the script that allows Netlify CMS login -->
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

<!-- Include the website scripts -->
<script src="/assets/js/scripts.min.js"></script>

<!-- Include Google Analytics script -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-XXXXXXXX-X"></script>
<script>
  var host = window.location.hostname;
  if (host != 'localhost') {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-XXXXXXXX-X');
  }
</script>
  


<!-- Include extra scripts -->



        

        
        
        
        
        
        
        
        
        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "BlogPosting",
            "name": "How to install Loki and Promtail with Helm",
            "headline": "A guide to deploying Loki and Promtail on Kubernetes",
            "description": "Learn how to install and configure Loki and Promtail using Helm charts for log aggregation",
            "image": "https://res.cloudinary.com/dkcm26aem/image/upload/v1738641555/loki-promtail-install_t7caxs.png",
            "url": "https://somaz.blog/category/monitoring/loki-promtail-install/",
            "articleBody": "Image Reference





Installing Loki and Promtail on Kubernetes

Loki and Promtail provide a powerful, resource-efficient logging stack for Kubernetes environments. This guide offers a step-by-step approach to installing and configuring both components using Helm charts, with a focus on optimizing for production use while minimizing resource consumption.



Introduction and Prerequisites


  Before You Begin
  This guide follows our previous post about Loki architecture and components. Before proceeding with the installation, ensure you have the following prerequisites in place:
  
  
    Kubernetes Cluster: A running Kubernetes cluster with proper networking
    Storage: Storage provisioner configured for persistent volumes (default StorageClass)
    Helm: Helm 3.x installed and configured to work with your cluster
    kubectl: Properly configured with access to your cluster
    Namespace: A namespace for your monitoring stack (we&apos;ll use &quot;monitoring&quot; in this guide)
  
  
  This guide uses a single-binary deployment mode for Loki, which is suitable for most small to medium deployments. For larger environments, you might want to consider the microservices deployment model.


Note:

We‚Äôre not using Loki-Stack due to version compatibility issues with recent Grafana query features. Instead, we‚Äôll install Loki and Promtail separately using their dedicated Helm charts.





Loki Deployment Approaches

Loki can be deployed in different operational modes, each with its own advantages and resource requirements. This section explains the available deployment options and why we‚Äôve chosen the single binary approach for this guide.


  
    graph LR
      A[Loki Deployment Models] --&amp;gt; B[Single Binary]
      A --&amp;gt; C[Microservices]
      A --&amp;gt; D[Simple Scalable]
      
      B --&amp;gt; B1[All components in one process]
      B --&amp;gt; B2[Easiest to deploy]
      B --&amp;gt; B3[Lowest resource overhead]
      B --&amp;gt; B4[Limited horizontal scalability]
      
      C --&amp;gt; C1[Components as separate services]
      C --&amp;gt; C2[Maximum scalability]
      C --&amp;gt; C3[Independent component scaling]
      C --&amp;gt; C4[Higher complexity]
      
      D --&amp;gt; D1[Middle ground approach]
      D --&amp;gt; D2[Groups related components]
      D --&amp;gt; D3[Better than Single Binary for scale]
      D --&amp;gt; D4[Simpler than full Microservices]
      
      style A fill:#f5f5f5,stroke:#333,stroke-width:1px
      style B fill:#a5d6a7,stroke:#333,stroke-width:1px
      style C fill:#64b5f6,stroke:#333,stroke-width:1px
      style D fill:#ffcc80,stroke:#333,stroke-width:1px
  



  
    
      Deployment Model
      Best For
      Characteristics
    
    
      Single Binary
      
        Small to medium environments
        Testing and development
        Resource-constrained clusters
      
      
        
          All Loki components run in a single process
          Simplest deployment and maintenance
          Lowest resource consumption
          Limited horizontal scalability
          Suitable for log volumes up to ~100GB/day
        
      
    
    
      Microservices
      
        Large production environments
        High log volumes
        Multi-tenant deployments
      
      
        
          Each component deployed separately
          Maximum scalability and resilience
          Independent scaling of components
          Higher operational complexity
          Suitable for log volumes &amp;gt;100GB/day
        
      
    
    
      Simple Scalable
      
        Medium production environments
        Growing environments
        Balance of simplicity and scale
      
      
        
          Components grouped by function
          Better scalability than Single Binary
          Simpler than full Microservices
          Good starting point for production
        
      
    
  






Installing Loki

We‚Äôll deploy Loki in SingleBinary mode, which offers a good balance of simplicity and functionality for small to medium deployments. This approach bundles all Loki components into a single process, making it easier to manage while still providing all core capabilities.



Preparing for Installation




  Step 1: Adding the Grafana Helm Repository
  First, add the Grafana Helm repository and update your local Helm charts:


# Add the Grafana Helm repository
helm repo add grafana https://grafana.github.io/helm-charts

# Update Helm repositories
helm repo update





  Step 2: Clone the Repository and Prepare Configuration
  To access the latest charts and configurations, clone the Loki repository:


# Clone the Loki repository
git clone https://github.com/grafana/loki.git

# Navigate to the Helm chart directory
cd loki/production/helm/loki/

# Update chart dependencies
helm dependency update

# Create directory for custom values
mkdir values
cp values.yaml values/somaz.yaml




Loki Configuration

Configuration Parameters Explained
Here are the key parameters in our configuration:

  global.clusterDomain: Your Kubernetes cluster domain (default: cluster.local)
  deploymentMode: Mode of deployment (SingleBinary for this guide)
  loki.storage.type: Storage type for logs (filesystem for simplicity)
  persistence: Configuration for persistent volume claims
  gateway: Ingress settings for accessing Loki API





  
    graph TD
      A[Loki Storage Configuration] --&amp;gt;|Schema| B[Schema Configuration]
      A --&amp;gt;|Store| C[Store Selection]
      B --&amp;gt; B1[from: date]
      B --&amp;gt; B2[store: type]
      B --&amp;gt; B3[schema: version]
      C --&amp;gt; C1[filesystem]
      C --&amp;gt; C2[object storage]
      C --&amp;gt; C3[chunk stores]
      
      style A fill:#f5f5f5,stroke:#333,stroke-width:1px
      style B fill:#a5d6a7,stroke:#333,stroke-width:1px
      style C fill:#64b5f6,stroke:#333,stroke-width:1px
  




Custom Configuration File (values/somaz.yaml)
Create a custom values file with the following configuration:

global:
  clusterDomain: &quot;somaz-cluster.local&quot;
  dnsService: &quot;coredns&quot;
  dnsNamespace: &quot;kube-system&quot;
deploymentMode: SingleBinary
loki:
  commonConfig:
    replication_factor: 1
  storage:
    type: filesystem
  schemaConfig:
    configs:
    - from: &quot;2024-01-01&quot;
      store: tsdb
      index:
        prefix: loki_index_
        period: 24h
      object_store: filesystem
      schema: v13
singleBinary:
  replicas: 1
  persistence:
    enabled: true
    storageClass: &quot;default&quot;
    accessModes:
      - ReadWriteOnce
    size: 10Gi
gateway:
  enabled: true
  service:
    type: NodePort
    nodePort: 31400
# Disable unnecessary components for single binary mode
chunksCache:
  enabled: false
resultsCache:
  enabled: false
# ... (other components disabled)




Installation Process

Installing Loki with Helm

Now we‚Äôre ready to install Loki using our custom configuration:

# Verify configuration syntax
helm lint --values ./values/somaz.yaml

# Optional: Generate and review the installation manifest
helm install loki . -n monitoring -f ./values/somaz.yaml --create-namespace --dry-run &amp;gt;&amp;gt; output.yaml

# Install Loki
helm install loki . -n monitoring -f ./values/somaz.yaml --create-namespace

# If you need to upgrade later
helm upgrade loki . -n monitoring -f ./values/somaz.yaml



  
    sequenceDiagram
        participant User as You
        participant Helm as Helm
        participant K8s as Kubernetes
        participant Loki as Loki Pod
        participant PV as Persistent Volume
        
        User-&amp;gt;&amp;gt;Helm: helm install loki
        Helm-&amp;gt;&amp;gt;K8s: Create namespace if needed
        Helm-&amp;gt;&amp;gt;K8s: Apply ConfigMaps and Secrets
        Helm-&amp;gt;&amp;gt;K8s: Create PVC
        K8s-&amp;gt;&amp;gt;PV: Provision storage
        Helm-&amp;gt;&amp;gt;K8s: Deploy Loki StatefulSet/Deployment
        K8s-&amp;gt;&amp;gt;Loki: Create Loki container
        Loki-&amp;gt;&amp;gt;PV: Mount storage
        Loki-&amp;gt;&amp;gt;User: Ready for log ingestion
  




Verifying the Installation

Check Loki Components
Verify that all Loki components are running correctly:







Troubleshooting Tips

If you encounter issues with Loki deployment:

Check Pod Status
kubectl get pods -n monitoring


View Logs
kubectl logs -n monitoring deployment/loki


Verify PVCs
kubectl get pvc -n monitoring


Check Services
kubectl get svc -n monitoring


Common Issues

  Storage provisioning failures (check StorageClass)
  Insufficient resources (check resource limits/requests)
  Service connectivity issues (check services and endpoints)






Installing Promtail

Promtail is Loki‚Äôs log collection agent, designed to discover and forward logs from Kubernetes pods and containers. It runs as a DaemonSet, ensuring coverage across all nodes in your cluster and automatically labels logs with metadata from Kubernetes.



Preparing for Installation

Obtaining and Configuring the Promtail Chart
Clone the Grafana Helm charts repository to access the Promtail chart:

# Clone the Grafana Helm charts repository
git clone https://github.com/grafana/helm-charts.git

# Navigate to the Promtail chart directory
cd helm-charts/charts/promtail

# Update chart dependencies
helm dependency update

# Create directory for custom values
mkdir values
cp values.yaml values/somaz.yaml




Promtail Configuration


  Configuration Parameters Explained
  Key parameters in the Promtail configuration:
  
  
    daemonset.enabled: Deploys Promtail as a DaemonSet on all nodes
    serviceMonitor.enabled: Creates ServiceMonitor for Prometheus to scrape Promtail metrics
    config.logLevel: Log verbosity level (info, debug, etc.)
    config.serverPort: Port for Promtail&apos;s HTTP server
    config.clients: List of Loki instances to push logs to
  
  
  The client URL points to the Loki Gateway service, which provides a centralized entry point to Loki.



  
    graph TD
      A[Kubernetes Pods] --&amp;gt;|Generate Logs| B[Container Log Files]
      B --&amp;gt;|Read| C[Promtail DaemonSet]
      C --&amp;gt;|Query| D[Kubernetes API]
      D --&amp;gt;|Pod Metadata| C
      C --&amp;gt;|Add Labels| C
      C --&amp;gt;|Push Logs| E[Loki Gateway]
      E --&amp;gt;|Forward| F[Loki Service]
      
      style A fill:#f5f5f5,stroke:#333,stroke-width:1px
      style B fill:#a5d6a7,stroke:#333,stroke-width:1px
      style C fill:#64b5f6,stroke:#333,stroke-width:1px
      style D fill:#ffcc80,stroke:#333,stroke-width:1px
      style E fill:#ce93d8,stroke:#333,stroke-width:1px
      style F fill:#ef9a9a,stroke:#333,stroke-width:1px
  




Custom Configuration File (values/somaz.yaml)
Create a custom values file for Promtail with the following configuration:

daemonset:
  enabled: true
serviceMonitor:
  enabled: true
config:
  enabled: true
  logLevel: info
  logFormat: logfmt
  serverPort: 3101
  clients:
    - url: http://loki-gateway/loki/api/v1/push




Installation Process

Installing Promtail with Helm

Now we can install Promtail using our custom configuration:

# Verify configuration syntax
helm lint --values ./values/somaz.yaml

# Optional: Generate and review the installation manifest
helm install promtail . -n monitoring -f ./values/somaz.yaml --create-namespace --dry-run &amp;gt;&amp;gt; output.yaml

# Install Promtail
helm install promtail . -n monitoring -f ./values/somaz.yaml --create-namespace

# If you need to upgrade later
helm upgrade promtail . -n monitoring -f ./values/somaz.yaml



  Additional Configuration Options
  Advanced Promtail configurations you might consider for production:
  
  
    Resource Limits: Set appropriate CPU and memory limits
    Tolerations: Enable Promtail to run on tainted nodes
    extraVolumes: Mount additional log locations beyond standard paths
    extraScrapeConfigs: Add custom scrape configurations for non-standard log formats
    pipelineStages: Configure log processing pipelines to extract fields, add labels, etc.
  






Accessing and Using Your Logging Stack

With Loki and Promtail installed, you now have a powerful logging infrastructure for your Kubernetes cluster. This section covers how to access logs and integrate with other components of your monitoring stack.



Accessing Logs

Querying Logs Through Loki API

Loki provides a REST API for querying logs. You can access it directly:







Integrating with Grafana

Adding Loki as a Grafana Data Source
To visualize logs in Grafana:

  Open your Grafana instance
  Go to Configuration &amp;gt; Data Sources
  Click ‚ÄúAdd data source‚Äù and select ‚ÄúLoki‚Äù
  Set the URL to http://loki-gateway.monitoring.svc.cluster.local
  Save and test the connection


Once connected, you can use Grafana‚Äôs Explore view to query logs and create dashboards that combine logs with metrics from Prometheus.


  
    graph TD
      A[Promtail] --&amp;gt;|Push Logs| B[Loki]
      C[Prometheus] --&amp;gt;|Scrape Metrics| D[Targets]
      E[Grafana] --&amp;gt;|Query Logs| B
      E --&amp;gt;|Query Metrics| C
      E --&amp;gt;|Visualize| F[Dashboards]
      
      style A fill:#f5f5f5,stroke:#333,stroke-width:1px
      style B fill:#a5d6a7,stroke:#333,stroke-width:1px
      style C fill:#64b5f6,stroke:#333,stroke-width:1px
      style D fill:#ffcc80,stroke:#333,stroke-width:1px
      style E fill:#ce93d8,stroke:#333,stroke-width:1px
      style F fill:#ef9a9a,stroke:#333,stroke-width:1px
  




Sample LogQL Queries

Useful LogQL Queries for Kubernetes

Try these queries in Grafana‚Äôs Explore view to get started with Loki:









Next Steps


  Upcoming Configuration Tasks
  In our next post, we&apos;ll explore:
  
  
    Setting up Grafana: Install and configure Grafana for visualization
    Creating Dashboards: Build comprehensive dashboards combining metrics and logs
    Alert Configuration: Set up alerts based on log patterns and metrics
    Log Integration: Correlate logs with metrics from Prometheus and Thanos
    Advanced LogQL: Advanced query techniques for log analysis
  






Key Points


  üí° Installation Summary
  
    
      Deployment Approach
      - Single Binary mode for Loki simplifies deployment
      - DaemonSet deployment for Promtail ensures coverage on all nodes
      - Persistent storage for Loki ensures log durability
    
    
      Configuration Highlights
      - Filesystem storage used for simplicity (switch to object storage for production)
      - NodePort service type enables external access
      - ServiceMonitor integration for Prometheus metrics collection
      - Simple client configuration for Promtail
    
    
      Usage Patterns
      - Access logs via Loki API or Grafana
      - Use LogQL for powerful querying capabilities
      - Integrate with existing monitoring infrastructure
      - Consider multi-tenancy for team isolation in larger environments
    
  






References

  Loki Helm Chart
  Promtail Helm Chart
  Loki Installation Guide
  Grafana Loki Architecture
  LogQL Query Language Reference
  Loki Best Practices
  Promtail Configuration
  Kubernetes Logging with Loki

",
            "wordcount": "2201",
            "inLanguage": "en",
            "dateCreated": "2025-01-23/",
            "datePublished": "2025-01-23/",
            "dateModified": "2025-01-23/",
            "author": {
                "@type": "Person",
                "name": "Somaz",
                
                "image": "/assets/img/uploads/profile.png",
                
                "jobTitle": "DevOps Engineer",
                "url": "https://somaz.blog/authors/somaz/",
                "sameAs": [
                    "https://github.com/somaz94","https://www.linkedin.com/in/somaz"
                ]
            },
            "publisher": {
                "@type": "Organization",
                "name": "somaz",
                "url": "https://somaz.blog/",
                "logo": {
                    "@type": "ImageObject",
                    "url": "https://somaz.blog/assets/img/blog-image.png",
                    "width": "600",
                    "height": "315"
                }
            },
            "mainEntityOfPage": "True",
            "genre": "MONITORING",
            "articleSection": "MONITORING",
            "keywords": ["loki","promtail","helm","kubernetes"]
        }
        </script>
    </body>
</html>
