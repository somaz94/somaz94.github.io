<!DOCTYPE html>
<html lang="en" class="no-js">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    

    
    

    
    

    
    

    <!-- ✅ Google Tag Manager 추가 -->
    <script>
        (function(w,d,s,l,i){
            w[l]=w[l]||[];
            w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
            var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
            j.async=true;
            j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
            f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-MBP83N4Q');
    </script>
      <!-- ✅ End Google Tag Manager -->

    <!-- Mermaid.js 직접 로드 -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>

    <title>Docker Compose - Complete Guide to Multi-Container Application Orchestration | somaz</title>
    <meta name="description" content="Comprehensive guide to Docker Compose for defining, configuring, and running multi-container Docker applications with YAML-based orchestration">
    
        <meta name="keywords" content="docker-compose, container-orchestration, microservices, yaml-configuration, multi-container, devops, development-environment, service-management, docker">
    

    <!-- Social: Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Docker Compose - Complete Guide to Multi-Container Application Orchestration | somaz">
    <meta name="twitter:description" content="Comprehensive guide to Docker Compose for defining, configuring, and running multi-container Docker applications with YAML-based orchestration">

    
        <meta property="twitter:image" content="https://res.cloudinary.com/dkcm26aem/image/upload/v1755654072/docker-compose_l2hvau.png">
    
    
    
        <meta name="twitter:site" content="@twitter_username">
    

    <!-- Social: Facebook / Open Graph -->
    <meta property="og:url" content="https://somaz.blog/category/container/docker-compose/">
    <meta property="og:title" content="Docker Compose - Complete Guide to Multi-Container Application Orchestration | somaz">
    <meta property="og:image" content="https://res.cloudinary.com/dkcm26aem/image/upload/v1755654072/docker-compose_l2hvau.png">
    <meta property="og:description" content="Comprehensive guide to Docker Compose for defining, configuring, and running multi-container Docker applications with YAML-based orchestration">
    <meta property="og:site_name" content="Somaz Tech Blog">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/assets/img/icons/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/img/icons/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/img/icons/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/img/icons/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/img/icons/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/img/icons/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/img/icons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/icons/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/img/icons/apple-touch-icon-152x152.png" />

    <!-- Windows 8 Tile Icons -->
    <meta name="application-name" content="somaz">
    <meta name="msapplication-TileColor" content="#141414">
    <meta name="msapplication-square70x70logo" content="smalltile.png" />
    <meta name="msapplication-square150x150logo" content="mediumtile.png" />
    <meta name="msapplication-wide310x150logo" content="widetile.png" />
    <meta name="msapplication-square310x310logo" content="largetile.png" />
    
    <!-- Android Lolipop Theme Color -->
    <meta name="theme-color" content="#141414">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Titillium+Web:300,400,700" rel="stylesheet">

    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="canonical" href="https://somaz.blog/category/container/docker-compose/">
    <link rel="alternate" type="application/rss+xml" title="Somaz Tech Blog" href="https://somaz.blog/feed.xml" />

    <!-- Include extra styles -->
    

    <!-- JavaScript enabled/disabled -->
    <script>
        document.querySelector('html').classList.remove('no-js');
    </script>

    <!-- Google Adsense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8725590811736154"
        crossorigin="anonymous"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"> -->
    <!-- <link href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/variable/woff2/SUIT-Variable.css" rel="stylesheet"> -->
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- <link href="https://fonts.googleapis.com/css2?family=Albert+Sans:wght@400;500;700&display=swap" rel="stylesheet"> -->

    <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml" />

</head>
<!-- ✅ Google Tag Manager (noscript) -->
<noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MBP83N4Q"
            height="0" width="0" style="display:none;visibility:hidden">
    </iframe>
</noscript>
<!-- ✅ End Google Tag Manager (noscript) -->
    <body class="has-push-menu">
        





        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" display="none" version="1.1"><defs><symbol id="icon-menu" viewBox="0 0 1024 1024"><path class="path1" d="M128 213.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 725.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 469.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5z"/></symbol><symbol id="icon-search" viewBox="0 0 951 1024"><path class="path1" d="M658.286 475.429q0-105.714-75.143-180.857t-180.857-75.143-180.857 75.143-75.143 180.857 75.143 180.857 180.857 75.143 180.857-75.143 75.143-180.857zM950.857 950.857q0 29.714-21.714 51.429t-51.429 21.714q-30.857 0-51.429-21.714l-196-195.429q-102.286 70.857-228 70.857-81.714 0-156.286-31.714t-128.571-85.714-85.714-128.571-31.714-156.286 31.714-156.286 85.714-128.571 128.571-85.714 156.286-31.714 156.286 31.714 128.571 85.714 85.714 128.571 31.714 156.286q0 125.714-70.857 228l196 196q21.143 21.143 21.143 51.429z"/></symbol><symbol id="icon-close" viewBox="0 0 1000 1000"><path d="M969.8,870.3c27,27.7,27,71.8,0,99.1C955.7,983,937.9,990,920,990c-17.9,0-35.7-7-49.7-20.7L500,599L129.6,969.4C115.6,983,97.8,990,79.9,990s-35.7-7-49.7-20.7c-27-27.3-27-71.4,0-99.1L400.9,500L30.3,129.3c-27-27.3-27-71.4,0-99.1c27.3-27,71.8-27,99.4,0L500,400.9L870.4,30.2c27.7-27,71.8-27,99.4,0c27,27.7,27,71.8,0,99.1L599.1,500L969.8,870.3z"/></symbol><symbol id="icon-twitter" viewBox="0 0 951 1024"><path class="path1" d="M925.714 233.143q-38.286 56-92.571 95.429 0.571 8 0.571 24 0 74.286-21.714 148.286t-66 142-105.429 120.286-147.429 83.429-184.571 31.143q-154.857 0-283.429-82.857 20 2.286 44.571 2.286 128.571 0 229.143-78.857-60-1.143-107.429-36.857t-65.143-91.143q18.857 2.857 34.857 2.857 24.571 0 48.571-6.286-64-13.143-106-63.714t-42-117.429v-2.286q38.857 21.714 83.429 23.429-37.714-25.143-60-65.714t-22.286-88q0-50.286 25.143-93.143 69.143 85.143 168.286 136.286t212.286 56.857q-4.571-21.714-4.571-42.286 0-76.571 54-130.571t130.571-54q80 0 134.857 58.286 62.286-12 117.143-44.571-21.143 65.714-81.143 101.714 53.143-5.714 106.286-28.571z"/></symbol><symbol id="icon-facebook" viewBox="0 0 585 1024"><path class="path1" d="M548 6.857v150.857h-89.714q-49.143 0-66.286 20.571t-17.143 61.714v108h167.429l-22.286 169.143h-145.143v433.714h-174.857v-433.714h-145.714v-169.143h145.714v-124.571q0-106.286 59.429-164.857t158.286-58.571q84 0 130.286 6.857z"/></symbol><symbol id="icon-clock" viewBox="0 0 1000 1000"><path d="M500,10C229.8,10,10,229.8,10,500c0,270.2,219.8,490,490,490c270.2,0,490-219.8,490-490C990,229.8,770.2,10,500,10z M500,910.2c-226.2,0-410.2-184-410.2-410.2c0-226.2,184-410.2,410.2-410.2c226.2,0,410.2,184,410.2,410.2C910.2,726.1,726.2,910.2,500,910.2z M753.1,374c8.2,11.9,5.2,28.1-6.6,36.3L509.9,573.7c-4.4,3.1-9.6,4.6-14.8,4.6c-4.1,0-8.3-1-12.1-3c-8.6-4.5-14-13.4-14-23.1V202.5c0-14.4,11.7-26.1,26.1-26.1c14.4,0,26.1,11.7,26.1,26.1v300l195.6-135.1C728.7,359.2,744.9,362.1,753.1,374z"/></symbol><symbol id="icon-calendar" viewBox="0 0 1000 1000"><path d="M920,500v420H80V500H920 M990,430H10v490c0,38.7,31.3,70,70,70h840c38.7,0,70-31.3,70-70V430L990,430z"/><path d="M850,80v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80H360v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80C72.8,80,10,142.7,10,220v140h980V220C990,142.7,927.2,80,850,80z"/><path d="M255,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C290,25.8,274.3,10,255,10z"/><path d="M745,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C780,25.8,764.3,10,745,10z"/></symbol><symbol id="icon-github" viewBox="0 0 12 14"><path d="M6 1q1.633 0 3.012 0.805t2.184 2.184 0.805 3.012q0 1.961-1.145 3.527t-2.957 2.168q-0.211 0.039-0.312-0.055t-0.102-0.234q0-0.023 0.004-0.598t0.004-1.051q0-0.758-0.406-1.109 0.445-0.047 0.801-0.141t0.734-0.305 0.633-0.52 0.414-0.82 0.16-1.176q0-0.93-0.617-1.609 0.289-0.711-0.062-1.594-0.219-0.070-0.633 0.086t-0.719 0.344l-0.297 0.187q-0.727-0.203-1.5-0.203t-1.5 0.203q-0.125-0.086-0.332-0.211t-0.652-0.301-0.664-0.105q-0.352 0.883-0.062 1.594-0.617 0.68-0.617 1.609 0 0.664 0.16 1.172t0.41 0.82 0.629 0.523 0.734 0.305 0.801 0.141q-0.305 0.281-0.383 0.805-0.164 0.078-0.352 0.117t-0.445 0.039-0.512-0.168-0.434-0.488q-0.148-0.25-0.379-0.406t-0.387-0.187l-0.156-0.023q-0.164 0-0.227 0.035t-0.039 0.090 0.070 0.109 0.102 0.094l0.055 0.039q0.172 0.078 0.34 0.297t0.246 0.398l0.078 0.18q0.102 0.297 0.344 0.48t0.523 0.234 0.543 0.055 0.434-0.027l0.18-0.031q0 0.297 0.004 0.691t0.004 0.426q0 0.141-0.102 0.234t-0.312 0.055q-1.812-0.602-2.957-2.168t-1.145-3.527q0-1.633 0.805-3.012t2.184-2.184 3.012-0.805zM2.273 9.617q0.023-0.055-0.055-0.094-0.078-0.023-0.102 0.016-0.023 0.055 0.055 0.094 0.070 0.047 0.102-0.016zM2.516 9.883q0.055-0.039-0.016-0.125-0.078-0.070-0.125-0.023-0.055 0.039 0.016 0.125 0.078 0.078 0.125 0.023zM2.75 10.234q0.070-0.055 0-0.148-0.062-0.102-0.133-0.047-0.070 0.039 0 0.141t0.133 0.055zM3.078 10.562q0.062-0.062-0.031-0.148-0.094-0.094-0.156-0.023-0.070 0.062 0.031 0.148 0.094 0.094 0.156 0.023zM3.523 10.758q0.023-0.086-0.102-0.125-0.117-0.031-0.148 0.055t0.102 0.117q0.117 0.047 0.148-0.047zM4.016 10.797q0-0.102-0.133-0.086-0.125 0-0.125 0.086 0 0.102 0.133 0.086 0.125 0 0.125-0.086zM4.469 10.719q-0.016-0.086-0.141-0.070-0.125 0.023-0.109 0.117t0.141 0.062 0.109-0.109z"></path></symbol><symbol id="icon-medium" viewBox="0 0 1000 1000"><path d="M336.5,240.2v641.5c0,9.1-2.3,16.9-6.8,23.2s-11.2,9.6-20,9.6c-6.2,0-12.2-1.5-18-4.4L37.3,782.7c-7.7-3.6-14.1-9.8-19.4-18.3S10,747.4,10,739V115.5c0-7.3,1.8-13.5,5.5-18.6c3.6-5.1,8.9-7.7,15.9-7.7c5.1,0,13.1,2.7,24.1,8.2l279.5,140C335.9,238.6,336.5,239.5,336.5,240.2L336.5,240.2z M371.5,295.5l292,473.6l-292-145.5V295.5z M990,305.3v576.4c0,9.1-2.6,16.5-7.7,22.1c-5.1,5.7-12,8.5-20.8,8.5s-17.3-2.4-25.7-7.1L694.7,784.9L990,305.3z M988.4,239.7c0,1.1-46.8,77.6-140.3,229.4C754.6,621,699.8,709.8,683.8,735.7L470.5,389l177.2-288.2c6.2-10.2,15.7-15.3,28.4-15.3c5.1,0,9.8,1.1,14.2,3.3l295.9,147.7C987.6,237.1,988.4,238.2,988.4,239.7L988.4,239.7z"/></symbol><symbol id="icon-instagram" viewBox="0 0 489.84 489.84"><path d="M249.62,50.46c65.4,0,73.14.25,99,1.43C372.47,53,385.44,57,394.07,60.32a75.88,75.88,0,0,1,28.16,18.32,75.88,75.88,0,0,1,18.32,28.16c3.35,8.63,7.34,21.6,8.43,45.48,1.18,25.83,1.43,33.57,1.43,99s-0.25,73.14-1.43,99c-1.09,23.88-5.08,36.85-8.43,45.48a81.11,81.11,0,0,1-46.48,46.48c-8.63,3.35-21.6,7.34-45.48,8.43-25.82,1.18-33.57,1.43-99,1.43s-73.15-.25-99-1.43c-23.88-1.09-36.85-5.08-45.48-8.43A75.88,75.88,0,0,1,77,423.86,75.88,75.88,0,0,1,58.69,395.7c-3.35-8.63-7.34-21.6-8.43-45.48-1.18-25.83-1.43-33.57-1.43-99s0.25-73.14,1.43-99c1.09-23.88,5.08-36.85,8.43-45.48A75.88,75.88,0,0,1,77,78.64a75.88,75.88,0,0,1,28.16-18.32c8.63-3.35,21.6-7.34,45.48-8.43,25.83-1.18,33.57-1.43,99-1.43m0-44.13c-66.52,0-74.86.28-101,1.47s-43.87,5.33-59.45,11.38A120.06,120.06,0,0,0,45.81,47.44,120.06,120.06,0,0,0,17.56,90.82C11.5,106.4,7.36,124.2,6.17,150.27s-1.47,34.46-1.47,101,0.28,74.86,1.47,101,5.33,43.87,11.38,59.45a120.06,120.06,0,0,0,28.25,43.38,120.06,120.06,0,0,0,43.38,28.25c15.58,6.05,33.38,10.19,59.45,11.38s34.46,1.47,101,1.47,74.86-.28,101-1.47,43.87-5.33,59.45-11.38a125.24,125.24,0,0,0,71.63-71.63c6.05-15.58,10.19-33.38,11.38-59.45s1.47-34.46,1.47-101-0.28-74.86-1.47-101-5.33-43.87-11.38-59.45a120.06,120.06,0,0,0-28.25-43.38,120.06,120.06,0,0,0-43.38-28.25C394.47,13.13,376.67,9,350.6,7.8s-34.46-1.47-101-1.47h0Z" transform="translate(-4.7 -6.33)" /><path d="M249.62,125.48A125.77,125.77,0,1,0,375.39,251.25,125.77,125.77,0,0,0,249.62,125.48Zm0,207.41a81.64,81.64,0,1,1,81.64-81.64A81.64,81.64,0,0,1,249.62,332.89Z" transform="translate(-4.7 -6.33)"/><circle cx="375.66" cy="114.18" r="29.39" /></symbol><symbol id="icon-linkedin" viewBox="0 0 12 14"><path d="M2.727 4.883v7.742h-2.578v-7.742h2.578zM2.891 2.492q0.008 0.57-0.395 0.953t-1.059 0.383h-0.016q-0.641 0-1.031-0.383t-0.391-0.953q0-0.578 0.402-0.957t1.051-0.379 1.039 0.379 0.398 0.957zM12 8.187v4.437h-2.57v-4.141q0-0.82-0.316-1.285t-0.988-0.465q-0.492 0-0.824 0.27t-0.496 0.668q-0.086 0.234-0.086 0.633v4.32h-2.57q0.016-3.117 0.016-5.055t-0.008-2.313l-0.008-0.375h2.57v1.125h-0.016q0.156-0.25 0.32-0.438t0.441-0.406 0.68-0.34 0.895-0.121q1.336 0 2.148 0.887t0.813 2.598z"></path></symbol><symbol id="icon-heart" viewBox="0 0 34 30"><path d="M17,29.7 L16.4,29.2 C3.5,18.7 0,15 0,9 C0,4 4,0 9,0 C13.1,0 15.4,2.3 17,4.1 C18.6,2.3 20.9,0 25,0 C30,0 34,4 34,9 C34,15 30.5,18.7 17.6,29.2 L17,29.7 Z M9,2 C5.1,2 2,5.1 2,9 C2,14.1 5.2,17.5 17,27.1 C28.8,17.5 32,14.1 32,9 C32,5.1 28.9,2 25,2 C21.5,2 19.6,4.1 18.1,5.8 L17,7.1 L15.9,5.8 C14.4,4.1 12.5,2 9,2 Z" id="Shape"></path></symbol><symbol id="icon-arrow-right" viewBox="0 0 25.452 25.452"><path d="M4.471,24.929v-2.004l12.409-9.788c0.122-0.101,0.195-0.251,0.195-0.411c0-0.156-0.073-0.31-0.195-0.409L4.471,2.526V0.522c0-0.2,0.115-0.384,0.293-0.469c0.18-0.087,0.396-0.066,0.552,0.061l15.47,12.202c0.123,0.1,0.195,0.253,0.195,0.409c0,0.16-0.072,0.311-0.195,0.411L5.316,25.34c-0.155,0.125-0.372,0.147-0.552,0.061C4.586,25.315,4.471,25.13,4.471,24.929z"/></symbol><symbol id="icon-star" viewBox="0 0 48 48"><path fill="currentColor" d="M44,24c0,11.045-8.955,20-20,20S4,35.045,4,24S12.955,4,24,4S44,12.955,44,24z"/><path fill="#ffffff" d="M24,11l3.898,7.898l8.703,1.301l-6.301,6.102l1.5,8.699L24,30.898L16.199,35l1.5-8.699l-6.301-6.102  l8.703-1.301L24,11z"/></symbol><symbol id="icon-read" viewBox="0 0 32 32"><path fill="currentColor" d="M29,4H3C1.343,4,0,5.343,0,7v18c0,1.657,1.343,3,3,3h10c0,0.552,0.448,1,1,1h4c0.552,0,1-0.448,1-1h10  c1.657,0,3-1.343,3-3V7C32,5.343,30.657,4,29,4z M29,5v20H18.708c-0.618,0-1.236,0.146-1.789,0.422l-0.419,0.21V5H29z M15.5,5  v20.632l-0.419-0.21C14.528,25.146,13.91,25,13.292,25H3V5H15.5z M31,25c0,1.103-0.897,2-2,2H18v1h-4v-1H3c-1.103,0-2-0.897-2-2V7  c0-0.737,0.405-1.375,1-1.722V25c0,0.552,0.448,1,1,1h10.292c0.466,0,0.925,0.108,1.342,0.317l0.919,0.46  c0.141,0.07,0.294,0.106,0.447,0.106c0.153,0,0.306-0.035,0.447-0.106l0.919-0.46C17.783,26.108,18.242,26,18.708,26H29  c0.552,0,1-0.448,1-1V5.278C30.595,5.625,31,6.263,31,7V25z M6,12.5C6,12.224,6.224,12,6.5,12h5c0.276,0,0.5,0.224,0.5,0.5  S11.776,13,11.5,13h-5C6.224,13,6,12.776,6,12.5z M6,14.5C6,14.224,6.224,14,6.5,14h5c0.276,0,0.5,0.224,0.5,0.5S11.776,15,11.5,15  h-5C6.224,15,6,14.776,6,14.5z M6,16.5C6,16.224,6.224,16,6.5,16h5c0.276,0,0.5,0.224,0.5,0.5S11.776,17,11.5,17h-5  C6.224,17,6,16.776,6,16.5z M20,12.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,13,25.5,13h-5  C20.224,13,20,12.776,20,12.5z M20,14.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,15,25.5,15h-5  C20.224,15,20,14.776,20,14.5z M20,16.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,17,25.5,17h-5  C20.224,17,20,16.776,20,16.5z"></path></symbol><symbol id="icon-tistory" viewBox="0 0 24 24"><path d="M4 4h16v3h-6v13h-4V7H4V4z"/></symbol></defs></svg>

        <header class="bar-header">
    <a id="menu" role="button">
        <svg id="open" class="icon-menu"><use xlink:href="#icon-menu"></use></svg>
    </a>
    <h1 class="logo">
        <a href="/">
            
                somaz <span class="version">v3.1.2</span>
            
        </a>
    </h1>
    <a id="search" class="dosearch" role="button">
        <svg class="icon-search"><use xlink:href="#icon-search"></use></svg>
    </a>
    
        <a href="https://github.com/thiagorossener/jekflix-template" class="get-theme" role="button">
            Get this theme!
        </a>
    
</header>

<div id="mask" class="overlay"></div>

<aside class="sidebar" id="sidebar">
    <nav id="navigation">
      <h2>Menu</h2>
      <ul>
  
    
      <li>
        <a href="https://somaz.blog/">Home</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/about">About</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/category">Category</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/contact">Contact</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/feed.xml">Feed</a>
      </li>
    
  
</ul>

    </nav>
</aside>

<div class="search-wrapper">
    <div class="search-form">
        <input type="text" class="search-field" placeholder="Search">
        <svg class="icon-remove-sign"><use xlink:href="#icon-close"></use></svg>
        <ul class="search-results search-list"></ul>
    </div>
</div>



        <section class="post two-columns">
            <article role="article" class="post-content">
                <p class="post-info">
                    
                        <svg class="icon-calendar" id="date"><use xlink:href="#icon-calendar"></use></svg>
                        <time class="date" datetime="2026-01-13T00:00:00+00:00">
                            


January 13, 2026

                        </time>
                    
                    <svg id="clock" class="icon-clock"><use xlink:href="#icon-clock"></use></svg>
                    <span>66 min to read</span>
                </p>
                <h1 class="post-title">Docker Compose - Complete Guide to Multi-Container Application Orchestration</h1>
                <p class="post-subtitle">Master containerized application configuration and deployment with Docker Compose</p>

                
                    <img src="https://res.cloudinary.com/dkcm26aem/image/upload/v1755654072/docker-compose_l2hvau.png" alt="Featured image" class="post-cover">
                

                <!-- Pagination links -->



                <!-- Add your table of contents here -->


                <p><br /></p>

<hr />

<h2 id="overview">Overview</h2>

<p><strong>Docker Compose</strong> is a powerful tool for defining and running multi-container Docker applications. Using a simple YAML file, you can configure your application’s services, networks, and volumes, then create and start all services with a single command. This approach transforms complex multi-container deployments into manageable, reproducible configurations.</p>

<p>Docker Compose excels in <strong>development, testing, and staging environments</strong>, while also being suitable for production use cases. It simplifies the orchestration of related services, making it an essential tool for modern containerized application development.</p>

<p><br /></p>

<h3 id="evolution-from-v1-to-v2">Evolution from V1 to V2</h3>

<div class="info-box info-box-success-not-check">
  <strong>Important Migration Notice</strong>
  <ul>
    <li><strong>July 2023</strong>: Docker Compose V1 reached end of life and no longer receives updates</li>
    <li><strong>V2 is now the official standard</strong>: Integrated as a Docker CLI subcommand rather than standalone binary</li>
    <li><strong>Command syntax change</strong>: <code>docker-compose</code> → <code>docker compose</code> (note the space)</li>
    <li><strong>Enhanced features</strong>: Better performance, improved error handling, and new capabilities</li>
  </ul>
</div>

<p><br /></p>

<hr />

<h2 id="core-concepts-and-architecture">Core Concepts and Architecture</h2>

<p>Understanding Docker Compose’s architecture helps you design better multi-container applications.</p>

<p><br /></p>

<h3 id="docker-compose-components">Docker Compose Components</h3>

<div class="table-container">
  <table class="table-beauty">
    <tr>
      <th style="width: 25%;">Component</th>
      <th style="width: 75%;">Description</th>
    </tr>
    <tr>
      <td><strong>Services</strong></td>
      <td>Define containers and their configuration (image, ports, volumes, environment)</td>
    </tr>
    <tr>
      <td><strong>Networks</strong></td>
      <td>Enable communication between containers with automatic DNS resolution</td>
    </tr>
    <tr>
      <td><strong>Volumes</strong></td>
      <td>Persist data and share files between containers and host system</td>
    </tr>
    <tr>
      <td><strong>Configs</strong></td>
      <td>Manage configuration files separately from container images</td>
    </tr>
    <tr>
      <td><strong>Secrets</strong></td>
      <td>Securely manage sensitive data like passwords and API keys</td>
    </tr>
  </table>
</div>

<p><br /></p>

<h3 id="compose-workflow-architecture">Compose Workflow Architecture</h3>

<div style="width: 100%; margin: 20px auto;">
  <div class="mermaid">
    graph TD
        A[docker-compose.yml] --&gt; B[Docker Compose CLI]
        B --&gt; C[Docker Engine]
        C --&gt; D[Container 1]
        C --&gt; E[Container 2]
        C --&gt; F[Container N]
        
        G[Custom Networks] --&gt; D
        G --&gt; E
        G --&gt; F
        
        H[Persistent Volumes] --&gt; D
        H --&gt; E
        H --&gt; F
        
        style A fill:#f9f,stroke:#333,stroke-width:2px
        style B fill:#bbf,stroke:#333,stroke-width:2px
        style C fill:#bfb,stroke:#333,stroke-width:2px
  </div>
</div>

<p><br /></p>

<hr />

<h2 id="installation-and-setup">Installation and Setup</h2>

<p>Install Docker Compose V2 for modern container orchestration capabilities.</p>

<p><br /></p>

<h3 id="official-installation-methods">Official Installation Methods</h3>

<h4 id="method-1-docker-desktop-recommended">Method 1: Docker Desktop (Recommended)</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Docker Desktop includes Compose V2 by default</span>
<span class="c"># Download from: https://www.docker.com/products/docker-desktop</span>

<span class="c"># Verify installation</span>
docker compose version
</code></pre></div></div>

<h4 id="method-2-manual-installation-linux">Method 2: Manual Installation (Linux)</h4>

<script src="https://gist.github.com/somaz94/1b60a814ba23e1811781b6af1a350677.js"></script>

<p><br /></p>

<h4 id="method-3-package-manager-installation">Method 3: Package Manager Installation</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Ubuntu/Debian</span>
<span class="nb">sudo </span>apt-get update
<span class="nb">sudo </span>apt-get <span class="nb">install </span>docker-compose-plugin

<span class="c"># CentOS/RHEL/Fedora</span>
<span class="nb">sudo </span>yum <span class="nb">install </span>docker-compose-plugin
<span class="c"># or</span>
<span class="nb">sudo </span>dnf <span class="nb">install </span>docker-compose-plugin

<span class="c"># macOS with Homebrew</span>
brew <span class="nb">install </span>docker-compose
</code></pre></div></div>

<p><br /></p>

<h3 id="post-installation-verification">Post-Installation Verification</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Check Docker Compose version</span>
docker compose version

<span class="c"># Verify Docker Engine compatibility</span>
docker <span class="nt">--version</span>

<span class="c"># Test basic functionality</span>
<span class="nb">echo</span> <span class="s2">"version: '3.8'
services:
  hello:
    image: hello-world"</span> <span class="o">&gt;</span> test-compose.yml

docker compose <span class="nt">-f</span> test-compose.yml up
docker compose <span class="nt">-f</span> test-compose.yml down

<span class="c"># Clean up test files</span>
<span class="nb">rm </span>test-compose.yml
</code></pre></div></div>

<p><br /></p>

<hr />

<h2 id="essential-commands-reference">Essential Commands Reference</h2>

<p>Master the core Docker Compose commands for efficient container management.</p>

<p><br /></p>

<h3 id="lifecycle-management-commands">Lifecycle Management Commands</h3>

<h4 id="service-startup-and-shutdown">Service Startup and Shutdown</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Start all services defined in docker-compose.yml</span>
docker compose up

<span class="c"># Start services in detached mode (background)</span>
docker compose up <span class="nt">-d</span>

<span class="c"># Start specific services only</span>
docker compose up service1 service2

<span class="c"># Build images before starting (if Dockerfile changes)</span>
docker compose up <span class="nt">--build</span>

<span class="c"># Recreate containers even if configuration hasn't changed</span>
docker compose up <span class="nt">--force-recreate</span>

<span class="c"># Stop all services</span>
docker compose stop

<span class="c"># Stop specific services</span>
docker compose stop service1 service2

<span class="c"># Stop and remove containers, networks, and volumes</span>
docker compose down

<span class="c"># Remove everything including volumes (destructive!)</span>
docker compose down <span class="nt">-v</span>

<span class="c"># Remove everything including images</span>
docker compose down <span class="nt">--rmi</span> all
</code></pre></div></div>

<h4 id="build-and-rebuild-operations">Build and Rebuild Operations</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Build or rebuild services</span>
docker compose build

<span class="c"># Build specific service</span>
docker compose build service-name

<span class="c"># Build with no cache (clean build)</span>
docker compose build <span class="nt">--no-cache</span>

<span class="c"># Build with progress output</span>
docker compose build <span class="nt">--progress</span><span class="o">=</span>plain

<span class="c"># Pull latest images before building</span>
docker compose build <span class="nt">--pull</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="monitoring-and-debugging-commands">Monitoring and Debugging Commands</h3>

<h4 id="container-status-and-logs">Container Status and Logs</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># List running containers</span>
docker compose ps

<span class="c"># List all containers (including stopped)</span>
docker compose ps <span class="nt">-a</span>

<span class="c"># Show container resource usage</span>
docker compose top

<span class="c"># View logs from all services</span>
docker compose logs

<span class="c"># Follow logs in real-time (like tail -f)</span>
docker compose logs <span class="nt">-f</span>

<span class="c"># View logs for specific service</span>
docker compose logs <span class="nt">-f</span> service-name

<span class="c"># View last N lines of logs</span>
docker compose logs <span class="nt">--tail</span><span class="o">=</span>100 service-name

<span class="c"># Show timestamps in logs</span>
docker compose logs <span class="nt">-t</span> service-name
</code></pre></div></div>

<h4 id="container-interaction">Container Interaction</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Execute command in running container</span>
docker compose <span class="nb">exec </span>service-name <span class="nb">command</span>

<span class="c"># Start interactive bash session</span>
docker compose <span class="nb">exec </span>service-name bash

<span class="c"># Execute command as specific user</span>
docker compose <span class="nb">exec</span> <span class="nt">--user</span> root service-name bash

<span class="c"># Run one-off command in new container</span>
docker compose run service-name <span class="nb">command</span>

<span class="c"># Run command without dependencies</span>
docker compose run <span class="nt">--no-deps</span> service-name <span class="nb">command</span>

<span class="c"># Run command and remove container after execution</span>
docker compose run <span class="nt">--rm</span> service-name <span class="nb">command</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="advanced-management-commands">Advanced Management Commands</h3>

<h4 id="configuration-and-validation">Configuration and Validation</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Validate docker-compose.yml syntax</span>
docker compose config

<span class="c"># View the actual configuration that will be used</span>
docker compose config <span class="nt">--services</span>

<span class="c"># Show only service names</span>
docker compose config <span class="nt">--services</span>

<span class="c"># Resolve environment variables and show final config</span>
docker compose config <span class="nt">--resolve-env-vars</span>

<span class="c"># Check for configuration errors</span>
docker compose config <span class="nt">--quiet</span>
</code></pre></div></div>

<h4 id="service-scaling-and-updates">Service Scaling and Updates</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Scale service to specific number of replicas</span>
docker compose up <span class="nt">--scale</span> service-name<span class="o">=</span>3

<span class="c"># Update service configuration without downtime</span>
docker compose up <span class="nt">-d</span> <span class="nt">--no-deps</span> service-name

<span class="c"># Restart specific services</span>
docker compose restart service-name

<span class="c"># Restart all services</span>
docker compose restart

<span class="c"># Pause/unpause services</span>
docker compose pause service-name
docker compose unpause service-name
</code></pre></div></div>

<p><br /></p>

<hr />

<h2 id="yaml-configuration-deep-dive">YAML Configuration Deep Dive</h2>

<p>Master the docker-compose.yml file structure for complex application architectures.</p>

<p><br /></p>

<h3 id="basic-compose-file-structure">Basic Compose File Structure</h3>

<h4 id="standard-web-application-stack">Standard Web Application Stack</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="c1"># Database service</span>
  <span class="na">database</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">postgres:15-alpine</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">app_database</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">POSTGRES_DB</span><span class="pi">:</span> <span class="s">${DB_NAME:-myapp}</span>
      <span class="na">POSTGRES_USER</span><span class="pi">:</span> <span class="s">${DB_USER:-postgres}</span>
      <span class="na">POSTGRES_PASSWORD</span><span class="pi">:</span> <span class="s">${DB_PASSWORD:-secret}</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">postgres_data:/var/lib/postgresql/data</span>
      <span class="pi">-</span> <span class="s">./init-scripts:/docker-entrypoint-initdb.d</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">${DB_PORT:-5432}:5432"</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">backend</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD-SHELL"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">pg_isready</span><span class="nv"> </span><span class="s">-U</span><span class="nv"> </span><span class="s">${DB_USER:-postgres}"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">30s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">10s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">3</span>
      <span class="na">start_period</span><span class="pi">:</span> <span class="s">60s</span>

  <span class="c1"># Redis cache service</span>
  <span class="na">cache</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis:7-alpine</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">app_cache</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s">redis-server --appendonly yes --requirepass ${REDIS_PASSWORD:-cache_secret}</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">redis_data:/data</span>
      <span class="pi">-</span> <span class="s">./redis.conf:/usr/local/etc/redis/redis.conf</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">${REDIS_PORT:-6379}:6379"</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">backend</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">redis-cli"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">--raw"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">incr"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">ping"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">30s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">3s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">5</span>

  <span class="c1"># Application service</span>
  <span class="na">app</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">./app</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">Dockerfile</span>
      <span class="na">args</span><span class="pi">:</span>
        <span class="na">BUILD_ENV</span><span class="pi">:</span> <span class="s">${NODE_ENV:-development}</span>
        <span class="na">APP_VERSION</span><span class="pi">:</span> <span class="s">${APP_VERSION:-latest}</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">app_backend</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">NODE_ENV</span><span class="pi">:</span> <span class="s">${NODE_ENV:-development}</span>
      <span class="na">DATABASE_URL</span><span class="pi">:</span> <span class="s">postgres://${DB_USER:-postgres}:${DB_PASSWORD:-secret}@database:5432/${DB_NAME:-myapp}</span>
      <span class="na">REDIS_URL</span><span class="pi">:</span> <span class="s">redis://cache:6379</span>
      <span class="na">JWT_SECRET</span><span class="pi">:</span> <span class="s">${JWT_SECRET:-your-jwt-secret}</span>
      <span class="na">API_PORT</span><span class="pi">:</span> <span class="m">3000</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./app:/usr/src/app</span>
      <span class="pi">-</span> <span class="s">/usr/src/app/node_modules</span>
      <span class="pi">-</span> <span class="s">app_uploads:/usr/src/app/uploads</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">${APP_PORT:-3000}:3000"</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="na">database</span><span class="pi">:</span>
        <span class="na">condition</span><span class="pi">:</span> <span class="s">service_healthy</span>
      <span class="na">cache</span><span class="pi">:</span>
        <span class="na">condition</span><span class="pi">:</span> <span class="s">service_healthy</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">frontend</span>
      <span class="pi">-</span> <span class="s">backend</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">curl"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-f"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">http://localhost:3000/health"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">30s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">10s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">3</span>
      <span class="na">start_period</span><span class="pi">:</span> <span class="s">120s</span>

  <span class="c1"># Nginx reverse proxy</span>
  <span class="na">nginx</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:alpine</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">app_nginx</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./nginx/nginx.conf:/etc/nginx/nginx.conf:ro</span>
      <span class="pi">-</span> <span class="s">./nginx/sites-enabled:/etc/nginx/sites-enabled:ro</span>
      <span class="pi">-</span> <span class="s">./static:/usr/share/nginx/html:ro</span>
      <span class="pi">-</span> <span class="s">nginx_logs:/var/log/nginx</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">${HTTP_PORT:-80}:80"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">${HTTPS_PORT:-443}:443"</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">app</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">frontend</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">curl"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-f"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">http://localhost/health"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">30s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">10s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">3</span>

<span class="c1"># Network definitions</span>
<span class="na">networks</span><span class="pi">:</span>
  <span class="na">frontend</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">app_frontend</span>
  <span class="na">backend</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">app_backend</span>
    <span class="na">internal</span><span class="pi">:</span> <span class="no">true</span>  <span class="c1"># Backend network is isolated</span>

<span class="c1"># Volume definitions</span>
<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">postgres_data</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">local</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">app_postgres_data</span>
  <span class="na">redis_data</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">local</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">app_redis_data</span>
  <span class="na">app_uploads</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">local</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">app_uploads</span>
  <span class="na">nginx_logs</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">local</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">app_nginx_logs</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="advanced-configuration-patterns">Advanced Configuration Patterns</h3>

<h4 id="microservices-architecture-example">Microservices Architecture Example</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="c1"># API Gateway</span>
  <span class="na">api-gateway</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">./api-gateway</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">Dockerfile</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">SERVICES_USER=user-service:3001</span>
      <span class="pi">-</span> <span class="s">SERVICES_ORDER=order-service:3002</span>
      <span class="pi">-</span> <span class="s">SERVICES_PAYMENT=payment-service:3003</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">8080:8080"</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">user-service</span>
      <span class="pi">-</span> <span class="s">order-service</span>
      <span class="pi">-</span> <span class="s">payment-service</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">api-network</span>

  <span class="c1"># User microservice</span>
  <span class="na">user-service</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">./services/user</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">Dockerfile</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">DB_HOST=user-db</span>
      <span class="pi">-</span> <span class="s">DB_PORT=5432</span>
      <span class="pi">-</span> <span class="s">DB_NAME=users</span>
      <span class="pi">-</span> <span class="s">JWT_SECRET=${JWT_SECRET}</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="na">user-db</span><span class="pi">:</span>
        <span class="na">condition</span><span class="pi">:</span> <span class="s">service_healthy</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">api-network</span>
      <span class="pi">-</span> <span class="s">user-network</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">replicas</span><span class="pi">:</span> <span class="m">2</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">limits</span><span class="pi">:</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">512M</span>
        <span class="na">reservations</span><span class="pi">:</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">256M</span>

  <span class="na">user-db</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">postgres:15-alpine</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">POSTGRES_DB</span><span class="pi">:</span> <span class="s">users</span>
      <span class="na">POSTGRES_USER</span><span class="pi">:</span> <span class="s">${USER_DB_USER}</span>
      <span class="na">POSTGRES_PASSWORD</span><span class="pi">:</span> <span class="s">${USER_DB_PASSWORD}</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">user_db_data:/var/lib/postgresql/data</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">user-network</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD-SHELL"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">pg_isready</span><span class="nv"> </span><span class="s">-U</span><span class="nv"> </span><span class="s">${USER_DB_USER}"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">30s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">10s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">3</span>

  <span class="c1"># Order microservice</span>
  <span class="na">order-service</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">./services/order</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">Dockerfile</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">DB_HOST=order-db</span>
      <span class="pi">-</span> <span class="s">MESSAGE_QUEUE_URL=amqp://rabbitmq:5672</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">order-db</span>
      <span class="pi">-</span> <span class="s">rabbitmq</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">api-network</span>
      <span class="pi">-</span> <span class="s">order-network</span>
      <span class="pi">-</span> <span class="s">message-network</span>

  <span class="na">order-db</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">mongodb/mongodb-community-server:latest</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">MONGODB_INITDB_ROOT_USERNAME</span><span class="pi">:</span> <span class="s">${MONGO_USER}</span>
      <span class="na">MONGODB_INITDB_ROOT_PASSWORD</span><span class="pi">:</span> <span class="s">${MONGO_PASSWORD}</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">order_db_data:/data/db</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">order-network</span>

  <span class="c1"># Payment microservice</span>
  <span class="na">payment-service</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">./services/payment</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">Dockerfile</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">PAYMENT_PROVIDER_API_KEY=${PAYMENT_API_KEY}</span>
      <span class="pi">-</span> <span class="s">MESSAGE_QUEUE_URL=amqp://rabbitmq:5672</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">rabbitmq</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">api-network</span>
      <span class="pi">-</span> <span class="s">message-network</span>
    <span class="na">secrets</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">payment_api_key</span>

  <span class="c1"># Message queue</span>
  <span class="na">rabbitmq</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">rabbitmq:3-management-alpine</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">RABBITMQ_DEFAULT_USER</span><span class="pi">:</span> <span class="s">${RABBITMQ_USER}</span>
      <span class="na">RABBITMQ_DEFAULT_PASS</span><span class="pi">:</span> <span class="s">${RABBITMQ_PASSWORD}</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">rabbitmq_data:/var/lib/rabbitmq</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">15672:15672"</span>  <span class="c1"># Management interface</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">message-network</span>

  <span class="c1"># Monitoring and logging</span>
  <span class="na">prometheus</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">prom/prometheus:latest</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml</span>
      <span class="pi">-</span> <span class="s">prometheus_data:/prometheus</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">9090:9090"</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">monitoring-network</span>

  <span class="na">grafana</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">grafana/grafana:latest</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_PASSWORD}</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">grafana_data:/var/lib/grafana</span>
      <span class="pi">-</span> <span class="s">./monitoring/dashboards:/etc/grafana/provisioning/dashboards</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">3001:3000"</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">prometheus</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">monitoring-network</span>

<span class="na">networks</span><span class="pi">:</span>
  <span class="na">api-network</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span>
  <span class="na">user-network</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span>
    <span class="na">internal</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">order-network</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span>
    <span class="na">internal</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">message-network</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span>
    <span class="na">internal</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">monitoring-network</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">user_db_data</span><span class="pi">:</span>
  <span class="na">order_db_data</span><span class="pi">:</span>
  <span class="na">rabbitmq_data</span><span class="pi">:</span>
  <span class="na">prometheus_data</span><span class="pi">:</span>
  <span class="na">grafana_data</span><span class="pi">:</span>

<span class="na">secrets</span><span class="pi">:</span>
  <span class="na">payment_api_key</span><span class="pi">:</span>
    <span class="na">file</span><span class="pi">:</span> <span class="s">./secrets/payment_api_key.txt</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="development-optimized-configuration">Development-Optimized Configuration</h3>

<h4 id="hot-reload-and-development-tools">Hot Reload and Development Tools</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="c1"># Development API with hot reload</span>
  <span class="na">api-dev</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">./api</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">Dockerfile.dev</span>
      <span class="na">target</span><span class="pi">:</span> <span class="s">development</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">NODE_ENV=development</span>
      <span class="pi">-</span> <span class="s">DEBUG=app:*</span>
      <span class="pi">-</span> <span class="s">DATABASE_URL=postgres://dev:dev@postgres:5432/dev_db</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./api:/app</span>
      <span class="pi">-</span> <span class="s">/app/node_modules</span>
      <span class="pi">-</span> <span class="s">api_logs:/app/logs</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">3000:3000"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">9229:9229"</span>  <span class="c1"># Node.js debugger port</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">postgres</span>
      <span class="pi">-</span> <span class="s">redis</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">dev-network</span>
    <span class="na">develop</span><span class="pi">:</span>
      <span class="na">watch</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">action</span><span class="pi">:</span> <span class="s">sync</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">./api/src</span>
          <span class="na">target</span><span class="pi">:</span> <span class="s">/app/src</span>
        <span class="pi">-</span> <span class="na">action</span><span class="pi">:</span> <span class="s">rebuild</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">./api/package.json</span>
          <span class="na">target</span><span class="pi">:</span> <span class="s">/app/package.json</span>

  <span class="c1"># Frontend development server</span>
  <span class="na">frontend-dev</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">./frontend</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">Dockerfile.dev</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">VITE_API_URL=http://localhost:3000</span>
      <span class="pi">-</span> <span class="s">VITE_HOT_RELOAD=true</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./frontend:/app</span>
      <span class="pi">-</span> <span class="s">/app/node_modules</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">5173:5173"</span>  <span class="c1"># Vite dev server</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">dev-network</span>
    <span class="na">develop</span><span class="pi">:</span>
      <span class="na">watch</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">action</span><span class="pi">:</span> <span class="s">sync+restart</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">./frontend/src</span>
          <span class="na">target</span><span class="pi">:</span> <span class="s">/app/src</span>

  <span class="c1"># Development database with initialization</span>
  <span class="na">postgres</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">postgres:15-alpine</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">POSTGRES_DB</span><span class="pi">:</span> <span class="s">dev_db</span>
      <span class="na">POSTGRES_USER</span><span class="pi">:</span> <span class="s">dev</span>
      <span class="na">POSTGRES_PASSWORD</span><span class="pi">:</span> <span class="s">dev</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">postgres_dev_data:/var/lib/postgresql/data</span>
      <span class="pi">-</span> <span class="s">./database/init:/docker-entrypoint-initdb.d</span>
      <span class="pi">-</span> <span class="s">./database/dev-data:/dev-data</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">5432:5432"</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">dev-network</span>

  <span class="c1"># Redis for development</span>
  <span class="na">redis</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis:7-alpine</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">6379:6379"</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">dev-network</span>

  <span class="c1"># Development tools</span>
  <span class="na">mailhog</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">mailhog/mailhog:latest</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">1025:1025"</span>  <span class="c1"># SMTP server</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">8025:8025"</span>  <span class="c1"># Web interface</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">dev-network</span>

  <span class="c1"># Database administration tool</span>
  <span class="na">pgadmin</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">dpage/pgadmin4:latest</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">PGADMIN_DEFAULT_EMAIL</span><span class="pi">:</span> <span class="s">admin@dev.local</span>
      <span class="na">PGADMIN_DEFAULT_PASSWORD</span><span class="pi">:</span> <span class="s">admin</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">8080:80"</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">postgres</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">dev-network</span>

<span class="na">networks</span><span class="pi">:</span>
  <span class="na">dev-network</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">dev_network</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">postgres_dev_data</span><span class="pi">:</span>
  <span class="na">api_logs</span><span class="pi">:</span>
</code></pre></div></div>

<p><br /></p>

<hr />

<h2 id="environment-management-and-configuration">Environment Management and Configuration</h2>

<p>Implement flexible environment-specific configurations for different deployment scenarios.</p>

<p><br /></p>

<h3 id="environment-variables-and-env-files">Environment Variables and .env Files</h3>

<h4 id="comprehensive-env-configuration">Comprehensive .env Configuration</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># .env file - Default development configuration</span>

<span class="c"># Application Settings</span>
<span class="nv">APP_NAME</span><span class="o">=</span>MyApplication
<span class="nv">APP_VERSION</span><span class="o">=</span>1.0.0
<span class="nv">NODE_ENV</span><span class="o">=</span>development
<span class="nv">APP_DEBUG</span><span class="o">=</span><span class="nb">true
</span><span class="nv">APP_PORT</span><span class="o">=</span>3000

<span class="c"># Database Configuration</span>
<span class="nv">DB_CONNECTION</span><span class="o">=</span>postgres
<span class="nv">DB_HOST</span><span class="o">=</span>database
<span class="nv">DB_PORT</span><span class="o">=</span>5432
<span class="nv">DB_NAME</span><span class="o">=</span>myapp_dev
<span class="nv">DB_USER</span><span class="o">=</span>postgres
<span class="nv">DB_PASSWORD</span><span class="o">=</span>dev_secret_123
<span class="nv">DATABASE_URL</span><span class="o">=</span>postgres://<span class="k">${</span><span class="nv">DB_USER</span><span class="k">}</span>:<span class="k">${</span><span class="nv">DB_PASSWORD</span><span class="k">}</span>@<span class="k">${</span><span class="nv">DB_HOST</span><span class="k">}</span>:<span class="k">${</span><span class="nv">DB_PORT</span><span class="k">}</span>/<span class="k">${</span><span class="nv">DB_NAME</span><span class="k">}</span>

<span class="c"># Redis Configuration</span>
<span class="nv">REDIS_HOST</span><span class="o">=</span>cache
<span class="nv">REDIS_PORT</span><span class="o">=</span>6379
<span class="nv">REDIS_PASSWORD</span><span class="o">=</span>redis_secret_456
<span class="nv">REDIS_URL</span><span class="o">=</span>redis://:<span class="k">${</span><span class="nv">REDIS_PASSWORD</span><span class="k">}</span>@<span class="k">${</span><span class="nv">REDIS_HOST</span><span class="k">}</span>:<span class="k">${</span><span class="nv">REDIS_PORT</span><span class="k">}</span>

<span class="c"># Security Settings</span>
<span class="nv">JWT_SECRET</span><span class="o">=</span>your-super-secret-jwt-key-change-in-production
<span class="nv">JWT_EXPIRES_IN</span><span class="o">=</span>7d
<span class="nv">SESSION_SECRET</span><span class="o">=</span>session-secret-key
<span class="nv">ENCRYPTION_KEY</span><span class="o">=</span>32-character-encryption-key-here

<span class="c"># External Services</span>
<span class="nv">STRIPE_PUBLIC_KEY</span><span class="o">=</span>pk_test_xxxxxxxxxxxxx
<span class="nv">STRIPE_SECRET_KEY</span><span class="o">=</span>sk_test_xxxxxxxxxxxxx
<span class="nv">SENDGRID_API_KEY</span><span class="o">=</span>SG.xxxxxxxxxxxxx
<span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span>AKIAXXXXXXXXXXXXX
<span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span>xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
<span class="nv">AWS_REGION</span><span class="o">=</span>us-east-1
<span class="nv">AWS_S3_BUCKET</span><span class="o">=</span>my-app-uploads

<span class="c"># Feature Flags</span>
<span class="nv">FEATURE_NEW_UI</span><span class="o">=</span><span class="nb">true
</span><span class="nv">FEATURE_ANALYTICS</span><span class="o">=</span><span class="nb">false
</span><span class="nv">FEATURE_BETA_FEATURES</span><span class="o">=</span><span class="nb">true</span>

<span class="c"># Monitoring and Logging</span>
<span class="nv">LOG_LEVEL</span><span class="o">=</span>debug
<span class="nv">SENTRY_DSN</span><span class="o">=</span>https://xxxxxxxxxxxxx@sentry.io/xxxxxxx
<span class="nv">NEW_RELIC_LICENSE_KEY</span><span class="o">=</span>xxxxxxxxxxxxx

<span class="c"># Development Tools</span>
<span class="nv">HOT_RELOAD</span><span class="o">=</span><span class="nb">true
</span><span class="nv">DEBUG_MODE</span><span class="o">=</span><span class="nb">true
</span><span class="nv">MOCK_EXTERNAL_SERVICES</span><span class="o">=</span><span class="nb">true</span>
</code></pre></div></div>

<h4 id="environment-specific-override-files">Environment-Specific Override Files</h4>

<p><strong>Production Environment (.env.production)</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># .env.production - Production overrides</span>

<span class="nv">NODE_ENV</span><span class="o">=</span>production
<span class="nv">APP_DEBUG</span><span class="o">=</span><span class="nb">false
</span><span class="nv">LOG_LEVEL</span><span class="o">=</span>info

<span class="c"># Secure production database</span>
<span class="nv">DB_HOST</span><span class="o">=</span>prod-db.company.com
<span class="nv">DB_NAME</span><span class="o">=</span>myapp_production
<span class="nv">DB_USER</span><span class="o">=</span>prod_user
<span class="nv">DB_PASSWORD</span><span class="o">=</span><span class="k">${</span><span class="nv">PROD_DB_PASSWORD</span><span class="k">}</span>  <span class="c"># Set via CI/CD secrets</span>

<span class="c"># Production Redis cluster</span>
<span class="nv">REDIS_HOST</span><span class="o">=</span>prod-redis-cluster.company.com
<span class="nv">REDIS_PASSWORD</span><span class="o">=</span><span class="k">${</span><span class="nv">PROD_REDIS_PASSWORD</span><span class="k">}</span>

<span class="c"># Production security</span>
<span class="nv">JWT_SECRET</span><span class="o">=</span><span class="k">${</span><span class="nv">PROD_JWT_SECRET</span><span class="k">}</span>
<span class="nv">SESSION_SECRET</span><span class="o">=</span><span class="k">${</span><span class="nv">PROD_SESSION_SECRET</span><span class="k">}</span>

<span class="c"># Production services</span>
<span class="nv">STRIPE_PUBLIC_KEY</span><span class="o">=</span><span class="k">${</span><span class="nv">PROD_STRIPE_PUBLIC_KEY</span><span class="k">}</span>
<span class="nv">STRIPE_SECRET_KEY</span><span class="o">=</span><span class="k">${</span><span class="nv">PROD_STRIPE_SECRET_KEY</span><span class="k">}</span>

<span class="c"># Feature flags for production</span>
<span class="nv">FEATURE_BETA_FEATURES</span><span class="o">=</span><span class="nb">false
</span><span class="nv">MOCK_EXTERNAL_SERVICES</span><span class="o">=</span><span class="nb">false</span>

<span class="c"># Production monitoring</span>
<span class="nv">SENTRY_DSN</span><span class="o">=</span><span class="k">${</span><span class="nv">PROD_SENTRY_DSN</span><span class="k">}</span>
<span class="nv">NEW_RELIC_LICENSE_KEY</span><span class="o">=</span><span class="k">${</span><span class="nv">PROD_NEW_RELIC_KEY</span><span class="k">}</span>
</code></pre></div></div>

<p><strong>Testing Environment (.env.test)</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># .env.test - Testing configuration</span>

<span class="nv">NODE_ENV</span><span class="o">=</span><span class="nb">test
</span><span class="nv">APP_DEBUG</span><span class="o">=</span><span class="nb">true
</span><span class="nv">LOG_LEVEL</span><span class="o">=</span>warn

<span class="c"># Test database (typically in-memory or isolated)</span>
<span class="nv">DB_NAME</span><span class="o">=</span>myapp_test
<span class="nv">DB_USER</span><span class="o">=</span>test_user
<span class="nv">DB_PASSWORD</span><span class="o">=</span>test_pass

<span class="c"># Mock external services for testing</span>
<span class="nv">MOCK_EXTERNAL_SERVICES</span><span class="o">=</span><span class="nb">true
</span><span class="nv">STRIPE_SECRET_KEY</span><span class="o">=</span>sk_test_mock
<span class="nv">SENDGRID_API_KEY</span><span class="o">=</span>test_key

<span class="c"># Fast test execution</span>
<span class="nv">FEATURE_ANALYTICS</span><span class="o">=</span><span class="nb">false
</span><span class="nv">FEATURE_NEW_UI</span><span class="o">=</span><span class="nb">true</span>

<span class="c"># Test-specific settings</span>
<span class="nv">TEST_TIMEOUT</span><span class="o">=</span>30000
<span class="nv">PARALLEL_TEST_WORKERS</span><span class="o">=</span>4
</code></pre></div></div>

<p><br /></p>

<h3 id="advanced-environment-variable-usage">Advanced Environment Variable Usage</h3>

<h4 id="dynamic-configuration-in-compose">Dynamic Configuration in Compose</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">app</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">myapp:${APP_VERSION:-latest}</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="c1"># Direct environment variable assignment</span>
      <span class="pi">-</span> <span class="s">NODE_ENV=${NODE_ENV:-development}</span>
      <span class="pi">-</span> <span class="s">APP_PORT=${APP_PORT:-3000}</span>
      
      <span class="c1"># Computed environment variables</span>
      <span class="pi">-</span> <span class="s">DATABASE_URL=postgres://${DB_USER}:${DB_PASSWORD}@${DB_HOST}:${DB_PORT}/${DB_NAME}</span>
      <span class="pi">-</span> <span class="s">REDIS_URL=redis://:${REDIS_PASSWORD}@${REDIS_HOST}:${REDIS_PORT}</span>
      
      <span class="c1"># Environment-specific feature flags</span>
      <span class="pi">-</span> <span class="s">FEATURE_DEBUG=${NODE_ENV:-development == 'development' ? 'true'</span> <span class="err">:</span> <span class="s1">'</span><span class="s">false'</span><span class="err">}</span>
      
      <span class="c1"># External file references</span>
      <span class="pi">-</span> <span class="s">AWS_CREDENTIALS_FILE=/run/secrets/aws_credentials</span>
    
    <span class="c1"># Environment file precedence (later files override earlier ones)</span>
    <span class="na">env_file</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">.env</span>                    <span class="c1"># Base configuration</span>
      <span class="pi">-</span> <span class="s">.env.${NODE_ENV:-dev}</span>   <span class="c1"># Environment-specific overrides</span>
      <span class="pi">-</span> <span class="s">.env.local</span>              <span class="c1"># Local developer overrides (git-ignored)</span>
    
    <span class="c1"># Secret management</span>
    <span class="na">secrets</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">source</span><span class="pi">:</span> <span class="s">aws_credentials</span>
        <span class="na">target</span><span class="pi">:</span> <span class="s">/run/secrets/aws_credentials</span>
        <span class="na">mode</span><span class="pi">:</span> <span class="m">0400</span>

<span class="na">secrets</span><span class="pi">:</span>
  <span class="na">aws_credentials</span><span class="pi">:</span>
    <span class="na">file</span><span class="pi">:</span> <span class="s">./secrets/aws_credentials.json</span>
</code></pre></div></div>

<h4 id="environment-variable-validation">Environment Variable Validation</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># docker-compose.yml with validation</span>
<span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">app</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span> <span class="s">.</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">NODE_ENV=${NODE_ENV:?NODE_ENV is required}</span>
      <span class="pi">-</span> <span class="s">DATABASE_URL=${DATABASE_URL:?DATABASE_URL is required}</span>
      <span class="pi">-</span> <span class="s">JWT_SECRET=${JWT_SECRET:?JWT_SECRET must be set for security}</span>
      <span class="pi">-</span> <span class="s">API_KEY=${API_KEY:?API_KEY is required for external service integration}</span>
    
    <span class="c1"># Health check that validates configuration</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">node"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">scripts/health-check.js"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">30s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">10s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">3</span>
      <span class="na">start_period</span><span class="pi">:</span> <span class="s">60s</span>
</code></pre></div></div>

<p><br /></p>

<hr />

<h2 id="override-files-and-multi-environment-support">Override Files and Multi-Environment Support</h2>

<p>Manage different environments efficiently using Docker Compose override mechanisms.</p>

<p><br /></p>

<h3 id="override-file-hierarchy">Override File Hierarchy</h3>

<h4 id="base-configuration-docker-composeyml">Base Configuration (docker-compose.yml)</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># docker-compose.yml - Base configuration for all environments</span>
<span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">app</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">Dockerfile</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">NODE_ENV=${NODE_ENV:-development}</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./src:/app/src</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">app-network</span>

  <span class="na">database</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">postgres:15-alpine</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">POSTGRES_DB=${DB_NAME}</span>
      <span class="pi">-</span> <span class="s">POSTGRES_USER=${DB_USER}</span>
      <span class="pi">-</span> <span class="s">POSTGRES_PASSWORD=${DB_PASSWORD}</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">db_data:/var/lib/postgresql/data</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">app-network</span>

<span class="na">networks</span><span class="pi">:</span>
  <span class="na">app-network</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">db_data</span><span class="pi">:</span>
</code></pre></div></div>

<h4 id="development-override-docker-composeoverrideyml">Development Override (docker-compose.override.yml)</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># docker-compose.override.yml - Automatically applied in development</span>
<span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">app</span><span class="pi">:</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">3000:3000"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">9229:9229"</span>  <span class="c1"># Debug port</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">DEBUG=app:*</span>
      <span class="pi">-</span> <span class="s">HOT_RELOAD=true</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./src:/app/src:cached</span>      <span class="c1"># Optimized for development</span>
      <span class="pi">-</span> <span class="s">/app/node_modules</span>          <span class="c1"># Prevent overwriting</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s">npm run dev</span>
    <span class="na">develop</span><span class="pi">:</span>
      <span class="na">watch</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">action</span><span class="pi">:</span> <span class="s">sync</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">./src</span>
          <span class="na">target</span><span class="pi">:</span> <span class="s">/app/src</span>
        <span class="pi">-</span> <span class="na">action</span><span class="pi">:</span> <span class="s">rebuild</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">package.json</span>

  <span class="na">database</span><span class="pi">:</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">5432:5432"</span>  <span class="c1"># Expose database for development tools</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">POSTGRES_DB=myapp_dev</span>
      <span class="pi">-</span> <span class="s">POSTGRES_USER=dev</span>
      <span class="pi">-</span> <span class="s">POSTGRES_PASSWORD=dev</span>

  <span class="c1"># Development-only services</span>
  <span class="na">pgadmin</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">dpage/pgadmin4:latest</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">PGADMIN_DEFAULT_EMAIL=admin@dev.local</span>
      <span class="pi">-</span> <span class="s">PGADMIN_DEFAULT_PASSWORD=admin</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">8080:80"</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">database</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">app-network</span>

  <span class="na">mailhog</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">mailhog/mailhog:latest</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">1025:1025"</span>  <span class="c1"># SMTP</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">8025:8025"</span>  <span class="c1"># Web interface</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">app-network</span>
</code></pre></div></div>

<h4 id="production-override-docker-composeprodyml">Production Override (docker-compose.prod.yml)</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># docker-compose.prod.yml - Production-specific configuration</span>
<span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">app</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">Dockerfile.prod</span>
      <span class="na">target</span><span class="pi">:</span> <span class="s">production</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">replicas</span><span class="pi">:</span> <span class="m">3</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">limits</span><span class="pi">:</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">1G</span>
          <span class="na">cpus</span><span class="pi">:</span> <span class="s1">'</span><span class="s">0.5'</span>
        <span class="na">reservations</span><span class="pi">:</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">512M</span>
          <span class="na">cpus</span><span class="pi">:</span> <span class="s1">'</span><span class="s">0.25'</span>
      <span class="na">update_config</span><span class="pi">:</span>
        <span class="na">parallelism</span><span class="pi">:</span> <span class="m">1</span>
        <span class="na">delay</span><span class="pi">:</span> <span class="s">10s</span>
        <span class="na">order</span><span class="pi">:</span> <span class="s">start-first</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">NODE_ENV=production</span>
      <span class="pi">-</span> <span class="s">LOG_LEVEL=info</span>
    <span class="c1"># Remove development volumes</span>
    <span class="na">volumes</span><span class="pi">:</span> <span class="pi">[]</span>
    <span class="c1"># Production command</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s">npm start</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">curl"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-f"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">http://localhost:3000/health"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">30s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">10s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">3</span>
      <span class="na">start_period</span><span class="pi">:</span> <span class="s">60s</span>

  <span class="na">database</span><span class="pi">:</span>
    <span class="c1"># Production database configuration</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">limits</span><span class="pi">:</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">2G</span>
          <span class="na">cpus</span><span class="pi">:</span> <span class="s1">'</span><span class="s">1.0'</span>
    <span class="c1"># Remove development port exposure</span>
    <span class="na">ports</span><span class="pi">:</span> <span class="pi">[]</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">POSTGRES_DB=${PROD_DB_NAME}</span>
      <span class="pi">-</span> <span class="s">POSTGRES_USER=${PROD_DB_USER}</span>
      <span class="pi">-</span> <span class="s">POSTGRES_PASSWORD=${PROD_DB_PASSWORD}</span>
    
    <span class="c1"># Production volume with backup configuration</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">prod_db_data:/var/lib/postgresql/data</span>
      <span class="pi">-</span> <span class="s">./backups:/backups</span>

  <span class="c1"># Production-specific services</span>
  <span class="na">nginx</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:alpine</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">80:80"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">443:443"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./nginx/prod.conf:/etc/nginx/nginx.conf:ro</span>
      <span class="pi">-</span> <span class="s">./ssl:/etc/nginx/ssl:ro</span>
      <span class="pi">-</span> <span class="s">./static:/usr/share/nginx/html:ro</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">app</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">app-network</span>

  <span class="c1"># Log aggregation</span>
  <span class="na">fluentd</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">fluent/fluentd:latest</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./fluentd/conf:/fluentd/etc</span>
      <span class="pi">-</span> <span class="s">./logs:/fluentd/log</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">app-network</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">prod_db_data</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">local</span>
    <span class="na">driver_opts</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">none</span>
      <span class="na">o</span><span class="pi">:</span> <span class="s">bind</span>
      <span class="na">device</span><span class="pi">:</span> <span class="s">/opt/app/data/postgres</span>
</code></pre></div></div>

<h4 id="testing-override-docker-composetestyml">Testing Override (docker-compose.test.yml)</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># docker-compose.test.yml - Testing environment configuration</span>
<span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">app</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">Dockerfile.test</span>
      <span class="na">target</span><span class="pi">:</span> <span class="s">test</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">NODE_ENV=test</span>
      <span class="pi">-</span> <span class="s">CI=true</span>
      <span class="pi">-</span> <span class="s">COVERAGE=true</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s">npm run test:ci</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./coverage:/app/coverage</span>
      <span class="pi">-</span> <span class="s">./test-results:/app/test-results</span>

  <span class="na">database</span><span class="pi">:</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">POSTGRES_DB=myapp_test</span>
      <span class="pi">-</span> <span class="s">POSTGRES_USER=test</span>
      <span class="pi">-</span> <span class="s">POSTGRES_PASSWORD=test</span>
    <span class="na">tmpfs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/var/lib/postgresql/data</span>  <span class="c1"># In-memory database for faster tests</span>

  <span class="c1"># Test dependencies</span>
  <span class="na">test-db</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">postgres:15-alpine</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">POSTGRES_DB=test_db</span>
      <span class="pi">-</span> <span class="s">POSTGRES_USER=test</span>
      <span class="pi">-</span> <span class="s">POSTGRES_PASSWORD=test</span>
    <span class="na">tmpfs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/var/lib/postgresql/data</span>

  <span class="c1"># Mock external services</span>
  <span class="na">mock-api</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">wiremock/wiremock:latest</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">8081:8080"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./test/mocks:/home/wiremock</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">app-network</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="environment-specific-usage-commands">Environment-Specific Usage Commands</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Development (uses docker-compose.override.yml automatically)</span>
docker compose up <span class="nt">-d</span>

<span class="c"># Production deployment</span>
docker compose <span class="nt">-f</span> docker-compose.yml <span class="nt">-f</span> docker-compose.prod.yml up <span class="nt">-d</span>

<span class="c"># Testing environment</span>
docker compose <span class="nt">-f</span> docker-compose.yml <span class="nt">-f</span> docker-compose.test.yml up <span class="nt">--abort-on-container-exit</span>

<span class="c"># Staging environment</span>
docker compose <span class="nt">-f</span> docker-compose.yml <span class="nt">-f</span> docker-compose.staging.yml up <span class="nt">-d</span>

<span class="c"># Local development with custom overrides</span>
docker compose <span class="nt">-f</span> docker-compose.yml <span class="nt">-f</span> docker-compose.override.yml <span class="nt">-f</span> docker-compose.local.yml up <span class="nt">-d</span>

<span class="c"># Multiple environment files (later files override earlier ones)</span>
docker compose <span class="nt">-f</span> docker-compose.yml <span class="nt">-f</span> docker-compose.prod.yml <span class="nt">-f</span> docker-compose.monitoring.yml up <span class="nt">-d</span>
</code></pre></div></div>

<p><br /></p>

<hr />

<h2 id="advanced-features-and-patterns">Advanced Features and Patterns</h2>

<p>Explore sophisticated Docker Compose capabilities for complex applications.</p>

<p><br /></p>

<h3 id="health-checks-and-dependency-management">Health Checks and Dependency Management</h3>

<h4 id="comprehensive-health-check-configuration">Comprehensive Health Check Configuration</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="c1"># Database with health check</span>
  <span class="na">postgres</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">postgres:15-alpine</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">POSTGRES_DB</span><span class="pi">:</span> <span class="s">myapp</span>
      <span class="na">POSTGRES_USER</span><span class="pi">:</span> <span class="s">user</span>
      <span class="na">POSTGRES_PASSWORD</span><span class="pi">:</span> <span class="s">password</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD-SHELL"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">pg_isready</span><span class="nv"> </span><span class="s">-U</span><span class="nv"> </span><span class="s">user</span><span class="nv"> </span><span class="s">-d</span><span class="nv"> </span><span class="s">myapp"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">30s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">10s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">5</span>
      <span class="na">start_period</span><span class="pi">:</span> <span class="s">60s</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">postgres_data:/var/lib/postgresql/data</span>

  <span class="c1"># Redis with health check</span>
  <span class="na">redis</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis:7-alpine</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">redis-cli"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">ping"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">30s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">3s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">5</span>
      <span class="na">start_period</span><span class="pi">:</span> <span class="s">30s</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">redis_data:/data</span>

  <span class="c1"># Application with sophisticated health check</span>
  <span class="na">app</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span> <span class="s">.</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">DATABASE_URL=postgres://user:password@postgres:5432/myapp</span>
      <span class="pi">-</span> <span class="s">REDIS_URL=redis://redis:6379</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="na">postgres</span><span class="pi">:</span>
        <span class="na">condition</span><span class="pi">:</span> <span class="s">service_healthy</span>
      <span class="na">redis</span><span class="pi">:</span>
        <span class="na">condition</span><span class="pi">:</span> <span class="s">service_healthy</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">curl"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-f"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">http://localhost:3000/health"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">30s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">10s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">3</span>
      <span class="na">start_period</span><span class="pi">:</span> <span class="s">120s</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">3000:3000"</span>

  <span class="c1"># Web server with dependency on app health</span>
  <span class="na">nginx</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:alpine</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span>
        <span class="na">condition</span><span class="pi">:</span> <span class="s">service_healthy</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">wget"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">--no-verbose"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">--tries=1"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">--spider"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">http://localhost/health"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">30s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">10s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">3</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">80:80"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./nginx.conf:/etc/nginx/nginx.conf</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">postgres_data</span><span class="pi">:</span>
  <span class="na">redis_data</span><span class="pi">:</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="watch-mode-and-live-development">Watch Mode and Live Development</h3>

<h4 id="advanced-watch-configuration">Advanced Watch Configuration</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="c1"># Frontend with hot module replacement</span>
  <span class="na">frontend</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">./frontend</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">Dockerfile.dev</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./frontend:/app</span>
      <span class="pi">-</span> <span class="s">/app/node_modules</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">3000:3000"</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">FAST_REFRESH=true</span>
      <span class="pi">-</span> <span class="s">CHOKIDAR_USEPOLLING=true</span>
    <span class="na">develop</span><span class="pi">:</span>
      <span class="na">watch</span><span class="pi">:</span>
        <span class="c1"># Sync JavaScript/TypeScript changes</span>
        <span class="pi">-</span> <span class="na">action</span><span class="pi">:</span> <span class="s">sync</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">./frontend/src</span>
          <span class="na">target</span><span class="pi">:</span> <span class="s">/app/src</span>
          <span class="na">ignore</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s2">"</span><span class="s">**/*.test.js"</span>
            <span class="pi">-</span> <span class="s2">"</span><span class="s">**/*.spec.ts"</span>
            
        <span class="c1"># Rebuild on package.json changes</span>
        <span class="pi">-</span> <span class="na">action</span><span class="pi">:</span> <span class="s">rebuild</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">./frontend/package.json</span>
          
        <span class="c1"># Sync configuration files</span>
        <span class="pi">-</span> <span class="na">action</span><span class="pi">:</span> <span class="s">sync+restart</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">./frontend/vite.config.js</span>
          <span class="na">target</span><span class="pi">:</span> <span class="s">/app/vite.config.js</span>

  <span class="c1"># Backend API with nodemon</span>
  <span class="na">api</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">./api</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">Dockerfile.dev</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./api:/app</span>
      <span class="pi">-</span> <span class="s">/app/node_modules</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">NODE_ENV=development</span>
    <span class="na">develop</span><span class="pi">:</span>
      <span class="na">watch</span><span class="pi">:</span>
        <span class="c1"># Sync source code changes</span>
        <span class="pi">-</span> <span class="na">action</span><span class="pi">:</span> <span class="s">sync+restart</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">./api/src</span>
          <span class="na">target</span><span class="pi">:</span> <span class="s">/app/src</span>
          
        <span class="c1"># Rebuild on dependency changes</span>
        <span class="pi">-</span> <span class="na">action</span><span class="pi">:</span> <span class="s">rebuild</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">./api/package.json</span>
          
        <span class="c1"># Sync environment configuration</span>
        <span class="pi">-</span> <span class="na">action</span><span class="pi">:</span> <span class="s">sync</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">./api/.env.development</span>
          <span class="na">target</span><span class="pi">:</span> <span class="s">/app/.env</span>

  <span class="c1"># Database migrations on schema changes</span>
  <span class="na">migrator</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">./api</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">Dockerfile.dev</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s">npm run migrate:watch</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./api/migrations:/app/migrations</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">postgres</span>
    <span class="na">develop</span><span class="pi">:</span>
      <span class="na">watch</span><span class="pi">:</span>
        <span class="c1"># Run migrations on schema changes</span>
        <span class="pi">-</span> <span class="na">action</span><span class="pi">:</span> <span class="s">exec</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">./api/migrations</span>
          <span class="na">command</span><span class="pi">:</span> <span class="s">npm run migrate:latest</span>

  <span class="na">postgres</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">postgres:15-alpine</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">POSTGRES_DB</span><span class="pi">:</span> <span class="s">development</span>
      <span class="na">POSTGRES_USER</span><span class="pi">:</span> <span class="s">dev</span>
      <span class="na">POSTGRES_PASSWORD</span><span class="pi">:</span> <span class="s">dev</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">postgres_data:/var/lib/postgresql/data</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">postgres_data</span><span class="pi">:</span>
</code></pre></div></div>

<p>Usage with watch mode:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Start services with file watching</span>
docker compose watch

<span class="c"># Start specific services with watching</span>
docker compose watch frontend api

<span class="c"># Watch with verbose output</span>
docker compose watch <span class="nt">--verbose</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="network-configuration-and-security">Network Configuration and Security</h3>

<h4 id="advanced-network-topologies">Advanced Network Topologies</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="c1"># Public-facing load balancer</span>
  <span class="na">traefik</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">traefik:latest</span>
    <span class="na">command</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">--api.insecure=true"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">--providers.docker=true"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">--providers.docker.exposedbydefault=false"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">--entrypoints.web.address=:80"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">--entrypoints.websecure.address=:443"</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">80:80"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">443:443"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">8080:8080"</span>  <span class="c1"># Traefik dashboard</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/var/run/docker.sock:/var/run/docker.sock:ro</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">public</span>
      <span class="pi">-</span> <span class="s">internal</span>

  <span class="c1"># Frontend application</span>
  <span class="na">frontend</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span> <span class="s">./frontend</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.enable=true"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.frontend.rule=Host(`app.localhost`)"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.frontend.entrypoints=web"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.services.frontend.loadbalancer.server.port=3000"</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">internal</span>

  <span class="c1"># API backend</span>
  <span class="na">api</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span> <span class="s">./api</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">DATABASE_URL=postgres://user:pass@postgres:5432/app</span>
      <span class="pi">-</span> <span class="s">REDIS_URL=redis://redis:6379</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.enable=true"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.api.rule=Host(`api.localhost`)"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.api.entrypoints=web"</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">postgres</span>
      <span class="pi">-</span> <span class="s">redis</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">internal</span>
      <span class="pi">-</span> <span class="s">database</span>

  <span class="c1"># Database (isolated network)</span>
  <span class="na">postgres</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">postgres:15-alpine</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">POSTGRES_DB</span><span class="pi">:</span> <span class="s">app</span>
      <span class="na">POSTGRES_USER</span><span class="pi">:</span> <span class="s">user</span>
      <span class="na">POSTGRES_PASSWORD</span><span class="pi">:</span> <span class="s">pass</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">postgres_data:/var/lib/postgresql/data</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">database</span>

  <span class="c1"># Cache (isolated network)</span>
  <span class="na">redis</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis:7-alpine</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">database</span>

  <span class="c1"># Background workers (database access only)</span>
  <span class="na">worker</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span> <span class="s">./worker</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">DATABASE_URL=postgres://user:pass@postgres:5432/app</span>
      <span class="pi">-</span> <span class="s">REDIS_URL=redis://redis:6379</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">postgres</span>
      <span class="pi">-</span> <span class="s">redis</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">database</span>

  <span class="c1"># Monitoring (separate network)</span>
  <span class="na">prometheus</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">prom/prometheus:latest</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml</span>
      <span class="pi">-</span> <span class="s">prometheus_data:/prometheus</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">monitoring</span>
      <span class="pi">-</span> <span class="s">internal</span>

  <span class="na">grafana</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">grafana/grafana:latest</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">GF_SECURITY_ADMIN_PASSWORD=admin</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">grafana_data:/var/lib/grafana</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">3001:3000"</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">monitoring</span>

<span class="na">networks</span><span class="pi">:</span>
  <span class="c1"># Public network for external access</span>
  <span class="na">public</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span>
    
  <span class="c1"># Internal network for inter-service communication</span>
  <span class="na">internal</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span>
    <span class="na">internal</span><span class="pi">:</span> <span class="no">false</span>
    
  <span class="c1"># Database network (isolated)</span>
  <span class="na">database</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span>
    <span class="na">internal</span><span class="pi">:</span> <span class="no">true</span>
    
  <span class="c1"># Monitoring network</span>
  <span class="na">monitoring</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">postgres_data</span><span class="pi">:</span>
  <span class="na">prometheus_data</span><span class="pi">:</span>
  <span class="na">grafana_data</span><span class="pi">:</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="resource-management-and-scaling">Resource Management and Scaling</h3>

<h4 id="resource-limits-and-constraints">Resource Limits and Constraints</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="c1"># Resource-constrained web application</span>
  <span class="na">app</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span> <span class="s">.</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">limits</span><span class="pi">:</span>
          <span class="na">cpus</span><span class="pi">:</span> <span class="s1">'</span><span class="s">1.0'</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">1G</span>
          <span class="na">pids</span><span class="pi">:</span> <span class="m">100</span>
        <span class="na">reservations</span><span class="pi">:</span>
          <span class="na">cpus</span><span class="pi">:</span> <span class="s1">'</span><span class="s">0.25'</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">256M</span>
      <span class="na">restart_policy</span><span class="pi">:</span>
        <span class="na">condition</span><span class="pi">:</span> <span class="s">on-failure</span>
        <span class="na">delay</span><span class="pi">:</span> <span class="s">5s</span>
        <span class="na">max_attempts</span><span class="pi">:</span> <span class="m">3</span>
        <span class="na">window</span><span class="pi">:</span> <span class="s">120s</span>
      <span class="na">update_config</span><span class="pi">:</span>
        <span class="na">parallelism</span><span class="pi">:</span> <span class="m">2</span>
        <span class="na">delay</span><span class="pi">:</span> <span class="s">10s</span>
        <span class="na">order</span><span class="pi">:</span> <span class="s">start-first</span>
        <span class="na">failure_action</span><span class="pi">:</span> <span class="s">rollback</span>
      <span class="na">rollback_config</span><span class="pi">:</span>
        <span class="na">parallelism</span><span class="pi">:</span> <span class="m">1</span>
        <span class="na">delay</span><span class="pi">:</span> <span class="s">5s</span>
        <span class="na">order</span><span class="pi">:</span> <span class="s">stop-first</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">curl"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-f"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">http://localhost:3000/health"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">30s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">10s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">3</span>

  <span class="c1"># Database with resource management</span>
  <span class="na">postgres</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">postgres:15-alpine</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">POSTGRES_DB</span><span class="pi">:</span> <span class="s">myapp</span>
      <span class="na">POSTGRES_USER</span><span class="pi">:</span> <span class="s">user</span>
      <span class="na">POSTGRES_PASSWORD</span><span class="pi">:</span> <span class="s">password</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">limits</span><span class="pi">:</span>
          <span class="na">cpus</span><span class="pi">:</span> <span class="s1">'</span><span class="s">2.0'</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">2G</span>
        <span class="na">reservations</span><span class="pi">:</span>
          <span class="na">cpus</span><span class="pi">:</span> <span class="s1">'</span><span class="s">0.5'</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">512M</span>
      <span class="na">placement</span><span class="pi">:</span>
        <span class="na">constraints</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">node.role == manager</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">postgres_data:/var/lib/postgresql/data</span>
    <span class="na">command</span><span class="pi">:</span> <span class="pi">&gt;</span>
      <span class="s">postgres</span>
      <span class="s">-c max_connections=200</span>
      <span class="s">-c shared_buffers=256MB</span>
      <span class="s">-c effective_cache_size=1GB</span>
      <span class="s">-c work_mem=4MB</span>

  <span class="c1"># Scalable worker service</span>
  <span class="na">worker</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span> <span class="s">./worker</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">replicas</span><span class="pi">:</span> <span class="m">3</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">limits</span><span class="pi">:</span>
          <span class="na">cpus</span><span class="pi">:</span> <span class="s1">'</span><span class="s">0.5'</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">512M</span>
        <span class="na">reservations</span><span class="pi">:</span>
          <span class="na">cpus</span><span class="pi">:</span> <span class="s1">'</span><span class="s">0.1'</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">128M</span>
      <span class="na">restart_policy</span><span class="pi">:</span>
        <span class="na">condition</span><span class="pi">:</span> <span class="s">on-failure</span>
        <span class="na">max_attempts</span><span class="pi">:</span> <span class="m">5</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">WORKER_CONCURRENCY=2</span>
      <span class="pi">-</span> <span class="s">QUEUE_URL=redis://redis:6379</span>

  <span class="c1"># Redis with memory limit</span>
  <span class="na">redis</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis:7-alpine</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">limits</span><span class="pi">:</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">256M</span>
        <span class="na">reservations</span><span class="pi">:</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">64M</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s">redis-server --maxmemory 200mb --maxmemory-policy allkeys-lru</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">postgres_data</span><span class="pi">:</span>
</code></pre></div></div>

<p><br /></p>

<hr />

<h2 id="best-practices-and-anti-patterns">Best Practices and Anti-Patterns</h2>

<p>Learn to avoid common mistakes and implement production-ready configurations.</p>

<p><br /></p>

<h3 id="security-best-practices">Security Best Practices</h3>

<h4 id="secure-compose-configuration">Secure Compose Configuration</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="c1"># Application with security hardening</span>
  <span class="na">app</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">Dockerfile</span>
    <span class="na">user</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1001:1001"</span>  <span class="c1"># Non-root user</span>
    <span class="na">read_only</span><span class="pi">:</span> <span class="no">true</span>    <span class="c1"># Read-only filesystem</span>
    <span class="na">cap_drop</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">ALL</span>
    <span class="na">cap_add</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">CHOWN</span>
      <span class="pi">-</span> <span class="s">SETGID</span>
      <span class="pi">-</span> <span class="s">SETUID</span>
    <span class="na">security_opt</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">no-new-privileges:true</span>
    <span class="na">tmpfs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/tmp:noexec,nosuid,size=100m</span>
      <span class="pi">-</span> <span class="s">/var/tmp:noexec,nosuid,size=50m</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">bind</span>
        <span class="na">source</span><span class="pi">:</span> <span class="s">./app-data</span>
        <span class="na">target</span><span class="pi">:</span> <span class="s">/app/data</span>
        <span class="na">read_only</span><span class="pi">:</span> <span class="no">false</span>
        <span class="na">bind</span><span class="pi">:</span>
          <span class="na">propagation</span><span class="pi">:</span> <span class="s">rprivate</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">NODE_ENV=production</span>
    <span class="na">secrets</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">source</span><span class="pi">:</span> <span class="s">app_secret_key</span>
        <span class="na">target</span><span class="pi">:</span> <span class="s">/run/secrets/secret_key</span>
        <span class="na">mode</span><span class="pi">:</span> <span class="m">0400</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">curl"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-f"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">http://localhost:3000/health"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">30s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">10s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">3</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>

  <span class="c1"># Database with security hardening</span>
  <span class="na">postgres</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">postgres:15-alpine</span>
    <span class="na">user</span><span class="pi">:</span> <span class="s">postgres</span>
    <span class="na">read_only</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">tmpfs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/tmp:noexec,nosuid,size=100m</span>
      <span class="pi">-</span> <span class="s">/var/run/postgresql:noexec,nosuid,size=100m</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">postgres_data:/var/lib/postgresql/data</span>
      <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">tmpfs</span>
        <span class="na">target</span><span class="pi">:</span> <span class="s">/dev/shm</span>
        <span class="na">tmpfs</span><span class="pi">:</span>
          <span class="na">size</span><span class="pi">:</span> <span class="s">256M</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">POSTGRES_DB</span><span class="pi">:</span> <span class="s">myapp</span>
      <span class="na">POSTGRES_USER_FILE</span><span class="pi">:</span> <span class="s">/run/secrets/postgres_user</span>
      <span class="na">POSTGRES_PASSWORD_FILE</span><span class="pi">:</span> <span class="s">/run/secrets/postgres_password</span>
    <span class="na">secrets</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">postgres_user</span>
      <span class="pi">-</span> <span class="s">postgres_password</span>
    <span class="na">command</span><span class="pi">:</span> <span class="pi">&gt;</span>
      <span class="s">postgres</span>
      <span class="s">-c ssl=on</span>
      <span class="s">-c ssl_cert_file=/etc/ssl/certs/server.crt</span>
      <span class="s">-c ssl_key_file=/etc/ssl/private/server.key</span>
      <span class="s">-c log_statement=mod</span>
      <span class="s">-c log_connections=on</span>
      <span class="s">-c log_disconnections=on</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD-SHELL"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">pg_isready</span><span class="nv"> </span><span class="s">-U</span><span class="nv"> </span><span class="s">postgres"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">30s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">10s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">5</span>

<span class="na">secrets</span><span class="pi">:</span>
  <span class="na">app_secret_key</span><span class="pi">:</span>
    <span class="na">file</span><span class="pi">:</span> <span class="s">./secrets/app_secret_key.txt</span>
  <span class="na">postgres_user</span><span class="pi">:</span>
    <span class="na">file</span><span class="pi">:</span> <span class="s">./secrets/postgres_user.txt</span>
  <span class="na">postgres_password</span><span class="pi">:</span>
    <span class="na">file</span><span class="pi">:</span> <span class="s">./secrets/postgres_password.txt</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">postgres_data</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">local</span>
    <span class="na">driver_opts</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">none</span>
      <span class="na">o</span><span class="pi">:</span> <span class="s">bind</span>
      <span class="na">device</span><span class="pi">:</span> <span class="s">/secure/postgres/data</span>

<span class="na">networks</span><span class="pi">:</span>
  <span class="na">default</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span>
    <span class="na">driver_opts</span><span class="pi">:</span>
      <span class="na">com.docker.network.bridge.enable_icc</span><span class="pi">:</span> <span class="s2">"</span><span class="s">false"</span>
      <span class="na">com.docker.network.bridge.enable_ip_masquerade</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="common-anti-patterns-to-avoid">Common Anti-Patterns to Avoid</h3>

<h4 id="-poor-practices">❌ Poor Practices</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># DON'T DO THIS - Anti-patterns</span>
<span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">bad-app</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">app:latest</span>              <span class="c1"># ❌ Always use specific versions</span>
    <span class="na">privileged</span><span class="pi">:</span> <span class="no">true</span>               <span class="c1"># ❌ Avoid privileged mode</span>
    <span class="na">user</span><span class="pi">:</span> <span class="s">root</span>                     <span class="c1"># ❌ Don't run as root</span>
    <span class="na">network_mode</span><span class="pi">:</span> <span class="s">host</span>             <span class="c1"># ❌ Host network breaks isolation</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/:/host</span>                    <span class="c1"># ❌ Don't mount entire host filesystem</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">PASSWORD=hardcoded123</span>      <span class="c1"># ❌ Never hardcode secrets</span>
      <span class="pi">-</span> <span class="s">DATABASE_HOST=localhost</span>    <span class="c1"># ❌ Use service names, not localhost</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>                <span class="c1"># ❌ 'unless-stopped' is usually better</span>
    
  <span class="na">bad-db</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">mysql</span>                   <span class="c1"># ❌ No version specified</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">MYSQL_ROOT_PASSWORD=</span>       <span class="c1"># ❌ Empty password</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./data:/var/lib/mysql</span>      <span class="c1"># ❌ Host directory instead of volume</span>
    <span class="c1"># ❌ No health check</span>
    <span class="c1"># ❌ No resource limits</span>
</code></pre></div></div>

<h4 id="-best-practices-implementation">✅ Best Practices Implementation</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># DO THIS - Best practices</span>
<span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">good-app</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">myapp:1.2.3</span>            <span class="c1"># ✅ Specific version tag</span>
    <span class="na">user</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1001:1001"</span>             <span class="c1"># ✅ Non-root user</span>
    <span class="na">read_only</span><span class="pi">:</span> <span class="no">true</span>               <span class="c1"># ✅ Read-only filesystem</span>
    <span class="na">cap_drop</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">ALL</span>                       <span class="c1"># ✅ Drop all capabilities</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">app_data:/app/data</span>        <span class="c1"># ✅ Named volume</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">NODE_ENV=production</span>
      <span class="pi">-</span> <span class="s">DATABASE_HOST=database</span>    <span class="c1"># ✅ Service name</span>
    <span class="na">env_file</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">.env</span>                      <span class="c1"># ✅ Environment file for non-secrets</span>
    <span class="na">secrets</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">jwt_secret</span>                <span class="c1"># ✅ Use secrets for sensitive data</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">curl"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-f"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">http://localhost:3000/health"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">30s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">10s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">3</span>
      <span class="na">start_period</span><span class="pi">:</span> <span class="s">60s</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>       <span class="c1"># ✅ Better restart policy</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">limits</span><span class="pi">:</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">1G</span>              <span class="c1"># ✅ Resource limits</span>
          <span class="na">cpus</span><span class="pi">:</span> <span class="s1">'</span><span class="s">0.5'</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">app-network</span>               <span class="c1"># ✅ Custom network</span>

  <span class="na">good-db</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">postgres:15.4-alpine</span>   <span class="c1"># ✅ Specific version</span>
    <span class="na">user</span><span class="pi">:</span> <span class="s">postgres</span>                <span class="c1"># ✅ Non-root user</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">POSTGRES_DB</span><span class="pi">:</span> <span class="s">myapp</span>
      <span class="na">POSTGRES_USER_FILE</span><span class="pi">:</span> <span class="s">/run/secrets/db_user</span>
      <span class="na">POSTGRES_PASSWORD_FILE</span><span class="pi">:</span> <span class="s">/run/secrets/db_password</span>
    <span class="na">secrets</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">db_user</span>                   <span class="c1"># ✅ Secrets for credentials</span>
      <span class="pi">-</span> <span class="s">db_password</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">postgres_data:/var/lib/postgresql/data</span>  <span class="c1"># ✅ Named volume</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD-SHELL"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">pg_isready</span><span class="nv"> </span><span class="s">-U</span><span class="nv"> </span><span class="s">postgres"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">30s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">10s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">5</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">limits</span><span class="pi">:</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">2G</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">app-network</span>

<span class="na">secrets</span><span class="pi">:</span>
  <span class="na">jwt_secret</span><span class="pi">:</span>
    <span class="na">file</span><span class="pi">:</span> <span class="s">./secrets/jwt_secret.txt</span>
  <span class="na">db_user</span><span class="pi">:</span>
    <span class="na">file</span><span class="pi">:</span> <span class="s">./secrets/db_user.txt</span>
  <span class="na">db_password</span><span class="pi">:</span>
    <span class="na">file</span><span class="pi">:</span> <span class="s">./secrets/db_password.txt</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">app_data</span><span class="pi">:</span>
  <span class="na">postgres_data</span><span class="pi">:</span>

<span class="na">networks</span><span class="pi">:</span>
  <span class="na">app-network</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="performance-optimization-guidelines">Performance Optimization Guidelines</h3>

<h4 id="docker-compose-performance-tuning">Docker Compose Performance Tuning</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="c1"># Optimized application configuration</span>
  <span class="na">app</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">Dockerfile.optimized</span>
      <span class="na">cache_from</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">myapp:cache</span>               <span class="c1"># Use build cache</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">myapp:${VERSION:-latest}</span>
    
    <span class="c1"># Memory and CPU optimization</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">limits</span><span class="pi">:</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">1G</span>
          <span class="na">cpus</span><span class="pi">:</span> <span class="s1">'</span><span class="s">1.0'</span>
        <span class="na">reservations</span><span class="pi">:</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">256M</span>
          <span class="na">cpus</span><span class="pi">:</span> <span class="s1">'</span><span class="s">0.25'</span>
    
    <span class="c1"># Optimized volume mounts</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">volume</span>
        <span class="na">source</span><span class="pi">:</span> <span class="s">app_cache</span>
        <span class="na">target</span><span class="pi">:</span> <span class="s">/app/cache</span>
        <span class="na">volume</span><span class="pi">:</span>
          <span class="na">nocopy</span><span class="pi">:</span> <span class="no">true</span>              <span class="c1"># Don't copy initial data</span>
      <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">tmpfs</span>
        <span class="na">target</span><span class="pi">:</span> <span class="s">/tmp</span>
        <span class="na">tmpfs</span><span class="pi">:</span>
          <span class="na">size</span><span class="pi">:</span> <span class="s">100M</span>                <span class="c1"># Limit tmpfs size</span>
    
    <span class="c1"># Environment-specific optimizations</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">NODE_ENV=production</span>
      <span class="pi">-</span> <span class="s">UV_THREADPOOL_SIZE=16</span>       <span class="c1"># Optimize Node.js thread pool</span>
      <span class="pi">-</span> <span class="s">NODE_OPTIONS=--max-old-space-size=768</span>  <span class="c1"># Optimize V8 heap</span>
    
    <span class="c1"># Networking optimization</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="na">backend</span><span class="pi">:</span>
        <span class="na">aliases</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">api.internal</span>            <span class="c1"># Custom DNS alias</span>
    
    <span class="c1"># Health check optimization</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">curl"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-f"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">http://localhost:3000/health"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">30s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">5s</span>                   <span class="c1"># Shorter timeout</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">2</span>                    <span class="c1"># Fewer retries</span>
      <span class="na">start_period</span><span class="pi">:</span> <span class="s">30s</span>             <span class="c1"># Reduced start period</span>

  <span class="c1"># Optimized database configuration</span>
  <span class="na">postgres</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">postgres:15.4-alpine</span>
    
    <span class="c1"># PostgreSQL performance tuning</span>
    <span class="na">command</span><span class="pi">:</span> <span class="pi">&gt;</span>
      <span class="s">postgres</span>
      <span class="s">-c max_connections=100</span>
      <span class="s">-c shared_buffers=256MB</span>
      <span class="s">-c effective_cache_size=1GB</span>
      <span class="s">-c maintenance_work_mem=64MB</span>
      <span class="s">-c checkpoint_completion_target=0.9</span>
      <span class="s">-c wal_buffers=16MB</span>
      <span class="s">-c default_statistics_target=100</span>
      <span class="s">-c random_page_cost=1.1</span>
      <span class="s">-c effective_io_concurrency=200</span>
      <span class="s">-c work_mem=4MB</span>
      <span class="s">-c min_wal_size=1GB</span>
      <span class="s">-c max_wal_size=4GB</span>
    
    <span class="c1"># Volume optimization</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">volume</span>
        <span class="na">source</span><span class="pi">:</span> <span class="s">postgres_data</span>
        <span class="na">target</span><span class="pi">:</span> <span class="s">/var/lib/postgresql/data</span>
        <span class="na">volume</span><span class="pi">:</span>
          <span class="na">driver_opts</span><span class="pi">:</span>
            <span class="na">type</span><span class="pi">:</span> <span class="s">none</span>
            <span class="na">o</span><span class="pi">:</span> <span class="s">bind</span>
            <span class="na">device</span><span class="pi">:</span> <span class="s">/opt/app/postgres</span>  <span class="c1"># SSD mount point</span>
    
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">limits</span><span class="pi">:</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">2G</span>
          <span class="na">cpus</span><span class="pi">:</span> <span class="s1">'</span><span class="s">2.0'</span>
        <span class="na">reservations</span><span class="pi">:</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">512M</span>
          <span class="na">cpus</span><span class="pi">:</span> <span class="s1">'</span><span class="s">0.5'</span>

  <span class="c1"># Redis optimization</span>
  <span class="na">redis</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis:7.2-alpine</span>
    <span class="na">command</span><span class="pi">:</span> <span class="pi">&gt;</span>
      <span class="s">redis-server</span>
      <span class="s">--maxmemory 256mb</span>
      <span class="s">--maxmemory-policy allkeys-lru</span>
      <span class="s">--tcp-keepalive 60</span>
      <span class="s">--tcp-backlog 511</span>
      <span class="s">--timeout 0</span>
      <span class="s">--save 900 1 300 10 60 10000  # Optimized persistence</span>
    
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">volume</span>
        <span class="na">source</span><span class="pi">:</span> <span class="s">redis_data</span>
        <span class="na">target</span><span class="pi">:</span> <span class="s">/data</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">app_cache</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">local</span>
    <span class="na">driver_opts</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">tmpfs</span>
      <span class="na">device</span><span class="pi">:</span> <span class="s">tmpfs</span>
      <span class="na">o</span><span class="pi">:</span> <span class="s">size=500M,uid=1001,gid=1001</span>

  <span class="na">postgres_data</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">local</span>

  <span class="na">redis_data</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">local</span>

<span class="na">networks</span><span class="pi">:</span>
  <span class="na">backend</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span>
    <span class="na">driver_opts</span><span class="pi">:</span>
      <span class="na">com.docker.network.driver.mtu</span><span class="pi">:</span> <span class="m">1450</span>
</code></pre></div></div>

<p><br /></p>

<hr />

<h2 id="monitoring-logging-and-debugging">Monitoring, Logging, and Debugging</h2>

<p>Implement comprehensive observability for your Compose applications.</p>

<p><br /></p>

<h3 id="comprehensive-monitoring-stack">Comprehensive Monitoring Stack</h3>

<h4 id="full-observability-configuration">Full Observability Configuration</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="c1"># Main application with monitoring</span>
  <span class="na">app</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span> <span class="s">.</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">NODE_ENV=production</span>
      <span class="pi">-</span> <span class="s">METRICS_ENABLED=true</span>
      <span class="pi">-</span> <span class="s">JAEGER_ENDPOINT=http://jaeger:14268/api/traces</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">prometheus.io/scrape=true"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">prometheus.io/port=3000"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">prometheus.io/path=/metrics"</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">app-network</span>
      <span class="pi">-</span> <span class="s">monitoring</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">postgres</span>
      <span class="pi">-</span> <span class="s">redis</span>
    <span class="na">logging</span><span class="pi">:</span>
      <span class="na">driver</span><span class="pi">:</span> <span class="s2">"</span><span class="s">fluentd"</span>
      <span class="na">options</span><span class="pi">:</span>
        <span class="na">fluentd-address</span><span class="pi">:</span> <span class="s2">"</span><span class="s">localhost:24224"</span>
        <span class="na">tag</span><span class="pi">:</span> <span class="s2">"</span><span class="s">app.logs"</span>

  <span class="c1"># Database</span>
  <span class="na">postgres</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">postgres:15-alpine</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">POSTGRES_DB</span><span class="pi">:</span> <span class="s">myapp</span>
      <span class="na">POSTGRES_USER</span><span class="pi">:</span> <span class="s">user</span>
      <span class="na">POSTGRES_PASSWORD</span><span class="pi">:</span> <span class="s">password</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">postgres_data:/var/lib/postgresql/data</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">app-network</span>
    <span class="na">logging</span><span class="pi">:</span>
      <span class="na">driver</span><span class="pi">:</span> <span class="s2">"</span><span class="s">json-file"</span>
      <span class="na">options</span><span class="pi">:</span>
        <span class="na">max-size</span><span class="pi">:</span> <span class="s2">"</span><span class="s">100m"</span>
        <span class="na">max-file</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3"</span>

  <span class="c1"># Redis</span>
  <span class="na">redis</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis:7-alpine</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">app-network</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s">redis-server --appendonly yes</span>

  <span class="c1"># Prometheus monitoring</span>
  <span class="na">prometheus</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">prom/prometheus:latest</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">prometheus</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">9090:9090"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./monitoring/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml</span>
      <span class="pi">-</span> <span class="s">./monitoring/prometheus/rules:/etc/prometheus/rules</span>
      <span class="pi">-</span> <span class="s">prometheus_data:/prometheus</span>
    <span class="na">command</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">--config.file=/etc/prometheus/prometheus.yml'</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">--storage.tsdb.path=/prometheus'</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">--web.console.libraries=/etc/prometheus/console_libraries'</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">--web.console.templates=/etc/prometheus/consoles'</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">--storage.tsdb.retention.time=200h'</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">--web.enable-lifecycle'</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">--web.enable-admin-api'</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">monitoring</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>

  <span class="c1"># Grafana dashboards</span>
  <span class="na">grafana</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">grafana/grafana:latest</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">grafana</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">3001:3000"</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">GF_SECURITY_ADMIN_USER=admin</span>
      <span class="pi">-</span> <span class="s">GF_SECURITY_ADMIN_PASSWORD=admin</span>
      <span class="pi">-</span> <span class="s">GF_USERS_ALLOW_SIGN_UP=false</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">grafana_data:/var/lib/grafana</span>
      <span class="pi">-</span> <span class="s">./monitoring/grafana/provisioning:/etc/grafana/provisioning</span>
      <span class="pi">-</span> <span class="s">./monitoring/grafana/dashboards:/var/lib/grafana/dashboards</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">monitoring</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">prometheus</span>

  <span class="c1"># Node Exporter for system metrics</span>
  <span class="na">node-exporter</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">prom/node-exporter:latest</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">node-exporter</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">9100:9100"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/proc:/host/proc:ro</span>
      <span class="pi">-</span> <span class="s">/sys:/host/sys:ro</span>
      <span class="pi">-</span> <span class="s">/:/rootfs:ro</span>
    <span class="na">command</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">--path.procfs=/host/proc'</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">--path.rootfs=/rootfs'</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">--path.sysfs=/host/sys'</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">--collector.filesystem.mount-points-exclude=^/(sys|proc|dev|host|etc)($$|/)'</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">monitoring</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>

  <span class="c1"># cAdvisor for container metrics</span>
  <span class="na">cadvisor</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">gcr.io/cadvisor/cadvisor:latest</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">cadvisor</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">8080:8080"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/:/rootfs:ro</span>
      <span class="pi">-</span> <span class="s">/var/run:/var/run:ro</span>
      <span class="pi">-</span> <span class="s">/sys:/sys:ro</span>
      <span class="pi">-</span> <span class="s">/var/lib/docker/:/var/lib/docker:ro</span>
      <span class="pi">-</span> <span class="s">/dev/disk/:/dev/disk:ro</span>
    <span class="na">privileged</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">devices</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/dev/kmsg</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">monitoring</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>

  <span class="c1"># Jaeger for distributed tracing</span>
  <span class="na">jaeger</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">jaegertracing/all-in-one:latest</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">jaeger</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">5775:5775/udp"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">6831:6831/udp"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">6832:6832/udp"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">5778:5778"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">16686:16686"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">14268:14268"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">14250:14250"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">9411:9411"</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">COLLECTOR_ZIPKIN_HOST_PORT=:9411</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">monitoring</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>

  <span class="c1"># FluentD for log aggregation</span>
  <span class="na">fluentd</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span> <span class="s">./monitoring/fluentd</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">fluentd</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">24224:24224"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">24224:24224/udp"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./monitoring/fluentd/conf:/fluentd/etc</span>
      <span class="pi">-</span> <span class="s">./logs:/fluentd/log</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">monitoring</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>

  <span class="c1"># Alertmanager for alerts</span>
  <span class="na">alertmanager</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">prom/alertmanager:latest</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">alertmanager</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">9093:9093"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./monitoring/alertmanager/alertmanager.yml:/etc/alertmanager/alertmanager.yml</span>
      <span class="pi">-</span> <span class="s">alertmanager_data:/alertmanager</span>
    <span class="na">command</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">--config.file=/etc/alertmanager/alertmanager.yml'</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">--storage.path=/alertmanager'</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">--web.external-url=http://localhost:9093'</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">monitoring</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>

  <span class="c1"># Elasticsearch for log storage</span>
  <span class="na">elasticsearch</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">docker.elastic.co/elasticsearch/elasticsearch:8.11.0</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">elasticsearch</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">discovery.type=single-node</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">ES_JAVA_OPTS=-Xms1g</span><span class="nv"> </span><span class="s">-Xmx1g"</span>
      <span class="pi">-</span> <span class="s">xpack.security.enabled=false</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">elasticsearch_data:/usr/share/elasticsearch/data</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">9200:9200"</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">monitoring</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>

  <span class="c1"># Kibana for log visualization</span>
  <span class="na">kibana</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">docker.elastic.co/kibana/kibana:8.11.0</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">kibana</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">ELASTICSEARCH_HOSTS=http://elasticsearch:9200</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">5601:5601"</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">elasticsearch</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">monitoring</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>

<span class="na">networks</span><span class="pi">:</span>
  <span class="na">app-network</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span>
  <span class="na">monitoring</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">postgres_data</span><span class="pi">:</span>
  <span class="na">prometheus_data</span><span class="pi">:</span>
  <span class="na">grafana_data</span><span class="pi">:</span>
  <span class="na">alertmanager_data</span><span class="pi">:</span>
  <span class="na">elasticsearch_data</span><span class="pi">:</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="debugging-and-troubleshooting-tools">Debugging and Troubleshooting Tools</h3>

<h4 id="debug-enabled-development-configuration">Debug-Enabled Development Configuration</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="c1"># Application with debugging enabled</span>
  <span class="na">app-debug</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">Dockerfile.debug</span>
      <span class="na">target</span><span class="pi">:</span> <span class="s">debug</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">NODE_ENV=development</span>
      <span class="pi">-</span> <span class="s">DEBUG=app:*,express:*,sequelize:*</span>
      <span class="pi">-</span> <span class="s">LOG_LEVEL=debug</span>
      <span class="pi">-</span> <span class="s">ENABLE_DEBUG_ENDPOINTS=true</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./src:/app/src</span>
      <span class="pi">-</span> <span class="s">./logs:/app/logs</span>
      <span class="pi">-</span> <span class="s">debug_data:/debug</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">3000:3000"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">9229:9229"</span>    <span class="c1"># Node.js debugger</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">9464:9464"</span>    <span class="c1"># Debug metrics</span>
    <span class="na">command</span><span class="pi">:</span> <span class="pi">&gt;</span>
      <span class="s">sh -c "npm install &amp;&amp;</span>
             <span class="s">npm run debug"</span>
    <span class="na">stdin_open</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">tty</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">debug-network</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">debug.enabled=true"</span>

  <span class="c1"># Database with query logging</span>
  <span class="na">postgres-debug</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">postgres:15-alpine</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">POSTGRES_DB</span><span class="pi">:</span> <span class="s">myapp_debug</span>
      <span class="na">POSTGRES_USER</span><span class="pi">:</span> <span class="s">debug</span>
      <span class="na">POSTGRES_PASSWORD</span><span class="pi">:</span> <span class="s">debug</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">postgres_debug_data:/var/lib/postgresql/data</span>
      <span class="pi">-</span> <span class="s">./database/debug-scripts:/docker-entrypoint-initdb.d</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">5432:5432"</span>
    <span class="na">command</span><span class="pi">:</span> <span class="pi">&gt;</span>
      <span class="s">postgres</span>
      <span class="s">-c log_statement=all</span>
      <span class="s">-c log_duration=on</span>
      <span class="s">-c log_line_prefix='%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '</span>
      <span class="s">-c log_checkpoints=on</span>
      <span class="s">-c log_connections=on</span>
      <span class="s">-c log_disconnections=on</span>
      <span class="s">-c log_lock_waits=on</span>
      <span class="s">-c shared_preload_libraries=pg_stat_statements</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">debug-network</span>

  <span class="c1"># Redis with debugging</span>
  <span class="na">redis-debug</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis:7-alpine</span>
    <span class="na">command</span><span class="pi">:</span> <span class="pi">&gt;</span>
      <span class="s">redis-server</span>
      <span class="s">--loglevel debug</span>
      <span class="s">--logfile /redis-logs/redis.log</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">redis_debug_data:/data</span>
      <span class="pi">-</span> <span class="s">redis_logs:/redis-logs</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">6379:6379"</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">debug-network</span>

  <span class="c1"># Debug tools container</span>
  <span class="na">debug-tools</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nicolaka/netshoot:latest</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">debug-tools</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s">sleep infinity</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/var/run/docker.sock:/var/run/docker.sock</span>
      <span class="pi">-</span> <span class="s">debug_tools:/debug</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">debug-network</span>
    <span class="na">privileged</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">stdin_open</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">tty</span><span class="pi">:</span> <span class="no">true</span>

  <span class="c1"># Log aggregation for debugging</span>
  <span class="na">debug-fluentd</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span> <span class="s">./debug/fluentd</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./debug/fluentd/conf:/fluentd/etc</span>
      <span class="pi">-</span> <span class="s">debug_logs:/fluentd/log</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">24224:24224"</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">debug-network</span>

  <span class="c1"># Web-based log viewer</span>
  <span class="na">dozzle</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">amir20/dozzle:latest</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/var/run/docker.sock:/var/run/docker.sock</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">8888:8080"</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">DOZZLE_LEVEL=debug</span>
      <span class="pi">-</span> <span class="s">DOZZLE_TAILSIZE=1000</span>

<span class="na">networks</span><span class="pi">:</span>
  <span class="na">debug-network</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span>
    <span class="na">driver_opts</span><span class="pi">:</span>
      <span class="na">com.docker.network.bridge.name</span><span class="pi">:</span> <span class="s">debug-bridge</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">postgres_debug_data</span><span class="pi">:</span>
  <span class="na">redis_debug_data</span><span class="pi">:</span>
  <span class="na">redis_logs</span><span class="pi">:</span>
  <span class="na">debug_data</span><span class="pi">:</span>
  <span class="na">debug_tools</span><span class="pi">:</span>
  <span class="na">debug_logs</span><span class="pi">:</span>
</code></pre></div></div>

<h4 id="useful-debugging-commands">Useful Debugging Commands</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Container debugging commands</span>
docker compose <span class="nb">exec </span>app bash                    <span class="c"># Interactive shell</span>
docker compose <span class="nb">exec</span> <span class="nt">--user</span> root app bash       <span class="c"># Root shell for debugging</span>
docker compose logs <span class="nt">-f</span> <span class="nt">--tail</span><span class="o">=</span>100 app          <span class="c"># Follow recent logs</span>
docker compose logs <span class="nt">--since</span><span class="o">=</span><span class="s2">"1h"</span> app           <span class="c"># Logs from last hour</span>
docker compose top                              <span class="c"># Process information</span>
docker compose <span class="nb">exec </span>app ps aux                 <span class="c"># Processes inside container</span>

<span class="c"># Network debugging</span>
docker compose <span class="nb">exec </span>debug-tools ping app       <span class="c"># Test connectivity</span>
docker compose <span class="nb">exec </span>debug-tools nslookup app   <span class="c"># DNS resolution</span>
docker compose <span class="nb">exec </span>debug-tools netstat <span class="nt">-tlnp</span>  <span class="c"># Port listening</span>
docker compose <span class="nb">exec </span>debug-tools ss <span class="nt">-tulpn</span>      <span class="c"># Socket statistics</span>

<span class="c"># Performance debugging</span>
docker compose <span class="nb">exec </span>app htop                   <span class="c"># Process monitoring</span>
docker compose <span class="nb">exec </span>app iotop                  <span class="c"># I/O monitoring</span>
docker compose stats                           <span class="c"># Resource usage</span>
docker compose <span class="nb">exec </span>app strace <span class="nt">-p</span> 1            <span class="c"># System call tracing</span>

<span class="c"># Database debugging</span>
docker compose <span class="nb">exec </span>postgres-debug psql <span class="nt">-U</span> debug <span class="nt">-d</span> myapp_debug
docker compose <span class="nb">exec </span>postgres-debug pg_stat_activity
docker compose <span class="nb">exec </span>redis-debug redis-cli monitor

<span class="c"># Log analysis</span>
docker compose logs app | <span class="nb">grep </span>ERROR           <span class="c"># Filter error logs</span>
docker compose logs <span class="nt">--since</span><span class="o">=</span><span class="s2">"2h"</span> <span class="nt">--until</span><span class="o">=</span><span class="s2">"1h"</span> <span class="c"># Time range</span>
docker compose logs <span class="nt">-t</span> app                     <span class="c"># Timestamps</span>
</code></pre></div></div>

<p><br /></p>

<hr />

<h2 id="production-deployment-strategies">Production Deployment Strategies</h2>

<p>Implement enterprise-ready deployment patterns with Docker Compose.</p>

<p><br /></p>

<h3 id="blue-green-deployment">Blue-Green Deployment</h3>

<h4 id="blue-green-deployment-configuration">Blue-Green Deployment Configuration</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># docker-compose.blue-green.yml</span>
<span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="c1"># Load balancer / Proxy</span>
  <span class="na">nginx</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:alpine</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">80:80"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">443:443"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./nginx/blue-green.conf:/etc/nginx/nginx.conf</span>
      <span class="pi">-</span> <span class="s">./ssl:/etc/nginx/ssl</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">app-blue</span>
      <span class="pi">-</span> <span class="s">app-green</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">frontend</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">ACTIVE_ENVIRONMENT=${ACTIVE_ENV:-blue}</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>

  <span class="c1"># Blue environment</span>
  <span class="na">app-blue</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">myapp:${BLUE_VERSION:-latest}</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">NODE_ENV=production</span>
      <span class="pi">-</span> <span class="s">APP_ENV=blue</span>
      <span class="pi">-</span> <span class="s">DATABASE_URL=${BLUE_DATABASE_URL}</span>
      <span class="pi">-</span> <span class="s">REDIS_URL=${BLUE_REDIS_URL}</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">frontend</span>
      <span class="pi">-</span> <span class="s">blue-backend</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">replicas</span><span class="pi">:</span> <span class="s">${BLUE_REPLICAS:-3}</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">limits</span><span class="pi">:</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">1G</span>
          <span class="na">cpus</span><span class="pi">:</span> <span class="s1">'</span><span class="s">0.5'</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">curl"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-f"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">http://localhost:3000/health"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">30s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">10s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">3</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>

  <span class="c1"># Green environment</span>
  <span class="na">app-green</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">myapp:${GREEN_VERSION:-latest}</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">NODE_ENV=production</span>
      <span class="pi">-</span> <span class="s">APP_ENV=green</span>
      <span class="pi">-</span> <span class="s">DATABASE_URL=${GREEN_DATABASE_URL}</span>
      <span class="pi">-</span> <span class="s">REDIS_URL=${GREEN_REDIS_URL}</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">frontend</span>
      <span class="pi">-</span> <span class="s">green-backend</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">replicas</span><span class="pi">:</span> <span class="s">${GREEN_REPLICAS:-0}</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">limits</span><span class="pi">:</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">1G</span>
          <span class="na">cpus</span><span class="pi">:</span> <span class="s1">'</span><span class="s">0.5'</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">curl"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-f"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">http://localhost:3000/health"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">30s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">10s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">3</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>

  <span class="c1"># Shared database</span>
  <span class="na">postgres</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">postgres:15-alpine</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">POSTGRES_DB</span><span class="pi">:</span> <span class="s">${DB_NAME}</span>
      <span class="na">POSTGRES_USER</span><span class="pi">:</span> <span class="s">${DB_USER}</span>
      <span class="na">POSTGRES_PASSWORD</span><span class="pi">:</span> <span class="s">${DB_PASSWORD}</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">postgres_data:/var/lib/postgresql/data</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">blue-backend</span>
      <span class="pi">-</span> <span class="s">green-backend</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>

  <span class="c1"># Shared cache</span>
  <span class="na">redis</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis:7-alpine</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">redis_data:/data</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">blue-backend</span>
      <span class="pi">-</span> <span class="s">green-backend</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>

<span class="na">networks</span><span class="pi">:</span>
  <span class="na">frontend</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span>
  <span class="na">blue-backend</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span>
  <span class="na">green-backend</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">postgres_data</span><span class="pi">:</span>
  <span class="na">redis_data</span><span class="pi">:</span>
</code></pre></div></div>

<h4 id="blue-green-deployment-scripts">Blue-Green Deployment Scripts</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># blue-green-deploy.sh</span>

<span class="nb">set</span> <span class="nt">-euo</span> pipefail

<span class="nv">COMPOSE_FILE</span><span class="o">=</span><span class="s2">"docker-compose.blue-green.yml"</span>
<span class="nv">NEW_VERSION</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">latest</span><span class="k">}</span><span class="s2">"</span>
<span class="nv">CURRENT_ENV</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">ACTIVE_ENV</span><span class="k">:-</span><span class="nv">blue</span><span class="k">}</span><span class="s2">"</span>
<span class="nv">TARGET_ENV</span><span class="o">=</span><span class="si">$(</span><span class="o">[</span> <span class="s2">"</span><span class="nv">$CURRENT_ENV</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"blue"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"green"</span> <span class="o">||</span> <span class="nb">echo</span> <span class="s2">"blue"</span><span class="si">)</span>

<span class="nb">echo</span> <span class="s2">"Current environment: </span><span class="nv">$CURRENT_ENV</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"Target environment: </span><span class="nv">$TARGET_ENV</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"Deploying version: </span><span class="nv">$NEW_VERSION</span><span class="s2">"</span>

<span class="c"># Deploy to target environment</span>
<span class="nb">echo</span> <span class="s2">"Deploying to </span><span class="nv">$TARGET_ENV</span><span class="s2"> environment..."</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$TARGET_ENV</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"green"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">export </span><span class="nv">GREEN_VERSION</span><span class="o">=</span><span class="s2">"</span><span class="nv">$NEW_VERSION</span><span class="s2">"</span>
    <span class="nb">export </span><span class="nv">GREEN_REPLICAS</span><span class="o">=</span>3
    <span class="nb">export </span><span class="nv">GREEN_DATABASE_URL</span><span class="o">=</span><span class="s2">"</span><span class="nv">$DATABASE_URL</span><span class="s2">"</span>
    <span class="nb">export </span><span class="nv">GREEN_REDIS_URL</span><span class="o">=</span><span class="s2">"</span><span class="nv">$REDIS_URL</span><span class="s2">"</span>
<span class="k">else
    </span><span class="nb">export </span><span class="nv">BLUE_VERSION</span><span class="o">=</span><span class="s2">"</span><span class="nv">$NEW_VERSION</span><span class="s2">"</span>
    <span class="nb">export </span><span class="nv">BLUE_REPLICAS</span><span class="o">=</span>3
    <span class="nb">export </span><span class="nv">BLUE_DATABASE_URL</span><span class="o">=</span><span class="s2">"</span><span class="nv">$DATABASE_URL</span><span class="s2">"</span>
    <span class="nb">export </span><span class="nv">BLUE_REDIS_URL</span><span class="o">=</span><span class="s2">"</span><span class="nv">$REDIS_URL</span><span class="s2">"</span>
<span class="k">fi</span>

<span class="c"># Start target environment</span>
docker compose <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$COMPOSE_FILE</span><span class="s2">"</span> up <span class="nt">-d</span> <span class="s2">"app-</span><span class="nv">$TARGET_ENV</span><span class="s2">"</span>

<span class="c"># Wait for health checks</span>
<span class="nb">echo</span> <span class="s2">"Waiting for </span><span class="nv">$TARGET_ENV</span><span class="s2"> environment to be healthy..."</span>
<span class="nb">timeout </span>300 bash <span class="nt">-c</span> <span class="s2">"
    while ! docker compose -f '</span><span class="nv">$COMPOSE_FILE</span><span class="s2">' exec app-</span><span class="nv">$TARGET_ENV</span><span class="s2"> curl -f http://localhost:3000/health; do
        echo 'Waiting for health check...'
        sleep 10
    done
"</span>

<span class="c"># Run smoke tests</span>
<span class="nb">echo</span> <span class="s2">"Running smoke tests against </span><span class="nv">$TARGET_ENV</span><span class="s2"> environment..."</span>
./scripts/smoke-test.sh <span class="s2">"</span><span class="nv">$TARGET_ENV</span><span class="s2">"</span>

<span class="c"># Switch traffic</span>
<span class="nb">echo</span> <span class="s2">"Switching traffic to </span><span class="nv">$TARGET_ENV</span><span class="s2"> environment..."</span>
<span class="nb">export </span><span class="nv">ACTIVE_ENV</span><span class="o">=</span><span class="s2">"</span><span class="nv">$TARGET_ENV</span><span class="s2">"</span>
docker compose <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$COMPOSE_FILE</span><span class="s2">"</span> up <span class="nt">-d</span> nginx

<span class="c"># Scale down old environment</span>
<span class="nb">echo</span> <span class="s2">"Scaling down </span><span class="nv">$CURRENT_ENV</span><span class="s2"> environment..."</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$CURRENT_ENV</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"green"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">export </span><span class="nv">GREEN_REPLICAS</span><span class="o">=</span>0
<span class="k">else
    </span><span class="nb">export </span><span class="nv">BLUE_REPLICAS</span><span class="o">=</span>0
<span class="k">fi

</span>docker compose <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$COMPOSE_FILE</span><span class="s2">"</span> up <span class="nt">-d</span> <span class="s2">"app-</span><span class="nv">$CURRENT_ENV</span><span class="s2">"</span>

<span class="nb">echo</span> <span class="s2">"Blue-green deployment completed successfully!"</span>
<span class="nb">echo</span> <span class="s2">"Active environment: </span><span class="nv">$TARGET_ENV</span><span class="s2">"</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="rolling-updates-and-zero-downtime-deployment">Rolling Updates and Zero-Downtime Deployment</h3>

<h4 id="rolling-update-configuration">Rolling Update Configuration</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># docker-compose.rolling.yml</span>
<span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="c1"># Load balancer with health checks</span>
  <span class="na">haproxy</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">haproxy:latest</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">80:80"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">443:443"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">8404:8404"</span>  <span class="c1"># Stats page</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./haproxy/haproxy.cfg:/usr/local/etc/haproxy/haproxy.cfg</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">frontend</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">curl"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-f"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">http://localhost:8404/stats"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">30s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">10s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">3</span>

  <span class="c1"># Application with rolling update support</span>
  <span class="na">app</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">myapp:${APP_VERSION:-latest}</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">NODE_ENV=production</span>
      <span class="pi">-</span> <span class="s">GRACEFUL_SHUTDOWN_TIMEOUT=30</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">frontend</span>
      <span class="pi">-</span> <span class="s">backend</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">replicas</span><span class="pi">:</span> <span class="s">${APP_REPLICAS:-5}</span>
      <span class="na">update_config</span><span class="pi">:</span>
        <span class="na">parallelism</span><span class="pi">:</span> <span class="m">1</span>           <span class="c1"># Update one container at a time</span>
        <span class="na">delay</span><span class="pi">:</span> <span class="s">30s</span>               <span class="c1"># Wait between updates</span>
        <span class="na">order</span><span class="pi">:</span> <span class="s">start-first</span>       <span class="c1"># Start new before stopping old</span>
        <span class="na">failure_action</span><span class="pi">:</span> <span class="s">rollback</span> <span class="c1"># Rollback on failure</span>
        <span class="na">monitor</span><span class="pi">:</span> <span class="s">60s</span>             <span class="c1"># Monitor period</span>
        <span class="na">max_failure_ratio</span><span class="pi">:</span> <span class="m">0.2</span>   <span class="c1"># Max 20% failure rate</span>
      <span class="na">rollback_config</span><span class="pi">:</span>
        <span class="na">parallelism</span><span class="pi">:</span> <span class="m">1</span>
        <span class="na">delay</span><span class="pi">:</span> <span class="s">10s</span>
        <span class="na">order</span><span class="pi">:</span> <span class="s">stop-first</span>
        <span class="na">monitor</span><span class="pi">:</span> <span class="s">30s</span>
      <span class="na">restart_policy</span><span class="pi">:</span>
        <span class="na">condition</span><span class="pi">:</span> <span class="s">on-failure</span>
        <span class="na">delay</span><span class="pi">:</span> <span class="s">5s</span>
        <span class="na">max_attempts</span><span class="pi">:</span> <span class="m">3</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">limits</span><span class="pi">:</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">1G</span>
          <span class="na">cpus</span><span class="pi">:</span> <span class="s1">'</span><span class="s">0.5'</span>
        <span class="na">reservations</span><span class="pi">:</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">256M</span>
          <span class="na">cpus</span><span class="pi">:</span> <span class="s1">'</span><span class="s">0.1'</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">curl"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-f"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">http://localhost:3000/health"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">30s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">10s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">3</span>
      <span class="na">start_period</span><span class="pi">:</span> <span class="s">60s</span>
    <span class="na">stop_grace_period</span><span class="pi">:</span> <span class="s">45s</span>       <span class="c1"># Graceful shutdown time</span>

  <span class="c1"># Database with backup during updates</span>
  <span class="na">postgres</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">postgres:15-alpine</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">POSTGRES_DB</span><span class="pi">:</span> <span class="s">${DB_NAME}</span>
      <span class="na">POSTGRES_USER</span><span class="pi">:</span> <span class="s">${DB_USER}</span>
      <span class="na">POSTGRES_PASSWORD</span><span class="pi">:</span> <span class="s">${DB_PASSWORD}</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">postgres_data:/var/lib/postgresql/data</span>
      <span class="pi">-</span> <span class="s">./backups:/backups</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">backend</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">limits</span><span class="pi">:</span>
          <span class="na">memory</span><span class="pi">:</span> <span class="s">2G</span>
          <span class="na">cpus</span><span class="pi">:</span> <span class="s1">'</span><span class="s">1.0'</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD-SHELL"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">pg_isready</span><span class="nv"> </span><span class="s">-U</span><span class="nv"> </span><span class="s">$DB_USER"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">30s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">10s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">5</span>

  <span class="c1"># Migration service</span>
  <span class="na">migrate</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">myapp:${APP_VERSION:-latest}</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s">npm run migrate</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">NODE_ENV=production</span>
      <span class="pi">-</span> <span class="s">DATABASE_URL=${DATABASE_URL}</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">backend</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="na">postgres</span><span class="pi">:</span>
        <span class="na">condition</span><span class="pi">:</span> <span class="s">service_healthy</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s2">"</span><span class="s">no"</span>

<span class="na">networks</span><span class="pi">:</span>
  <span class="na">frontend</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span>
  <span class="na">backend</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">postgres_data</span><span class="pi">:</span>
</code></pre></div></div>

<h4 id="rolling-update-script">Rolling Update Script</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># rolling-update.sh</span>

<span class="nb">set</span> <span class="nt">-euo</span> pipefail

<span class="nv">COMPOSE_FILE</span><span class="o">=</span><span class="s2">"docker-compose.rolling.yml"</span>
<span class="nv">NEW_VERSION</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">latest</span><span class="k">}</span><span class="s2">"</span>
<span class="nv">HEALTH_CHECK_URL</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">2</span><span class="k">:-</span><span class="nv">http</span>://localhost/health<span class="k">}</span><span class="s2">"</span>

<span class="nb">echo</span> <span class="s2">"Starting rolling update to version: </span><span class="nv">$NEW_VERSION</span><span class="s2">"</span>

<span class="c"># Pre-deployment checks</span>
<span class="nb">echo</span> <span class="s2">"Running pre-deployment checks..."</span>
docker image pull <span class="s2">"myapp:</span><span class="nv">$NEW_VERSION</span><span class="s2">"</span>

<span class="c"># Create database backup</span>
<span class="nb">echo</span> <span class="s2">"Creating database backup..."</span>
docker compose <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$COMPOSE_FILE</span><span class="s2">"</span> <span class="nb">exec </span>postgres pg_dump <span class="nt">-U</span> <span class="s2">"</span><span class="nv">$DB_USER</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$DB_NAME</span><span class="s2">"</span> <span class="o">&gt;</span> <span class="s2">"backup-</span><span class="si">$(</span><span class="nb">date</span> +%Y%m%d_%H%M%S<span class="si">)</span><span class="s2">.sql"</span>

<span class="c"># Run database migrations</span>
<span class="nb">echo</span> <span class="s2">"Running database migrations..."</span>
<span class="nb">export </span><span class="nv">APP_VERSION</span><span class="o">=</span><span class="s2">"</span><span class="nv">$NEW_VERSION</span><span class="s2">"</span>
docker compose <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$COMPOSE_FILE</span><span class="s2">"</span> run <span class="nt">--rm</span> migrate

<span class="c"># Update application with rolling strategy</span>
<span class="nb">echo</span> <span class="s2">"Starting rolling update of application..."</span>
docker compose <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$COMPOSE_FILE</span><span class="s2">"</span> up <span class="nt">-d</span> app

<span class="c"># Monitor deployment</span>
<span class="nb">echo</span> <span class="s2">"Monitoring deployment progress..."</span>
<span class="k">for </span>i <span class="k">in</span> <span class="o">{</span>1..30<span class="o">}</span><span class="p">;</span> <span class="k">do
    if </span>curl <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$HEALTH_CHECK_URL</span><span class="s2">"</span> <span class="o">&gt;</span>/dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"Health check passed (attempt </span><span class="nv">$i</span><span class="s2">/30)"</span>
        <span class="nv">HEALTHY_COUNT</span><span class="o">=</span><span class="k">$((</span>HEALTHY_COUNT <span class="o">+</span> <span class="m">1</span><span class="k">))</span>
        <span class="k">if</span> <span class="o">[</span> <span class="nv">$HEALTHY_COUNT</span> <span class="nt">-ge</span> 3 <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span><span class="nb">echo</span> <span class="s2">"Rolling update completed successfully!"</span>
            <span class="nb">break
        </span><span class="k">fi
    else
        </span><span class="nb">echo</span> <span class="s2">"Health check failed (attempt </span><span class="nv">$i</span><span class="s2">/30)"</span>
        <span class="nv">HEALTHY_COUNT</span><span class="o">=</span>0
    <span class="k">fi
    
    if</span> <span class="o">[</span> <span class="nv">$i</span> <span class="nt">-eq</span> 30 <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"Rolling update failed - triggering rollback"</span>
        docker compose <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$COMPOSE_FILE</span><span class="s2">"</span> rollback app
        <span class="nb">exit </span>1
    <span class="k">fi
    
    </span><span class="nb">sleep </span>10
<span class="k">done</span>

<span class="c"># Cleanup old images</span>
<span class="nb">echo</span> <span class="s2">"Cleaning up old images..."</span>
docker image prune <span class="nt">-f</span>

<span class="nb">echo</span> <span class="s2">"Rolling update completed successfully!"</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="disaster-recovery-and-backup-strategies">Disaster Recovery and Backup Strategies</h3>

<h4 id="comprehensive-backup-configuration">Comprehensive Backup Configuration</h4>

<script src="https://gist.github.com/somaz94/e65db84e109b8dd82a49867cae16e46d.js"></script>

<p><br /></p>

<h4 id="backup-and-recovery-scripts">Backup and Recovery Scripts</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># backup-restore.sh</span>

<span class="nb">set</span> <span class="nt">-euo</span> pipefail

<span class="nv">COMPOSE_FILE</span><span class="o">=</span><span class="s2">"docker-compose.backup.yml"</span>
<span class="nv">BACKUP_TYPE</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">full</span><span class="k">}</span><span class="s2">"</span>
<span class="nv">RESTORE_POINT</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">2</span><span class="k">:-}</span><span class="s2">"</span>

<span class="k">case</span> <span class="s2">"</span><span class="nv">$BACKUP_TYPE</span><span class="s2">"</span> <span class="k">in</span>
    <span class="s2">"full"</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"Creating full backup..."</span>
        docker compose <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$COMPOSE_FILE</span><span class="s2">"</span> <span class="nb">exec </span>backup /scripts/full-backup.sh
        <span class="p">;;</span>
    
    <span class="s2">"incremental"</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"Creating incremental backup..."</span>
        docker compose <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$COMPOSE_FILE</span><span class="s2">"</span> <span class="nb">exec </span>backup /scripts/incremental-backup.sh
        <span class="p">;;</span>
    
    <span class="s2">"restore"</span><span class="p">)</span>
        <span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$RESTORE_POINT</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span><span class="nb">echo</span> <span class="s2">"Error: Restore point required"</span>
            <span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> restore &lt;backup-file-or-timestamp&gt;"</span>
            <span class="nb">exit </span>1
        <span class="k">fi
        
        </span><span class="nb">echo</span> <span class="s2">"Restoring from: </span><span class="nv">$RESTORE_POINT</span><span class="s2">"</span>
        
        <span class="c"># Stop application</span>
        docker compose <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$COMPOSE_FILE</span><span class="s2">"</span> stop app
        
        <span class="c"># Restore database</span>
        docker compose <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$COMPOSE_FILE</span><span class="s2">"</span> <span class="nb">exec </span>postgres-primary /scripts/restore.sh <span class="s2">"</span><span class="nv">$RESTORE_POINT</span><span class="s2">"</span>
        
        <span class="c"># Start application</span>
        docker compose <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$COMPOSE_FILE</span><span class="s2">"</span> start app
        <span class="p">;;</span>
    
    <span class="s2">"pitr"</span><span class="p">)</span>
        <span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$RESTORE_POINT</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
            </span><span class="nb">echo</span> <span class="s2">"Error: Point-in-time restore requires timestamp"</span>
            <span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> pitr 'YYYY-MM-DD HH:MM:SS'"</span>
            <span class="nb">exit </span>1
        <span class="k">fi
        
        </span><span class="nb">echo</span> <span class="s2">"Point-in-time restore to: </span><span class="nv">$RESTORE_POINT</span><span class="s2">"</span>
        docker compose <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$COMPOSE_FILE</span><span class="s2">"</span> <span class="nb">exec </span>pitr /scripts/pitr-restore.sh <span class="s2">"</span><span class="nv">$RESTORE_POINT</span><span class="s2">"</span>
        <span class="p">;;</span>
    
    <span class="s2">"verify"</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"Verifying backup integrity..."</span>
        docker compose <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$COMPOSE_FILE</span><span class="s2">"</span> <span class="nb">exec </span>backup /scripts/verify-backup.sh
        <span class="p">;;</span>
    
    <span class="k">*</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> {full|incremental|restore|pitr|verify} [restore-point]"</span>
        <span class="nb">exit </span>1
        <span class="p">;;</span>
<span class="k">esac</span>
</code></pre></div></div>

<p><br /></p>

<hr />

<h2 id="key-points">Key Points</h2>

<div class="info-box info-box-success-not-check">
  <strong>Docker Compose Mastery Summary</strong>
  <ul>
    <li>
      <strong>Modern Compose Usage</strong><br />
      - Use Compose V2 with <code>docker compose</code> command (space, not hyphen)<br />
      - Leverage new features like watch mode and improved networking<br />
      - Implement proper health checks and dependency management<br />
      - Follow security best practices with non-root users and read-only filesystems
    </li>
    <li>
      <strong>Production Readiness</strong><br />
      - Implement comprehensive monitoring and logging solutions<br />
      - Use resource limits and restart policies appropriately<br />
      - Design for high availability with multiple replicas and health checks<br />
      - Plan disaster recovery with backup and restore procedures
    </li>
    <li>
      <strong>Development Excellence</strong><br />
      - Utilize environment-specific override files effectively<br />
      - Implement hot reload and debugging capabilities<br />
      - Maintain clean separation between development and production configs<br />
      - Use secrets management for sensitive configuration data
    </li>
  </ul>
</div>

<p><br /></p>

<hr />

<h2 id="conclusion">Conclusion</h2>

<p><strong>Docker Compose</strong> has evolved into an indispensable tool for modern application development and deployment. The transition from V1 to V2 brought significant improvements in <strong>performance, usability, and integration</strong> with the broader Docker ecosystem.</p>

<p><strong>From simple development environments to complex production deployments</strong>, Docker Compose provides the flexibility and power needed to manage multi-container applications effectively. The <strong>YAML-based configuration approach</strong> makes complex infrastructures <strong>readable, maintainable, and version-controllable</strong>.</p>

<p><br /></p>

<h3 id="strategic-implementation-guidelines">Strategic Implementation Guidelines</h3>

<ol>
  <li><strong>Start with Development</strong>: Use Compose to standardize development environments across teams</li>
  <li><strong>Progress to Staging</strong>: Implement override files for environment-specific configurations</li>
  <li><strong>Scale to Production</strong>: Add monitoring, logging, and deployment automation</li>
  <li><strong>Plan for Growth</strong>: Design with scalability and disaster recovery in mind</li>
  <li><strong>Maintain Security</strong>: Implement proper secrets management and security hardening</li>
</ol>

<p><br /></p>

<h3 id="future-considerations">Future Considerations</h3>

<p>As <strong>container orchestration continues to evolve</strong>, Docker Compose remains relevant for <strong>single-host deployments, development environments, and smaller production workloads</strong>. For larger, distributed systems, consider <strong>Kubernetes or Docker Swarm</strong>, but Docker Compose provides an excellent <strong>foundation and learning platform</strong> for container orchestration concepts.</p>

<p><strong>The combination of simplicity, power, and extensive ecosystem support ensures that Docker Compose will continue to be a cornerstone tool</strong> for developers and DevOps professionals working with containerized applications.</p>

<p><br /></p>

<hr />

<h2 id="references">References</h2>

<ul>
  <li><a href="https://docs.docker.com/compose/">Docker Compose Official Documentation</a></li>
  <li><a href="https://docs.docker.com/compose/migrate/">Docker Compose V2 Migration Guide</a></li>
  <li><a href="https://docs.docker.com/compose/compose-file/">Compose File Specification</a></li>
  <li><a href="https://docs.docker.com/compose/reference/">Docker Compose CLI Reference</a></li>
  <li><a href="https://docs.docker.com/compose/networking/">Docker Compose Networking</a></li>
  <li><a href="https://docs.docker.com/compose/environment-variables/">Docker Compose Environment Variables</a></li>
  <li><a href="https://docs.docker.com/compose/production/">Docker Compose Production Guidelines</a></li>
  <li><a href="https://docs.docker.com/compose/production/">Docker Swarm vs Compose</a></li>
  <li><a href="https://docs.docker.com/engine/security/">Container Security Best Practices</a></li>
  <li><a href="https://docs.docker.com/compose/file-watch/">Docker Compose Watch Mode</a></li>
  <li><a href="https://docs.docker.com/compose/extends/">Docker Compose Override Files</a></li>
  <li><a href="https://prometheus.io/docs/guides/dockerswarm/">Prometheus Docker Monitoring</a></li>
  <li><a href="https://grafana.com/docs/grafana/latest/installation/docker/">Grafana Docker Integration</a></li>
  <li><a href="https://www.elastic.co/guide/en/elastic-stack-get-started/current/get-started-docker.html">ELK Stack with Docker Compose</a></li>
  <li><a href="https://www.jaegertracing.io/docs/getting-started/">Jaeger Tracing with Docker</a></li>
</ul>


                <!-- Pagination links -->


            </article>

            
                <aside class="see-also">
                    <h2>See also</h2>
                    <ul>
                        
                        
                        
                            <li>
                                <a href="/category/cs/tls-https/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1767770122/tls-handshake-1_nwd3f0.png">
                                    
                                    <h3>TLS Handshake and Certificate Architecture - A Deep Dive into HTTPS Security</h3>
                                </a>
                            </li>
                        
                            <li>
                                <a href="/category/container/dockerfile/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1755656803/dockerfile-1_xe6akt.png">
                                    
                                    <h3>Dockerfile - Complete Guide to Container Image Creation and Best Practices</h3>
                                </a>
                            </li>
                        
                            <li>
                                <a href="/category/cicd/git-standard/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1755676242/git-standard-1_vlntxr.png">
                                    
                                    <h3>Essential Git Commands: A Complete Developer's Guide</h3>
                                </a>
                            </li>
                        
                    </ul>
                </aside>
            

        </section>

        <!-- Add time bar only for pages without pagination -->
        
            <div class="time-bar" data-minutes="66">
    <span class="time-completed"></span>
    <span class="time-remaining"></span>
    <div class="bar">
        <span class="completed" style="width:0%;"></span>
        <span class="remaining" style="width:100%;"></span>
    </div>
</div>

            <button class="toggle-preview" onclick="togglePreview()">
    <span>Hide Preview ▼</span>
</button>

<div id="recommendationSection" class="recommendation">
    <div class="message">
        <strong>Why don't you read something next?</strong>
        <div>
            <button>
                <svg><use xlink:href="#icon-arrow-right"></use></svg>
                <span>Go back to top</span>
            </button>
        </div>
    </div>
    <div id="previewSection" class="preview-section">
        
        <a href="/category/cicd/git-standard/" class="post-preview">
            <div class="image">
                
                    <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1755676242/git-standard-1_vlntxr.png">
                
            </div>
            <h3 class="title">Essential Git Commands: A Complete Developer's Guide</h3>
        </a>
    </div>
</div>

<style>
.toggle-preview {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #333;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 4px;
    cursor: pointer;
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.toggle-preview:hover {
    background: #444;
}

.toggle-preview.visible {
    opacity: 1;
}

.recommendation {
    margin-top: 1000px;
    display: block;
    transition: all 0.3s ease;
}

.recommendation.hidden {
    display: none;
}

.hide-preview {
    margin-left: 10px;
    background: none;
    border: 1px solid #666;
    color: #666;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
}

.hide-preview:hover {
    background: #f0f0f0;
}

.preview-section {
    max-height: 1000px;
    overflow: hidden;
    transition: max-height 0.3s ease-out;
}

.preview-section.hidden {
    max-height: 0;
}
</style>

<script>
function togglePreview() {
    const recommendation = document.getElementById('recommendationSection');
    const button = document.querySelector('.toggle-preview span');
    
    if (recommendation.classList.contains('hidden')) {
        recommendation.classList.remove('hidden');
        button.textContent = 'Hide Preview ▼';
    } else {
        recommendation.classList.add('hidden');
        button.textContent = 'Show Preview ▲';
    }
}

window.addEventListener('scroll', function() {
    const toggleButton = document.querySelector('.toggle-preview');
    const recommendation = document.getElementById('recommendationSection');
    const rect = recommendation.getBoundingClientRect();
    
    if (rect.top <= window.innerHeight) {
        toggleButton.classList.add('visible');
    } else {
        toggleButton.classList.remove('visible');
    }
});
</script>

        

        <!-- Show modal if the post is the last one -->
        

        <!-- Show modal before user leaves the page -->
        

        <!-- Add your newsletter subscription form here -->

        <section class="share">
    <h3>Share</h3>
    <a aria-label="Share on Twitter" href="https://twitter.com/intent/tweet?text=&quot;Comprehensive guide to Docker Compose for defining, configuring, and running multi-container Docker applications with YAML-based orchestration&quot;%20https://somaz.blog/category/container/docker-compose/%20via%20&#64;twitter_username&hashtags=docker-compose,container-orchestration,microservices,yaml-configuration,multi-container,devops,development-environment,service-management,docker"
    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Share on Twitter">
        <svg class="icon icon-twitter"><use xlink:href="#icon-twitter"></use></svg>
    </a>
    <a aria-label="Share on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://somaz.blog/category/container/docker-compose/"
    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook">
        <svg class="icon icon-facebook"><use xlink:href="#icon-facebook"></use></svg>
    </a>
</section>

        

  <section class="author">
    <div class="details">
      
        <img class="img-rounded" src="/assets/img/uploads/profile.png" alt="Somaz">
      
      <p class="def">Author</p>
      <h3 class="name">
        <a href="/authors/somaz/">Somaz</a>
      </h3>
      <p class="desc">DevOps engineer focused on cloud infrastructure and automation</p>
      <p>
        
          <a href="https://github.com/somaz94" title="Github">
            <svg><use xlink:href="#icon-github"></use></svg>
          </a>
        
        
        
        
        
        
          <a href="https://www.linkedin.com/in/somaz" title="LinkedIn">
            <svg><use xlink:href="#icon-linkedin"></use></svg>
          </a>
        
        
          <a href="https://somaz.tistory.com" title="Tistory">
            <svg><use xlink:href="#icon-tistory"></use></svg>
          </a>
        
      </p>
    </div>
  </section>

  
  
  
  
  
  
  
  

  <script type="application/ld+json">
  {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "Somaz",
      
      "image": "/assets/img/uploads/profile.png",
      
      "jobTitle": "DevOps Engineer",
      "url": "https://somaz.blog/authors/somaz/",
      "sameAs": [
        "https://github.com/somaz94","https://www.linkedin.com/in/somaz","https://{{ author.tistory_username }}.tistory.com"
      ]
  }
  </script>


        

<section class="comments">
    <h3>Comments</h3>
    <div id="disqus_thread"></div>
</section>
<script type="text/javascript">
    var disqus_loaded = false;

    function load_disqus()
    {
        disqus_loaded = true;
        var disqus_shortname = 'https-somaz94-github-io';
        var disqus_title = '';
        var disqus_url = '/category/container/docker-compose/';
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        var ldr = document.getElementById('disqus_loader');
    };
    window.onscroll = function(e) {
        if ((window.innerHeight + window.scrollY) >= (document.body.offsetHeight - 800)) {
            //hit bottom of page
            if (disqus_loaded==false)
                load_disqus()
        }
    };
</script>



        <footer>
    <p>
      
        <a href="https://github.com/somaz94" title="Github">
          <svg><use xlink:href="#icon-github"></use></svg>
        </a>
      
      
        <a href="https://www.facebook.com/facebook_username" title="Facebook">
          <svg><use xlink:href="#icon-facebook"></use></svg>
        </a>
      
      
        <a href="https://twitter.com/twitter_username" title="Twitter">
          <svg><use xlink:href="#icon-twitter"></use></svg>
        </a>
      
      
        <a href="https://medium.com/@medium_username" title="Medium">
          <svg><use xlink:href="#icon-medium"></use></svg>
        </a>
      
      
        <a href="https://www.instagram.com/instagram_username" title="Instagram">
          <svg><use xlink:href="#icon-instagram"></use></svg>
        </a>
      
      
        <a href="https://www.linkedin.com/in/somaz" title="LinkedIn">
          <svg><use xlink:href="#icon-linkedin"></use></svg>
        </a>
      
      
        <a href="https://somaz.tistory.com" title="Tistory">
          <svg><use xlink:href="#icon-tistory"></use></svg>
        </a>
      
    </p>

    <ul>
  
    
      <li>
        <a href="https://somaz.blog/">Home</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/about">About</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/category">Category</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/contact">Contact</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/feed.xml">Feed</a>
      </li>
    
  
</ul>


    <p>
      <a href="https://somaz.blog/sitemap.xml" title="sitemap">Sitemap</a> |
      <a href="https://somaz.blog/privacy-policy" title="Privacy Policy">Privacy Policy</a>
    </p>

    <p>
      <span>Somaz Tech Blog</span> <svg class="love"><use xlink:href="#icon-heart"></use></svg>
    </p>
</footer>










<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "somaz",
  "description": "DevOps engineer's tech blog.",
  "url": "https://somaz.blog/",
  "logo": {
      "@type": "ImageObject",
      "url": "https://somaz.blog/assets/img/icons/mediumtile.png",
      "width": "600",
      "height": "315"
  },
  "sameAs": [
    "https://github.com/somaz94","https://www.facebook.com/facebook_username","https://twitter.com/twitter_username","https://medium.com/@medium_username","https://www.instagram.com/instagram_username","https://www.linkedin.com/in/somaz","https://{{ site.tistory_username }}.tistory.com"
  ]
}
</script>

<!-- Include the script that allows Netlify CMS login -->
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

<!-- Include the website scripts -->
<script src="/assets/js/scripts.min.js"></script>

<!-- Include Google Analytics script -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-XXXXXXXX-X"></script>
<script>
  var host = window.location.hostname;
  if (host != 'localhost') {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-XXXXXXXX-X');
  }
</script>
  


<!-- Include extra scripts -->



        

        
        
        
        
        
        
        
        
        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "BlogPosting",
            "name": "Docker Compose - Complete Guide to Multi-Container Application Orchestration",
            "headline": "Master containerized application configuration and deployment with Docker Compose",
            "description": "Comprehensive guide to Docker Compose for defining, configuring, and running multi-container Docker applications with YAML-based orchestration",
            "image": "https://res.cloudinary.com/dkcm26aem/image/upload/v1755654072/docker-compose_l2hvau.png",
            "url": "https://somaz.blog/category/container/docker-compose/",
            "articleBody": "



Overview

Docker Compose is a powerful tool for defining and running multi-container Docker applications. Using a simple YAML file, you can configure your application’s services, networks, and volumes, then create and start all services with a single command. This approach transforms complex multi-container deployments into manageable, reproducible configurations.

Docker Compose excels in development, testing, and staging environments, while also being suitable for production use cases. It simplifies the orchestration of related services, making it an essential tool for modern containerized application development.



Evolution from V1 to V2


  Important Migration Notice
  
    July 2023: Docker Compose V1 reached end of life and no longer receives updates
    V2 is now the official standard: Integrated as a Docker CLI subcommand rather than standalone binary
    Command syntax change: docker-compose → docker compose (note the space)
    Enhanced features: Better performance, improved error handling, and new capabilities
  






Core Concepts and Architecture

Understanding Docker Compose’s architecture helps you design better multi-container applications.



Docker Compose Components


  
    
      Component
      Description
    
    
      Services
      Define containers and their configuration (image, ports, volumes, environment)
    
    
      Networks
      Enable communication between containers with automatic DNS resolution
    
    
      Volumes
      Persist data and share files between containers and host system
    
    
      Configs
      Manage configuration files separately from container images
    
    
      Secrets
      Securely manage sensitive data like passwords and API keys
    
  




Compose Workflow Architecture


  
    graph TD
        A[docker-compose.yml] --&amp;gt; B[Docker Compose CLI]
        B --&amp;gt; C[Docker Engine]
        C --&amp;gt; D[Container 1]
        C --&amp;gt; E[Container 2]
        C --&amp;gt; F[Container N]
        
        G[Custom Networks] --&amp;gt; D
        G --&amp;gt; E
        G --&amp;gt; F
        
        H[Persistent Volumes] --&amp;gt; D
        H --&amp;gt; E
        H --&amp;gt; F
        
        style A fill:#f9f,stroke:#333,stroke-width:2px
        style B fill:#bbf,stroke:#333,stroke-width:2px
        style C fill:#bfb,stroke:#333,stroke-width:2px
  






Installation and Setup

Install Docker Compose V2 for modern container orchestration capabilities.



Official Installation Methods

Method 1: Docker Desktop (Recommended)

# Docker Desktop includes Compose V2 by default
# Download from: https://www.docker.com/products/docker-desktop

# Verify installation
docker compose version


Method 2: Manual Installation (Linux)





Method 3: Package Manager Installation

# Ubuntu/Debian
sudo apt-get update
sudo apt-get install docker-compose-plugin

# CentOS/RHEL/Fedora
sudo yum install docker-compose-plugin
# or
sudo dnf install docker-compose-plugin

# macOS with Homebrew
brew install docker-compose




Post-Installation Verification

# Check Docker Compose version
docker compose version

# Verify Docker Engine compatibility
docker --version

# Test basic functionality
echo &quot;version: &apos;3.8&apos;
services:
  hello:
    image: hello-world&quot; &amp;gt; test-compose.yml

docker compose -f test-compose.yml up
docker compose -f test-compose.yml down

# Clean up test files
rm test-compose.yml






Essential Commands Reference

Master the core Docker Compose commands for efficient container management.



Lifecycle Management Commands

Service Startup and Shutdown

# Start all services defined in docker-compose.yml
docker compose up

# Start services in detached mode (background)
docker compose up -d

# Start specific services only
docker compose up service1 service2

# Build images before starting (if Dockerfile changes)
docker compose up --build

# Recreate containers even if configuration hasn&apos;t changed
docker compose up --force-recreate

# Stop all services
docker compose stop

# Stop specific services
docker compose stop service1 service2

# Stop and remove containers, networks, and volumes
docker compose down

# Remove everything including volumes (destructive!)
docker compose down -v

# Remove everything including images
docker compose down --rmi all


Build and Rebuild Operations

# Build or rebuild services
docker compose build

# Build specific service
docker compose build service-name

# Build with no cache (clean build)
docker compose build --no-cache

# Build with progress output
docker compose build --progress=plain

# Pull latest images before building
docker compose build --pull




Monitoring and Debugging Commands

Container Status and Logs

# List running containers
docker compose ps

# List all containers (including stopped)
docker compose ps -a

# Show container resource usage
docker compose top

# View logs from all services
docker compose logs

# Follow logs in real-time (like tail -f)
docker compose logs -f

# View logs for specific service
docker compose logs -f service-name

# View last N lines of logs
docker compose logs --tail=100 service-name

# Show timestamps in logs
docker compose logs -t service-name


Container Interaction

# Execute command in running container
docker compose exec service-name command

# Start interactive bash session
docker compose exec service-name bash

# Execute command as specific user
docker compose exec --user root service-name bash

# Run one-off command in new container
docker compose run service-name command

# Run command without dependencies
docker compose run --no-deps service-name command

# Run command and remove container after execution
docker compose run --rm service-name command




Advanced Management Commands

Configuration and Validation

# Validate docker-compose.yml syntax
docker compose config

# View the actual configuration that will be used
docker compose config --services

# Show only service names
docker compose config --services

# Resolve environment variables and show final config
docker compose config --resolve-env-vars

# Check for configuration errors
docker compose config --quiet


Service Scaling and Updates

# Scale service to specific number of replicas
docker compose up --scale service-name=3

# Update service configuration without downtime
docker compose up -d --no-deps service-name

# Restart specific services
docker compose restart service-name

# Restart all services
docker compose restart

# Pause/unpause services
docker compose pause service-name
docker compose unpause service-name






YAML Configuration Deep Dive

Master the docker-compose.yml file structure for complex application architectures.



Basic Compose File Structure

Standard Web Application Stack

version: &apos;3.8&apos;

services:
  # Database service
  database:
    image: postgres:15-alpine
    container_name: app_database
    environment:
      POSTGRES_DB: ${DB_NAME:-myapp}
      POSTGRES_USER: ${DB_USER:-postgres}
      POSTGRES_PASSWORD: ${DB_PASSWORD:-secret}
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./init-scripts:/docker-entrypoint-initdb.d
    ports:
      - &quot;${DB_PORT:-5432}:5432&quot;
    networks:
      - backend
    restart: unless-stopped
    healthcheck:
      test: [&quot;CMD-SHELL&quot;, &quot;pg_isready -U ${DB_USER:-postgres}&quot;]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

  # Redis cache service
  cache:
    image: redis:7-alpine
    container_name: app_cache
    command: redis-server --appendonly yes --requirepass ${REDIS_PASSWORD:-cache_secret}
    volumes:
      - redis_data:/data
      - ./redis.conf:/usr/local/etc/redis/redis.conf
    ports:
      - &quot;${REDIS_PORT:-6379}:6379&quot;
    networks:
      - backend
    restart: unless-stopped
    healthcheck:
      test: [&quot;CMD&quot;, &quot;redis-cli&quot;, &quot;--raw&quot;, &quot;incr&quot;, &quot;ping&quot;]
      interval: 30s
      timeout: 3s
      retries: 5

  # Application service
  app:
    build:
      context: ./app
      dockerfile: Dockerfile
      args:
        BUILD_ENV: ${NODE_ENV:-development}
        APP_VERSION: ${APP_VERSION:-latest}
    container_name: app_backend
    environment:
      NODE_ENV: ${NODE_ENV:-development}
      DATABASE_URL: postgres://${DB_USER:-postgres}:${DB_PASSWORD:-secret}@database:5432/${DB_NAME:-myapp}
      REDIS_URL: redis://cache:6379
      JWT_SECRET: ${JWT_SECRET:-your-jwt-secret}
      API_PORT: 3000
    volumes:
      - ./app:/usr/src/app
      - /usr/src/app/node_modules
      - app_uploads:/usr/src/app/uploads
    ports:
      - &quot;${APP_PORT:-3000}:3000&quot;
    depends_on:
      database:
        condition: service_healthy
      cache:
        condition: service_healthy
    networks:
      - frontend
      - backend
    restart: unless-stopped
    healthcheck:
      test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost:3000/health&quot;]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 120s

  # Nginx reverse proxy
  nginx:
    image: nginx:alpine
    container_name: app_nginx
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./nginx/sites-enabled:/etc/nginx/sites-enabled:ro
      - ./static:/usr/share/nginx/html:ro
      - nginx_logs:/var/log/nginx
    ports:
      - &quot;${HTTP_PORT:-80}:80&quot;
      - &quot;${HTTPS_PORT:-443}:443&quot;
    depends_on:
      - app
    networks:
      - frontend
    restart: unless-stopped
    healthcheck:
      test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost/health&quot;]
      interval: 30s
      timeout: 10s
      retries: 3

# Network definitions
networks:
  frontend:
    driver: bridge
    name: app_frontend
  backend:
    driver: bridge
    name: app_backend
    internal: true  # Backend network is isolated

# Volume definitions
volumes:
  postgres_data:
    driver: local
    name: app_postgres_data
  redis_data:
    driver: local
    name: app_redis_data
  app_uploads:
    driver: local
    name: app_uploads
  nginx_logs:
    driver: local
    name: app_nginx_logs




Advanced Configuration Patterns

Microservices Architecture Example

version: &apos;3.8&apos;

services:
  # API Gateway
  api-gateway:
    build:
      context: ./api-gateway
      dockerfile: Dockerfile
    environment:
      - SERVICES_USER=user-service:3001
      - SERVICES_ORDER=order-service:3002
      - SERVICES_PAYMENT=payment-service:3003
    ports:
      - &quot;8080:8080&quot;
    depends_on:
      - user-service
      - order-service
      - payment-service
    networks:
      - api-network

  # User microservice
  user-service:
    build:
      context: ./services/user
      dockerfile: Dockerfile
    environment:
      - DB_HOST=user-db
      - DB_PORT=5432
      - DB_NAME=users
      - JWT_SECRET=${JWT_SECRET}
    depends_on:
      user-db:
        condition: service_healthy
    networks:
      - api-network
      - user-network
    deploy:
      replicas: 2
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M

  user-db:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: users
      POSTGRES_USER: ${USER_DB_USER}
      POSTGRES_PASSWORD: ${USER_DB_PASSWORD}
    volumes:
      - user_db_data:/var/lib/postgresql/data
    networks:
      - user-network
    healthcheck:
      test: [&quot;CMD-SHELL&quot;, &quot;pg_isready -U ${USER_DB_USER}&quot;]
      interval: 30s
      timeout: 10s
      retries: 3

  # Order microservice
  order-service:
    build:
      context: ./services/order
      dockerfile: Dockerfile
    environment:
      - DB_HOST=order-db
      - MESSAGE_QUEUE_URL=amqp://rabbitmq:5672
    depends_on:
      - order-db
      - rabbitmq
    networks:
      - api-network
      - order-network
      - message-network

  order-db:
    image: mongodb/mongodb-community-server:latest
    environment:
      MONGODB_INITDB_ROOT_USERNAME: ${MONGO_USER}
      MONGODB_INITDB_ROOT_PASSWORD: ${MONGO_PASSWORD}
    volumes:
      - order_db_data:/data/db
    networks:
      - order-network

  # Payment microservice
  payment-service:
    build:
      context: ./services/payment
      dockerfile: Dockerfile
    environment:
      - PAYMENT_PROVIDER_API_KEY=${PAYMENT_API_KEY}
      - MESSAGE_QUEUE_URL=amqp://rabbitmq:5672
    depends_on:
      - rabbitmq
    networks:
      - api-network
      - message-network
    secrets:
      - payment_api_key

  # Message queue
  rabbitmq:
    image: rabbitmq:3-management-alpine
    environment:
      RABBITMQ_DEFAULT_USER: ${RABBITMQ_USER}
      RABBITMQ_DEFAULT_PASS: ${RABBITMQ_PASSWORD}
    volumes:
      - rabbitmq_data:/var/lib/rabbitmq
    ports:
      - &quot;15672:15672&quot;  # Management interface
    networks:
      - message-network

  # Monitoring and logging
  prometheus:
    image: prom/prometheus:latest
    volumes:
      - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus_data:/prometheus
    ports:
      - &quot;9090:9090&quot;
    networks:
      - monitoring-network

  grafana:
    image: grafana/grafana:latest
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_PASSWORD}
    volumes:
      - grafana_data:/var/lib/grafana
      - ./monitoring/dashboards:/etc/grafana/provisioning/dashboards
    ports:
      - &quot;3001:3000&quot;
    depends_on:
      - prometheus
    networks:
      - monitoring-network

networks:
  api-network:
    driver: bridge
  user-network:
    driver: bridge
    internal: true
  order-network:
    driver: bridge
    internal: true
  message-network:
    driver: bridge
    internal: true
  monitoring-network:
    driver: bridge

volumes:
  user_db_data:
  order_db_data:
  rabbitmq_data:
  prometheus_data:
  grafana_data:

secrets:
  payment_api_key:
    file: ./secrets/payment_api_key.txt




Development-Optimized Configuration

Hot Reload and Development Tools

version: &apos;3.8&apos;

services:
  # Development API with hot reload
  api-dev:
    build:
      context: ./api
      dockerfile: Dockerfile.dev
      target: development
    environment:
      - NODE_ENV=development
      - DEBUG=app:*
      - DATABASE_URL=postgres://dev:dev@postgres:5432/dev_db
    volumes:
      - ./api:/app
      - /app/node_modules
      - api_logs:/app/logs
    ports:
      - &quot;3000:3000&quot;
      - &quot;9229:9229&quot;  # Node.js debugger port
    depends_on:
      - postgres
      - redis
    networks:
      - dev-network
    develop:
      watch:
        - action: sync
          path: ./api/src
          target: /app/src
        - action: rebuild
          path: ./api/package.json
          target: /app/package.json

  # Frontend development server
  frontend-dev:
    build:
      context: ./frontend
      dockerfile: Dockerfile.dev
    environment:
      - VITE_API_URL=http://localhost:3000
      - VITE_HOT_RELOAD=true
    volumes:
      - ./frontend:/app
      - /app/node_modules
    ports:
      - &quot;5173:5173&quot;  # Vite dev server
    networks:
      - dev-network
    develop:
      watch:
        - action: sync+restart
          path: ./frontend/src
          target: /app/src

  # Development database with initialization
  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: dev_db
      POSTGRES_USER: dev
      POSTGRES_PASSWORD: dev
    volumes:
      - postgres_dev_data:/var/lib/postgresql/data
      - ./database/init:/docker-entrypoint-initdb.d
      - ./database/dev-data:/dev-data
    ports:
      - &quot;5432:5432&quot;
    networks:
      - dev-network

  # Redis for development
  redis:
    image: redis:7-alpine
    ports:
      - &quot;6379:6379&quot;
    networks:
      - dev-network

  # Development tools
  mailhog:
    image: mailhog/mailhog:latest
    ports:
      - &quot;1025:1025&quot;  # SMTP server
      - &quot;8025:8025&quot;  # Web interface
    networks:
      - dev-network

  # Database administration tool
  pgadmin:
    image: dpage/pgadmin4:latest
    environment:
      PGADMIN_DEFAULT_EMAIL: admin@dev.local
      PGADMIN_DEFAULT_PASSWORD: admin
    ports:
      - &quot;8080:80&quot;
    depends_on:
      - postgres
    networks:
      - dev-network

networks:
  dev-network:
    driver: bridge
    name: dev_network

volumes:
  postgres_dev_data:
  api_logs:






Environment Management and Configuration

Implement flexible environment-specific configurations for different deployment scenarios.



Environment Variables and .env Files

Comprehensive .env Configuration

# .env file - Default development configuration

# Application Settings
APP_NAME=MyApplication
APP_VERSION=1.0.0
NODE_ENV=development
APP_DEBUG=true
APP_PORT=3000

# Database Configuration
DB_CONNECTION=postgres
DB_HOST=database
DB_PORT=5432
DB_NAME=myapp_dev
DB_USER=postgres
DB_PASSWORD=dev_secret_123
DATABASE_URL=postgres://${DB_USER}:${DB_PASSWORD}@${DB_HOST}:${DB_PORT}/${DB_NAME}

# Redis Configuration
REDIS_HOST=cache
REDIS_PORT=6379
REDIS_PASSWORD=redis_secret_456
REDIS_URL=redis://:${REDIS_PASSWORD}@${REDIS_HOST}:${REDIS_PORT}

# Security Settings
JWT_SECRET=your-super-secret-jwt-key-change-in-production
JWT_EXPIRES_IN=7d
SESSION_SECRET=session-secret-key
ENCRYPTION_KEY=32-character-encryption-key-here

# External Services
STRIPE_PUBLIC_KEY=pk_test_xxxxxxxxxxxxx
STRIPE_SECRET_KEY=sk_test_xxxxxxxxxxxxx
SENDGRID_API_KEY=SG.xxxxxxxxxxxxx
AWS_ACCESS_KEY_ID=AKIAXXXXXXXXXXXXX
AWS_SECRET_ACCESS_KEY=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
AWS_REGION=us-east-1
AWS_S3_BUCKET=my-app-uploads

# Feature Flags
FEATURE_NEW_UI=true
FEATURE_ANALYTICS=false
FEATURE_BETA_FEATURES=true

# Monitoring and Logging
LOG_LEVEL=debug
SENTRY_DSN=https://xxxxxxxxxxxxx@sentry.io/xxxxxxx
NEW_RELIC_LICENSE_KEY=xxxxxxxxxxxxx

# Development Tools
HOT_RELOAD=true
DEBUG_MODE=true
MOCK_EXTERNAL_SERVICES=true


Environment-Specific Override Files

Production Environment (.env.production)

# .env.production - Production overrides

NODE_ENV=production
APP_DEBUG=false
LOG_LEVEL=info

# Secure production database
DB_HOST=prod-db.company.com
DB_NAME=myapp_production
DB_USER=prod_user
DB_PASSWORD=${PROD_DB_PASSWORD}  # Set via CI/CD secrets

# Production Redis cluster
REDIS_HOST=prod-redis-cluster.company.com
REDIS_PASSWORD=${PROD_REDIS_PASSWORD}

# Production security
JWT_SECRET=${PROD_JWT_SECRET}
SESSION_SECRET=${PROD_SESSION_SECRET}

# Production services
STRIPE_PUBLIC_KEY=${PROD_STRIPE_PUBLIC_KEY}
STRIPE_SECRET_KEY=${PROD_STRIPE_SECRET_KEY}

# Feature flags for production
FEATURE_BETA_FEATURES=false
MOCK_EXTERNAL_SERVICES=false

# Production monitoring
SENTRY_DSN=${PROD_SENTRY_DSN}
NEW_RELIC_LICENSE_KEY=${PROD_NEW_RELIC_KEY}


Testing Environment (.env.test)

# .env.test - Testing configuration

NODE_ENV=test
APP_DEBUG=true
LOG_LEVEL=warn

# Test database (typically in-memory or isolated)
DB_NAME=myapp_test
DB_USER=test_user
DB_PASSWORD=test_pass

# Mock external services for testing
MOCK_EXTERNAL_SERVICES=true
STRIPE_SECRET_KEY=sk_test_mock
SENDGRID_API_KEY=test_key

# Fast test execution
FEATURE_ANALYTICS=false
FEATURE_NEW_UI=true

# Test-specific settings
TEST_TIMEOUT=30000
PARALLEL_TEST_WORKERS=4




Advanced Environment Variable Usage

Dynamic Configuration in Compose

version: &apos;3.8&apos;

services:
  app:
    image: myapp:${APP_VERSION:-latest}
    environment:
      # Direct environment variable assignment
      - NODE_ENV=${NODE_ENV:-development}
      - APP_PORT=${APP_PORT:-3000}
      
      # Computed environment variables
      - DATABASE_URL=postgres://${DB_USER}:${DB_PASSWORD}@${DB_HOST}:${DB_PORT}/${DB_NAME}
      - REDIS_URL=redis://:${REDIS_PASSWORD}@${REDIS_HOST}:${REDIS_PORT}
      
      # Environment-specific feature flags
      - FEATURE_DEBUG=${NODE_ENV:-development == &apos;development&apos; ? &apos;true&apos; : &apos;false&apos;}
      
      # External file references
      - AWS_CREDENTIALS_FILE=/run/secrets/aws_credentials
    
    # Environment file precedence (later files override earlier ones)
    env_file:
      - .env                    # Base configuration
      - .env.${NODE_ENV:-dev}   # Environment-specific overrides
      - .env.local              # Local developer overrides (git-ignored)
    
    # Secret management
    secrets:
      - source: aws_credentials
        target: /run/secrets/aws_credentials
        mode: 0400

secrets:
  aws_credentials:
    file: ./secrets/aws_credentials.json


Environment Variable Validation

# docker-compose.yml with validation
version: &apos;3.8&apos;

services:
  app:
    build: .
    environment:
      - NODE_ENV=${NODE_ENV:?NODE_ENV is required}
      - DATABASE_URL=${DATABASE_URL:?DATABASE_URL is required}
      - JWT_SECRET=${JWT_SECRET:?JWT_SECRET must be set for security}
      - API_KEY=${API_KEY:?API_KEY is required for external service integration}
    
    # Health check that validates configuration
    healthcheck:
      test: [&quot;CMD&quot;, &quot;node&quot;, &quot;scripts/health-check.js&quot;]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s






Override Files and Multi-Environment Support

Manage different environments efficiently using Docker Compose override mechanisms.



Override File Hierarchy

Base Configuration (docker-compose.yml)

# docker-compose.yml - Base configuration for all environments
version: &apos;3.8&apos;

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    environment:
      - NODE_ENV=${NODE_ENV:-development}
    volumes:
      - ./src:/app/src
    networks:
      - app-network

  database:
    image: postgres:15-alpine
    environment:
      - POSTGRES_DB=${DB_NAME}
      - POSTGRES_USER=${DB_USER}
      - POSTGRES_PASSWORD=${DB_PASSWORD}
    volumes:
      - db_data:/var/lib/postgresql/data
    networks:
      - app-network

networks:
  app-network:
    driver: bridge

volumes:
  db_data:


Development Override (docker-compose.override.yml)

# docker-compose.override.yml - Automatically applied in development
version: &apos;3.8&apos;

services:
  app:
    ports:
      - &quot;3000:3000&quot;
      - &quot;9229:9229&quot;  # Debug port
    environment:
      - DEBUG=app:*
      - HOT_RELOAD=true
    volumes:
      - ./src:/app/src:cached      # Optimized for development
      - /app/node_modules          # Prevent overwriting
    command: npm run dev
    develop:
      watch:
        - action: sync
          path: ./src
          target: /app/src
        - action: rebuild
          path: package.json

  database:
    ports:
      - &quot;5432:5432&quot;  # Expose database for development tools
    environment:
      - POSTGRES_DB=myapp_dev
      - POSTGRES_USER=dev
      - POSTGRES_PASSWORD=dev

  # Development-only services
  pgadmin:
    image: dpage/pgadmin4:latest
    environment:
      - PGADMIN_DEFAULT_EMAIL=admin@dev.local
      - PGADMIN_DEFAULT_PASSWORD=admin
    ports:
      - &quot;8080:80&quot;
    depends_on:
      - database
    networks:
      - app-network

  mailhog:
    image: mailhog/mailhog:latest
    ports:
      - &quot;1025:1025&quot;  # SMTP
      - &quot;8025:8025&quot;  # Web interface
    networks:
      - app-network


Production Override (docker-compose.prod.yml)

# docker-compose.prod.yml - Production-specific configuration
version: &apos;3.8&apos;

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile.prod
      target: production
    restart: unless-stopped
    deploy:
      replicas: 3
      resources:
        limits:
          memory: 1G
          cpus: &apos;0.5&apos;
        reservations:
          memory: 512M
          cpus: &apos;0.25&apos;
      update_config:
        parallelism: 1
        delay: 10s
        order: start-first
    environment:
      - NODE_ENV=production
      - LOG_LEVEL=info
    # Remove development volumes
    volumes: []
    # Production command
    command: npm start
    healthcheck:
      test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost:3000/health&quot;]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

  database:
    # Production database configuration
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 2G
          cpus: &apos;1.0&apos;
    # Remove development port exposure
    ports: []
    environment:
      - POSTGRES_DB=${PROD_DB_NAME}
      - POSTGRES_USER=${PROD_DB_USER}
      - POSTGRES_PASSWORD=${PROD_DB_PASSWORD}
    
    # Production volume with backup configuration
    volumes:
      - prod_db_data:/var/lib/postgresql/data
      - ./backups:/backups

  # Production-specific services
  nginx:
    image: nginx:alpine
    ports:
      - &quot;80:80&quot;
      - &quot;443:443&quot;
    volumes:
      - ./nginx/prod.conf:/etc/nginx/nginx.conf:ro
      - ./ssl:/etc/nginx/ssl:ro
      - ./static:/usr/share/nginx/html:ro
    depends_on:
      - app
    restart: unless-stopped
    networks:
      - app-network

  # Log aggregation
  fluentd:
    image: fluent/fluentd:latest
    volumes:
      - ./fluentd/conf:/fluentd/etc
      - ./logs:/fluentd/log
    networks:
      - app-network

volumes:
  prod_db_data:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: /opt/app/data/postgres


Testing Override (docker-compose.test.yml)

# docker-compose.test.yml - Testing environment configuration
version: &apos;3.8&apos;

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile.test
      target: test
    environment:
      - NODE_ENV=test
      - CI=true
      - COVERAGE=true
    command: npm run test:ci
    volumes:
      - ./coverage:/app/coverage
      - ./test-results:/app/test-results

  database:
    environment:
      - POSTGRES_DB=myapp_test
      - POSTGRES_USER=test
      - POSTGRES_PASSWORD=test
    tmpfs:
      - /var/lib/postgresql/data  # In-memory database for faster tests

  # Test dependencies
  test-db:
    image: postgres:15-alpine
    environment:
      - POSTGRES_DB=test_db
      - POSTGRES_USER=test
      - POSTGRES_PASSWORD=test
    tmpfs:
      - /var/lib/postgresql/data

  # Mock external services
  mock-api:
    image: wiremock/wiremock:latest
    ports:
      - &quot;8081:8080&quot;
    volumes:
      - ./test/mocks:/home/wiremock
    networks:
      - app-network




Environment-Specific Usage Commands

# Development (uses docker-compose.override.yml automatically)
docker compose up -d

# Production deployment
docker compose -f docker-compose.yml -f docker-compose.prod.yml up -d

# Testing environment
docker compose -f docker-compose.yml -f docker-compose.test.yml up --abort-on-container-exit

# Staging environment
docker compose -f docker-compose.yml -f docker-compose.staging.yml up -d

# Local development with custom overrides
docker compose -f docker-compose.yml -f docker-compose.override.yml -f docker-compose.local.yml up -d

# Multiple environment files (later files override earlier ones)
docker compose -f docker-compose.yml -f docker-compose.prod.yml -f docker-compose.monitoring.yml up -d






Advanced Features and Patterns

Explore sophisticated Docker Compose capabilities for complex applications.



Health Checks and Dependency Management

Comprehensive Health Check Configuration

version: &apos;3.8&apos;

services:
  # Database with health check
  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: myapp
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
    healthcheck:
      test: [&quot;CMD-SHELL&quot;, &quot;pg_isready -U user -d myapp&quot;]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 60s
    volumes:
      - postgres_data:/var/lib/postgresql/data

  # Redis with health check
  redis:
    image: redis:7-alpine
    healthcheck:
      test: [&quot;CMD&quot;, &quot;redis-cli&quot;, &quot;ping&quot;]
      interval: 30s
      timeout: 3s
      retries: 5
      start_period: 30s
    volumes:
      - redis_data:/data

  # Application with sophisticated health check
  app:
    build: .
    environment:
      - DATABASE_URL=postgres://user:password@postgres:5432/myapp
      - REDIS_URL=redis://redis:6379
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
    healthcheck:
      test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost:3000/health&quot;]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 120s
    ports:
      - &quot;3000:3000&quot;

  # Web server with dependency on app health
  nginx:
    image: nginx:alpine
    depends_on:
      app:
        condition: service_healthy
    healthcheck:
      test: [&quot;CMD&quot;, &quot;wget&quot;, &quot;--no-verbose&quot;, &quot;--tries=1&quot;, &quot;--spider&quot;, &quot;http://localhost/health&quot;]
      interval: 30s
      timeout: 10s
      retries: 3
    ports:
      - &quot;80:80&quot;
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf

volumes:
  postgres_data:
  redis_data:




Watch Mode and Live Development

Advanced Watch Configuration

version: &apos;3.8&apos;

services:
  # Frontend with hot module replacement
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile.dev
    volumes:
      - ./frontend:/app
      - /app/node_modules
    ports:
      - &quot;3000:3000&quot;
    environment:
      - FAST_REFRESH=true
      - CHOKIDAR_USEPOLLING=true
    develop:
      watch:
        # Sync JavaScript/TypeScript changes
        - action: sync
          path: ./frontend/src
          target: /app/src
          ignore:
            - &quot;**/*.test.js&quot;
            - &quot;**/*.spec.ts&quot;
            
        # Rebuild on package.json changes
        - action: rebuild
          path: ./frontend/package.json
          
        # Sync configuration files
        - action: sync+restart
          path: ./frontend/vite.config.js
          target: /app/vite.config.js

  # Backend API with nodemon
  api:
    build:
      context: ./api
      dockerfile: Dockerfile.dev
    volumes:
      - ./api:/app
      - /app/node_modules
    environment:
      - NODE_ENV=development
    develop:
      watch:
        # Sync source code changes
        - action: sync+restart
          path: ./api/src
          target: /app/src
          
        # Rebuild on dependency changes
        - action: rebuild
          path: ./api/package.json
          
        # Sync environment configuration
        - action: sync
          path: ./api/.env.development
          target: /app/.env

  # Database migrations on schema changes
  migrator:
    build:
      context: ./api
      dockerfile: Dockerfile.dev
    command: npm run migrate:watch
    volumes:
      - ./api/migrations:/app/migrations
    depends_on:
      - postgres
    develop:
      watch:
        # Run migrations on schema changes
        - action: exec
          path: ./api/migrations
          command: npm run migrate:latest

  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: development
      POSTGRES_USER: dev
      POSTGRES_PASSWORD: dev
    volumes:
      - postgres_data:/var/lib/postgresql/data

volumes:
  postgres_data:


Usage with watch mode:

# Start services with file watching
docker compose watch

# Start specific services with watching
docker compose watch frontend api

# Watch with verbose output
docker compose watch --verbose




Network Configuration and Security

Advanced Network Topologies

version: &apos;3.8&apos;

services:
  # Public-facing load balancer
  traefik:
    image: traefik:latest
    command:
      - &quot;--api.insecure=true&quot;
      - &quot;--providers.docker=true&quot;
      - &quot;--providers.docker.exposedbydefault=false&quot;
      - &quot;--entrypoints.web.address=:80&quot;
      - &quot;--entrypoints.websecure.address=:443&quot;
    ports:
      - &quot;80:80&quot;
      - &quot;443:443&quot;
      - &quot;8080:8080&quot;  # Traefik dashboard
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    networks:
      - public
      - internal

  # Frontend application
  frontend:
    build: ./frontend
    labels:
      - &quot;traefik.enable=true&quot;
      - &quot;traefik.http.routers.frontend.rule=Host(`app.localhost`)&quot;
      - &quot;traefik.http.routers.frontend.entrypoints=web&quot;
      - &quot;traefik.http.services.frontend.loadbalancer.server.port=3000&quot;
    networks:
      - internal

  # API backend
  api:
    build: ./api
    environment:
      - DATABASE_URL=postgres://user:pass@postgres:5432/app
      - REDIS_URL=redis://redis:6379
    labels:
      - &quot;traefik.enable=true&quot;
      - &quot;traefik.http.routers.api.rule=Host(`api.localhost`)&quot;
      - &quot;traefik.http.routers.api.entrypoints=web&quot;
    depends_on:
      - postgres
      - redis
    networks:
      - internal
      - database

  # Database (isolated network)
  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: app
      POSTGRES_USER: user
      POSTGRES_PASSWORD: pass
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - database

  # Cache (isolated network)
  redis:
    image: redis:7-alpine
    networks:
      - database

  # Background workers (database access only)
  worker:
    build: ./worker
    environment:
      - DATABASE_URL=postgres://user:pass@postgres:5432/app
      - REDIS_URL=redis://redis:6379
    depends_on:
      - postgres
      - redis
    networks:
      - database

  # Monitoring (separate network)
  prometheus:
    image: prom/prometheus:latest
    volumes:
      - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus_data:/prometheus
    networks:
      - monitoring
      - internal

  grafana:
    image: grafana/grafana:latest
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
    volumes:
      - grafana_data:/var/lib/grafana
    ports:
      - &quot;3001:3000&quot;
    networks:
      - monitoring

networks:
  # Public network for external access
  public:
    driver: bridge
    
  # Internal network for inter-service communication
  internal:
    driver: bridge
    internal: false
    
  # Database network (isolated)
  database:
    driver: bridge
    internal: true
    
  # Monitoring network
  monitoring:
    driver: bridge

volumes:
  postgres_data:
  prometheus_data:
  grafana_data:




Resource Management and Scaling

Resource Limits and Constraints

version: &apos;3.8&apos;

services:
  # Resource-constrained web application
  app:
    build: .
    deploy:
      resources:
        limits:
          cpus: &apos;1.0&apos;
          memory: 1G
          pids: 100
        reservations:
          cpus: &apos;0.25&apos;
          memory: 256M
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3
        window: 120s
      update_config:
        parallelism: 2
        delay: 10s
        order: start-first
        failure_action: rollback
      rollback_config:
        parallelism: 1
        delay: 5s
        order: stop-first
    healthcheck:
      test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost:3000/health&quot;]
      interval: 30s
      timeout: 10s
      retries: 3

  # Database with resource management
  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: myapp
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
    deploy:
      resources:
        limits:
          cpus: &apos;2.0&apos;
          memory: 2G
        reservations:
          cpus: &apos;0.5&apos;
          memory: 512M
      placement:
        constraints:
          - node.role == manager
    volumes:
      - postgres_data:/var/lib/postgresql/data
    command: &amp;gt;
      postgres
      -c max_connections=200
      -c shared_buffers=256MB
      -c effective_cache_size=1GB
      -c work_mem=4MB

  # Scalable worker service
  worker:
    build: ./worker
    deploy:
      replicas: 3
      resources:
        limits:
          cpus: &apos;0.5&apos;
          memory: 512M
        reservations:
          cpus: &apos;0.1&apos;
          memory: 128M
      restart_policy:
        condition: on-failure
        max_attempts: 5
    environment:
      - WORKER_CONCURRENCY=2
      - QUEUE_URL=redis://redis:6379

  # Redis with memory limit
  redis:
    image: redis:7-alpine
    deploy:
      resources:
        limits:
          memory: 256M
        reservations:
          memory: 64M
    command: redis-server --maxmemory 200mb --maxmemory-policy allkeys-lru

volumes:
  postgres_data:






Best Practices and Anti-Patterns

Learn to avoid common mistakes and implement production-ready configurations.



Security Best Practices

Secure Compose Configuration

version: &apos;3.8&apos;

services:
  # Application with security hardening
  app:
    build:
      context: .
      dockerfile: Dockerfile
    user: &quot;1001:1001&quot;  # Non-root user
    read_only: true    # Read-only filesystem
    cap_drop:
      - ALL
    cap_add:
      - CHOWN
      - SETGID
      - SETUID
    security_opt:
      - no-new-privileges:true
    tmpfs:
      - /tmp:noexec,nosuid,size=100m
      - /var/tmp:noexec,nosuid,size=50m
    volumes:
      - type: bind
        source: ./app-data
        target: /app/data
        read_only: false
        bind:
          propagation: rprivate
    environment:
      - NODE_ENV=production
    secrets:
      - source: app_secret_key
        target: /run/secrets/secret_key
        mode: 0400
    healthcheck:
      test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost:3000/health&quot;]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # Database with security hardening
  postgres:
    image: postgres:15-alpine
    user: postgres
    read_only: true
    tmpfs:
      - /tmp:noexec,nosuid,size=100m
      - /var/run/postgresql:noexec,nosuid,size=100m
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - type: tmpfs
        target: /dev/shm
        tmpfs:
          size: 256M
    environment:
      POSTGRES_DB: myapp
      POSTGRES_USER_FILE: /run/secrets/postgres_user
      POSTGRES_PASSWORD_FILE: /run/secrets/postgres_password
    secrets:
      - postgres_user
      - postgres_password
    command: &amp;gt;
      postgres
      -c ssl=on
      -c ssl_cert_file=/etc/ssl/certs/server.crt
      -c ssl_key_file=/etc/ssl/private/server.key
      -c log_statement=mod
      -c log_connections=on
      -c log_disconnections=on
    healthcheck:
      test: [&quot;CMD-SHELL&quot;, &quot;pg_isready -U postgres&quot;]
      interval: 30s
      timeout: 10s
      retries: 5

secrets:
  app_secret_key:
    file: ./secrets/app_secret_key.txt
  postgres_user:
    file: ./secrets/postgres_user.txt
  postgres_password:
    file: ./secrets/postgres_password.txt

volumes:
  postgres_data:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: /secure/postgres/data

networks:
  default:
    driver: bridge
    driver_opts:
      com.docker.network.bridge.enable_icc: &quot;false&quot;
      com.docker.network.bridge.enable_ip_masquerade: &quot;true&quot;




Common Anti-Patterns to Avoid

❌ Poor Practices

# DON&apos;T DO THIS - Anti-patterns
version: &apos;3.8&apos;

services:
  bad-app:
    image: app:latest              # ❌ Always use specific versions
    privileged: true               # ❌ Avoid privileged mode
    user: root                     # ❌ Don&apos;t run as root
    network_mode: host             # ❌ Host network breaks isolation
    volumes:
      - /:/host                    # ❌ Don&apos;t mount entire host filesystem
    environment:
      - PASSWORD=hardcoded123      # ❌ Never hardcode secrets
      - DATABASE_HOST=localhost    # ❌ Use service names, not localhost
    restart: always                # ❌ &apos;unless-stopped&apos; is usually better
    
  bad-db:
    image: mysql                   # ❌ No version specified
    environment:
      - MYSQL_ROOT_PASSWORD=       # ❌ Empty password
    volumes:
      - ./data:/var/lib/mysql      # ❌ Host directory instead of volume
    # ❌ No health check
    # ❌ No resource limits


✅ Best Practices Implementation

# DO THIS - Best practices
version: &apos;3.8&apos;

services:
  good-app:
    image: myapp:1.2.3            # ✅ Specific version tag
    user: &quot;1001:1001&quot;             # ✅ Non-root user
    read_only: true               # ✅ Read-only filesystem
    cap_drop:
      - ALL                       # ✅ Drop all capabilities
    volumes:
      - app_data:/app/data        # ✅ Named volume
    environment:
      - NODE_ENV=production
      - DATABASE_HOST=database    # ✅ Service name
    env_file:
      - .env                      # ✅ Environment file for non-secrets
    secrets:
      - jwt_secret                # ✅ Use secrets for sensitive data
    healthcheck:
      test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost:3000/health&quot;]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    restart: unless-stopped       # ✅ Better restart policy
    deploy:
      resources:
        limits:
          memory: 1G              # ✅ Resource limits
          cpus: &apos;0.5&apos;
    networks:
      - app-network               # ✅ Custom network

  good-db:
    image: postgres:15.4-alpine   # ✅ Specific version
    user: postgres                # ✅ Non-root user
    environment:
      POSTGRES_DB: myapp
      POSTGRES_USER_FILE: /run/secrets/db_user
      POSTGRES_PASSWORD_FILE: /run/secrets/db_password
    secrets:
      - db_user                   # ✅ Secrets for credentials
      - db_password
    volumes:
      - postgres_data:/var/lib/postgresql/data  # ✅ Named volume
    healthcheck:
      test: [&quot;CMD-SHELL&quot;, &quot;pg_isready -U postgres&quot;]
      interval: 30s
      timeout: 10s
      retries: 5
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 2G
    networks:
      - app-network

secrets:
  jwt_secret:
    file: ./secrets/jwt_secret.txt
  db_user:
    file: ./secrets/db_user.txt
  db_password:
    file: ./secrets/db_password.txt

volumes:
  app_data:
  postgres_data:

networks:
  app-network:
    driver: bridge




Performance Optimization Guidelines

Docker Compose Performance Tuning

version: &apos;3.8&apos;

services:
  # Optimized application configuration
  app:
    build:
      context: .
      dockerfile: Dockerfile.optimized
      cache_from:
        - myapp:cache               # Use build cache
    image: myapp:${VERSION:-latest}
    
    # Memory and CPU optimization
    deploy:
      resources:
        limits:
          memory: 1G
          cpus: &apos;1.0&apos;
        reservations:
          memory: 256M
          cpus: &apos;0.25&apos;
    
    # Optimized volume mounts
    volumes:
      - type: volume
        source: app_cache
        target: /app/cache
        volume:
          nocopy: true              # Don&apos;t copy initial data
      - type: tmpfs
        target: /tmp
        tmpfs:
          size: 100M                # Limit tmpfs size
    
    # Environment-specific optimizations
    environment:
      - NODE_ENV=production
      - UV_THREADPOOL_SIZE=16       # Optimize Node.js thread pool
      - NODE_OPTIONS=--max-old-space-size=768  # Optimize V8 heap
    
    # Networking optimization
    networks:
      backend:
        aliases:
          - api.internal            # Custom DNS alias
    
    # Health check optimization
    healthcheck:
      test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost:3000/health&quot;]
      interval: 30s
      timeout: 5s                   # Shorter timeout
      retries: 2                    # Fewer retries
      start_period: 30s             # Reduced start period

  # Optimized database configuration
  postgres:
    image: postgres:15.4-alpine
    
    # PostgreSQL performance tuning
    command: &amp;gt;
      postgres
      -c max_connections=100
      -c shared_buffers=256MB
      -c effective_cache_size=1GB
      -c maintenance_work_mem=64MB
      -c checkpoint_completion_target=0.9
      -c wal_buffers=16MB
      -c default_statistics_target=100
      -c random_page_cost=1.1
      -c effective_io_concurrency=200
      -c work_mem=4MB
      -c min_wal_size=1GB
      -c max_wal_size=4GB
    
    # Volume optimization
    volumes:
      - type: volume
        source: postgres_data
        target: /var/lib/postgresql/data
        volume:
          driver_opts:
            type: none
            o: bind
            device: /opt/app/postgres  # SSD mount point
    
    deploy:
      resources:
        limits:
          memory: 2G
          cpus: &apos;2.0&apos;
        reservations:
          memory: 512M
          cpus: &apos;0.5&apos;

  # Redis optimization
  redis:
    image: redis:7.2-alpine
    command: &amp;gt;
      redis-server
      --maxmemory 256mb
      --maxmemory-policy allkeys-lru
      --tcp-keepalive 60
      --tcp-backlog 511
      --timeout 0
      --save 900 1 300 10 60 10000  # Optimized persistence
    
    volumes:
      - type: volume
        source: redis_data
        target: /data

volumes:
  app_cache:
    driver: local
    driver_opts:
      type: tmpfs
      device: tmpfs
      o: size=500M,uid=1001,gid=1001

  postgres_data:
    driver: local

  redis_data:
    driver: local

networks:
  backend:
    driver: bridge
    driver_opts:
      com.docker.network.driver.mtu: 1450






Monitoring, Logging, and Debugging

Implement comprehensive observability for your Compose applications.



Comprehensive Monitoring Stack

Full Observability Configuration

version: &apos;3.8&apos;

services:
  # Main application with monitoring
  app:
    build: .
    environment:
      - NODE_ENV=production
      - METRICS_ENABLED=true
      - JAEGER_ENDPOINT=http://jaeger:14268/api/traces
    labels:
      - &quot;prometheus.io/scrape=true&quot;
      - &quot;prometheus.io/port=3000&quot;
      - &quot;prometheus.io/path=/metrics&quot;
    networks:
      - app-network
      - monitoring
    depends_on:
      - postgres
      - redis
    logging:
      driver: &quot;fluentd&quot;
      options:
        fluentd-address: &quot;localhost:24224&quot;
        tag: &quot;app.logs&quot;

  # Database
  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: myapp
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - app-network
    logging:
      driver: &quot;json-file&quot;
      options:
        max-size: &quot;100m&quot;
        max-file: &quot;3&quot;

  # Redis
  redis:
    image: redis:7-alpine
    networks:
      - app-network
    command: redis-server --appendonly yes

  # Prometheus monitoring
  prometheus:
    image: prom/prometheus:latest
    container_name: prometheus
    ports:
      - &quot;9090:9090&quot;
    volumes:
      - ./monitoring/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml
      - ./monitoring/prometheus/rules:/etc/prometheus/rules
      - prometheus_data:/prometheus
    command:
      - &apos;--config.file=/etc/prometheus/prometheus.yml&apos;
      - &apos;--storage.tsdb.path=/prometheus&apos;
      - &apos;--web.console.libraries=/etc/prometheus/console_libraries&apos;
      - &apos;--web.console.templates=/etc/prometheus/consoles&apos;
      - &apos;--storage.tsdb.retention.time=200h&apos;
      - &apos;--web.enable-lifecycle&apos;
      - &apos;--web.enable-admin-api&apos;
    networks:
      - monitoring
    restart: unless-stopped

  # Grafana dashboards
  grafana:
    image: grafana/grafana:latest
    container_name: grafana
    ports:
      - &quot;3001:3000&quot;
    environment:
      - GF_SECURITY_ADMIN_USER=admin
      - GF_SECURITY_ADMIN_PASSWORD=admin
      - GF_USERS_ALLOW_SIGN_UP=false
    volumes:
      - grafana_data:/var/lib/grafana
      - ./monitoring/grafana/provisioning:/etc/grafana/provisioning
      - ./monitoring/grafana/dashboards:/var/lib/grafana/dashboards
    networks:
      - monitoring
    restart: unless-stopped
    depends_on:
      - prometheus

  # Node Exporter for system metrics
  node-exporter:
    image: prom/node-exporter:latest
    container_name: node-exporter
    ports:
      - &quot;9100:9100&quot;
    volumes:
      - /proc:/host/proc:ro
      - /sys:/host/sys:ro
      - /:/rootfs:ro
    command:
      - &apos;--path.procfs=/host/proc&apos;
      - &apos;--path.rootfs=/rootfs&apos;
      - &apos;--path.sysfs=/host/sys&apos;
      - &apos;--collector.filesystem.mount-points-exclude=^/(sys|proc|dev|host|etc)($$|/)&apos;
    networks:
      - monitoring
    restart: unless-stopped

  # cAdvisor for container metrics
  cadvisor:
    image: gcr.io/cadvisor/cadvisor:latest
    container_name: cadvisor
    ports:
      - &quot;8080:8080&quot;
    volumes:
      - /:/rootfs:ro
      - /var/run:/var/run:ro
      - /sys:/sys:ro
      - /var/lib/docker/:/var/lib/docker:ro
      - /dev/disk/:/dev/disk:ro
    privileged: true
    devices:
      - /dev/kmsg
    networks:
      - monitoring
    restart: unless-stopped

  # Jaeger for distributed tracing
  jaeger:
    image: jaegertracing/all-in-one:latest
    container_name: jaeger
    ports:
      - &quot;5775:5775/udp&quot;
      - &quot;6831:6831/udp&quot;
      - &quot;6832:6832/udp&quot;
      - &quot;5778:5778&quot;
      - &quot;16686:16686&quot;
      - &quot;14268:14268&quot;
      - &quot;14250:14250&quot;
      - &quot;9411:9411&quot;
    environment:
      - COLLECTOR_ZIPKIN_HOST_PORT=:9411
    networks:
      - monitoring
    restart: unless-stopped

  # FluentD for log aggregation
  fluentd:
    build: ./monitoring/fluentd
    container_name: fluentd
    ports:
      - &quot;24224:24224&quot;
      - &quot;24224:24224/udp&quot;
    volumes:
      - ./monitoring/fluentd/conf:/fluentd/etc
      - ./logs:/fluentd/log
    networks:
      - monitoring
    restart: unless-stopped

  # Alertmanager for alerts
  alertmanager:
    image: prom/alertmanager:latest
    container_name: alertmanager
    ports:
      - &quot;9093:9093&quot;
    volumes:
      - ./monitoring/alertmanager/alertmanager.yml:/etc/alertmanager/alertmanager.yml
      - alertmanager_data:/alertmanager
    command:
      - &apos;--config.file=/etc/alertmanager/alertmanager.yml&apos;
      - &apos;--storage.path=/alertmanager&apos;
      - &apos;--web.external-url=http://localhost:9093&apos;
    networks:
      - monitoring
    restart: unless-stopped

  # Elasticsearch for log storage
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.11.0
    container_name: elasticsearch
    environment:
      - discovery.type=single-node
      - &quot;ES_JAVA_OPTS=-Xms1g -Xmx1g&quot;
      - xpack.security.enabled=false
    volumes:
      - elasticsearch_data:/usr/share/elasticsearch/data
    ports:
      - &quot;9200:9200&quot;
    networks:
      - monitoring
    restart: unless-stopped

  # Kibana for log visualization
  kibana:
    image: docker.elastic.co/kibana/kibana:8.11.0
    container_name: kibana
    environment:
      - ELASTICSEARCH_HOSTS=http://elasticsearch:9200
    ports:
      - &quot;5601:5601&quot;
    depends_on:
      - elasticsearch
    networks:
      - monitoring
    restart: unless-stopped

networks:
  app-network:
    driver: bridge
  monitoring:
    driver: bridge

volumes:
  postgres_data:
  prometheus_data:
  grafana_data:
  alertmanager_data:
  elasticsearch_data:




Debugging and Troubleshooting Tools

Debug-Enabled Development Configuration

version: &apos;3.8&apos;

services:
  # Application with debugging enabled
  app-debug:
    build:
      context: .
      dockerfile: Dockerfile.debug
      target: debug
    environment:
      - NODE_ENV=development
      - DEBUG=app:*,express:*,sequelize:*
      - LOG_LEVEL=debug
      - ENABLE_DEBUG_ENDPOINTS=true
    volumes:
      - ./src:/app/src
      - ./logs:/app/logs
      - debug_data:/debug
    ports:
      - &quot;3000:3000&quot;
      - &quot;9229:9229&quot;    # Node.js debugger
      - &quot;9464:9464&quot;    # Debug metrics
    command: &amp;gt;
      sh -c &quot;npm install &amp;amp;&amp;amp;
             npm run debug&quot;
    stdin_open: true
    tty: true
    networks:
      - debug-network
    labels:
      - &quot;debug.enabled=true&quot;

  # Database with query logging
  postgres-debug:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: myapp_debug
      POSTGRES_USER: debug
      POSTGRES_PASSWORD: debug
    volumes:
      - postgres_debug_data:/var/lib/postgresql/data
      - ./database/debug-scripts:/docker-entrypoint-initdb.d
    ports:
      - &quot;5432:5432&quot;
    command: &amp;gt;
      postgres
      -c log_statement=all
      -c log_duration=on
      -c log_line_prefix=&apos;%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h &apos;
      -c log_checkpoints=on
      -c log_connections=on
      -c log_disconnections=on
      -c log_lock_waits=on
      -c shared_preload_libraries=pg_stat_statements
    networks:
      - debug-network

  # Redis with debugging
  redis-debug:
    image: redis:7-alpine
    command: &amp;gt;
      redis-server
      --loglevel debug
      --logfile /redis-logs/redis.log
    volumes:
      - redis_debug_data:/data
      - redis_logs:/redis-logs
    ports:
      - &quot;6379:6379&quot;
    networks:
      - debug-network

  # Debug tools container
  debug-tools:
    image: nicolaka/netshoot:latest
    container_name: debug-tools
    command: sleep infinity
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - debug_tools:/debug
    networks:
      - debug-network
    privileged: true
    stdin_open: true
    tty: true

  # Log aggregation for debugging
  debug-fluentd:
    build: ./debug/fluentd
    volumes:
      - ./debug/fluentd/conf:/fluentd/etc
      - debug_logs:/fluentd/log
    ports:
      - &quot;24224:24224&quot;
    networks:
      - debug-network

  # Web-based log viewer
  dozzle:
    image: amir20/dozzle:latest
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    ports:
      - &quot;8888:8080&quot;
    environment:
      - DOZZLE_LEVEL=debug
      - DOZZLE_TAILSIZE=1000

networks:
  debug-network:
    driver: bridge
    driver_opts:
      com.docker.network.bridge.name: debug-bridge

volumes:
  postgres_debug_data:
  redis_debug_data:
  redis_logs:
  debug_data:
  debug_tools:
  debug_logs:


Useful Debugging Commands

# Container debugging commands
docker compose exec app bash                    # Interactive shell
docker compose exec --user root app bash       # Root shell for debugging
docker compose logs -f --tail=100 app          # Follow recent logs
docker compose logs --since=&quot;1h&quot; app           # Logs from last hour
docker compose top                              # Process information
docker compose exec app ps aux                 # Processes inside container

# Network debugging
docker compose exec debug-tools ping app       # Test connectivity
docker compose exec debug-tools nslookup app   # DNS resolution
docker compose exec debug-tools netstat -tlnp  # Port listening
docker compose exec debug-tools ss -tulpn      # Socket statistics

# Performance debugging
docker compose exec app htop                   # Process monitoring
docker compose exec app iotop                  # I/O monitoring
docker compose stats                           # Resource usage
docker compose exec app strace -p 1            # System call tracing

# Database debugging
docker compose exec postgres-debug psql -U debug -d myapp_debug
docker compose exec postgres-debug pg_stat_activity
docker compose exec redis-debug redis-cli monitor

# Log analysis
docker compose logs app | grep ERROR           # Filter error logs
docker compose logs --since=&quot;2h&quot; --until=&quot;1h&quot; # Time range
docker compose logs -t app                     # Timestamps






Production Deployment Strategies

Implement enterprise-ready deployment patterns with Docker Compose.



Blue-Green Deployment

Blue-Green Deployment Configuration

# docker-compose.blue-green.yml
version: &apos;3.8&apos;

services:
  # Load balancer / Proxy
  nginx:
    image: nginx:alpine
    ports:
      - &quot;80:80&quot;
      - &quot;443:443&quot;
    volumes:
      - ./nginx/blue-green.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/nginx/ssl
    depends_on:
      - app-blue
      - app-green
    networks:
      - frontend
    environment:
      - ACTIVE_ENVIRONMENT=${ACTIVE_ENV:-blue}
    restart: unless-stopped

  # Blue environment
  app-blue:
    image: myapp:${BLUE_VERSION:-latest}
    environment:
      - NODE_ENV=production
      - APP_ENV=blue
      - DATABASE_URL=${BLUE_DATABASE_URL}
      - REDIS_URL=${BLUE_REDIS_URL}
    networks:
      - frontend
      - blue-backend
    deploy:
      replicas: ${BLUE_REPLICAS:-3}
      resources:
        limits:
          memory: 1G
          cpus: &apos;0.5&apos;
    healthcheck:
      test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost:3000/health&quot;]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # Green environment
  app-green:
    image: myapp:${GREEN_VERSION:-latest}
    environment:
      - NODE_ENV=production
      - APP_ENV=green
      - DATABASE_URL=${GREEN_DATABASE_URL}
      - REDIS_URL=${GREEN_REDIS_URL}
    networks:
      - frontend
      - green-backend
    deploy:
      replicas: ${GREEN_REPLICAS:-0}
      resources:
        limits:
          memory: 1G
          cpus: &apos;0.5&apos;
    healthcheck:
      test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost:3000/health&quot;]
      interval: 30s
      timeout: 10s
      retries: 3
    restart: unless-stopped

  # Shared database
  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: ${DB_NAME}
      POSTGRES_USER: ${DB_USER}
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - blue-backend
      - green-backend
    restart: unless-stopped

  # Shared cache
  redis:
    image: redis:7-alpine
    volumes:
      - redis_data:/data
    networks:
      - blue-backend
      - green-backend
    restart: unless-stopped

networks:
  frontend:
    driver: bridge
  blue-backend:
    driver: bridge
  green-backend:
    driver: bridge

volumes:
  postgres_data:
  redis_data:


Blue-Green Deployment Scripts

#!/bin/bash
# blue-green-deploy.sh

set -euo pipefail

COMPOSE_FILE=&quot;docker-compose.blue-green.yml&quot;
NEW_VERSION=&quot;${1:-latest}&quot;
CURRENT_ENV=&quot;${ACTIVE_ENV:-blue}&quot;
TARGET_ENV=$([ &quot;$CURRENT_ENV&quot; = &quot;blue&quot; ] &amp;amp;&amp;amp; echo &quot;green&quot; || echo &quot;blue&quot;)

echo &quot;Current environment: $CURRENT_ENV&quot;
echo &quot;Target environment: $TARGET_ENV&quot;
echo &quot;Deploying version: $NEW_VERSION&quot;

# Deploy to target environment
echo &quot;Deploying to $TARGET_ENV environment...&quot;
if [ &quot;$TARGET_ENV&quot; = &quot;green&quot; ]; then
    export GREEN_VERSION=&quot;$NEW_VERSION&quot;
    export GREEN_REPLICAS=3
    export GREEN_DATABASE_URL=&quot;$DATABASE_URL&quot;
    export GREEN_REDIS_URL=&quot;$REDIS_URL&quot;
else
    export BLUE_VERSION=&quot;$NEW_VERSION&quot;
    export BLUE_REPLICAS=3
    export BLUE_DATABASE_URL=&quot;$DATABASE_URL&quot;
    export BLUE_REDIS_URL=&quot;$REDIS_URL&quot;
fi

# Start target environment
docker compose -f &quot;$COMPOSE_FILE&quot; up -d &quot;app-$TARGET_ENV&quot;

# Wait for health checks
echo &quot;Waiting for $TARGET_ENV environment to be healthy...&quot;
timeout 300 bash -c &quot;
    while ! docker compose -f &apos;$COMPOSE_FILE&apos; exec app-$TARGET_ENV curl -f http://localhost:3000/health; do
        echo &apos;Waiting for health check...&apos;
        sleep 10
    done
&quot;

# Run smoke tests
echo &quot;Running smoke tests against $TARGET_ENV environment...&quot;
./scripts/smoke-test.sh &quot;$TARGET_ENV&quot;

# Switch traffic
echo &quot;Switching traffic to $TARGET_ENV environment...&quot;
export ACTIVE_ENV=&quot;$TARGET_ENV&quot;
docker compose -f &quot;$COMPOSE_FILE&quot; up -d nginx

# Scale down old environment
echo &quot;Scaling down $CURRENT_ENV environment...&quot;
if [ &quot;$CURRENT_ENV&quot; = &quot;green&quot; ]; then
    export GREEN_REPLICAS=0
else
    export BLUE_REPLICAS=0
fi

docker compose -f &quot;$COMPOSE_FILE&quot; up -d &quot;app-$CURRENT_ENV&quot;

echo &quot;Blue-green deployment completed successfully!&quot;
echo &quot;Active environment: $TARGET_ENV&quot;




Rolling Updates and Zero-Downtime Deployment

Rolling Update Configuration

# docker-compose.rolling.yml
version: &apos;3.8&apos;

services:
  # Load balancer with health checks
  haproxy:
    image: haproxy:latest
    ports:
      - &quot;80:80&quot;
      - &quot;443:443&quot;
      - &quot;8404:8404&quot;  # Stats page
    volumes:
      - ./haproxy/haproxy.cfg:/usr/local/etc/haproxy/haproxy.cfg
    networks:
      - frontend
    restart: unless-stopped
    healthcheck:
      test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost:8404/stats&quot;]
      interval: 30s
      timeout: 10s
      retries: 3

  # Application with rolling update support
  app:
    image: myapp:${APP_VERSION:-latest}
    environment:
      - NODE_ENV=production
      - GRACEFUL_SHUTDOWN_TIMEOUT=30
    networks:
      - frontend
      - backend
    deploy:
      replicas: ${APP_REPLICAS:-5}
      update_config:
        parallelism: 1           # Update one container at a time
        delay: 30s               # Wait between updates
        order: start-first       # Start new before stopping old
        failure_action: rollback # Rollback on failure
        monitor: 60s             # Monitor period
        max_failure_ratio: 0.2   # Max 20% failure rate
      rollback_config:
        parallelism: 1
        delay: 10s
        order: stop-first
        monitor: 30s
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3
      resources:
        limits:
          memory: 1G
          cpus: &apos;0.5&apos;
        reservations:
          memory: 256M
          cpus: &apos;0.1&apos;
    healthcheck:
      test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost:3000/health&quot;]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    stop_grace_period: 45s       # Graceful shutdown time

  # Database with backup during updates
  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: ${DB_NAME}
      POSTGRES_USER: ${DB_USER}
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./backups:/backups
    networks:
      - backend
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 2G
          cpus: &apos;1.0&apos;
    healthcheck:
      test: [&quot;CMD-SHELL&quot;, &quot;pg_isready -U $DB_USER&quot;]
      interval: 30s
      timeout: 10s
      retries: 5

  # Migration service
  migrate:
    image: myapp:${APP_VERSION:-latest}
    command: npm run migrate
    environment:
      - NODE_ENV=production
      - DATABASE_URL=${DATABASE_URL}
    networks:
      - backend
    depends_on:
      postgres:
        condition: service_healthy
    restart: &quot;no&quot;

networks:
  frontend:
    driver: bridge
  backend:
    driver: bridge

volumes:
  postgres_data:


Rolling Update Script

#!/bin/bash
# rolling-update.sh

set -euo pipefail

COMPOSE_FILE=&quot;docker-compose.rolling.yml&quot;
NEW_VERSION=&quot;${1:-latest}&quot;
HEALTH_CHECK_URL=&quot;${2:-http://localhost/health}&quot;

echo &quot;Starting rolling update to version: $NEW_VERSION&quot;

# Pre-deployment checks
echo &quot;Running pre-deployment checks...&quot;
docker image pull &quot;myapp:$NEW_VERSION&quot;

# Create database backup
echo &quot;Creating database backup...&quot;
docker compose -f &quot;$COMPOSE_FILE&quot; exec postgres pg_dump -U &quot;$DB_USER&quot; &quot;$DB_NAME&quot; &amp;gt; &quot;backup-$(date +%Y%m%d_%H%M%S).sql&quot;

# Run database migrations
echo &quot;Running database migrations...&quot;
export APP_VERSION=&quot;$NEW_VERSION&quot;
docker compose -f &quot;$COMPOSE_FILE&quot; run --rm migrate

# Update application with rolling strategy
echo &quot;Starting rolling update of application...&quot;
docker compose -f &quot;$COMPOSE_FILE&quot; up -d app

# Monitor deployment
echo &quot;Monitoring deployment progress...&quot;
for i in {1..30}; do
    if curl -f &quot;$HEALTH_CHECK_URL&quot; &amp;gt;/dev/null 2&amp;gt;&amp;amp;1; then
        echo &quot;Health check passed (attempt $i/30)&quot;
        HEALTHY_COUNT=$((HEALTHY_COUNT + 1))
        if [ $HEALTHY_COUNT -ge 3 ]; then
            echo &quot;Rolling update completed successfully!&quot;
            break
        fi
    else
        echo &quot;Health check failed (attempt $i/30)&quot;
        HEALTHY_COUNT=0
    fi
    
    if [ $i -eq 30 ]; then
        echo &quot;Rolling update failed - triggering rollback&quot;
        docker compose -f &quot;$COMPOSE_FILE&quot; rollback app
        exit 1
    fi
    
    sleep 10
done

# Cleanup old images
echo &quot;Cleaning up old images...&quot;
docker image prune -f

echo &quot;Rolling update completed successfully!&quot;




Disaster Recovery and Backup Strategies

Comprehensive Backup Configuration





Backup and Recovery Scripts

#!/bin/bash
# backup-restore.sh

set -euo pipefail

COMPOSE_FILE=&quot;docker-compose.backup.yml&quot;
BACKUP_TYPE=&quot;${1:-full}&quot;
RESTORE_POINT=&quot;${2:-}&quot;

case &quot;$BACKUP_TYPE&quot; in
    &quot;full&quot;)
        echo &quot;Creating full backup...&quot;
        docker compose -f &quot;$COMPOSE_FILE&quot; exec backup /scripts/full-backup.sh
        ;;
    
    &quot;incremental&quot;)
        echo &quot;Creating incremental backup...&quot;
        docker compose -f &quot;$COMPOSE_FILE&quot; exec backup /scripts/incremental-backup.sh
        ;;
    
    &quot;restore&quot;)
        if [ -z &quot;$RESTORE_POINT&quot; ]; then
            echo &quot;Error: Restore point required&quot;
            echo &quot;Usage: $0 restore &amp;lt;backup-file-or-timestamp&amp;gt;&quot;
            exit 1
        fi
        
        echo &quot;Restoring from: $RESTORE_POINT&quot;
        
        # Stop application
        docker compose -f &quot;$COMPOSE_FILE&quot; stop app
        
        # Restore database
        docker compose -f &quot;$COMPOSE_FILE&quot; exec postgres-primary /scripts/restore.sh &quot;$RESTORE_POINT&quot;
        
        # Start application
        docker compose -f &quot;$COMPOSE_FILE&quot; start app
        ;;
    
    &quot;pitr&quot;)
        if [ -z &quot;$RESTORE_POINT&quot; ]; then
            echo &quot;Error: Point-in-time restore requires timestamp&quot;
            echo &quot;Usage: $0 pitr &apos;YYYY-MM-DD HH:MM:SS&apos;&quot;
            exit 1
        fi
        
        echo &quot;Point-in-time restore to: $RESTORE_POINT&quot;
        docker compose -f &quot;$COMPOSE_FILE&quot; exec pitr /scripts/pitr-restore.sh &quot;$RESTORE_POINT&quot;
        ;;
    
    &quot;verify&quot;)
        echo &quot;Verifying backup integrity...&quot;
        docker compose -f &quot;$COMPOSE_FILE&quot; exec backup /scripts/verify-backup.sh
        ;;
    
    *)
        echo &quot;Usage: $0 {full|incremental|restore|pitr|verify} [restore-point]&quot;
        exit 1
        ;;
esac






Key Points


  Docker Compose Mastery Summary
  
    
      Modern Compose Usage
      - Use Compose V2 with docker compose command (space, not hyphen)
      - Leverage new features like watch mode and improved networking
      - Implement proper health checks and dependency management
      - Follow security best practices with non-root users and read-only filesystems
    
    
      Production Readiness
      - Implement comprehensive monitoring and logging solutions
      - Use resource limits and restart policies appropriately
      - Design for high availability with multiple replicas and health checks
      - Plan disaster recovery with backup and restore procedures
    
    
      Development Excellence
      - Utilize environment-specific override files effectively
      - Implement hot reload and debugging capabilities
      - Maintain clean separation between development and production configs
      - Use secrets management for sensitive configuration data
    
  






Conclusion

Docker Compose has evolved into an indispensable tool for modern application development and deployment. The transition from V1 to V2 brought significant improvements in performance, usability, and integration with the broader Docker ecosystem.

From simple development environments to complex production deployments, Docker Compose provides the flexibility and power needed to manage multi-container applications effectively. The YAML-based configuration approach makes complex infrastructures readable, maintainable, and version-controllable.



Strategic Implementation Guidelines


  Start with Development: Use Compose to standardize development environments across teams
  Progress to Staging: Implement override files for environment-specific configurations
  Scale to Production: Add monitoring, logging, and deployment automation
  Plan for Growth: Design with scalability and disaster recovery in mind
  Maintain Security: Implement proper secrets management and security hardening




Future Considerations

As container orchestration continues to evolve, Docker Compose remains relevant for single-host deployments, development environments, and smaller production workloads. For larger, distributed systems, consider Kubernetes or Docker Swarm, but Docker Compose provides an excellent foundation and learning platform for container orchestration concepts.

The combination of simplicity, power, and extensive ecosystem support ensures that Docker Compose will continue to be a cornerstone tool for developers and DevOps professionals working with containerized applications.





References


  Docker Compose Official Documentation
  Docker Compose V2 Migration Guide
  Compose File Specification
  Docker Compose CLI Reference
  Docker Compose Networking
  Docker Compose Environment Variables
  Docker Compose Production Guidelines
  Docker Swarm vs Compose
  Container Security Best Practices
  Docker Compose Watch Mode
  Docker Compose Override Files
  Prometheus Docker Monitoring
  Grafana Docker Integration
  ELK Stack with Docker Compose
  Jaeger Tracing with Docker

",
            "wordcount": "11911",
            "inLanguage": "en",
            "dateCreated": "2026-01-13/",
            "datePublished": "2026-01-13/",
            "dateModified": "2026-01-13/",
            "author": {
                "@type": "Person",
                "name": "Somaz",
                
                "image": "/assets/img/uploads/profile.png",
                
                "jobTitle": "DevOps Engineer",
                "url": "https://somaz.blog/authors/somaz/",
                "sameAs": [
                    "https://github.com/somaz94","https://www.linkedin.com/in/somaz"
                ]
            },
            "publisher": {
                "@type": "Organization",
                "name": "somaz",
                "url": "https://somaz.blog/",
                "logo": {
                    "@type": "ImageObject",
                    "url": "https://somaz.blog/assets/img/blog-image.png",
                    "width": "600",
                    "height": "315"
                }
            },
            "mainEntityOfPage": "True",
            "genre": "CONTAINER",
            "articleSection": "CONTAINER",
            "keywords": ["docker-compose","container-orchestration","microservices","yaml-configuration","multi-container","devops","development-environment","service-management","docker"]
        }
        </script>
    </body>
</html>
