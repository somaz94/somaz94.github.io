<!DOCTYPE html>
<html lang="en" class="no-js">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    

    
    

    
    

    
    

    <!-- ✅ Google Tag Manager 추가 -->
    <script>
        (function(w,d,s,l,i){
            w[l]=w[l]||[];
            w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
            var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
            j.async=true;
            j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
            f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-MBP83N4Q');
    </script>
      <!-- ✅ End Google Tag Manager -->

    <!-- Mermaid.js 직접 로드 -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>

    <title>Docker Layers - A Deep Dive into Dockerfile Build Principles | somaz</title>
    <meta name="description" content="Learn about Docker layers, caching mechanisms, and best practices for efficient image building">
    
        <meta name="keywords" content="docker, dockerfile, containers, optimization">
    

    <!-- Social: Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Docker Layers - A Deep Dive into Dockerfile Build Principles | somaz">
    <meta name="twitter:description" content="Learn about Docker layers, caching mechanisms, and best practices for efficient image building">

    
        <meta property="twitter:image" content="https://res.cloudinary.com/dkcm26aem/image/upload/v1737710995/docker-layer_pvvhqk.png">
    
    
    
        <meta name="twitter:site" content="@twitter_username">
    

    <!-- Social: Facebook / Open Graph -->
    <meta property="og:url" content="https://somaz.blog/category/container/docker-layer/">
    <meta property="og:title" content="Docker Layers - A Deep Dive into Dockerfile Build Principles | somaz">
    <meta property="og:image" content="https://res.cloudinary.com/dkcm26aem/image/upload/v1737710995/docker-layer_pvvhqk.png">
    <meta property="og:description" content="Learn about Docker layers, caching mechanisms, and best practices for efficient image building">
    <meta property="og:site_name" content="Somaz Tech Blog">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/assets/img/icons/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/img/icons/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/img/icons/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/img/icons/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/img/icons/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/img/icons/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/img/icons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/icons/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/img/icons/apple-touch-icon-152x152.png" />

    <!-- Windows 8 Tile Icons -->
    <meta name="application-name" content="somaz">
    <meta name="msapplication-TileColor" content="#141414">
    <meta name="msapplication-square70x70logo" content="smalltile.png" />
    <meta name="msapplication-square150x150logo" content="mediumtile.png" />
    <meta name="msapplication-wide310x150logo" content="widetile.png" />
    <meta name="msapplication-square310x310logo" content="largetile.png" />
    
    <!-- Android Lolipop Theme Color -->
    <meta name="theme-color" content="#141414">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Titillium+Web:300,400,700" rel="stylesheet">

    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="canonical" href="https://somaz.blog/category/container/docker-layer/">
    <link rel="alternate" type="application/rss+xml" title="Somaz Tech Blog" href="https://somaz.blog/feed.xml" />

    <!-- Include extra styles -->
    

    <!-- JavaScript enabled/disabled -->
    <script>
        document.querySelector('html').classList.remove('no-js');
    </script>

    <!-- Google Adsense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8725590811736154"
        crossorigin="anonymous"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"> -->
    <!-- <link href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/variable/woff2/SUIT-Variable.css" rel="stylesheet"> -->
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- <link href="https://fonts.googleapis.com/css2?family=Albert+Sans:wght@400;500;700&display=swap" rel="stylesheet"> -->

    <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml" />

</head>
<!-- ✅ Google Tag Manager (noscript) -->
<noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MBP83N4Q"
            height="0" width="0" style="display:none;visibility:hidden">
    </iframe>
</noscript>
<!-- ✅ End Google Tag Manager (noscript) -->
    <body class="has-push-menu">
        





        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" display="none" version="1.1"><defs><symbol id="icon-menu" viewBox="0 0 1024 1024"><path class="path1" d="M128 213.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 725.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 469.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5z"/></symbol><symbol id="icon-search" viewBox="0 0 951 1024"><path class="path1" d="M658.286 475.429q0-105.714-75.143-180.857t-180.857-75.143-180.857 75.143-75.143 180.857 75.143 180.857 180.857 75.143 180.857-75.143 75.143-180.857zM950.857 950.857q0 29.714-21.714 51.429t-51.429 21.714q-30.857 0-51.429-21.714l-196-195.429q-102.286 70.857-228 70.857-81.714 0-156.286-31.714t-128.571-85.714-85.714-128.571-31.714-156.286 31.714-156.286 85.714-128.571 128.571-85.714 156.286-31.714 156.286 31.714 128.571 85.714 85.714 128.571 31.714 156.286q0 125.714-70.857 228l196 196q21.143 21.143 21.143 51.429z"/></symbol><symbol id="icon-close" viewBox="0 0 1000 1000"><path d="M969.8,870.3c27,27.7,27,71.8,0,99.1C955.7,983,937.9,990,920,990c-17.9,0-35.7-7-49.7-20.7L500,599L129.6,969.4C115.6,983,97.8,990,79.9,990s-35.7-7-49.7-20.7c-27-27.3-27-71.4,0-99.1L400.9,500L30.3,129.3c-27-27.3-27-71.4,0-99.1c27.3-27,71.8-27,99.4,0L500,400.9L870.4,30.2c27.7-27,71.8-27,99.4,0c27,27.7,27,71.8,0,99.1L599.1,500L969.8,870.3z"/></symbol><symbol id="icon-twitter" viewBox="0 0 951 1024"><path class="path1" d="M925.714 233.143q-38.286 56-92.571 95.429 0.571 8 0.571 24 0 74.286-21.714 148.286t-66 142-105.429 120.286-147.429 83.429-184.571 31.143q-154.857 0-283.429-82.857 20 2.286 44.571 2.286 128.571 0 229.143-78.857-60-1.143-107.429-36.857t-65.143-91.143q18.857 2.857 34.857 2.857 24.571 0 48.571-6.286-64-13.143-106-63.714t-42-117.429v-2.286q38.857 21.714 83.429 23.429-37.714-25.143-60-65.714t-22.286-88q0-50.286 25.143-93.143 69.143 85.143 168.286 136.286t212.286 56.857q-4.571-21.714-4.571-42.286 0-76.571 54-130.571t130.571-54q80 0 134.857 58.286 62.286-12 117.143-44.571-21.143 65.714-81.143 101.714 53.143-5.714 106.286-28.571z"/></symbol><symbol id="icon-facebook" viewBox="0 0 585 1024"><path class="path1" d="M548 6.857v150.857h-89.714q-49.143 0-66.286 20.571t-17.143 61.714v108h167.429l-22.286 169.143h-145.143v433.714h-174.857v-433.714h-145.714v-169.143h145.714v-124.571q0-106.286 59.429-164.857t158.286-58.571q84 0 130.286 6.857z"/></symbol><symbol id="icon-clock" viewBox="0 0 1000 1000"><path d="M500,10C229.8,10,10,229.8,10,500c0,270.2,219.8,490,490,490c270.2,0,490-219.8,490-490C990,229.8,770.2,10,500,10z M500,910.2c-226.2,0-410.2-184-410.2-410.2c0-226.2,184-410.2,410.2-410.2c226.2,0,410.2,184,410.2,410.2C910.2,726.1,726.2,910.2,500,910.2z M753.1,374c8.2,11.9,5.2,28.1-6.6,36.3L509.9,573.7c-4.4,3.1-9.6,4.6-14.8,4.6c-4.1,0-8.3-1-12.1-3c-8.6-4.5-14-13.4-14-23.1V202.5c0-14.4,11.7-26.1,26.1-26.1c14.4,0,26.1,11.7,26.1,26.1v300l195.6-135.1C728.7,359.2,744.9,362.1,753.1,374z"/></symbol><symbol id="icon-calendar" viewBox="0 0 1000 1000"><path d="M920,500v420H80V500H920 M990,430H10v490c0,38.7,31.3,70,70,70h840c38.7,0,70-31.3,70-70V430L990,430z"/><path d="M850,80v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80H360v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80C72.8,80,10,142.7,10,220v140h980V220C990,142.7,927.2,80,850,80z"/><path d="M255,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C290,25.8,274.3,10,255,10z"/><path d="M745,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C780,25.8,764.3,10,745,10z"/></symbol><symbol id="icon-github" viewBox="0 0 12 14"><path d="M6 1q1.633 0 3.012 0.805t2.184 2.184 0.805 3.012q0 1.961-1.145 3.527t-2.957 2.168q-0.211 0.039-0.312-0.055t-0.102-0.234q0-0.023 0.004-0.598t0.004-1.051q0-0.758-0.406-1.109 0.445-0.047 0.801-0.141t0.734-0.305 0.633-0.52 0.414-0.82 0.16-1.176q0-0.93-0.617-1.609 0.289-0.711-0.062-1.594-0.219-0.070-0.633 0.086t-0.719 0.344l-0.297 0.187q-0.727-0.203-1.5-0.203t-1.5 0.203q-0.125-0.086-0.332-0.211t-0.652-0.301-0.664-0.105q-0.352 0.883-0.062 1.594-0.617 0.68-0.617 1.609 0 0.664 0.16 1.172t0.41 0.82 0.629 0.523 0.734 0.305 0.801 0.141q-0.305 0.281-0.383 0.805-0.164 0.078-0.352 0.117t-0.445 0.039-0.512-0.168-0.434-0.488q-0.148-0.25-0.379-0.406t-0.387-0.187l-0.156-0.023q-0.164 0-0.227 0.035t-0.039 0.090 0.070 0.109 0.102 0.094l0.055 0.039q0.172 0.078 0.34 0.297t0.246 0.398l0.078 0.18q0.102 0.297 0.344 0.48t0.523 0.234 0.543 0.055 0.434-0.027l0.18-0.031q0 0.297 0.004 0.691t0.004 0.426q0 0.141-0.102 0.234t-0.312 0.055q-1.812-0.602-2.957-2.168t-1.145-3.527q0-1.633 0.805-3.012t2.184-2.184 3.012-0.805zM2.273 9.617q0.023-0.055-0.055-0.094-0.078-0.023-0.102 0.016-0.023 0.055 0.055 0.094 0.070 0.047 0.102-0.016zM2.516 9.883q0.055-0.039-0.016-0.125-0.078-0.070-0.125-0.023-0.055 0.039 0.016 0.125 0.078 0.078 0.125 0.023zM2.75 10.234q0.070-0.055 0-0.148-0.062-0.102-0.133-0.047-0.070 0.039 0 0.141t0.133 0.055zM3.078 10.562q0.062-0.062-0.031-0.148-0.094-0.094-0.156-0.023-0.070 0.062 0.031 0.148 0.094 0.094 0.156 0.023zM3.523 10.758q0.023-0.086-0.102-0.125-0.117-0.031-0.148 0.055t0.102 0.117q0.117 0.047 0.148-0.047zM4.016 10.797q0-0.102-0.133-0.086-0.125 0-0.125 0.086 0 0.102 0.133 0.086 0.125 0 0.125-0.086zM4.469 10.719q-0.016-0.086-0.141-0.070-0.125 0.023-0.109 0.117t0.141 0.062 0.109-0.109z"></path></symbol><symbol id="icon-medium" viewBox="0 0 1000 1000"><path d="M336.5,240.2v641.5c0,9.1-2.3,16.9-6.8,23.2s-11.2,9.6-20,9.6c-6.2,0-12.2-1.5-18-4.4L37.3,782.7c-7.7-3.6-14.1-9.8-19.4-18.3S10,747.4,10,739V115.5c0-7.3,1.8-13.5,5.5-18.6c3.6-5.1,8.9-7.7,15.9-7.7c5.1,0,13.1,2.7,24.1,8.2l279.5,140C335.9,238.6,336.5,239.5,336.5,240.2L336.5,240.2z M371.5,295.5l292,473.6l-292-145.5V295.5z M990,305.3v576.4c0,9.1-2.6,16.5-7.7,22.1c-5.1,5.7-12,8.5-20.8,8.5s-17.3-2.4-25.7-7.1L694.7,784.9L990,305.3z M988.4,239.7c0,1.1-46.8,77.6-140.3,229.4C754.6,621,699.8,709.8,683.8,735.7L470.5,389l177.2-288.2c6.2-10.2,15.7-15.3,28.4-15.3c5.1,0,9.8,1.1,14.2,3.3l295.9,147.7C987.6,237.1,988.4,238.2,988.4,239.7L988.4,239.7z"/></symbol><symbol id="icon-instagram" viewBox="0 0 489.84 489.84"><path d="M249.62,50.46c65.4,0,73.14.25,99,1.43C372.47,53,385.44,57,394.07,60.32a75.88,75.88,0,0,1,28.16,18.32,75.88,75.88,0,0,1,18.32,28.16c3.35,8.63,7.34,21.6,8.43,45.48,1.18,25.83,1.43,33.57,1.43,99s-0.25,73.14-1.43,99c-1.09,23.88-5.08,36.85-8.43,45.48a81.11,81.11,0,0,1-46.48,46.48c-8.63,3.35-21.6,7.34-45.48,8.43-25.82,1.18-33.57,1.43-99,1.43s-73.15-.25-99-1.43c-23.88-1.09-36.85-5.08-45.48-8.43A75.88,75.88,0,0,1,77,423.86,75.88,75.88,0,0,1,58.69,395.7c-3.35-8.63-7.34-21.6-8.43-45.48-1.18-25.83-1.43-33.57-1.43-99s0.25-73.14,1.43-99c1.09-23.88,5.08-36.85,8.43-45.48A75.88,75.88,0,0,1,77,78.64a75.88,75.88,0,0,1,28.16-18.32c8.63-3.35,21.6-7.34,45.48-8.43,25.83-1.18,33.57-1.43,99-1.43m0-44.13c-66.52,0-74.86.28-101,1.47s-43.87,5.33-59.45,11.38A120.06,120.06,0,0,0,45.81,47.44,120.06,120.06,0,0,0,17.56,90.82C11.5,106.4,7.36,124.2,6.17,150.27s-1.47,34.46-1.47,101,0.28,74.86,1.47,101,5.33,43.87,11.38,59.45a120.06,120.06,0,0,0,28.25,43.38,120.06,120.06,0,0,0,43.38,28.25c15.58,6.05,33.38,10.19,59.45,11.38s34.46,1.47,101,1.47,74.86-.28,101-1.47,43.87-5.33,59.45-11.38a125.24,125.24,0,0,0,71.63-71.63c6.05-15.58,10.19-33.38,11.38-59.45s1.47-34.46,1.47-101-0.28-74.86-1.47-101-5.33-43.87-11.38-59.45a120.06,120.06,0,0,0-28.25-43.38,120.06,120.06,0,0,0-43.38-28.25C394.47,13.13,376.67,9,350.6,7.8s-34.46-1.47-101-1.47h0Z" transform="translate(-4.7 -6.33)" /><path d="M249.62,125.48A125.77,125.77,0,1,0,375.39,251.25,125.77,125.77,0,0,0,249.62,125.48Zm0,207.41a81.64,81.64,0,1,1,81.64-81.64A81.64,81.64,0,0,1,249.62,332.89Z" transform="translate(-4.7 -6.33)"/><circle cx="375.66" cy="114.18" r="29.39" /></symbol><symbol id="icon-linkedin" viewBox="0 0 12 14"><path d="M2.727 4.883v7.742h-2.578v-7.742h2.578zM2.891 2.492q0.008 0.57-0.395 0.953t-1.059 0.383h-0.016q-0.641 0-1.031-0.383t-0.391-0.953q0-0.578 0.402-0.957t1.051-0.379 1.039 0.379 0.398 0.957zM12 8.187v4.437h-2.57v-4.141q0-0.82-0.316-1.285t-0.988-0.465q-0.492 0-0.824 0.27t-0.496 0.668q-0.086 0.234-0.086 0.633v4.32h-2.57q0.016-3.117 0.016-5.055t-0.008-2.313l-0.008-0.375h2.57v1.125h-0.016q0.156-0.25 0.32-0.438t0.441-0.406 0.68-0.34 0.895-0.121q1.336 0 2.148 0.887t0.813 2.598z"></path></symbol><symbol id="icon-heart" viewBox="0 0 34 30"><path d="M17,29.7 L16.4,29.2 C3.5,18.7 0,15 0,9 C0,4 4,0 9,0 C13.1,0 15.4,2.3 17,4.1 C18.6,2.3 20.9,0 25,0 C30,0 34,4 34,9 C34,15 30.5,18.7 17.6,29.2 L17,29.7 Z M9,2 C5.1,2 2,5.1 2,9 C2,14.1 5.2,17.5 17,27.1 C28.8,17.5 32,14.1 32,9 C32,5.1 28.9,2 25,2 C21.5,2 19.6,4.1 18.1,5.8 L17,7.1 L15.9,5.8 C14.4,4.1 12.5,2 9,2 Z" id="Shape"></path></symbol><symbol id="icon-arrow-right" viewBox="0 0 25.452 25.452"><path d="M4.471,24.929v-2.004l12.409-9.788c0.122-0.101,0.195-0.251,0.195-0.411c0-0.156-0.073-0.31-0.195-0.409L4.471,2.526V0.522c0-0.2,0.115-0.384,0.293-0.469c0.18-0.087,0.396-0.066,0.552,0.061l15.47,12.202c0.123,0.1,0.195,0.253,0.195,0.409c0,0.16-0.072,0.311-0.195,0.411L5.316,25.34c-0.155,0.125-0.372,0.147-0.552,0.061C4.586,25.315,4.471,25.13,4.471,24.929z"/></symbol><symbol id="icon-star" viewBox="0 0 48 48"><path fill="currentColor" d="M44,24c0,11.045-8.955,20-20,20S4,35.045,4,24S12.955,4,24,4S44,12.955,44,24z"/><path fill="#ffffff" d="M24,11l3.898,7.898l8.703,1.301l-6.301,6.102l1.5,8.699L24,30.898L16.199,35l1.5-8.699l-6.301-6.102  l8.703-1.301L24,11z"/></symbol><symbol id="icon-read" viewBox="0 0 32 32"><path fill="currentColor" d="M29,4H3C1.343,4,0,5.343,0,7v18c0,1.657,1.343,3,3,3h10c0,0.552,0.448,1,1,1h4c0.552,0,1-0.448,1-1h10  c1.657,0,3-1.343,3-3V7C32,5.343,30.657,4,29,4z M29,5v20H18.708c-0.618,0-1.236,0.146-1.789,0.422l-0.419,0.21V5H29z M15.5,5  v20.632l-0.419-0.21C14.528,25.146,13.91,25,13.292,25H3V5H15.5z M31,25c0,1.103-0.897,2-2,2H18v1h-4v-1H3c-1.103,0-2-0.897-2-2V7  c0-0.737,0.405-1.375,1-1.722V25c0,0.552,0.448,1,1,1h10.292c0.466,0,0.925,0.108,1.342,0.317l0.919,0.46  c0.141,0.07,0.294,0.106,0.447,0.106c0.153,0,0.306-0.035,0.447-0.106l0.919-0.46C17.783,26.108,18.242,26,18.708,26H29  c0.552,0,1-0.448,1-1V5.278C30.595,5.625,31,6.263,31,7V25z M6,12.5C6,12.224,6.224,12,6.5,12h5c0.276,0,0.5,0.224,0.5,0.5  S11.776,13,11.5,13h-5C6.224,13,6,12.776,6,12.5z M6,14.5C6,14.224,6.224,14,6.5,14h5c0.276,0,0.5,0.224,0.5,0.5S11.776,15,11.5,15  h-5C6.224,15,6,14.776,6,14.5z M6,16.5C6,16.224,6.224,16,6.5,16h5c0.276,0,0.5,0.224,0.5,0.5S11.776,17,11.5,17h-5  C6.224,17,6,16.776,6,16.5z M20,12.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,13,25.5,13h-5  C20.224,13,20,12.776,20,12.5z M20,14.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,15,25.5,15h-5  C20.224,15,20,14.776,20,14.5z M20,16.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,17,25.5,17h-5  C20.224,17,20,16.776,20,16.5z"></path></symbol><symbol id="icon-tistory" viewBox="0 0 24 24"><path d="M4 4h16v3h-6v13h-4V7H4V4z"/></symbol></defs></svg>

        <header class="bar-header">
    <a id="menu" role="button">
        <svg id="open" class="icon-menu"><use xlink:href="#icon-menu"></use></svg>
    </a>
    <h1 class="logo">
        <a href="/">
            
                somaz <span class="version">v3.1.2</span>
            
        </a>
    </h1>
    <a id="search" class="dosearch" role="button">
        <svg class="icon-search"><use xlink:href="#icon-search"></use></svg>
    </a>
    
        <a href="https://github.com/thiagorossener/jekflix-template" class="get-theme" role="button">
            Get this theme!
        </a>
    
</header>

<div id="mask" class="overlay"></div>

<aside class="sidebar" id="sidebar">
    <nav id="navigation">
      <h2>Menu</h2>
      <ul>
  
    
      <li>
        <a href="https://somaz.blog/">Home</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/about">About</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/category">Category</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/contact">Contact</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/feed.xml">Feed</a>
      </li>
    
  
</ul>

    </nav>
</aside>

<div class="search-wrapper">
    <div class="search-form">
        <input type="text" class="search-field" placeholder="Search">
        <svg class="icon-remove-sign"><use xlink:href="#icon-close"></use></svg>
        <ul class="search-results search-list"></ul>
    </div>
</div>



        <section class="post two-columns">
            <article role="article" class="post-content">
                <p class="post-info">
                    
                        <svg class="icon-calendar" id="date"><use xlink:href="#icon-calendar"></use></svg>
                        <time class="date" datetime="2025-01-26T16:00:00+00:00">
                            


January 26, 2025

                        </time>
                    
                    <svg id="clock" class="icon-clock"><use xlink:href="#icon-clock"></use></svg>
                    <span>5 min to read</span>
                </p>
                <h1 class="post-title">Docker Layers - A Deep Dive into Dockerfile Build Principles</h1>
                <p class="post-subtitle">Exploring Docker image layers and build optimization techniques</p>

                
                    <img src="https://res.cloudinary.com/dkcm26aem/image/upload/v1737710995/docker-layer_pvvhqk.png" alt="Featured image" class="post-cover">
                

                <!-- Pagination links -->



                <!-- Add your table of contents here -->


                <p><a href="https://docs.docker.com/build/cache/">Image Reference link</a></p>

<p><br /></p>

<hr />

<h2 id="overview">Overview</h2>

<p>Following our previous discussion about Dockerfiles, today we’ll explore Docker layers and build principles in depth. Understanding these concepts is crucial for creating efficient and maintainable Docker images.</p>

<p><br /></p>

<h3 id="dockerfile-build-principles">Dockerfile Build Principles</h3>
<blockquote>
  <p>Dockerfile is a script that contains a series of instructions on how to build a Docker image. <br /><br /> Docker images consist of a series of layers, each of which represents Dockerfile’s instructions.<br /><br /> Understanding the building principle and layers is important in creating an efficient and easy-to-manage Docker image.</p>
</blockquote>

<h4 id="1-base-image">1. Base Image</h4>
<p>Every Dockerfile starts with a base image specified using the <code class="language-plaintext highlighter-rouge">FROM</code> instruction:</p>
<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="s"> ubuntu:latest</span>
</code></pre></div></div>

<h4 id="2-instructions">2. Instructions</h4>
<p>Dockerfile contains several key instructions:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">RUN</code>: Execute commands in shell</li>
  <li><code class="language-plaintext highlighter-rouge">COPY/ADD</code>: Copy files from host to image</li>
  <li><code class="language-plaintext highlighter-rouge">WORKDIR</code>: Set working directory</li>
  <li><code class="language-plaintext highlighter-rouge">ENV</code>: Set environment variables</li>
  <li><code class="language-plaintext highlighter-rouge">EXPOSE</code>: Inform Docker about network ports</li>
  <li><code class="language-plaintext highlighter-rouge">CMD/ENTRYPOINT</code>: Specify container startup commands</li>
</ul>

<h4 id="3-layers">3. Layers</h4>
<p>Each instruction creates a new layer in the Docker image.</p>

<h4 id="4-caching">4. Caching</h4>
<p>Docker optimizes builds by caching unchanged layers.</p>

<h4 id="5-final-image">5. Final Image</h4>
<p>The result is a cumulative stack of all layers.</p>

<p><br /></p>

<h3 id="understanding-docker-layers">Understanding Docker Layers</h3>

<p>Docker images consist of read-only layers, each representing a Dockerfile instruction. Here’s how they work:</p>

<h4 id="layer-operation">Layer Operation</h4>

<div class="info-box info-box-default">
  <strong>1. Base Layer</strong>
  <ul>
    <li>Created by the `FROM` instruction</li>
    <li>Contains OS or runtime environment</li>
  </ul>
</div>

<p><br /></p>

<div class="info-box info-box-default">
  <strong>2. Additional Layers</strong>
  <ul>
    <li>Created by filesystem-modifying instructions</li>
  </ul>
</div>

<p><strong>Example Dockerfile:</strong>
<script src="https://gist.github.com/somaz94/037c41f44a94840da0756231727cac47.js"></script></p>

<p><br /></p>

<div class="info-box info-box-default">
  <strong>3. Layer Storage</strong>
  <ul>
    <li>Each layer is stored separately</li>
    <li>Only new layers are downloaded during pulls</li>
  </ul>
</div>

<p><br /></p>

<h3 id="benefits-of-layers">Benefits of Layers</h3>

<div class="info-box info-box-default">
  <strong>1. Reusability</strong>
  <ul>
    <li>Layers can be shared across images</li>
    <li>Saves disk space</li>
    <li>Improves download speed</li>
  </ul>
</div>

<div class="info-box info-box-default">
  <strong>2. Efficiency</strong>
  <ul>
    <li>Cached layers are reused</li>
    <li>Faster build times</li>
  </ul>
</div>

<div class="info-box info-box-default">
  <strong>3. Immutability</strong>
  <ul>
    <li>Layers are read-only</li>
    <li>Ensures consistency</li>
  </ul>
</div>

<p><br /></p>

<h3 id="visualizing-docker-layers">Visualizing Docker Layers</h3>

<p>To better understand layers in your Docker images, you can use the <code class="language-plaintext highlighter-rouge">docker history</code> command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker <span class="nb">history </span>my-image:latest
</code></pre></div></div>

<p>Example output:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>IMAGE          CREATED       CREATED BY                                      SIZE      COMMENT
abc123def456   2 hours ago   /bin/sh <span class="nt">-c</span> <span class="c">#(nop) CMD ["python3" "app.py"]      0B        </span>
ghijkl789101   2 hours ago   /bin/sh <span class="nt">-c</span> pip3 <span class="nb">install</span> <span class="nt">-r</span> requirements.txt     15.8MB    
mnopqr112131   2 hours ago   /bin/sh <span class="nt">-c</span> <span class="c">#(nop) WORKDIR /app                  0B        </span>
stuvwx141516   2 hours ago   /bin/sh <span class="nt">-c</span> <span class="c">#(nop) COPY . /app                   1.5MB     </span>
yz1718192021   2 hours ago   /bin/sh <span class="nt">-c</span> apt-get update <span class="o">&amp;&amp;</span> apt-get <span class="nb">install</span>…   180MB     
base22232425   5 days ago    /bin/sh <span class="nt">-c</span> <span class="c">#(nop) CMD ["bash"]                  0B        </span>
&lt;missing&gt;      5 days ago    /bin/sh <span class="nt">-c</span> <span class="c">#(nop) ADD file:4f15d7…              75.2MB    </span>
</code></pre></div></div>

<p>For a more detailed view, you can use external tools like <code class="language-plaintext highlighter-rouge">dive</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Install dive</span>
wget https://github.com/wagoodman/dive/releases/download/v0.9.2/dive_0.9.2_linux_amd64.deb
<span class="nb">sudo </span>apt <span class="nb">install</span> ./dive_0.9.2_linux_amd64.deb

<span class="c"># Analyze image layers</span>
dive my-image:latest
</code></pre></div></div>

<p><br /></p>

<h3 id="layer-caching">Layer Caching</h3>

<p>Caching is a key feature of Docker layers:</p>

<p><br /></p>

<script src="https://gist.github.com/somaz94/ae51c16a9342d73dfc0dc7368562d90b.js"></script>

<p><br /></p>

<h4 id="understanding-cache-invalidation">Understanding Cache Invalidation</h4>

<p>Cache is invalidated when:</p>
<ol>
  <li>The content of copied files changes</li>
  <li>The instruction itself changes</li>
  <li>Earlier layers that subsequent layers depend on change</li>
</ol>

<p><br /></p>

<script src="https://gist.github.com/somaz94/b17366401076c6e3279ca3fa6dfd7393.js"></script>

<p><br /></p>

<h3 id="advanced-caching-strategies">Advanced Caching Strategies</h3>

<h4 id="1-using-buildkits-mount-cache">1. Using BuildKit’s Mount Cache</h4>

<p>BuildKit (available in Docker 18.09+) offers more advanced caching:</p>

<p><br /></p>

<script src="https://gist.github.com/somaz94/f6d5514d4b33ff6888af90efb90f0363.js"></script>

<p><br /></p>

<p>To enable BuildKit:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Linux/macOS</span>
<span class="nb">export </span><span class="nv">DOCKER_BUILDKIT</span><span class="o">=</span>1

<span class="c"># Windows PowerShell</span>
<span class="nv">$env</span>:DOCKER_BUILDKIT<span class="o">=</span>1
</code></pre></div></div>

<h4 id="2-using-dockerignore">2. Using .dockerignore</h4>

<p>Create a proper <code class="language-plaintext highlighter-rouge">.dockerignore</code> file to exclude unnecessary files:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Example .dockerignore</span>
node_modules
npm-debug.log
Dockerfile
.dockerignore
.git
.gitignore
README.md
tests
coverage
.env
</code></pre></div></div>

<p><br /></p>

<h3 id="examples">Examples</h3>

<h4 id="1-standard-dockerfile">1. Standard Dockerfile</h4>

<p><br /></p>

<script src="https://gist.github.com/somaz94/883f2e37d7349fb77a12c3bf9a76849a.js"></script>

<p><br /></p>

<p>Layer breakdown:</p>
<ol>
  <li>Ubuntu base image</li>
  <li>Python installation</li>
  <li>Application code</li>
  <li>Dependencies</li>
  <li>Command configuration</li>
</ol>

<h4 id="2-multi-stage-build">2. Multi-Stage Build</h4>

<p><br /></p>

<script src="https://gist.github.com/somaz94/c1257a1e2a5beec77731ebbe8b76f84f.js"></script>

<p><br /></p>

<p>Benefits:</p>
<ul>
  <li>Smaller final image</li>
  <li>Separation of build and runtime environments</li>
  <li>Better security</li>
</ul>

<h3 id="layer-optimization-techniques">Layer Optimization Techniques</h3>

<p><strong>Minimizing Image Size:</strong></p>

<p><strong>1. Combine RUN Instructions:</strong>
Reduce the number of layers by combining RUN commands. Use ‘&amp;&amp;’ to chain commands and ‘' for line breaks to maintain readability. Clean up files in the same layer where they’re created to minimize image size.</p>

<p><strong>2. Use .dockerignore:</strong>
Utilize a .dockerignore file to exclude unnecessary files from your build context. This prevents large or sensitive files from being copied into your image.</p>

<p><strong>3. Choose Smaller Base Images:</strong>
Use alpine or slim variants when possible to reduce base image size. Consider distroless images for production environments to further minimize attack surface.</p>

<p><strong>4. Remove Unnecessary Files:</strong>
Delete package manager caches and temporary files. Use the –no-install-recommends option with apt-get to prevent installation of recommended packages and reduce image size.</p>

<h4 id="before-optimization">Before Optimization:</h4>

<p><br /></p>

<script src="https://gist.github.com/somaz94/3c88a5f995732aa8b794a4c1ee7d9ec9.js"></script>

<p><br /></p>

<h4 id="after-optimization">After Optimization:</h4>

<p><br /></p>

<script src="https://gist.github.com/somaz94/563507a4b1876d656cdb533697365db7.js"></script>

<p><br /></p>

<p>Further optimized with multi-stage build:</p>

<p><br /></p>

<script src="https://gist.github.com/somaz94/a10a91c1f4cd733d9f543a0631b39297.js"></script>

<p><br /></p>

<h3 id="real-world-examples">Real-World Examples</h3>

<h4 id="1-nodejs-application">1. Node.js Application</h4>

<p><br /></p>

<script src="https://gist.github.com/somaz94/cf66e12b486c7088c7639c66231ccd60.js"></script>

<p><br /></p>

<h4 id="2-java-spring-boot-application">2. Java Spring Boot Application</h4>

<p><br /></p>

<script src="https://gist.github.com/somaz94/34bf6f337913af532622ffc04f091cec.js"></script>

<p><br /></p>

<h3 id="layer-debugging-and-analysis">Layer Debugging and Analysis</h3>

<p>When you encounter issues with Docker layers, these commands can help:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># View detailed layer information</span>
docker <span class="nb">history</span> <span class="nt">--no-trunc</span> my-image:latest

<span class="c"># Inspect image metadata</span>
docker inspect my-image:latest

<span class="c"># Check image size</span>
docker images my-image:latest

<span class="c"># Compare image layers</span>
docker diff my-container-id
</code></pre></div></div>

<p>For identifying the largest layers:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Using dive tool</span>
dive my-image:latest

<span class="c"># Alternative with Docker CLI</span>
docker save my-image:latest | <span class="nb">tar</span> <span class="nt">-xC</span> /tmp
<span class="nb">du</span> <span class="nt">-sh</span> /tmp/<span class="k">*</span>/layer.tar | <span class="nb">sort</span> <span class="nt">-hr</span>
</code></pre></div></div>

<p><br /></p>

<hr />

<h2 id="-references">📚 References</h2>
<ul>
  <li><a href="https://docs.docker.com/build/guide/layers/">Docker Build Guide</a></li>
  <li><a href="https://www.cherryservers.com/blog/docker-build-command">Cherry Servers Docker Guide</a></li>
  <li><a href="https://docs.docker.com/develop/develop-images/build_enhancements/">Docker BuildKit Documentation</a></li>
  <li><a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/">Docker Best Practices</a></li>
  <li><a href="https://github.com/wagoodman/dive">Dive Tool for Image Analysis</a></li>
</ul>


                <!-- Pagination links -->


            </article>

            
                <aside class="see-also">
                    <h2>See also</h2>
                    <ul>
                        
                        
                        
                            <li>
                                <a href="/category/monitoring/what-is-grafana/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1745821241/grafana_rbydo6.png">
                                    
                                    <h3>What is Grafana?</h3>
                                </a>
                            </li>
                        
                            <li>
                                <a href="/category/kubernetes/kubernetes-endpoints-endpointslices/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1745818882/endpoints-endpointslices_bhba68.png">
                                    
                                    <h3>Understanding Kubernetes Endpoints and EndpointSlices</h3>
                                </a>
                            </li>
                        
                            <li>
                                <a href="/category/security/ssh-tunneling-guide/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1745818610/ssh-tunnel_feuxns.png">
                                    
                                    <h3>Mastering SSH Tunneling for Secure Remote Access</h3>
                                </a>
                            </li>
                        
                    </ul>
                </aside>
            

        </section>

        <!-- Add time bar only for pages without pagination -->
        
            <div class="time-bar" data-minutes="5">
    <span class="time-completed"></span>
    <span class="time-remaining"></span>
    <div class="bar">
        <span class="completed" style="width:0%;"></span>
        <span class="remaining" style="width:100%;"></span>
    </div>
</div>

            <div class="recommendation">
    <div class="message">
        <strong>Why don't you read something next?</strong>
        <div>
            <button>
                <svg><use xlink:href="#icon-arrow-right"></use></svg>
                <span>Go back to top</span>
            </button>
        </div>
    </div>
    
    <a href="/category/container/docker-hadolint/" class="post-preview">
        <div class="image">
            
                <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1737711522/docker_wbooxb.png">
            
        </div>
        <h3 class="title">Dockerfile Security Best Practices and Hadolint Usage Guide</h3>
    </a>
</div>

        

        <!-- Show modal if the post is the last one -->
        

        <!-- Show modal before user leaves the page -->
        

        <!-- Add your newsletter subscription form here -->

        <section class="share">
    <h3>Share</h3>
    <a aria-label="Share on Twitter" href="https://twitter.com/intent/tweet?text=&quot;Learn about Docker layers, caching mechanisms, and best practices for efficient image building&quot;%20https://somaz.blog/category/container/docker-layer/%20via%20&#64;twitter_username&hashtags=docker,dockerfile,containers,optimization"
    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Share on Twitter">
        <svg class="icon icon-twitter"><use xlink:href="#icon-twitter"></use></svg>
    </a>
    <a aria-label="Share on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://somaz.blog/category/container/docker-layer/"
    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook">
        <svg class="icon icon-facebook"><use xlink:href="#icon-facebook"></use></svg>
    </a>
</section>

        

  <section class="author">
    <div class="details">
      
        <img class="img-rounded" src="/assets/img/uploads/profile.png" alt="Somaz">
      
      <p class="def">Author</p>
      <h3 class="name">
        <a href="/authors/somaz/">Somaz</a>
      </h3>
      <p class="desc">DevOps engineer focused on cloud infrastructure and automation</p>
      <p>
        
          <a href="https://github.com/somaz94" title="Github">
            <svg><use xlink:href="#icon-github"></use></svg>
          </a>
        
        
        
        
        
        
          <a href="https://www.linkedin.com/in/somaz" title="LinkedIn">
            <svg><use xlink:href="#icon-linkedin"></use></svg>
          </a>
        
        
          <a href="https://somaz.tistory.com" title="Tistory">
            <svg><use xlink:href="#icon-tistory"></use></svg>
          </a>
        
      </p>
    </div>
  </section>

  
  
  
  
  
  
  
  

  <script type="application/ld+json">
  {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "Somaz",
      
      "image": "/assets/img/uploads/profile.png",
      
      "jobTitle": "DevOps Engineer",
      "url": "https://somaz.blog/authors/somaz/",
      "sameAs": [
        "https://github.com/somaz94","https://www.linkedin.com/in/somaz","https://{{ author.tistory_username }}.tistory.com"
      ]
  }
  </script>


        

<section class="comments">
    <h3>Comments</h3>
    <div id="disqus_thread"></div>
</section>
<script type="text/javascript">
    var disqus_loaded = false;

    function load_disqus()
    {
        disqus_loaded = true;
        var disqus_shortname = 'https-somaz94-github-io';
        var disqus_title = '';
        var disqus_url = '/category/container/docker-layer/';
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        var ldr = document.getElementById('disqus_loader');
    };
    window.onscroll = function(e) {
        if ((window.innerHeight + window.scrollY) >= (document.body.offsetHeight - 800)) {
            //hit bottom of page
            if (disqus_loaded==false)
                load_disqus()
        }
    };
</script>



        <footer>
    <p>
      
        <a href="https://github.com/somaz94" title="Github">
          <svg><use xlink:href="#icon-github"></use></svg>
        </a>
      
      
        <a href="https://www.facebook.com/facebook_username" title="Facebook">
          <svg><use xlink:href="#icon-facebook"></use></svg>
        </a>
      
      
        <a href="https://twitter.com/twitter_username" title="Twitter">
          <svg><use xlink:href="#icon-twitter"></use></svg>
        </a>
      
      
        <a href="https://medium.com/@medium_username" title="Medium">
          <svg><use xlink:href="#icon-medium"></use></svg>
        </a>
      
      
        <a href="https://www.instagram.com/instagram_username" title="Instagram">
          <svg><use xlink:href="#icon-instagram"></use></svg>
        </a>
      
      
        <a href="https://www.linkedin.com/in/somaz" title="LinkedIn">
          <svg><use xlink:href="#icon-linkedin"></use></svg>
        </a>
      
      
        <a href="https://somaz.tistory.com" title="Tistory">
          <svg><use xlink:href="#icon-tistory"></use></svg>
        </a>
      
    </p>

    <ul>
  
    
      <li>
        <a href="https://somaz.blog/">Home</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/about">About</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/category">Category</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/contact">Contact</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/feed.xml">Feed</a>
      </li>
    
  
</ul>


    <p>
      <a href="https://somaz.blog/sitemap.xml" title="sitemap">Sitemap</a> |
      <a href="https://somaz.blog/privacy-policy.html" title="Privacy Policy">Privacy Policy</a>
    </p>

    <p>
      <span>Somaz Tech Blog</span> <svg class="love"><use xlink:href="#icon-heart"></use></svg>
    </p>
</footer>










<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "somaz",
  "description": "DevOps engineer's tech blog.",
  "url": "https://somaz.blog/",
  "logo": {
      "@type": "ImageObject",
      "url": "https://somaz.blog/assets/img/icons/mediumtile.png",
      "width": "600",
      "height": "315"
  },
  "sameAs": [
    "https://github.com/somaz94","https://www.facebook.com/facebook_username","https://twitter.com/twitter_username","https://medium.com/@medium_username","https://www.instagram.com/instagram_username","https://www.linkedin.com/in/somaz","https://{{ site.tistory_username }}.tistory.com"
  ]
}
</script>

<!-- Include the script that allows Netlify CMS login -->
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

<!-- Include the website scripts -->
<script src="/assets/js/scripts.min.js"></script>

<!-- Include Google Analytics script -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-XXXXXXXX-X"></script>
<script>
  var host = window.location.hostname;
  if (host != 'localhost') {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-XXXXXXXX-X');
  }
</script>
  


<!-- Include extra scripts -->



        

        
        
        
        
        
        
        
        
        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "BlogPosting",
            "name": "Docker Layers - A Deep Dive into Dockerfile Build Principles",
            "headline": "Exploring Docker image layers and build optimization techniques",
            "description": "Learn about Docker layers, caching mechanisms, and best practices for efficient image building",
            "image": "https://res.cloudinary.com/dkcm26aem/image/upload/v1737710995/docker-layer_pvvhqk.png",
            "url": "https://somaz.blog/category/container/docker-layer/",
            "articleBody": "Image Reference link





Overview

Following our previous discussion about Dockerfiles, today we’ll explore Docker layers and build principles in depth. Understanding these concepts is crucial for creating efficient and maintainable Docker images.



Dockerfile Build Principles

  Dockerfile is a script that contains a series of instructions on how to build a Docker image.  Docker images consist of a series of layers, each of which represents Dockerfile’s instructions. Understanding the building principle and layers is important in creating an efficient and easy-to-manage Docker image.


1. Base Image
Every Dockerfile starts with a base image specified using the FROM instruction:
FROM ubuntu:latest


2. Instructions
Dockerfile contains several key instructions:

  RUN: Execute commands in shell
  COPY/ADD: Copy files from host to image
  WORKDIR: Set working directory
  ENV: Set environment variables
  EXPOSE: Inform Docker about network ports
  CMD/ENTRYPOINT: Specify container startup commands


3. Layers
Each instruction creates a new layer in the Docker image.

4. Caching
Docker optimizes builds by caching unchanged layers.

5. Final Image
The result is a cumulative stack of all layers.



Understanding Docker Layers

Docker images consist of read-only layers, each representing a Dockerfile instruction. Here’s how they work:

Layer Operation


  1. Base Layer
  
    Created by the `FROM` instruction
    Contains OS or runtime environment
  





  2. Additional Layers
  
    Created by filesystem-modifying instructions
  


Example Dockerfile:





  3. Layer Storage
  
    Each layer is stored separately
    Only new layers are downloaded during pulls
  




Benefits of Layers


  1. Reusability
  
    Layers can be shared across images
    Saves disk space
    Improves download speed
  



  2. Efficiency
  
    Cached layers are reused
    Faster build times
  



  3. Immutability
  
    Layers are read-only
    Ensures consistency
  




Visualizing Docker Layers

To better understand layers in your Docker images, you can use the docker history command:

docker history my-image:latest


Example output:
IMAGE          CREATED       CREATED BY                                      SIZE      COMMENT
abc123def456   2 hours ago   /bin/sh -c #(nop) CMD [&quot;python3&quot; &quot;app.py&quot;]      0B        
ghijkl789101   2 hours ago   /bin/sh -c pip3 install -r requirements.txt     15.8MB    
mnopqr112131   2 hours ago   /bin/sh -c #(nop) WORKDIR /app                  0B        
stuvwx141516   2 hours ago   /bin/sh -c #(nop) COPY . /app                   1.5MB     
yz1718192021   2 hours ago   /bin/sh -c apt-get update &amp;amp;&amp;amp; apt-get install…   180MB     
base22232425   5 days ago    /bin/sh -c #(nop) CMD [&quot;bash&quot;]                  0B        
&amp;lt;missing&amp;gt;      5 days ago    /bin/sh -c #(nop) ADD file:4f15d7…              75.2MB    


For a more detailed view, you can use external tools like dive:

# Install dive
wget https://github.com/wagoodman/dive/releases/download/v0.9.2/dive_0.9.2_linux_amd64.deb
sudo apt install ./dive_0.9.2_linux_amd64.deb

# Analyze image layers
dive my-image:latest




Layer Caching

Caching is a key feature of Docker layers:







Understanding Cache Invalidation

Cache is invalidated when:

  The content of copied files changes
  The instruction itself changes
  Earlier layers that subsequent layers depend on change








Advanced Caching Strategies

1. Using BuildKit’s Mount Cache

BuildKit (available in Docker 18.09+) offers more advanced caching:







To enable BuildKit:
# Linux/macOS
export DOCKER_BUILDKIT=1

# Windows PowerShell
$env:DOCKER_BUILDKIT=1


2. Using .dockerignore

Create a proper .dockerignore file to exclude unnecessary files:

# Example .dockerignore
node_modules
npm-debug.log
Dockerfile
.dockerignore
.git
.gitignore
README.md
tests
coverage
.env




Examples

1. Standard Dockerfile







Layer breakdown:

  Ubuntu base image
  Python installation
  Application code
  Dependencies
  Command configuration


2. Multi-Stage Build







Benefits:

  Smaller final image
  Separation of build and runtime environments
  Better security


Layer Optimization Techniques

Minimizing Image Size:

1. Combine RUN Instructions:
Reduce the number of layers by combining RUN commands. Use ‘&amp;amp;&amp;amp;’ to chain commands and ‘&apos; for line breaks to maintain readability. Clean up files in the same layer where they’re created to minimize image size.

2. Use .dockerignore:
Utilize a .dockerignore file to exclude unnecessary files from your build context. This prevents large or sensitive files from being copied into your image.

3. Choose Smaller Base Images:
Use alpine or slim variants when possible to reduce base image size. Consider distroless images for production environments to further minimize attack surface.

4. Remove Unnecessary Files:
Delete package manager caches and temporary files. Use the –no-install-recommends option with apt-get to prevent installation of recommended packages and reduce image size.

Before Optimization:







After Optimization:







Further optimized with multi-stage build:







Real-World Examples

1. Node.js Application







2. Java Spring Boot Application







Layer Debugging and Analysis

When you encounter issues with Docker layers, these commands can help:

# View detailed layer information
docker history --no-trunc my-image:latest

# Inspect image metadata
docker inspect my-image:latest

# Check image size
docker images my-image:latest

# Compare image layers
docker diff my-container-id


For identifying the largest layers:

# Using dive tool
dive my-image:latest

# Alternative with Docker CLI
docker save my-image:latest | tar -xC /tmp
du -sh /tmp/*/layer.tar | sort -hr






📚 References

  Docker Build Guide
  Cherry Servers Docker Guide
  Docker BuildKit Documentation
  Docker Best Practices
  Dive Tool for Image Analysis

",
            "wordcount": "1034",
            "inLanguage": "en",
            "dateCreated": "2025-01-26/",
            "datePublished": "2025-01-26/",
            "dateModified": "2025-01-26/",
            "author": {
                "@type": "Person",
                "name": "Somaz",
                
                "image": "/assets/img/uploads/profile.png",
                
                "jobTitle": "DevOps Engineer",
                "url": "https://somaz.blog/authors/somaz/",
                "sameAs": [
                    "https://github.com/somaz94","https://www.linkedin.com/in/somaz"
                ]
            },
            "publisher": {
                "@type": "Organization",
                "name": "somaz",
                "url": "https://somaz.blog/",
                "logo": {
                    "@type": "ImageObject",
                    "url": "https://somaz.blog/assets/img/blog-image.png",
                    "width": "600",
                    "height": "315"
                }
            },
            "mainEntityOfPage": "True",
            "genre": "CONTAINER",
            "articleSection": "CONTAINER",
            "keywords": ["docker","dockerfile","containers","optimization"]
        }
        </script>
    </body>
</html>
