<!DOCTYPE html>
<html lang="en" class="no-js">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    

    
    

    
    

    
    

    <!-- ✅ Google Tag Manager 추가 -->
    <script>
        (function(w,d,s,l,i){
            w[l]=w[l]||[];
            w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
            var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
            j.async=true;
            j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
            f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-MBP83N4Q');
    </script>
      <!-- ✅ End Google Tag Manager -->

    <!-- Mermaid.js 직접 로드 -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>

    <title>Docker Image Optimization Practical Guide | somaz</title>
    <meta name="description" content="Learn advanced Docker image optimization techniques through real-world examples with Python FastAPI and Go applications, achieving up to 99% size reduction">
    
        <meta name="keywords" content="docker, containerization, optimization, golang, python, fastapi, devops, security">
    

    <!-- Social: Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Docker Image Optimization Practical Guide | somaz">
    <meta name="twitter:description" content="Learn advanced Docker image optimization techniques through real-world examples with Python FastAPI and Go applications, achieving up to 99% size reduction">

    
        <meta property="twitter:image" content="https://res.cloudinary.com/dkcm26aem/image/upload/v1767693107/docker-image-opt-1_bfyljd.png">
    
    
    
        <meta name="twitter:site" content="@twitter_username">
    

    <!-- Social: Facebook / Open Graph -->
    <meta property="og:url" content="https://somaz.blog/category/container/docker-image-optimization/">
    <meta property="og:title" content="Docker Image Optimization Practical Guide | somaz">
    <meta property="og:image" content="https://res.cloudinary.com/dkcm26aem/image/upload/v1767693107/docker-image-opt-1_bfyljd.png">
    <meta property="og:description" content="Learn advanced Docker image optimization techniques through real-world examples with Python FastAPI and Go applications, achieving up to 99% size reduction">
    <meta property="og:site_name" content="Somaz Tech Blog">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/assets/img/icons/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/img/icons/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/img/icons/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/img/icons/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/img/icons/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/img/icons/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/img/icons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/icons/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/img/icons/apple-touch-icon-152x152.png" />

    <!-- Windows 8 Tile Icons -->
    <meta name="application-name" content="somaz">
    <meta name="msapplication-TileColor" content="#141414">
    <meta name="msapplication-square70x70logo" content="smalltile.png" />
    <meta name="msapplication-square150x150logo" content="mediumtile.png" />
    <meta name="msapplication-wide310x150logo" content="widetile.png" />
    <meta name="msapplication-square310x310logo" content="largetile.png" />
    
    <!-- Android Lolipop Theme Color -->
    <meta name="theme-color" content="#141414">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Titillium+Web:300,400,700" rel="stylesheet">

    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="canonical" href="https://somaz.blog/category/container/docker-image-optimization/">
    <link rel="alternate" type="application/rss+xml" title="Somaz Tech Blog" href="https://somaz.blog/feed.xml" />

    <!-- Include extra styles -->
    

    <!-- JavaScript enabled/disabled -->
    <script>
        document.querySelector('html').classList.remove('no-js');
    </script>

    <!-- Google Adsense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8725590811736154"
        crossorigin="anonymous"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"> -->
    <!-- <link href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/variable/woff2/SUIT-Variable.css" rel="stylesheet"> -->
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- <link href="https://fonts.googleapis.com/css2?family=Albert+Sans:wght@400;500;700&display=swap" rel="stylesheet"> -->

    <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml" />

</head>
<!-- ✅ Google Tag Manager (noscript) -->
<noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MBP83N4Q"
            height="0" width="0" style="display:none;visibility:hidden">
    </iframe>
</noscript>
<!-- ✅ End Google Tag Manager (noscript) -->
    <body class="has-push-menu">
        





        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" display="none" version="1.1"><defs><symbol id="icon-menu" viewBox="0 0 1024 1024"><path class="path1" d="M128 213.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 725.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 469.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5z"/></symbol><symbol id="icon-search" viewBox="0 0 951 1024"><path class="path1" d="M658.286 475.429q0-105.714-75.143-180.857t-180.857-75.143-180.857 75.143-75.143 180.857 75.143 180.857 180.857 75.143 180.857-75.143 75.143-180.857zM950.857 950.857q0 29.714-21.714 51.429t-51.429 21.714q-30.857 0-51.429-21.714l-196-195.429q-102.286 70.857-228 70.857-81.714 0-156.286-31.714t-128.571-85.714-85.714-128.571-31.714-156.286 31.714-156.286 85.714-128.571 128.571-85.714 156.286-31.714 156.286 31.714 128.571 85.714 85.714 128.571 31.714 156.286q0 125.714-70.857 228l196 196q21.143 21.143 21.143 51.429z"/></symbol><symbol id="icon-close" viewBox="0 0 1000 1000"><path d="M969.8,870.3c27,27.7,27,71.8,0,99.1C955.7,983,937.9,990,920,990c-17.9,0-35.7-7-49.7-20.7L500,599L129.6,969.4C115.6,983,97.8,990,79.9,990s-35.7-7-49.7-20.7c-27-27.3-27-71.4,0-99.1L400.9,500L30.3,129.3c-27-27.3-27-71.4,0-99.1c27.3-27,71.8-27,99.4,0L500,400.9L870.4,30.2c27.7-27,71.8-27,99.4,0c27,27.7,27,71.8,0,99.1L599.1,500L969.8,870.3z"/></symbol><symbol id="icon-twitter" viewBox="0 0 951 1024"><path class="path1" d="M925.714 233.143q-38.286 56-92.571 95.429 0.571 8 0.571 24 0 74.286-21.714 148.286t-66 142-105.429 120.286-147.429 83.429-184.571 31.143q-154.857 0-283.429-82.857 20 2.286 44.571 2.286 128.571 0 229.143-78.857-60-1.143-107.429-36.857t-65.143-91.143q18.857 2.857 34.857 2.857 24.571 0 48.571-6.286-64-13.143-106-63.714t-42-117.429v-2.286q38.857 21.714 83.429 23.429-37.714-25.143-60-65.714t-22.286-88q0-50.286 25.143-93.143 69.143 85.143 168.286 136.286t212.286 56.857q-4.571-21.714-4.571-42.286 0-76.571 54-130.571t130.571-54q80 0 134.857 58.286 62.286-12 117.143-44.571-21.143 65.714-81.143 101.714 53.143-5.714 106.286-28.571z"/></symbol><symbol id="icon-facebook" viewBox="0 0 585 1024"><path class="path1" d="M548 6.857v150.857h-89.714q-49.143 0-66.286 20.571t-17.143 61.714v108h167.429l-22.286 169.143h-145.143v433.714h-174.857v-433.714h-145.714v-169.143h145.714v-124.571q0-106.286 59.429-164.857t158.286-58.571q84 0 130.286 6.857z"/></symbol><symbol id="icon-clock" viewBox="0 0 1000 1000"><path d="M500,10C229.8,10,10,229.8,10,500c0,270.2,219.8,490,490,490c270.2,0,490-219.8,490-490C990,229.8,770.2,10,500,10z M500,910.2c-226.2,0-410.2-184-410.2-410.2c0-226.2,184-410.2,410.2-410.2c226.2,0,410.2,184,410.2,410.2C910.2,726.1,726.2,910.2,500,910.2z M753.1,374c8.2,11.9,5.2,28.1-6.6,36.3L509.9,573.7c-4.4,3.1-9.6,4.6-14.8,4.6c-4.1,0-8.3-1-12.1-3c-8.6-4.5-14-13.4-14-23.1V202.5c0-14.4,11.7-26.1,26.1-26.1c14.4,0,26.1,11.7,26.1,26.1v300l195.6-135.1C728.7,359.2,744.9,362.1,753.1,374z"/></symbol><symbol id="icon-calendar" viewBox="0 0 1000 1000"><path d="M920,500v420H80V500H920 M990,430H10v490c0,38.7,31.3,70,70,70h840c38.7,0,70-31.3,70-70V430L990,430z"/><path d="M850,80v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80H360v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80C72.8,80,10,142.7,10,220v140h980V220C990,142.7,927.2,80,850,80z"/><path d="M255,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C290,25.8,274.3,10,255,10z"/><path d="M745,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C780,25.8,764.3,10,745,10z"/></symbol><symbol id="icon-github" viewBox="0 0 12 14"><path d="M6 1q1.633 0 3.012 0.805t2.184 2.184 0.805 3.012q0 1.961-1.145 3.527t-2.957 2.168q-0.211 0.039-0.312-0.055t-0.102-0.234q0-0.023 0.004-0.598t0.004-1.051q0-0.758-0.406-1.109 0.445-0.047 0.801-0.141t0.734-0.305 0.633-0.52 0.414-0.82 0.16-1.176q0-0.93-0.617-1.609 0.289-0.711-0.062-1.594-0.219-0.070-0.633 0.086t-0.719 0.344l-0.297 0.187q-0.727-0.203-1.5-0.203t-1.5 0.203q-0.125-0.086-0.332-0.211t-0.652-0.301-0.664-0.105q-0.352 0.883-0.062 1.594-0.617 0.68-0.617 1.609 0 0.664 0.16 1.172t0.41 0.82 0.629 0.523 0.734 0.305 0.801 0.141q-0.305 0.281-0.383 0.805-0.164 0.078-0.352 0.117t-0.445 0.039-0.512-0.168-0.434-0.488q-0.148-0.25-0.379-0.406t-0.387-0.187l-0.156-0.023q-0.164 0-0.227 0.035t-0.039 0.090 0.070 0.109 0.102 0.094l0.055 0.039q0.172 0.078 0.34 0.297t0.246 0.398l0.078 0.18q0.102 0.297 0.344 0.48t0.523 0.234 0.543 0.055 0.434-0.027l0.18-0.031q0 0.297 0.004 0.691t0.004 0.426q0 0.141-0.102 0.234t-0.312 0.055q-1.812-0.602-2.957-2.168t-1.145-3.527q0-1.633 0.805-3.012t2.184-2.184 3.012-0.805zM2.273 9.617q0.023-0.055-0.055-0.094-0.078-0.023-0.102 0.016-0.023 0.055 0.055 0.094 0.070 0.047 0.102-0.016zM2.516 9.883q0.055-0.039-0.016-0.125-0.078-0.070-0.125-0.023-0.055 0.039 0.016 0.125 0.078 0.078 0.125 0.023zM2.75 10.234q0.070-0.055 0-0.148-0.062-0.102-0.133-0.047-0.070 0.039 0 0.141t0.133 0.055zM3.078 10.562q0.062-0.062-0.031-0.148-0.094-0.094-0.156-0.023-0.070 0.062 0.031 0.148 0.094 0.094 0.156 0.023zM3.523 10.758q0.023-0.086-0.102-0.125-0.117-0.031-0.148 0.055t0.102 0.117q0.117 0.047 0.148-0.047zM4.016 10.797q0-0.102-0.133-0.086-0.125 0-0.125 0.086 0 0.102 0.133 0.086 0.125 0 0.125-0.086zM4.469 10.719q-0.016-0.086-0.141-0.070-0.125 0.023-0.109 0.117t0.141 0.062 0.109-0.109z"></path></symbol><symbol id="icon-medium" viewBox="0 0 1000 1000"><path d="M336.5,240.2v641.5c0,9.1-2.3,16.9-6.8,23.2s-11.2,9.6-20,9.6c-6.2,0-12.2-1.5-18-4.4L37.3,782.7c-7.7-3.6-14.1-9.8-19.4-18.3S10,747.4,10,739V115.5c0-7.3,1.8-13.5,5.5-18.6c3.6-5.1,8.9-7.7,15.9-7.7c5.1,0,13.1,2.7,24.1,8.2l279.5,140C335.9,238.6,336.5,239.5,336.5,240.2L336.5,240.2z M371.5,295.5l292,473.6l-292-145.5V295.5z M990,305.3v576.4c0,9.1-2.6,16.5-7.7,22.1c-5.1,5.7-12,8.5-20.8,8.5s-17.3-2.4-25.7-7.1L694.7,784.9L990,305.3z M988.4,239.7c0,1.1-46.8,77.6-140.3,229.4C754.6,621,699.8,709.8,683.8,735.7L470.5,389l177.2-288.2c6.2-10.2,15.7-15.3,28.4-15.3c5.1,0,9.8,1.1,14.2,3.3l295.9,147.7C987.6,237.1,988.4,238.2,988.4,239.7L988.4,239.7z"/></symbol><symbol id="icon-instagram" viewBox="0 0 489.84 489.84"><path d="M249.62,50.46c65.4,0,73.14.25,99,1.43C372.47,53,385.44,57,394.07,60.32a75.88,75.88,0,0,1,28.16,18.32,75.88,75.88,0,0,1,18.32,28.16c3.35,8.63,7.34,21.6,8.43,45.48,1.18,25.83,1.43,33.57,1.43,99s-0.25,73.14-1.43,99c-1.09,23.88-5.08,36.85-8.43,45.48a81.11,81.11,0,0,1-46.48,46.48c-8.63,3.35-21.6,7.34-45.48,8.43-25.82,1.18-33.57,1.43-99,1.43s-73.15-.25-99-1.43c-23.88-1.09-36.85-5.08-45.48-8.43A75.88,75.88,0,0,1,77,423.86,75.88,75.88,0,0,1,58.69,395.7c-3.35-8.63-7.34-21.6-8.43-45.48-1.18-25.83-1.43-33.57-1.43-99s0.25-73.14,1.43-99c1.09-23.88,5.08-36.85,8.43-45.48A75.88,75.88,0,0,1,77,78.64a75.88,75.88,0,0,1,28.16-18.32c8.63-3.35,21.6-7.34,45.48-8.43,25.83-1.18,33.57-1.43,99-1.43m0-44.13c-66.52,0-74.86.28-101,1.47s-43.87,5.33-59.45,11.38A120.06,120.06,0,0,0,45.81,47.44,120.06,120.06,0,0,0,17.56,90.82C11.5,106.4,7.36,124.2,6.17,150.27s-1.47,34.46-1.47,101,0.28,74.86,1.47,101,5.33,43.87,11.38,59.45a120.06,120.06,0,0,0,28.25,43.38,120.06,120.06,0,0,0,43.38,28.25c15.58,6.05,33.38,10.19,59.45,11.38s34.46,1.47,101,1.47,74.86-.28,101-1.47,43.87-5.33,59.45-11.38a125.24,125.24,0,0,0,71.63-71.63c6.05-15.58,10.19-33.38,11.38-59.45s1.47-34.46,1.47-101-0.28-74.86-1.47-101-5.33-43.87-11.38-59.45a120.06,120.06,0,0,0-28.25-43.38,120.06,120.06,0,0,0-43.38-28.25C394.47,13.13,376.67,9,350.6,7.8s-34.46-1.47-101-1.47h0Z" transform="translate(-4.7 -6.33)" /><path d="M249.62,125.48A125.77,125.77,0,1,0,375.39,251.25,125.77,125.77,0,0,0,249.62,125.48Zm0,207.41a81.64,81.64,0,1,1,81.64-81.64A81.64,81.64,0,0,1,249.62,332.89Z" transform="translate(-4.7 -6.33)"/><circle cx="375.66" cy="114.18" r="29.39" /></symbol><symbol id="icon-linkedin" viewBox="0 0 12 14"><path d="M2.727 4.883v7.742h-2.578v-7.742h2.578zM2.891 2.492q0.008 0.57-0.395 0.953t-1.059 0.383h-0.016q-0.641 0-1.031-0.383t-0.391-0.953q0-0.578 0.402-0.957t1.051-0.379 1.039 0.379 0.398 0.957zM12 8.187v4.437h-2.57v-4.141q0-0.82-0.316-1.285t-0.988-0.465q-0.492 0-0.824 0.27t-0.496 0.668q-0.086 0.234-0.086 0.633v4.32h-2.57q0.016-3.117 0.016-5.055t-0.008-2.313l-0.008-0.375h2.57v1.125h-0.016q0.156-0.25 0.32-0.438t0.441-0.406 0.68-0.34 0.895-0.121q1.336 0 2.148 0.887t0.813 2.598z"></path></symbol><symbol id="icon-heart" viewBox="0 0 34 30"><path d="M17,29.7 L16.4,29.2 C3.5,18.7 0,15 0,9 C0,4 4,0 9,0 C13.1,0 15.4,2.3 17,4.1 C18.6,2.3 20.9,0 25,0 C30,0 34,4 34,9 C34,15 30.5,18.7 17.6,29.2 L17,29.7 Z M9,2 C5.1,2 2,5.1 2,9 C2,14.1 5.2,17.5 17,27.1 C28.8,17.5 32,14.1 32,9 C32,5.1 28.9,2 25,2 C21.5,2 19.6,4.1 18.1,5.8 L17,7.1 L15.9,5.8 C14.4,4.1 12.5,2 9,2 Z" id="Shape"></path></symbol><symbol id="icon-arrow-right" viewBox="0 0 25.452 25.452"><path d="M4.471,24.929v-2.004l12.409-9.788c0.122-0.101,0.195-0.251,0.195-0.411c0-0.156-0.073-0.31-0.195-0.409L4.471,2.526V0.522c0-0.2,0.115-0.384,0.293-0.469c0.18-0.087,0.396-0.066,0.552,0.061l15.47,12.202c0.123,0.1,0.195,0.253,0.195,0.409c0,0.16-0.072,0.311-0.195,0.411L5.316,25.34c-0.155,0.125-0.372,0.147-0.552,0.061C4.586,25.315,4.471,25.13,4.471,24.929z"/></symbol><symbol id="icon-star" viewBox="0 0 48 48"><path fill="currentColor" d="M44,24c0,11.045-8.955,20-20,20S4,35.045,4,24S12.955,4,24,4S44,12.955,44,24z"/><path fill="#ffffff" d="M24,11l3.898,7.898l8.703,1.301l-6.301,6.102l1.5,8.699L24,30.898L16.199,35l1.5-8.699l-6.301-6.102  l8.703-1.301L24,11z"/></symbol><symbol id="icon-read" viewBox="0 0 32 32"><path fill="currentColor" d="M29,4H3C1.343,4,0,5.343,0,7v18c0,1.657,1.343,3,3,3h10c0,0.552,0.448,1,1,1h4c0.552,0,1-0.448,1-1h10  c1.657,0,3-1.343,3-3V7C32,5.343,30.657,4,29,4z M29,5v20H18.708c-0.618,0-1.236,0.146-1.789,0.422l-0.419,0.21V5H29z M15.5,5  v20.632l-0.419-0.21C14.528,25.146,13.91,25,13.292,25H3V5H15.5z M31,25c0,1.103-0.897,2-2,2H18v1h-4v-1H3c-1.103,0-2-0.897-2-2V7  c0-0.737,0.405-1.375,1-1.722V25c0,0.552,0.448,1,1,1h10.292c0.466,0,0.925,0.108,1.342,0.317l0.919,0.46  c0.141,0.07,0.294,0.106,0.447,0.106c0.153,0,0.306-0.035,0.447-0.106l0.919-0.46C17.783,26.108,18.242,26,18.708,26H29  c0.552,0,1-0.448,1-1V5.278C30.595,5.625,31,6.263,31,7V25z M6,12.5C6,12.224,6.224,12,6.5,12h5c0.276,0,0.5,0.224,0.5,0.5  S11.776,13,11.5,13h-5C6.224,13,6,12.776,6,12.5z M6,14.5C6,14.224,6.224,14,6.5,14h5c0.276,0,0.5,0.224,0.5,0.5S11.776,15,11.5,15  h-5C6.224,15,6,14.776,6,14.5z M6,16.5C6,16.224,6.224,16,6.5,16h5c0.276,0,0.5,0.224,0.5,0.5S11.776,17,11.5,17h-5  C6.224,17,6,16.776,6,16.5z M20,12.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,13,25.5,13h-5  C20.224,13,20,12.776,20,12.5z M20,14.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,15,25.5,15h-5  C20.224,15,20,14.776,20,14.5z M20,16.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,17,25.5,17h-5  C20.224,17,20,16.776,20,16.5z"></path></symbol><symbol id="icon-tistory" viewBox="0 0 24 24"><path d="M4 4h16v3h-6v13h-4V7H4V4z"/></symbol></defs></svg>

        <header class="bar-header">
    <a id="menu" role="button">
        <svg id="open" class="icon-menu"><use xlink:href="#icon-menu"></use></svg>
    </a>
    <h1 class="logo">
        <a href="/">
            
                somaz <span class="version">v3.1.2</span>
            
        </a>
    </h1>
    <a id="search" class="dosearch" role="button">
        <svg class="icon-search"><use xlink:href="#icon-search"></use></svg>
    </a>
    
        <a href="https://github.com/thiagorossener/jekflix-template" class="get-theme" role="button">
            Get this theme!
        </a>
    
</header>

<div id="mask" class="overlay"></div>

<aside class="sidebar" id="sidebar">
    <nav id="navigation">
      <h2>Menu</h2>
      <ul>
  
    
      <li>
        <a href="https://somaz.blog/">Home</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/about">About</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/category">Category</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/contact">Contact</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/feed.xml">Feed</a>
      </li>
    
  
</ul>

    </nav>
</aside>

<div class="search-wrapper">
    <div class="search-form">
        <input type="text" class="search-field" placeholder="Search">
        <svg class="icon-remove-sign"><use xlink:href="#icon-close"></use></svg>
        <ul class="search-results search-list"></ul>
    </div>
</div>



        <section class="post two-columns">
            <article role="article" class="post-content">
                <p class="post-info">
                    
                        <svg class="icon-calendar" id="date"><use xlink:href="#icon-calendar"></use></svg>
                        <time class="date" datetime="2026-02-07T00:00:00+00:00">
                            


February 7, 2026

                        </time>
                    
                    <svg id="clock" class="icon-clock"><use xlink:href="#icon-clock"></use></svg>
                    <span>29 min to read</span>
                </p>
                <h1 class="post-title">Docker Image Optimization Practical Guide</h1>
                <p class="post-subtitle">Comprehensive strategies for reducing Docker image sizes while maintaining functionality and security</p>

                
                    <img src="https://res.cloudinary.com/dkcm26aem/image/upload/v1767693107/docker-image-opt-1_bfyljd.png" alt="Featured image" class="post-cover">
                

                <!-- Pagination links -->



                <!-- Add your table of contents here -->


                <p><br /></p>

<hr />

<h2 id="overview">Overview</h2>

<p>As a DevOps engineer, oversized Docker images have consistently been a persistent challenge throughout my career. Python machine learning stacks and Go development tools often result in images exceeding 1GB, creating significant operational obstacles.</p>

<p>Recent experiments with personal projects revealed critical issues with initial image sizes consuming excessive local development environment disk space. This investigation focused on three primary pain points:</p>

<ul>
  <li><strong>Deployment Time</strong>: Extended image build and transfer duration</li>
  <li><strong>Development Environment</strong>: Local disk space constraints</li>
  <li><strong>Security Vulnerabilities</strong>: Unnecessary packages introducing potential risks</li>
</ul>

<p>Through several weeks of optimization experimentation, I successfully reduced a Python FastAPI service from <strong>1.96GB to 305MB</strong> and a Go API server from <strong>1.54GB to 30MB</strong>.</p>

<p>This comprehensive guide presents language-specific Docker image optimization strategies validated through practical implementation.</p>

<p><br /></p>

<h2 id="why-image-size-matters">Why Image Size Matters</h2>

<div class="quote-box">
  <p>Docker image optimization extends beyond mere size reduction - it encompasses deployment speed improvement, development environment efficiency, and security enhancement.</p>
</div>

<p><br /></p>

<h3 id="real-world-production-issues">Real-World Production Issues</h3>

<h4 id="deployment-delays">Deployment Delays</h4>
<ul>
  <li>1.2GB image requiring 8 minutes for new instance startup</li>
  <li>Autoscaling inability to respond to rapid traffic increases</li>
  <li>Extended recovery time during incident resolution</li>
</ul>

<h4 id="infrastructure-cost-escalation">Infrastructure Cost Escalation</h4>
<ul>
  <li>AWS ECR costs: $300 → $1,200 monthly (4x increase)</li>
  <li>EKS node disk space exhaustion requiring scale-out</li>
  <li>Increased network costs from image pull traffic</li>
</ul>

<h4 id="security-risk-amplification">Security Risk Amplification</h4>
<ul>
  <li>Over 300 CVE vulnerabilities from unnecessary packages</li>
  <li>Container scanning requiring 10 minutes, degrading CI/CD speed</li>
  <li>Expanded runtime attack surface</li>
</ul>

<p><br /></p>

<h3 id="optimization-results-preview">Optimization Results Preview</h3>

<div class="table-container">
  <table class="table-beauty">
    <tr>
      <th style="width: 15%;">Language</th>
      <th style="width: 20%;">Stage</th>
      <th style="width: 20%;">Image Size</th>
      <th style="width: 20%;">Reduction</th>
      <th style="width: 25%;">Cumulative Reduction</th>
    </tr>
    <tr>
      <td rowspan="4">Python</td>
      <td>Base (python:latest)</td>
      <td>1.96GB</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <td>Slim version</td>
      <td>703MB</td>
      <td>64%</td>
      <td>64%</td>
    </tr>
    <tr>
      <td>Alpine version</td>
      <td>352MB</td>
      <td>50%</td>
      <td>82%</td>
    </tr>
    <tr>
      <td>Multi-stage</td>
      <td>305MB</td>
      <td>13%</td>
      <td>84%</td>
    </tr>
    <tr>
      <td rowspan="4">Go</td>
      <td>Base (golang:latest)</td>
      <td>1.54GB</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <td>Alpine version</td>
      <td>628MB</td>
      <td>59%</td>
      <td>59%</td>
    </tr>
    <tr>
      <td>Multi-stage</td>
      <td>30MB</td>
      <td>95%</td>
      <td>98%</td>
    </tr>
    <tr>
      <td>Scratch base</td>
      <td>15.3MB</td>
      <td>49%</td>
      <td>99%</td>
    </tr>
  </table>
</div>

<p><br /></p>

<h2 id="python-fastapi-optimization-journey">Python FastAPI Optimization Journey</h2>

<div style="width: 100%; margin: auto; margin-top: 40px;">  
  <div class="mermaid">
  graph TB
      subgraph "Python Optimization Pipeline"
          A[Base Python Image<br />1.96GB] --&gt; B[Python Slim<br />703MB]
          B --&gt; C[Alpine Linux<br />352MB]
          C --&gt; D[Multi-stage Build<br />305MB]
          
          A -.-&gt;|64% reduction| B
          B -.-&gt;|50% reduction| C
          C -.-&gt;|13% reduction| D
      end
  </div>
</div>

<p><br /></p>

<h3 id="sample-application-setup">Sample Application Setup</h3>

<p>Creating a production-like FastAPI application with machine learning capabilities to demonstrate real-world optimization scenarios.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.py
</span><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span><span class="p">,</span> <span class="n">HTTPException</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">uvicorn</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"ML Prediction API"</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s">"1.0.0"</span><span class="p">)</span>

<span class="c1"># Data models
</span><span class="k">class</span> <span class="nc">PredictionRequest</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">features</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
    <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">"linear"</span>

<span class="k">class</span> <span class="nc">PredictionResponse</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">prediction</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">confidence</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">str</span>

<span class="c1"># Simple ML model simulation
</span><span class="k">class</span> <span class="nc">SimpleModel</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># In production, this would be a pickled model
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">weights</span><span class="p">):</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">"Feature dimension mismatch"</span><span class="p">)</span>
        
        <span class="n">prediction</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">weights</span><span class="p">)</span>
        <span class="n">confidence</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">prediction</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">prediction</span><span class="p">,</span> <span class="n">confidence</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">SimpleModel</span><span class="p">()</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">root</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s">"service"</span><span class="p">:</span> <span class="s">"ML Prediction API"</span><span class="p">,</span>
        <span class="s">"status"</span><span class="p">:</span> <span class="s">"healthy"</span><span class="p">,</span>
        <span class="s">"timestamp"</span><span class="p">:</span> <span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">().</span><span class="n">isoformat</span><span class="p">()</span>
    <span class="p">}</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"/health"</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">health_check</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s">"status"</span><span class="p">:</span> <span class="s">"ok"</span><span class="p">,</span>
        <span class="s">"memory_usage"</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s">"test"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}).</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="nb">sum</span><span class="p">()</span>
    <span class="p">}</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">"/predict"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">PredictionResponse</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">PredictionRequest</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">features</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s">"Expected 10 features"</span><span class="p">)</span>
            
        <span class="n">prediction</span><span class="p">,</span> <span class="n">confidence</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">features</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">PredictionResponse</span><span class="p">(</span>
            <span class="n">prediction</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">prediction</span><span class="p">),</span>
            <span class="n">confidence</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">confidence</span><span class="p">),</span>
            <span class="n">timestamp</span><span class="o">=</span><span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">().</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">"PORT"</span><span class="p">,</span> <span class="mi">8000</span><span class="p">))</span>
    <span class="n">uvicorn</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s">"0.0.0.0"</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code># requirements.txt
fastapi==0.104.1
uvicorn[standard]==0.24.0
pandas==2.2.0
numpy==1.26.0
pydantic==2.5.0
</code></pre></div></div>

<p><br /></p>

<h3 id="stage-1-baseline-implementation-196gb">Stage 1: Baseline Implementation (1.96GB)</h3>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Dockerfile.step1</span>
<span class="k">FROM</span><span class="s"> python:3.12</span>

<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="k">COPY</span><span class="s"> requirements.txt .</span>
<span class="k">RUN </span>pip <span class="nb">install</span> <span class="nt">-r</span> requirements.txt

<span class="k">COPY</span><span class="s"> . .</span>

<span class="k">EXPOSE</span><span class="s"> 8000</span>
<span class="k">CMD</span><span class="s"> ["python", "main.py"]</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="nt">-f</span> Dockerfile.step1 <span class="nt">-t</span> ml-api:step1 <span class="nb">.</span>
docker images | <span class="nb">grep </span>ml-api
<span class="c"># ml-api    step1    1.96GB</span>
</code></pre></div></div>

<div class="diagram-caption">
  <p><strong>Issues</strong>: Full Debian system with Python development tools and compilers included</p>
</div>

<p><br /></p>

<h3 id="stage-2-slim-base-image-703mb-64-reduction">Stage 2: Slim Base Image (703MB, 64% reduction)</h3>

<script src="https://gist.github.com/somaz94/ed812bf9076375802132928a58699e05.js"></script>

<p><br /></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="nt">-f</span> Dockerfile.step2 <span class="nt">-t</span> ml-api:step2 <span class="nb">.</span>
docker images | <span class="nb">grep </span>ml-api
<span class="c"># ml-api    step2    703MB</span>
</code></pre></div></div>

<div class="diagram-caption">
  <p><strong>Improvement</strong>: Debian slim version eliminates unnecessary packages</p>
</div>

<p><br /></p>

<h3 id="stage-3-alpine-base-352mb-additional-50-reduction">Stage 3: Alpine Base (352MB, additional 50% reduction)</h3>

<script src="https://gist.github.com/somaz94/e2def80728d5ef55f95da5e64feb4586.js"></script>

<p><br /></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="nt">-f</span> Dockerfile.step3 <span class="nt">-t</span> ml-api:step3 <span class="nb">.</span>
docker images | <span class="nb">grep </span>ml-api
<span class="c"># ml-api    step3    352MB</span>
</code></pre></div></div>

<div class="diagram-caption">
  <p><strong>Consideration</strong>: pandas and numpy compilation on Alpine requires extended build time</p>
</div>

<p><br /></p>

<h3 id="stage-4-multi-stage-build-305mb-additional-13-reduction">Stage 4: Multi-stage Build (305MB, additional 13% reduction)</h3>

<script src="https://gist.github.com/somaz94/92a648a794d3e7bcd8f4970b0bf6ceea.js"></script>

<p><br /></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="nt">-f</span> Dockerfile.step4 <span class="nt">-t</span> ml-api:step4 <span class="nb">.</span>
docker images | <span class="nb">grep </span>ml-api
<span class="c"># ml-api    step4    305MB</span>
</code></pre></div></div>

<div class="diagram-caption">
  <p><strong>Final Result</strong>: 305MB represents the practical balance between optimization and functionality for ML applications with pandas/numpy dependencies.</p>
</div>

<p><br /></p>

<h2 id="go-api-server-optimization-journey">Go API Server Optimization Journey</h2>

<div style="width: 100%; margin: auto; margin-top: 40px;">  
  <div class="mermaid">
  graph TB
      subgraph "Go Optimization Pipeline"
          A[Base Golang Image<br />1.54GB] --&gt; B[Alpine Linux<br />628MB]
          B --&gt; C[Multi-stage Build<br />30MB]
          C --&gt; D[Scratch Base<br />15.3MB]
          
          A -.-&gt;|59% reduction| B
          B -.-&gt;|95% reduction| C
          C -.-&gt;|49% reduction| D
      end
  </div>
</div>

<p><br /></p>

<h3 id="sample-application-setup-1">Sample Application Setup</h3>

<p>Production-ready Go REST API server with monitoring capabilities.</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// main.go</span>
<span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
    <span class="s">"encoding/json"</span>
    <span class="s">"fmt"</span>
    <span class="s">"log"</span>
    <span class="s">"net/http"</span>
    <span class="s">"os"</span>
    <span class="s">"strconv"</span>
    <span class="s">"time"</span>

    <span class="s">"github.com/gorilla/mux"</span>
    <span class="s">"github.com/prometheus/client_golang/prometheus"</span>
    <span class="s">"github.com/prometheus/client_golang/prometheus/promhttp"</span>
<span class="p">)</span>

<span class="k">type</span> <span class="n">User</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">ID</span>        <span class="kt">int</span>       <span class="s">`json:"id"`</span>
    <span class="n">Name</span>      <span class="kt">string</span>    <span class="s">`json:"name"`</span>
    <span class="n">Email</span>     <span class="kt">string</span>    <span class="s">`json:"email"`</span>
    <span class="n">CreatedAt</span> <span class="n">time</span><span class="o">.</span><span class="n">Time</span> <span class="s">`json:"created_at"`</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">APIResponse</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">Status</span>  <span class="kt">string</span>      <span class="s">`json:"status"`</span>
    <span class="n">Message</span> <span class="kt">string</span>      <span class="s">`json:"message,omitempty"`</span>
    <span class="n">Data</span>    <span class="k">interface</span><span class="p">{}</span> <span class="s">`json:"data,omitempty"`</span>
<span class="p">}</span>

<span class="c">// Prometheus metrics</span>
<span class="k">var</span> <span class="p">(</span>
    <span class="n">httpRequestsTotal</span> <span class="o">=</span> <span class="n">prometheus</span><span class="o">.</span><span class="n">NewCounterVec</span><span class="p">(</span>
        <span class="n">prometheus</span><span class="o">.</span><span class="n">CounterOpts</span><span class="p">{</span>
            <span class="n">Name</span><span class="o">:</span> <span class="s">"http_requests_total"</span><span class="p">,</span>
            <span class="n">Help</span><span class="o">:</span> <span class="s">"Total number of HTTP requests"</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"method"</span><span class="p">,</span> <span class="s">"endpoint"</span><span class="p">,</span> <span class="s">"status"</span><span class="p">},</span>
    <span class="p">)</span>
    <span class="n">httpRequestDuration</span> <span class="o">=</span> <span class="n">prometheus</span><span class="o">.</span><span class="n">NewHistogramVec</span><span class="p">(</span>
        <span class="n">prometheus</span><span class="o">.</span><span class="n">HistogramOpts</span><span class="p">{</span>
            <span class="n">Name</span><span class="o">:</span> <span class="s">"http_request_duration_seconds"</span><span class="p">,</span>
            <span class="n">Help</span><span class="o">:</span> <span class="s">"HTTP request duration in seconds"</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"method"</span><span class="p">,</span> <span class="s">"endpoint"</span><span class="p">},</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="c">// Mock database</span>
<span class="k">var</span> <span class="n">users</span> <span class="o">=</span> <span class="p">[]</span><span class="n">User</span><span class="p">{</span>
    <span class="p">{</span><span class="n">ID</span><span class="o">:</span> <span class="m">1</span><span class="p">,</span> <span class="n">Name</span><span class="o">:</span> <span class="s">"Alice"</span><span class="p">,</span> <span class="n">Email</span><span class="o">:</span> <span class="s">"alice@example.com"</span><span class="p">,</span> <span class="n">CreatedAt</span><span class="o">:</span> <span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()},</span>
    <span class="p">{</span><span class="n">ID</span><span class="o">:</span> <span class="m">2</span><span class="p">,</span> <span class="n">Name</span><span class="o">:</span> <span class="s">"Bob"</span><span class="p">,</span> <span class="n">Email</span><span class="o">:</span> <span class="s">"bob@example.com"</span><span class="p">,</span> <span class="n">CreatedAt</span><span class="o">:</span> <span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()},</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">prometheus</span><span class="o">.</span><span class="n">MustRegister</span><span class="p">(</span><span class="n">httpRequestsTotal</span><span class="p">)</span>
    <span class="n">prometheus</span><span class="o">.</span><span class="n">MustRegister</span><span class="p">(</span><span class="n">httpRequestDuration</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">loggingMiddleware</span><span class="p">(</span><span class="n">next</span> <span class="n">http</span><span class="o">.</span><span class="n">Handler</span><span class="p">)</span> <span class="n">http</span><span class="o">.</span><span class="n">Handler</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="n">HandlerFunc</span><span class="p">(</span><span class="k">func</span><span class="p">(</span><span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">start</span> <span class="o">:=</span> <span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span>
        <span class="n">log</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"%s %s %s"</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">Method</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">RequestURI</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">RemoteAddr</span><span class="p">)</span>
        <span class="n">next</span><span class="o">.</span><span class="n">ServeHTTP</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
        <span class="n">duration</span> <span class="o">:=</span> <span class="n">time</span><span class="o">.</span><span class="n">Since</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"Request completed in %v"</span><span class="p">,</span> <span class="n">duration</span><span class="p">)</span>
    <span class="p">})</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">metricsMiddleware</span><span class="p">(</span><span class="n">next</span> <span class="n">http</span><span class="o">.</span><span class="n">Handler</span><span class="p">)</span> <span class="n">http</span><span class="o">.</span><span class="n">Handler</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="n">HandlerFunc</span><span class="p">(</span><span class="k">func</span><span class="p">(</span><span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">start</span> <span class="o">:=</span> <span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span>
        <span class="n">next</span><span class="o">.</span><span class="n">ServeHTTP</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
        <span class="n">duration</span> <span class="o">:=</span> <span class="n">time</span><span class="o">.</span><span class="n">Since</span><span class="p">(</span><span class="n">start</span><span class="p">)</span><span class="o">.</span><span class="n">Seconds</span><span class="p">()</span>
        
        <span class="n">httpRequestsTotal</span><span class="o">.</span><span class="n">WithLabelValues</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">Method</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">URL</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="s">"200"</span><span class="p">)</span><span class="o">.</span><span class="n">Inc</span><span class="p">()</span>
        <span class="n">httpRequestDuration</span><span class="o">.</span><span class="n">WithLabelValues</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">Method</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">URL</span><span class="o">.</span><span class="n">Path</span><span class="p">)</span><span class="o">.</span><span class="n">Observe</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>
    <span class="p">})</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">healthHandler</span><span class="p">(</span><span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">w</span><span class="o">.</span><span class="n">Header</span><span class="p">()</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="s">"Content-Type"</span><span class="p">,</span> <span class="s">"application/json"</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">:=</span> <span class="n">APIResponse</span><span class="p">{</span>
        <span class="n">Status</span><span class="o">:</span> <span class="s">"healthy"</span><span class="p">,</span>
        <span class="n">Data</span><span class="o">:</span> <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="k">interface</span><span class="p">{}{</span>
            <span class="s">"timestamp"</span><span class="o">:</span> <span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">(),</span>
            <span class="s">"service"</span><span class="o">:</span>   <span class="s">"User API"</span><span class="p">,</span>
            <span class="s">"version"</span><span class="o">:</span>   <span class="s">"1.0.0"</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>
    <span class="n">json</span><span class="o">.</span><span class="n">NewEncoder</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">Encode</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">getUsersHandler</span><span class="p">(</span><span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">w</span><span class="o">.</span><span class="n">Header</span><span class="p">()</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="s">"Content-Type"</span><span class="p">,</span> <span class="s">"application/json"</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">:=</span> <span class="n">APIResponse</span><span class="p">{</span>
        <span class="n">Status</span><span class="o">:</span> <span class="s">"success"</span><span class="p">,</span>
        <span class="n">Data</span><span class="o">:</span>   <span class="n">users</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">json</span><span class="o">.</span><span class="n">NewEncoder</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">Encode</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">getUserHandler</span><span class="p">(</span><span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">vars</span> <span class="o">:=</span> <span class="n">mux</span><span class="o">.</span><span class="n">Vars</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">id</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">strconv</span><span class="o">.</span><span class="n">Atoi</span><span class="p">(</span><span class="n">vars</span><span class="p">[</span><span class="s">"id"</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="n">w</span><span class="o">.</span><span class="n">WriteHeader</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">StatusBadRequest</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">:=</span> <span class="n">APIResponse</span><span class="p">{</span>
            <span class="n">Status</span><span class="o">:</span>  <span class="s">"error"</span><span class="p">,</span>
            <span class="n">Message</span><span class="o">:</span> <span class="s">"Invalid user ID"</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">json</span><span class="o">.</span><span class="n">NewEncoder</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">Encode</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">user</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">users</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="n">id</span> <span class="p">{</span>
            <span class="n">w</span><span class="o">.</span><span class="n">Header</span><span class="p">()</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="s">"Content-Type"</span><span class="p">,</span> <span class="s">"application/json"</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">:=</span> <span class="n">APIResponse</span><span class="p">{</span>
                <span class="n">Status</span><span class="o">:</span> <span class="s">"success"</span><span class="p">,</span>
                <span class="n">Data</span><span class="o">:</span>   <span class="n">user</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">json</span><span class="o">.</span><span class="n">NewEncoder</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">Encode</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">w</span><span class="o">.</span><span class="n">WriteHeader</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">StatusNotFound</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">:=</span> <span class="n">APIResponse</span><span class="p">{</span>
        <span class="n">Status</span><span class="o">:</span>  <span class="s">"error"</span><span class="p">,</span>
        <span class="n">Message</span><span class="o">:</span> <span class="s">"User not found"</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">json</span><span class="o">.</span><span class="n">NewEncoder</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">Encode</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">createUserHandler</span><span class="p">(</span><span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">var</span> <span class="n">user</span> <span class="n">User</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">json</span><span class="o">.</span><span class="n">NewDecoder</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">Body</span><span class="p">)</span><span class="o">.</span><span class="n">Decode</span><span class="p">(</span><span class="o">&amp;</span><span class="n">user</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="n">w</span><span class="o">.</span><span class="n">WriteHeader</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">StatusBadRequest</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">:=</span> <span class="n">APIResponse</span><span class="p">{</span>
            <span class="n">Status</span><span class="o">:</span>  <span class="s">"error"</span><span class="p">,</span>
            <span class="n">Message</span><span class="o">:</span> <span class="s">"Invalid JSON"</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">json</span><span class="o">.</span><span class="n">NewEncoder</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">Encode</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="n">user</span><span class="o">.</span><span class="n">ID</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">users</span><span class="p">)</span> <span class="o">+</span> <span class="m">1</span>
    <span class="n">user</span><span class="o">.</span><span class="n">CreatedAt</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span>
    <span class="n">users</span> <span class="o">=</span> <span class="nb">append</span><span class="p">(</span><span class="n">users</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>

    <span class="n">w</span><span class="o">.</span><span class="n">Header</span><span class="p">()</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="s">"Content-Type"</span><span class="p">,</span> <span class="s">"application/json"</span><span class="p">)</span>
    <span class="n">w</span><span class="o">.</span><span class="n">WriteHeader</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">StatusCreated</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">:=</span> <span class="n">APIResponse</span><span class="p">{</span>
        <span class="n">Status</span><span class="o">:</span> <span class="s">"success"</span><span class="p">,</span>
        <span class="n">Data</span><span class="o">:</span>   <span class="n">user</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">json</span><span class="o">.</span><span class="n">NewEncoder</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">Encode</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">r</span> <span class="o">:=</span> <span class="n">mux</span><span class="o">.</span><span class="n">NewRouter</span><span class="p">()</span>
    
    <span class="c">// Middleware</span>
    <span class="n">r</span><span class="o">.</span><span class="n">Use</span><span class="p">(</span><span class="n">loggingMiddleware</span><span class="p">)</span>
    <span class="n">r</span><span class="o">.</span><span class="n">Use</span><span class="p">(</span><span class="n">metricsMiddleware</span><span class="p">)</span>
    
    <span class="c">// Routes</span>
    <span class="n">r</span><span class="o">.</span><span class="n">HandleFunc</span><span class="p">(</span><span class="s">"/health"</span><span class="p">,</span> <span class="n">healthHandler</span><span class="p">)</span><span class="o">.</span><span class="n">Methods</span><span class="p">(</span><span class="s">"GET"</span><span class="p">)</span>
    <span class="n">r</span><span class="o">.</span><span class="n">HandleFunc</span><span class="p">(</span><span class="s">"/users"</span><span class="p">,</span> <span class="n">getUsersHandler</span><span class="p">)</span><span class="o">.</span><span class="n">Methods</span><span class="p">(</span><span class="s">"GET"</span><span class="p">)</span>
    <span class="n">r</span><span class="o">.</span><span class="n">HandleFunc</span><span class="p">(</span><span class="s">"/users/{id:[0-9]+}"</span><span class="p">,</span> <span class="n">getUserHandler</span><span class="p">)</span><span class="o">.</span><span class="n">Methods</span><span class="p">(</span><span class="s">"GET"</span><span class="p">)</span>
    <span class="n">r</span><span class="o">.</span><span class="n">HandleFunc</span><span class="p">(</span><span class="s">"/users"</span><span class="p">,</span> <span class="n">createUserHandler</span><span class="p">)</span><span class="o">.</span><span class="n">Methods</span><span class="p">(</span><span class="s">"POST"</span><span class="p">)</span>
    <span class="n">r</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="s">"/metrics"</span><span class="p">,</span> <span class="n">promhttp</span><span class="o">.</span><span class="n">Handler</span><span class="p">())</span>

    <span class="n">port</span> <span class="o">:=</span> <span class="n">os</span><span class="o">.</span><span class="n">Getenv</span><span class="p">(</span><span class="s">"PORT"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">port</span> <span class="o">==</span> <span class="s">""</span> <span class="p">{</span>
        <span class="n">port</span> <span class="o">=</span> <span class="s">"8080"</span>
    <span class="p">}</span>

    <span class="n">log</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"Server starting on port %s"</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
    <span class="n">log</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">ListenAndServe</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s">":%s"</span><span class="p">,</span> <span class="n">port</span><span class="p">),</span> <span class="n">r</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// go.mod</span>
<span class="n">module</span> <span class="n">user</span><span class="o">-</span><span class="n">api</span>

<span class="k">go</span> <span class="m">1.21</span>

<span class="n">require</span> <span class="p">(</span>
    <span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">gorilla</span><span class="o">/</span><span class="n">mux</span> <span class="n">v1</span><span class="m">.8.1</span>
    <span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">prometheus</span><span class="o">/</span><span class="n">client_golang</span> <span class="n">v1</span><span class="m">.17.0</span>
<span class="p">)</span>
</code></pre></div></div>

<p><br /></p>

<p>Generate <code class="language-plaintext highlighter-rouge">go.sum</code>:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>go mod tidy
</code></pre></div></div>

<p><br /></p>

<h3 id="stage-1-baseline-implementation-154gb">Stage 1: Baseline Implementation (1.54GB)</h3>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Dockerfile.step1</span>
<span class="k">FROM</span><span class="s"> golang:1.24</span>

<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="k">COPY</span><span class="s"> go.mod go.sum ./</span>
<span class="k">RUN </span>go mod download

<span class="k">COPY</span><span class="s"> . .</span>
<span class="k">RUN </span>go build <span class="nt">-o</span> main .

<span class="k">EXPOSE</span><span class="s"> 8080</span>
<span class="k">CMD</span><span class="s"> ["./main"]</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="nt">-f</span> Dockerfile.step1 <span class="nt">-t</span> user-api:step1 <span class="nb">.</span>
docker images | <span class="nb">grep </span>user-api
<span class="c"># user-api    step1    1.54GB</span>
</code></pre></div></div>

<div class="diagram-caption">
  <p><strong>Issues</strong>: Complete Go development environment with build tools and Git</p>
</div>

<p><br /></p>

<h3 id="stage-2-alpine-base-628mb-59-reduction">Stage 2: Alpine Base (628MB, 59% reduction)</h3>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Dockerfile.step2</span>
<span class="k">FROM</span><span class="s"> golang:1.24-alpine</span>

<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="c"># Git installation for go mod download</span>
<span class="k">RUN </span>apk add <span class="nt">--no-cache</span> git

<span class="k">COPY</span><span class="s"> go.mod go.sum ./</span>
<span class="k">RUN </span>go mod download

<span class="k">COPY</span><span class="s"> . .</span>
<span class="k">RUN </span>go build <span class="nt">-o</span> main .

<span class="k">EXPOSE</span><span class="s"> 8080</span>
<span class="k">CMD</span><span class="s"> ["./main"]</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="nt">-f</span> Dockerfile.step2 <span class="nt">-t</span> user-api:step2 <span class="nb">.</span>
docker images | <span class="nb">grep </span>user-api
<span class="c"># user-api    step2    628MB</span>
</code></pre></div></div>

<div class="diagram-caption">
  <p><strong>Improvement</strong>: Alpine Linux significantly reduces base OS size</p>
</div>

<p><br /></p>

<h3 id="stage-3-multi-stage-build-30mb-92-reduction">Stage 3: Multi-stage Build (30MB, 92% reduction)</h3>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Dockerfile.step3</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">golang:1.24-alpine</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">builder</span>

<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="c"># Dependency caching layer separation</span>
<span class="k">COPY</span><span class="s"> go.mod go.sum ./</span>
<span class="k">RUN </span>go mod download

<span class="k">COPY</span><span class="s"> . .</span>
<span class="k">RUN </span><span class="nv">CGO_ENABLED</span><span class="o">=</span>0 <span class="nv">GOOS</span><span class="o">=</span>linux go build <span class="nt">-ldflags</span><span class="o">=</span><span class="s2">"-w -s"</span> <span class="nt">-o</span> main .

<span class="c"># Runtime stage</span>
<span class="k">FROM</span><span class="s"> alpine:latest</span>

<span class="k">WORKDIR</span><span class="s"> /root/</span>

<span class="c"># SSL certificates and timezone information</span>
<span class="k">RUN </span>apk <span class="nt">--no-cache</span> add ca-certificates tzdata
<span class="k">COPY</span><span class="s"> --from=builder /app/main .</span>

<span class="k">EXPOSE</span><span class="s"> 8080</span>
<span class="k">CMD</span><span class="s"> ["./main"]</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="nt">-f</span> Dockerfile.step3 <span class="nt">-t</span> user-api:step3 <span class="nb">.</span>
docker images | <span class="nb">grep </span>user-api
<span class="c"># user-api    step3    30MB</span>
</code></pre></div></div>

<h4 id="improvements">Improvements:</h4>
<ul>
  <li><code class="language-plaintext highlighter-rouge">CGO_ENABLED=0</code>: Eliminates C library dependencies</li>
  <li><code class="language-plaintext highlighter-rouge">-ldflags="-w -s"</code>: Removes debug information and symbol table</li>
  <li>Alpine runtime with minimal environment</li>
</ul>

<p><br /></p>

<h3 id="stage-4-scratch-base-153mb-49-additional-reduction">Stage 4: Scratch Base (15.3MB, 49% additional reduction)</h3>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Dockerfile.step4</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">golang:1.24-alpine</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">builder</span>

<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="c"># Install necessary packages for Alpine</span>
<span class="k">RUN </span>apk <span class="nt">--no-cache</span> add ca-certificates tzdata

<span class="k">COPY</span><span class="s"> go.mod go.sum ./</span>
<span class="k">RUN </span>go mod download

<span class="k">COPY</span><span class="s"> . .</span>
<span class="k">RUN </span><span class="nv">CGO_ENABLED</span><span class="o">=</span>0 <span class="nv">GOOS</span><span class="o">=</span>linux go build <span class="nt">-a</span> <span class="nt">-installsuffix</span> cgo <span class="nt">-ldflags</span><span class="o">=</span><span class="s2">"-w -s"</span> <span class="nt">-o</span> main .

<span class="c"># Final stage: scratch (empty image)</span>
<span class="k">FROM</span><span class="s"> scratch</span>

<span class="c"># Copy SSL certificates for HTTPS requests</span>
<span class="k">COPY</span><span class="s"> --from=builder /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/</span>

<span class="c"># Copy timezone information</span>
<span class="k">COPY</span><span class="s"> --from=builder /usr/share/zoneinfo /usr/share/zoneinfo</span>

<span class="k">COPY</span><span class="s"> --from=builder /app/main /main</span>

<span class="k">EXPOSE</span><span class="s"> 8080</span>
<span class="k">ENTRYPOINT</span><span class="s"> ["/main"]</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="nt">-f</span> Dockerfile.step4 <span class="nt">-t</span> user-api:step4 <span class="nb">.</span>
docker images | <span class="nb">grep </span>user-api
<span class="c"># user-api    step4    15.3MB</span>
</code></pre></div></div>

<h4 id="final-optimization">Final Optimization:</h4>
<ul>
  <li>scratch: Completely empty base image</li>
  <li><code class="language-plaintext highlighter-rouge">-a -installsuffix cgo</code>: Complete static build</li>
  <li>Selective copying of essential files only</li>
</ul>

<p><br /></p>

<h2 id="optimization-strategy-comparison">Optimization Strategy Comparison</h2>

<div style="width: 100%; margin: auto; margin-top: 40px;">  
  <div class="mermaid">
  graph TB
      subgraph "Language-Specific Optimization Characteristics"
          subgraph "Python Optimization"
              P1[Base Image: 1.96GB]
              P2[Slim: 703MB]
              P3[Alpine: 352MB]
              P4[Multi-stage: 305MB]
              P1 --&gt; P2 --&gt; P3 --&gt; P4
          end
          
          subgraph "Go Optimization"
              G1[Base Image: 1.54GB]
              G2[Alpine: 628MB]
              G3[Multi-stage: 30MB]
              G4[Scratch: 15.3MB]
              G1 --&gt; G2 --&gt; G3 --&gt; G4
          end
      end
  </div>
</div>

<p><br /></p>

<h3 id="python-vs-go-optimization-characteristics">Python vs Go Optimization Characteristics</h3>

<div class="table-container">
  <table class="table-beauty">
    <tr>
      <th style="width: 25%;">Characteristic</th>
      <th style="width: 35%;">Python</th>
      <th style="width: 40%;">Go</th>
    </tr>
    <tr>
      <td>Optimization Limit</td>
      <td>305MB (due to dependencies)</td>
      <td>15.3MB (static compilation)</td>
    </tr>
    <tr>
      <td>Complexity</td>
      <td>Medium (dependency management)</td>
      <td>Low (simple build process)</td>
    </tr>
    <tr>
      <td>Build Time</td>
      <td>Extended (numpy/pandas compilation)</td>
      <td>Fast (native compilation)</td>
    </tr>
    <tr>
      <td>Debugging Ease</td>
      <td>Good</td>
      <td>Limited (scratch usage)</td>
    </tr>
  </table>
</div>

<p><br /></p>

<h2 id="advanced-optimization-techniques">Advanced Optimization Techniques</h2>

<p><br /></p>

<h3 id="docker-ignore-configuration">Docker Ignore Configuration</h3>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code># .dockerignore
.git
.gitignore
README.md
Dockerfile*
.DS_Store
node_modules
npm-debug.log
coverage/
.nyc_output
*.log
.env.local
.env.development.local
.env.test.local
.env.production.local
.pytest_cache/
__pycache__/
*.pyc
*.pyo
*.pyd
.Python
env/
venv/
.venv/
pip-log.txt
pip-delete-this-directory.txt
.coverage
.tox/
.cache
nosetests.xml
coverage.xml
*.cover
*.log
.git
.mypy_cache
.pytest_cache
.hypothesis
</code></pre></div></div>

<div class="diagram-caption">
  <p>Excluding unnecessary files from build context improves both build speed and image size.</p>
</div>

<p><br /></p>

<h3 id="security-hardening">Security Hardening</h3>

<script src="https://gist.github.com/somaz94/e92a0511369d77ada5f324df011bdb37.js"></script>

<p><br /></p>

<h3 id="build-performance-optimization">Build Performance Optimization</h3>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Multi-stage with dependency caching</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">python:3.12-alpine</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">deps</span>

<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="c"># Copy only dependency files first for better caching</span>
<span class="k">COPY</span><span class="s"> requirements.txt ./</span>
<span class="k">RUN </span>pip <span class="nb">install</span> <span class="nt">--no-cache-dir</span> <span class="nt">--user</span> <span class="nt">-r</span> requirements.txt

<span class="c"># Build stage</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">python:3.12-alpine</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">builder</span>

<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="c"># Copy dependencies from deps stage</span>
<span class="k">COPY</span><span class="s"> --from=deps /root/.local /root/.local</span>

<span class="c"># Copy application code</span>
<span class="k">COPY</span><span class="s"> . .</span>

<span class="c"># Runtime stage</span>
<span class="k">FROM</span><span class="s"> python:3.12-alpine</span>

<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="k">RUN </span>apk add <span class="nt">--no-cache</span> libstdc++

<span class="k">COPY</span><span class="s"> --from=builder /root/.local /root/.local</span>
<span class="k">COPY</span><span class="s"> --from=builder /app .</span>

<span class="k">ENV</span><span class="s"> PATH=/root/.local/bin:$PATH</span>

<span class="k">EXPOSE</span><span class="s"> 8000</span>
<span class="k">CMD</span><span class="s"> ["python", "main.py"]</span>
</code></pre></div></div>

<p><br /></p>

<h2 id="production-recommendations">Production Recommendations</h2>

<p><br /></p>

<h3 id="python-projects">Python Projects</h3>

<ul>
  <li>Multi-stage Alpine (305MB) represents the practical optimization limit</li>
  <li>Without ML libraries, images can achieve ~50MB</li>
  <li>Distroless images offer minimal complexity-to-benefit ratio</li>
</ul>

<p><br /></p>

<h3 id="go-projects">Go Projects</h3>

<ul>
  <li>Scratch base (15.3MB) strongly recommended for production</li>
  <li>Consider Alpine (30MB) when external C libraries required</li>
  <li>Use Alpine for development environments requiring debugging capabilities</li>
</ul>

<p><br /></p>

<h3 id="decision-framework">Decision Framework</h3>

<div style="width: 100%; margin: auto; margin-top: 40px;">  
  <div class="mermaid">
  flowchart TD
      Start[New Container Project] --&gt; Lang{Language?}
      
      Lang --&gt;|Python| PyDeps{Heavy Dependencies?}
      Lang --&gt;|Go| GoCLib{C Libraries?}
      Lang --&gt;|Node.js| NodeApproach[Alpine + Multi-stage]
      
      PyDeps --&gt;|Yes ML/Data| PyML[Alpine Multi-stage<br />~300MB]
      PyDeps --&gt;|Lightweight| PyLight[Slim Multi-stage<br />~50MB]
      
      GoCLib --&gt;|Yes| GoAlpine[Alpine Multi-stage<br />~30MB]
      GoCLib --&gt;|No| GoScratch[Scratch<br />~15MB]
      
      PyML --&gt; Security[Add Security Hardening]
      PyLight --&gt; Security
      GoAlpine --&gt; Security
      GoScratch --&gt; Security
      NodeApproach --&gt; Security
      
      Security --&gt; Monitor[Implement Size Monitoring]
  </div>
</div>

<p><br /><br /></p>

<h2 id="monitoring-and-automation">Monitoring and Automation</h2>

<p><br /></p>

<h3 id="cicd-integration">CI/CD Integration</h3>

<script src="https://gist.github.com/somaz94/109b38b9f595238c6ccb74454b9d7bef.js"></script>

<p><br /></p>

<h3 id="image-size-tracking-script">Image Size Tracking Script</h3>

<script src="https://gist.github.com/somaz94/54ea1a76ee7ee297a3c1559e29a54430.js"></script>

<p><br /></p>

<h2 id="performance-impact-analysis">Performance Impact Analysis</h2>

<p><br /></p>

<h3 id="build-time-comparison">Build Time Comparison</h3>

<div class="table-container">
  <table class="table-beauty">
    <tr>
      <th style="width: 25%;">Optimization Stage</th>
      <th style="width: 25%;">Python Build Time</th>
      <th style="width: 25%;">Go Build Time</th>
      <th style="width: 25%;">Cache Hit Impact</th>
    </tr>
    <tr>
      <td>Base Image</td>
      <td>3m 45s</td>
      <td>2m 15s</td>
      <td>Low</td>
    </tr>
    <tr>
      <td>Slim/Alpine</td>
      <td>8m 30s</td>
      <td>1m 45s</td>
      <td>Medium</td>
    </tr>
    <tr>
      <td>Multi-stage</td>
      <td>6m 20s</td>
      <td>1m 30s</td>
      <td>High</td>
    </tr>
    <tr>
      <td>Optimized</td>
      <td>4m 10s</td>
      <td>1m 10s</td>
      <td>Very High</td>
    </tr>
  </table>
</div>

<p><br /></p>

<h3 id="registry-storage-impact">Registry Storage Impact</h3>

<script src="https://gist.github.com/somaz94/9537e04458beba3cfdd5624b99e77fe4.js"></script>

<p><br /></p>

<h2 id="common-pitfalls-and-solutions">Common Pitfalls and Solutions</h2>

<p><br /></p>

<h3 id="layer-caching-mistakes">Layer Caching Mistakes</h3>

<h4 id="problem-poor-layer-ordering-causing-cache-invalidation">Problem: Poor layer ordering causing cache invalidation</h4>
<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Bad: Changes frequently, invalidates all subsequent layers</span>
<span class="k">FROM</span><span class="s"> python:3.12-slim</span>
<span class="k">COPY</span><span class="s"> . .</span>
<span class="k">RUN </span>pip <span class="nb">install</span> <span class="nt">-r</span> requirements.txt
</code></pre></div></div>

<h4 id="solution-separate-dependency-installation-from-code-copying">Solution: Separate dependency installation from code copying</h4>
<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Good: Dependencies cached separately from application code</span>
<span class="k">FROM</span><span class="s"> python:3.12-slim</span>
<span class="k">COPY</span><span class="s"> requirements.txt .</span>
<span class="k">RUN </span>pip <span class="nb">install</span> <span class="nt">-r</span> requirements.txt
<span class="k">COPY</span><span class="s"> . .</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="alpine-package-issues">Alpine Package Issues</h3>

<h4 id="problem-missing-libraries-in-alpine-causing-runtime-failures">Problem: Missing libraries in Alpine causing runtime failures</h4>
<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="s"> python:3.12-alpine</span>
<span class="c"># Missing: musl-dev, gcc for some Python packages</span>
<span class="k">RUN </span>pip <span class="nb">install </span>pandas  <span class="c"># May fail</span>
</code></pre></div></div>

<h4 id="solution-install-necessary-build-dependencies">Solution: Install necessary build dependencies</h4>
<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="s"> python:3.12-alpine</span>
<span class="k">RUN </span>apk add <span class="nt">--no-cache</span> gcc musl-dev g++
<span class="k">RUN </span>pip <span class="nb">install </span>pandas
<span class="k">RUN </span>apk del gcc musl-dev g++  <span class="c"># Clean up after install</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="multi-stage-copy-errors">Multi-stage Copy Errors</h3>

<h4 id="problem-incomplete-file-copying-between-stages">Problem: Incomplete file copying between stages</h4>
<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="w"> </span><span class="s">golang:alpine</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">builder</span>
<span class="k">RUN </span>go build <span class="nt">-o</span> app .

<span class="k">FROM</span><span class="s"> scratch</span>
<span class="k">COPY</span><span class="s"> --from=builder /app/app .  # Missing supporting files</span>
</code></pre></div></div>

<h4 id="solution-copy-all-necessary-runtime-files">Solution: Copy all necessary runtime files</h4>
<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="w"> </span><span class="s">golang:alpine</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">builder</span>
<span class="k">RUN </span>apk add <span class="nt">--no-cache</span> ca-certificates tzdata
<span class="k">RUN </span>go build <span class="nt">-o</span> app .

<span class="k">FROM</span><span class="s"> scratch</span>
<span class="k">COPY</span><span class="s"> --from=builder /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/</span>
<span class="k">COPY</span><span class="s"> --from=builder /usr/share/zoneinfo /usr/share/zoneinfo</span>
<span class="k">COPY</span><span class="s"> --from=builder /app/app .</span>
</code></pre></div></div>

<p><br /></p>

<h2 id="security-considerations">Security Considerations</h2>

<p><br /></p>

<h3 id="vulnerability-scanning-integration">Vulnerability Scanning Integration</h3>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># docker-compose.security.yml</span>
<span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">security-scan</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">anchore/syft:latest</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/var/run/docker.sock:/var/run/docker.sock</span>
    <span class="na">command</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="s">sh -c "</span>
        <span class="s">syft packages docker:my-app:latest -o json &gt; /tmp/sbom.json &amp;&amp;</span>
        <span class="s">grype sbom:/tmp/sbom.json --fail-on medium</span>
      <span class="s">"</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="minimal-attack-surface">Minimal Attack Surface</h3>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Security-hardened minimal image</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">golang:1.21-alpine</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">builder</span>

<span class="c"># Install only essential build tools</span>
<span class="k">RUN </span>apk add <span class="nt">--no-cache</span> ca-certificates git

<span class="k">WORKDIR</span><span class="s"> /app</span>
<span class="k">COPY</span><span class="s"> go.mod go.sum ./</span>
<span class="k">RUN </span>go mod download

<span class="k">COPY</span><span class="s"> . .</span>
<span class="k">RUN </span><span class="nv">CGO_ENABLED</span><span class="o">=</span>0 <span class="nv">GOOS</span><span class="o">=</span>linux go build <span class="nt">-ldflags</span><span class="o">=</span><span class="s2">"-X main.version=</span><span class="si">$(</span>git describe <span class="nt">--tags</span><span class="si">)</span><span class="s2">"</span> <span class="nt">-o</span> app .

<span class="c"># Distroless runtime (even smaller than Alpine)</span>
<span class="k">FROM</span><span class="s"> gcr.io/distroless/static-debian11</span>

<span class="k">COPY</span><span class="s"> --from=builder /app/app /</span>
<span class="k">COPY</span><span class="s"> --from=builder /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/</span>

<span class="k">USER</span><span class="s"> 65534:65534</span>
<span class="k">EXPOSE</span><span class="s"> 8080</span>
<span class="k">ENTRYPOINT</span><span class="s"> ["/app"]</span>
</code></pre></div></div>

<p><br /></p>

<h2 id="real-world-case-studies">Real-World Case Studies</h2>

<p><br /></p>

<h3 id="e-commerce-microservice">E-commerce Microservice</h3>

<h4 id="before-optimization-21gb-nodejs-application">Before Optimization: 2.1GB Node.js application</h4>
<ul>
  <li>Base: <code class="language-plaintext highlighter-rouge">node:18</code> (940MB)</li>
  <li>Dependencies: 890MB</li>
  <li>Application code: 270MB</li>
</ul>

<h4 id="after-optimization-145mb">After Optimization: 145MB</h4>
<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="w"> </span><span class="s">node:18-alpine</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">builder</span>
<span class="k">WORKDIR</span><span class="s"> /app</span>
<span class="k">COPY</span><span class="s"> package*.json ./</span>
<span class="k">RUN </span>npm ci <span class="nt">--only</span><span class="o">=</span>production <span class="o">&amp;&amp;</span> npm cache clean <span class="nt">--force</span>

<span class="k">FROM</span><span class="s"> node:18-alpine</span>
<span class="k">RUN </span>apk add <span class="nt">--no-cache</span> dumb-init
<span class="k">WORKDIR</span><span class="s"> /app</span>
<span class="k">COPY</span><span class="s"> --from=builder /app/node_modules ./node_modules</span>
<span class="k">COPY</span><span class="s"> . .</span>
<span class="k">USER</span><span class="s"> node</span>
<span class="k">EXPOSE</span><span class="s"> 3000</span>
<span class="k">CMD</span><span class="s"> ["dumb-init", "node", "server.js"]</span>
</code></pre></div></div>

<h4 id="results">Results:</h4>
<ul>
  <li>93% size reduction</li>
  <li>5x faster deployment</li>
  <li>40% reduction in CVE count</li>
</ul>

<p><br /></p>

<h3 id="machine-learning-pipeline">Machine Learning Pipeline</h3>

<h4 id="challenge-tensorflow--jupyter-environment-38gb">Challenge: TensorFlow + Jupyter environment (3.8GB)</h4>

<h4 id="solution-separate-training-and-inference-images">Solution: Separate training and inference images</h4>
<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Training image (kept large for flexibility)</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">tensorflow/tensorflow:2.13-gpu-jupyter</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">training</span>
<span class="c"># ... full development environment</span>

<span class="c"># Inference image (optimized for production)</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">python:3.11-slim</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">inference</span>
<span class="k">RUN </span>pip <span class="nb">install </span>tensorflow-cpu<span class="o">==</span>2.13.0 <span class="nt">--no-deps</span>
<span class="k">COPY</span><span class="s"> --from=training /app/model /app/model</span>
<span class="k">COPY</span><span class="s"> inference_server.py /app/</span>
<span class="k">CMD</span><span class="s"> ["python", "/app/inference_server.py"]</span>
</code></pre></div></div>

<div class="diagram-caption">
  <p><strong>Results</strong>: Production inference image reduced from 3.8GB to 890MB</p>
</div>

<p><br /></p>

<h2 id="automation-and-tooling">Automation and Tooling</h2>

<p><br /></p>

<h3 id="docker-build-optimization-script">Docker Build Optimization Script</h3>

<script src="https://gist.github.com/somaz94/4350a064a1bd7aa2bf332c91b46e8b71.js"></script>

<p><br /></p>

<h3 id="image-size-monitoring">Image Size Monitoring</h3>

<script src="https://gist.github.com/somaz94/6304dee08afe798154f5555b518401e4.js"></script>

<p><br /></p>

<h2 id="performance-testing">Performance Testing</h2>

<p><br /></p>

<h3 id="load-test-with-optimized-images">Load Test with Optimized Images</h3>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># k6-load-test.js</span>
<span class="s">import http from 'k6/http';</span>
<span class="s">import { check } from 'k6';</span>

<span class="s">export let options = {</span>
  <span class="s">stages</span><span class="err">:</span> <span class="pi">[</span>
    <span class="pi">{</span> <span class="nv">duration</span><span class="pi">:</span> <span class="s1">'</span><span class="s">2m'</span><span class="pi">,</span> <span class="nv">target</span><span class="pi">:</span> <span class="nv">100</span> <span class="pi">},</span>
    <span class="pi">{</span> <span class="nv">duration</span><span class="pi">:</span> <span class="s1">'</span><span class="s">5m'</span><span class="pi">,</span> <span class="nv">target</span><span class="pi">:</span> <span class="nv">200</span> <span class="pi">},</span>
    <span class="pi">{</span> <span class="nv">duration</span><span class="pi">:</span> <span class="s1">'</span><span class="s">2m'</span><span class="pi">,</span> <span class="nv">target</span><span class="pi">:</span> <span class="nv">0</span> <span class="pi">},</span>
  <span class="pi">]</span><span class="err">,</span>
<span class="err">}</span><span class="s">;</span>

<span class="s">export default function() {</span>
  <span class="s">let response = http.get('http://localhost:8000/health');</span>
  
  <span class="s">check(response, {</span>
    <span class="s">'status is 200'</span><span class="err">:</span> <span class="s">(r) =&gt; r.status === 200,</span>
    <span class="s">'response time &lt; 200ms'</span><span class="err">:</span> <span class="s">(r) =&gt; r.timings.duration &lt; 200,</span>
  <span class="s">});</span>
<span class="err">}</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="deployment-speed-comparison">Deployment Speed Comparison</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># deployment-speed-test.sh</span>

<span class="nv">IMAGES</span><span class="o">=(</span><span class="s2">"app:large"</span> <span class="s2">"app:medium"</span> <span class="s2">"app:small"</span><span class="o">)</span>

<span class="k">for </span>image <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">IMAGES</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
  </span><span class="nb">echo</span> <span class="s2">"Testing deployment speed for </span><span class="nv">$image</span><span class="s2">"</span>
  
  <span class="c"># Clear local cache</span>
  docker rmi <span class="s2">"</span><span class="nv">$image</span><span class="s2">"</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">true</span>
  
  <span class="c"># Time the pull and start</span>
  <span class="nv">start_time</span><span class="o">=</span><span class="si">$(</span><span class="nb">date</span> +%s.%N<span class="si">)</span>
  
  docker run <span class="nt">-d</span> <span class="nt">--name</span> <span class="s2">"test-</span><span class="nv">$image</span><span class="s2">"</span> <span class="nt">-p</span> 8000:8000 <span class="s2">"</span><span class="nv">$image</span><span class="s2">"</span>
  
  <span class="c"># Wait for health check</span>
  <span class="k">while</span> <span class="o">!</span> curl <span class="nt">-sf</span> http://localhost:8000/health <span class="o">&gt;</span>/dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">do
    </span><span class="nb">sleep </span>0.1
  <span class="k">done
  
  </span><span class="nv">end_time</span><span class="o">=</span><span class="si">$(</span><span class="nb">date</span> +%s.%N<span class="si">)</span>
  <span class="nv">duration</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$end_time</span><span class="s2"> - </span><span class="nv">$start_time</span><span class="s2">"</span> | bc<span class="si">)</span>
  
  <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$image</span><span class="s2">: </span><span class="k">${</span><span class="nv">duration</span><span class="k">}</span><span class="s2">s"</span>
  
  <span class="c"># Cleanup</span>
  docker stop <span class="s2">"test-</span><span class="nv">$image</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> docker <span class="nb">rm</span> <span class="s2">"test-</span><span class="nv">$image</span><span class="s2">"</span>
  
  <span class="nb">echo</span> <span class="s2">"---"</span>
<span class="k">done</span>
</code></pre></div></div>

<p><br /></p>

<h2 id="future-considerations">Future Considerations</h2>

<p><br /></p>

<h3 id="emerging-technologies">Emerging Technologies</h3>

<h4 id="webassembly-wasm-integration">WebAssembly (WASM) Integration</h4>
<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Future: WASM-based containers</span>
<span class="k">FROM</span><span class="s"> scratch</span>
<span class="k">COPY</span><span class="s"> app.wasm /app.wasm</span>
<span class="k">COPY</span><span class="s"> wasmtime /wasmtime</span>
<span class="k">ENTRYPOINT</span><span class="s"> ["/wasmtime", "/app.wasm"]</span>
</code></pre></div></div>

<h4 id="oci-artifacts-and-supply-chain">OCI Artifacts and Supply Chain</h4>
<ul>
  <li>Image signing with Cosign</li>
  <li>Software Bill of Materials (SBOM) integration</li>
  <li>Vulnerability attestation</li>
</ul>

<p><br /></p>

<h3 id="platform-specific-optimizations">Platform-Specific Optimizations</h3>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Multi-architecture optimization</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">--platform=$BUILDPLATFORM golang:1.21-alpine</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">builder</span>
<span class="k">ARG</span><span class="s"> TARGETPLATFORM</span>
<span class="k">ARG</span><span class="s"> BUILDPLATFORM</span>
<span class="k">ARG</span><span class="s"> TARGETOS</span>
<span class="k">ARG</span><span class="s"> TARGETARCH</span>

<span class="k">WORKDIR</span><span class="s"> /app</span>
<span class="k">COPY</span><span class="s"> go.mod go.sum ./</span>
<span class="k">RUN </span>go mod download

<span class="k">COPY</span><span class="s"> . .</span>
<span class="k">RUN </span><span class="nv">CGO_ENABLED</span><span class="o">=</span>0 <span class="nv">GOOS</span><span class="o">=</span><span class="nv">$TARGETOS</span> <span class="nv">GOARCH</span><span class="o">=</span><span class="nv">$TARGETARCH</span> go build <span class="nt">-o</span> app .

<span class="k">FROM</span><span class="s"> scratch</span>
<span class="k">COPY</span><span class="s"> --from=builder /app/app .</span>
<span class="k">ENTRYPOINT</span><span class="s"> ["./app"]</span>
</code></pre></div></div>

<p><br /></p>

<h2 id="conclusion">Conclusion</h2>

<p>Docker image optimization represents a critical DevOps practice that extends far beyond simple size reduction. Through systematic application of language-specific strategies, organizations achieve substantial improvements in deployment velocity, infrastructure costs, and security posture.</p>

<p><br /></p>

<h3 id="core-optimization-principles">Core Optimization Principles</h3>

<p><strong>Language-Specific Approaches</strong>: Python optimization focuses on dependency management and build environment separation, while Go leverages static compilation advantages for minimal runtime footprints.</p>

<p><strong>Incremental Optimization</strong>: Successful optimization requires methodical progression through multiple stages rather than attempting comprehensive changes simultaneously.</p>

<p><strong>Practical Balance</strong>: The optimal image size balances complexity, maintainability, and performance requirements rather than pursuing minimal size at any cost.</p>

<p><strong>Continuous Monitoring</strong>: Automated size tracking and security scanning integration prevents optimization regression and maintains security standards.</p>

<p><br /></p>

<h3 id="key-achievements">Key Achievements</h3>

<p>The optimization experiments demonstrated significant practical benefits:</p>
<ul>
  <li><strong>Python FastAPI</strong>: 84% size reduction (1.96GB → 305MB)</li>
  <li><strong>Go API Server</strong>: 99% size reduction (1.54GB → 15.3MB)</li>
  <li><strong>Security</strong>: Substantial CVE reduction through minimal attack surfaces</li>
  <li><strong>Performance</strong>: Improved deployment speeds and resource utilization</li>
</ul>

<p><br /></p>

<h3 id="implementation-recommendations">Implementation Recommendations</h3>

<p>Start with base image selection and dependency optimization before pursuing advanced multi-stage builds. Implement monitoring and automation early to maintain optimization gains over time. Focus on security hardening alongside size reduction to achieve comprehensive container optimization.</p>

<p>The investment in systematic Docker image optimization yields compound returns through improved deployment reliability, reduced infrastructure costs, and enhanced security posture across the entire application lifecycle.</p>

<p><br /></p>

<hr />

<h2 id="references">References</h2>

<ul>
  <li><a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/">Docker Best Practices Documentation</a></li>
  <li><a href="https://github.com/GoogleContainerTools/distroless">Google Distroless Images</a></li>
  <li><a href="https://hub.docker.com/_/python">Python Docker Hub Official Images</a></li>
  <li><a href="https://pythonspeed.com/articles/smaller-python-docker-images/">Python Speed - Smaller Docker Images</a></li>
  <li><a href="https://docs.docker.com/build/buildkit/">Docker BuildKit Documentation</a></li>
  <li><a href="https://docs.docker.com/engine/security/">Container Security Best Practices</a></li>
  <li><a href="https://docs.docker.com/build/building/multi-stage/">Multi-stage Build Documentation</a></li>
  <li><a href="https://docs.docker.com/build/cache/">Docker Layer Caching Guide</a></li>
  <li><a href="https://golang.org/doc/faq#unused_variables_and_imports">Go Binary Size Optimization</a></li>
  <li><a href="https://wiki.alpinelinux.org/wiki/Alpine_Package_Keeper">Alpine Linux Package Management</a></li>
</ul>


                <!-- Pagination links -->


            </article>

            
                <aside class="see-also">
                    <h2>See also</h2>
                    <ul>
                        
                        
                        
                            <li>
                                <a href="/category/gcp/gcp-loadbalancer/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1767686138/gcp-loadbalancer-1_mih9pb.png">
                                    
                                    <h3>GCP Load Balancer Complete Comparison Guide</h3>
                                </a>
                            </li>
                        
                            <li>
                                <a href="/category/aws/aws-vpc-peering-transit-gateway/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1767769488/aws-network-1_y4kc1r.png">
                                    
                                    <h3>AWS Network Connection Methods Complete Comparison - VPC Peering vs Transit Gateway vs VPN</h3>
                                </a>
                            </li>
                        
                            <li>
                                <a href="/category/ai/llm-ollama-open-webui/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1770607787/ollama-openwebui-llm-1_dl6rlu.png">
                                    
                                    <h3>Building an On-Premises LLM System with Ollama + Open WebUI</h3>
                                </a>
                            </li>
                        
                    </ul>
                </aside>
            

        </section>

        <!-- Add time bar only for pages without pagination -->
        
            <div class="time-bar" data-minutes="29">
    <span class="time-completed"></span>
    <span class="time-remaining"></span>
    <div class="bar">
        <span class="completed" style="width:0%;"></span>
        <span class="remaining" style="width:100%;"></span>
    </div>
</div>

            <button class="toggle-preview" onclick="togglePreview()">
    <span>Hide Preview ▼</span>
</button>

<div id="recommendationSection" class="recommendation">
    <div class="message">
        <strong>Why don't you read something next?</strong>
        <div>
            <button>
                <svg><use xlink:href="#icon-arrow-right"></use></svg>
                <span>Go back to top</span>
            </button>
        </div>
    </div>
    <div id="previewSection" class="preview-section">
        
        <a href="/category/ai/llm-ollama-open-webui/" class="post-preview">
            <div class="image">
                
                    <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1770607787/ollama-openwebui-llm-1_dl6rlu.png">
                
            </div>
            <h3 class="title">Building an On-Premises LLM System with Ollama + Open WebUI</h3>
        </a>
    </div>
</div>

<style>
.toggle-preview {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #333;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 4px;
    cursor: pointer;
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.toggle-preview:hover {
    background: #444;
}

.toggle-preview.visible {
    opacity: 1;
}

.recommendation {
    margin-top: 1000px;
    display: block;
    transition: all 0.3s ease;
}

.recommendation.hidden {
    display: none;
}

.hide-preview {
    margin-left: 10px;
    background: none;
    border: 1px solid #666;
    color: #666;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
}

.hide-preview:hover {
    background: #f0f0f0;
}

.preview-section {
    max-height: 1000px;
    overflow: hidden;
    transition: max-height 0.3s ease-out;
}

.preview-section.hidden {
    max-height: 0;
}
</style>

<script>
function togglePreview() {
    const recommendation = document.getElementById('recommendationSection');
    const button = document.querySelector('.toggle-preview span');
    
    if (recommendation.classList.contains('hidden')) {
        recommendation.classList.remove('hidden');
        button.textContent = 'Hide Preview ▼';
    } else {
        recommendation.classList.add('hidden');
        button.textContent = 'Show Preview ▲';
    }
}

window.addEventListener('scroll', function() {
    const toggleButton = document.querySelector('.toggle-preview');
    const recommendation = document.getElementById('recommendationSection');
    const rect = recommendation.getBoundingClientRect();
    
    if (rect.top <= window.innerHeight) {
        toggleButton.classList.add('visible');
    } else {
        toggleButton.classList.remove('visible');
    }
});
</script>

        

        <!-- Show modal if the post is the last one -->
        

        <!-- Show modal before user leaves the page -->
        

        <!-- Add your newsletter subscription form here -->

        <section class="share">
    <h3>Share</h3>
    <a aria-label="Share on Twitter" href="https://twitter.com/intent/tweet?text=&quot;Learn advanced Docker image optimization techniques through real-world examples with Python FastAPI and Go applications, achieving up to 99% size reduction&quot;%20https://somaz.blog/category/container/docker-image-optimization/%20via%20&#64;twitter_username&hashtags=docker,containerization,optimization,golang,python,fastapi,devops,security"
    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Share on Twitter">
        <svg class="icon icon-twitter"><use xlink:href="#icon-twitter"></use></svg>
    </a>
    <a aria-label="Share on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://somaz.blog/category/container/docker-image-optimization/"
    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook">
        <svg class="icon icon-facebook"><use xlink:href="#icon-facebook"></use></svg>
    </a>
</section>

        

  <section class="author">
    <div class="details">
      
        <img class="img-rounded" src="/assets/img/uploads/profile.png" alt="Somaz">
      
      <p class="def">Author</p>
      <h3 class="name">
        <a href="/authors/somaz/">Somaz</a>
      </h3>
      <p class="desc">DevOps engineer focused on cloud infrastructure and automation</p>
      <p>
        
          <a href="https://github.com/somaz94" title="Github">
            <svg><use xlink:href="#icon-github"></use></svg>
          </a>
        
        
        
        
        
        
          <a href="https://www.linkedin.com/in/somaz" title="LinkedIn">
            <svg><use xlink:href="#icon-linkedin"></use></svg>
          </a>
        
        
          <a href="https://somaz.tistory.com" title="Tistory">
            <svg><use xlink:href="#icon-tistory"></use></svg>
          </a>
        
      </p>
    </div>
  </section>

  
  
  
  
  
  
  
  

  <script type="application/ld+json">
  {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "Somaz",
      
      "image": "/assets/img/uploads/profile.png",
      
      "jobTitle": "DevOps Engineer",
      "url": "https://somaz.blog/authors/somaz/",
      "sameAs": [
        "https://github.com/somaz94","https://www.linkedin.com/in/somaz","https://{{ author.tistory_username }}.tistory.com"
      ]
  }
  </script>


        

<section class="comments">
    <h3>Comments</h3>
    <div id="disqus_thread"></div>
</section>
<script type="text/javascript">
    var disqus_loaded = false;

    function load_disqus()
    {
        disqus_loaded = true;
        var disqus_shortname = 'https-somaz94-github-io';
        var disqus_title = '';
        var disqus_url = '/category/container/docker-image-optimization/';
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        var ldr = document.getElementById('disqus_loader');
    };
    window.onscroll = function(e) {
        if ((window.innerHeight + window.scrollY) >= (document.body.offsetHeight - 800)) {
            //hit bottom of page
            if (disqus_loaded==false)
                load_disqus()
        }
    };
</script>



        <footer>
    <p>
      
        <a href="https://github.com/somaz94" title="Github">
          <svg><use xlink:href="#icon-github"></use></svg>
        </a>
      
      
        <a href="https://www.facebook.com/facebook_username" title="Facebook">
          <svg><use xlink:href="#icon-facebook"></use></svg>
        </a>
      
      
        <a href="https://twitter.com/twitter_username" title="Twitter">
          <svg><use xlink:href="#icon-twitter"></use></svg>
        </a>
      
      
        <a href="https://medium.com/@medium_username" title="Medium">
          <svg><use xlink:href="#icon-medium"></use></svg>
        </a>
      
      
        <a href="https://www.instagram.com/instagram_username" title="Instagram">
          <svg><use xlink:href="#icon-instagram"></use></svg>
        </a>
      
      
        <a href="https://www.linkedin.com/in/somaz" title="LinkedIn">
          <svg><use xlink:href="#icon-linkedin"></use></svg>
        </a>
      
      
        <a href="https://somaz.tistory.com" title="Tistory">
          <svg><use xlink:href="#icon-tistory"></use></svg>
        </a>
      
    </p>

    <ul>
  
    
      <li>
        <a href="https://somaz.blog/">Home</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/about">About</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/category">Category</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/contact">Contact</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/feed.xml">Feed</a>
      </li>
    
  
</ul>


    <p>
      <a href="https://somaz.blog/sitemap.xml" title="sitemap">Sitemap</a> |
      <a href="https://somaz.blog/privacy-policy" title="Privacy Policy">Privacy Policy</a>
    </p>

    <p>
      <span>Somaz Tech Blog</span> <svg class="love"><use xlink:href="#icon-heart"></use></svg>
    </p>
</footer>










<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "somaz",
  "description": "DevOps engineer's tech blog.",
  "url": "https://somaz.blog/",
  "logo": {
      "@type": "ImageObject",
      "url": "https://somaz.blog/assets/img/icons/mediumtile.png",
      "width": "600",
      "height": "315"
  },
  "sameAs": [
    "https://github.com/somaz94","https://www.facebook.com/facebook_username","https://twitter.com/twitter_username","https://medium.com/@medium_username","https://www.instagram.com/instagram_username","https://www.linkedin.com/in/somaz","https://{{ site.tistory_username }}.tistory.com"
  ]
}
</script>

<!-- Include the script that allows Netlify CMS login -->
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

<!-- Include the website scripts -->
<script src="/assets/js/scripts.min.js"></script>

<!-- Include Google Analytics script -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-XXXXXXXX-X"></script>
<script>
  var host = window.location.hostname;
  if (host != 'localhost') {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-XXXXXXXX-X');
  }
</script>
  


<!-- Include extra scripts -->



        

        
        
        
        
        
        
        
        
        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "BlogPosting",
            "name": "Docker Image Optimization Practical Guide",
            "headline": "Comprehensive strategies for reducing Docker image sizes while maintaining functionality and security",
            "description": "Learn advanced Docker image optimization techniques through real-world examples with Python FastAPI and Go applications, achieving up to 99% size reduction",
            "image": "https://res.cloudinary.com/dkcm26aem/image/upload/v1767693107/docker-image-opt-1_bfyljd.png",
            "url": "https://somaz.blog/category/container/docker-image-optimization/",
            "articleBody": "



Overview

As a DevOps engineer, oversized Docker images have consistently been a persistent challenge throughout my career. Python machine learning stacks and Go development tools often result in images exceeding 1GB, creating significant operational obstacles.

Recent experiments with personal projects revealed critical issues with initial image sizes consuming excessive local development environment disk space. This investigation focused on three primary pain points:


  Deployment Time: Extended image build and transfer duration
  Development Environment: Local disk space constraints
  Security Vulnerabilities: Unnecessary packages introducing potential risks


Through several weeks of optimization experimentation, I successfully reduced a Python FastAPI service from 1.96GB to 305MB and a Go API server from 1.54GB to 30MB.

This comprehensive guide presents language-specific Docker image optimization strategies validated through practical implementation.



Why Image Size Matters


  Docker image optimization extends beyond mere size reduction - it encompasses deployment speed improvement, development environment efficiency, and security enhancement.




Real-World Production Issues

Deployment Delays

  1.2GB image requiring 8 minutes for new instance startup
  Autoscaling inability to respond to rapid traffic increases
  Extended recovery time during incident resolution


Infrastructure Cost Escalation

  AWS ECR costs: $300 → $1,200 monthly (4x increase)
  EKS node disk space exhaustion requiring scale-out
  Increased network costs from image pull traffic


Security Risk Amplification

  Over 300 CVE vulnerabilities from unnecessary packages
  Container scanning requiring 10 minutes, degrading CI/CD speed
  Expanded runtime attack surface




Optimization Results Preview


  
    
      Language
      Stage
      Image Size
      Reduction
      Cumulative Reduction
    
    
      Python
      Base (python:latest)
      1.96GB
      -
      -
    
    
      Slim version
      703MB
      64%
      64%
    
    
      Alpine version
      352MB
      50%
      82%
    
    
      Multi-stage
      305MB
      13%
      84%
    
    
      Go
      Base (golang:latest)
      1.54GB
      -
      -
    
    
      Alpine version
      628MB
      59%
      59%
    
    
      Multi-stage
      30MB
      95%
      98%
    
    
      Scratch base
      15.3MB
      49%
      99%
    
  




Python FastAPI Optimization Journey

  
  
  graph TB
      subgraph &quot;Python Optimization Pipeline&quot;
          A[Base Python Image1.96GB] --&amp;gt; B[Python Slim703MB]
          B --&amp;gt; C[Alpine Linux352MB]
          C --&amp;gt; D[Multi-stage Build305MB]
          
          A -.-&amp;gt;|64% reduction| B
          B -.-&amp;gt;|50% reduction| C
          C -.-&amp;gt;|13% reduction| D
      end
  




Sample Application Setup

Creating a production-like FastAPI application with machine learning capabilities to demonstrate real-world optimization scenarios.

# main.py
from fastapi import FastAPI, HTTPException
from pydantic import BaseModel
import pandas as pd
import numpy as np
from datetime import datetime
import uvicorn
import os

app = FastAPI(title=&quot;ML Prediction API&quot;, version=&quot;1.0.0&quot;)

# Data models
class PredictionRequest(BaseModel):
    features: list[float]
    model_name: str = &quot;linear&quot;

class PredictionResponse(BaseModel):
    prediction: float
    confidence: float
    timestamp: str

# Simple ML model simulation
class SimpleModel:
    def __init__(self):
        # In production, this would be a pickled model
        self.weights = np.random.randn(10)
        
    def predict(self, features):
        if len(features) != len(self.weights):
            raise ValueError(&quot;Feature dimension mismatch&quot;)
        
        prediction = np.dot(features, self.weights)
        confidence = min(0.95, abs(prediction) / 10)
        return prediction, confidence

model = SimpleModel()

@app.get(&quot;/&quot;)
async def root():
    return {
        &quot;service&quot;: &quot;ML Prediction API&quot;,
        &quot;status&quot;: &quot;healthy&quot;,
        &quot;timestamp&quot;: datetime.now().isoformat()
    }

@app.get(&quot;/health&quot;)
async def health_check():
    return {
        &quot;status&quot;: &quot;ok&quot;,
        &quot;memory_usage&quot;: pd.DataFrame({&quot;test&quot;: [1, 2, 3]}).memory_usage(deep=True).sum()
    }

@app.post(&quot;/predict&quot;, response_model=PredictionResponse)
async def predict(request: PredictionRequest):
    try:
        if len(request.features) != 10:
            raise HTTPException(status_code=400, detail=&quot;Expected 10 features&quot;)
            
        prediction, confidence = model.predict(request.features)
        
        return PredictionResponse(
            prediction=float(prediction),
            confidence=float(confidence),
            timestamp=datetime.now().isoformat()
        )
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

if __name__ == &quot;__main__&quot;:
    port = int(os.getenv(&quot;PORT&quot;, 8000))
    uvicorn.run(app, host=&quot;0.0.0.0&quot;, port=port)


# requirements.txt
fastapi==0.104.1
uvicorn[standard]==0.24.0
pandas==2.2.0
numpy==1.26.0
pydantic==2.5.0




Stage 1: Baseline Implementation (1.96GB)

# Dockerfile.step1
FROM python:3.12

WORKDIR /app

COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .

EXPOSE 8000
CMD [&quot;python&quot;, &quot;main.py&quot;]


docker build -f Dockerfile.step1 -t ml-api:step1 .
docker images | grep ml-api
# ml-api    step1    1.96GB



  Issues: Full Debian system with Python development tools and compilers included




Stage 2: Slim Base Image (703MB, 64% reduction)





docker build -f Dockerfile.step2 -t ml-api:step2 .
docker images | grep ml-api
# ml-api    step2    703MB



  Improvement: Debian slim version eliminates unnecessary packages




Stage 3: Alpine Base (352MB, additional 50% reduction)





docker build -f Dockerfile.step3 -t ml-api:step3 .
docker images | grep ml-api
# ml-api    step3    352MB



  Consideration: pandas and numpy compilation on Alpine requires extended build time




Stage 4: Multi-stage Build (305MB, additional 13% reduction)





docker build -f Dockerfile.step4 -t ml-api:step4 .
docker images | grep ml-api
# ml-api    step4    305MB



  Final Result: 305MB represents the practical balance between optimization and functionality for ML applications with pandas/numpy dependencies.




Go API Server Optimization Journey

  
  
  graph TB
      subgraph &quot;Go Optimization Pipeline&quot;
          A[Base Golang Image1.54GB] --&amp;gt; B[Alpine Linux628MB]
          B --&amp;gt; C[Multi-stage Build30MB]
          C --&amp;gt; D[Scratch Base15.3MB]
          
          A -.-&amp;gt;|59% reduction| B
          B -.-&amp;gt;|95% reduction| C
          C -.-&amp;gt;|49% reduction| D
      end
  




Sample Application Setup

Production-ready Go REST API server with monitoring capabilities.

// main.go
package main

import (
    &quot;encoding/json&quot;
    &quot;fmt&quot;
    &quot;log&quot;
    &quot;net/http&quot;
    &quot;os&quot;
    &quot;strconv&quot;
    &quot;time&quot;

    &quot;github.com/gorilla/mux&quot;
    &quot;github.com/prometheus/client_golang/prometheus&quot;
    &quot;github.com/prometheus/client_golang/prometheus/promhttp&quot;
)

type User struct {
    ID        int       `json:&quot;id&quot;`
    Name      string    `json:&quot;name&quot;`
    Email     string    `json:&quot;email&quot;`
    CreatedAt time.Time `json:&quot;created_at&quot;`
}

type APIResponse struct {
    Status  string      `json:&quot;status&quot;`
    Message string      `json:&quot;message,omitempty&quot;`
    Data    interface{} `json:&quot;data,omitempty&quot;`
}

// Prometheus metrics
var (
    httpRequestsTotal = prometheus.NewCounterVec(
        prometheus.CounterOpts{
            Name: &quot;http_requests_total&quot;,
            Help: &quot;Total number of HTTP requests&quot;,
        },
        []string{&quot;method&quot;, &quot;endpoint&quot;, &quot;status&quot;},
    )
    httpRequestDuration = prometheus.NewHistogramVec(
        prometheus.HistogramOpts{
            Name: &quot;http_request_duration_seconds&quot;,
            Help: &quot;HTTP request duration in seconds&quot;,
        },
        []string{&quot;method&quot;, &quot;endpoint&quot;},
    )
)

// Mock database
var users = []User{
    {ID: 1, Name: &quot;Alice&quot;, Email: &quot;alice@example.com&quot;, CreatedAt: time.Now()},
    {ID: 2, Name: &quot;Bob&quot;, Email: &quot;bob@example.com&quot;, CreatedAt: time.Now()},
}

func init() {
    prometheus.MustRegister(httpRequestsTotal)
    prometheus.MustRegister(httpRequestDuration)
}

func loggingMiddleware(next http.Handler) http.Handler {
    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        start := time.Now()
        log.Printf(&quot;%s %s %s&quot;, r.Method, r.RequestURI, r.RemoteAddr)
        next.ServeHTTP(w, r)
        duration := time.Since(start)
        log.Printf(&quot;Request completed in %v&quot;, duration)
    })
}

func metricsMiddleware(next http.Handler) http.Handler {
    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        start := time.Now()
        next.ServeHTTP(w, r)
        duration := time.Since(start).Seconds()
        
        httpRequestsTotal.WithLabelValues(r.Method, r.URL.Path, &quot;200&quot;).Inc()
        httpRequestDuration.WithLabelValues(r.Method, r.URL.Path).Observe(duration)
    })
}

func healthHandler(w http.ResponseWriter, r *http.Request) {
    w.Header().Set(&quot;Content-Type&quot;, &quot;application/json&quot;)
    response := APIResponse{
        Status: &quot;healthy&quot;,
        Data: map[string]interface{}{
            &quot;timestamp&quot;: time.Now(),
            &quot;service&quot;:   &quot;User API&quot;,
            &quot;version&quot;:   &quot;1.0.0&quot;,
        },
    }
    json.NewEncoder(w).Encode(response)
}

func getUsersHandler(w http.ResponseWriter, r *http.Request) {
    w.Header().Set(&quot;Content-Type&quot;, &quot;application/json&quot;)
    response := APIResponse{
        Status: &quot;success&quot;,
        Data:   users,
    }
    json.NewEncoder(w).Encode(response)
}

func getUserHandler(w http.ResponseWriter, r *http.Request) {
    vars := mux.Vars(r)
    id, err := strconv.Atoi(vars[&quot;id&quot;])
    if err != nil {
        w.WriteHeader(http.StatusBadRequest)
        response := APIResponse{
            Status:  &quot;error&quot;,
            Message: &quot;Invalid user ID&quot;,
        }
        json.NewEncoder(w).Encode(response)
        return
    }

    for _, user := range users {
        if user.ID == id {
            w.Header().Set(&quot;Content-Type&quot;, &quot;application/json&quot;)
            response := APIResponse{
                Status: &quot;success&quot;,
                Data:   user,
            }
            json.NewEncoder(w).Encode(response)
            return
        }
    }

    w.WriteHeader(http.StatusNotFound)
    response := APIResponse{
        Status:  &quot;error&quot;,
        Message: &quot;User not found&quot;,
    }
    json.NewEncoder(w).Encode(response)
}

func createUserHandler(w http.ResponseWriter, r *http.Request) {
    var user User
    if err := json.NewDecoder(r.Body).Decode(&amp;amp;user); err != nil {
        w.WriteHeader(http.StatusBadRequest)
        response := APIResponse{
            Status:  &quot;error&quot;,
            Message: &quot;Invalid JSON&quot;,
        }
        json.NewEncoder(w).Encode(response)
        return
    }

    user.ID = len(users) + 1
    user.CreatedAt = time.Now()
    users = append(users, user)

    w.Header().Set(&quot;Content-Type&quot;, &quot;application/json&quot;)
    w.WriteHeader(http.StatusCreated)
    response := APIResponse{
        Status: &quot;success&quot;,
        Data:   user,
    }
    json.NewEncoder(w).Encode(response)
}

func main() {
    r := mux.NewRouter()
    
    // Middleware
    r.Use(loggingMiddleware)
    r.Use(metricsMiddleware)
    
    // Routes
    r.HandleFunc(&quot;/health&quot;, healthHandler).Methods(&quot;GET&quot;)
    r.HandleFunc(&quot;/users&quot;, getUsersHandler).Methods(&quot;GET&quot;)
    r.HandleFunc(&quot;/users/{id:[0-9]+}&quot;, getUserHandler).Methods(&quot;GET&quot;)
    r.HandleFunc(&quot;/users&quot;, createUserHandler).Methods(&quot;POST&quot;)
    r.Handle(&quot;/metrics&quot;, promhttp.Handler())

    port := os.Getenv(&quot;PORT&quot;)
    if port == &quot;&quot; {
        port = &quot;8080&quot;
    }

    log.Printf(&quot;Server starting on port %s&quot;, port)
    log.Fatal(http.ListenAndServe(fmt.Sprintf(&quot;:%s&quot;, port), r))
}


// go.mod
module user-api

go 1.21

require (
    github.com/gorilla/mux v1.8.1
    github.com/prometheus/client_golang v1.17.0
)




Generate go.sum:
go mod tidy




Stage 1: Baseline Implementation (1.54GB)

# Dockerfile.step1
FROM golang:1.24

WORKDIR /app

COPY go.mod go.sum ./
RUN go mod download

COPY . .
RUN go build -o main .

EXPOSE 8080
CMD [&quot;./main&quot;]


docker build -f Dockerfile.step1 -t user-api:step1 .
docker images | grep user-api
# user-api    step1    1.54GB



  Issues: Complete Go development environment with build tools and Git




Stage 2: Alpine Base (628MB, 59% reduction)

# Dockerfile.step2
FROM golang:1.24-alpine

WORKDIR /app

# Git installation for go mod download
RUN apk add --no-cache git

COPY go.mod go.sum ./
RUN go mod download

COPY . .
RUN go build -o main .

EXPOSE 8080
CMD [&quot;./main&quot;]


docker build -f Dockerfile.step2 -t user-api:step2 .
docker images | grep user-api
# user-api    step2    628MB



  Improvement: Alpine Linux significantly reduces base OS size




Stage 3: Multi-stage Build (30MB, 92% reduction)

# Dockerfile.step3
FROM golang:1.24-alpine AS builder

WORKDIR /app

# Dependency caching layer separation
COPY go.mod go.sum ./
RUN go mod download

COPY . .
RUN CGO_ENABLED=0 GOOS=linux go build -ldflags=&quot;-w -s&quot; -o main .

# Runtime stage
FROM alpine:latest

WORKDIR /root/

# SSL certificates and timezone information
RUN apk --no-cache add ca-certificates tzdata
COPY --from=builder /app/main .

EXPOSE 8080
CMD [&quot;./main&quot;]


docker build -f Dockerfile.step3 -t user-api:step3 .
docker images | grep user-api
# user-api    step3    30MB


Improvements:

  CGO_ENABLED=0: Eliminates C library dependencies
  -ldflags=&quot;-w -s&quot;: Removes debug information and symbol table
  Alpine runtime with minimal environment




Stage 4: Scratch Base (15.3MB, 49% additional reduction)

# Dockerfile.step4
FROM golang:1.24-alpine AS builder

WORKDIR /app

# Install necessary packages for Alpine
RUN apk --no-cache add ca-certificates tzdata

COPY go.mod go.sum ./
RUN go mod download

COPY . .
RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -ldflags=&quot;-w -s&quot; -o main .

# Final stage: scratch (empty image)
FROM scratch

# Copy SSL certificates for HTTPS requests
COPY --from=builder /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/

# Copy timezone information
COPY --from=builder /usr/share/zoneinfo /usr/share/zoneinfo

COPY --from=builder /app/main /main

EXPOSE 8080
ENTRYPOINT [&quot;/main&quot;]


docker build -f Dockerfile.step4 -t user-api:step4 .
docker images | grep user-api
# user-api    step4    15.3MB


Final Optimization:

  scratch: Completely empty base image
  -a -installsuffix cgo: Complete static build
  Selective copying of essential files only




Optimization Strategy Comparison

  
  
  graph TB
      subgraph &quot;Language-Specific Optimization Characteristics&quot;
          subgraph &quot;Python Optimization&quot;
              P1[Base Image: 1.96GB]
              P2[Slim: 703MB]
              P3[Alpine: 352MB]
              P4[Multi-stage: 305MB]
              P1 --&amp;gt; P2 --&amp;gt; P3 --&amp;gt; P4
          end
          
          subgraph &quot;Go Optimization&quot;
              G1[Base Image: 1.54GB]
              G2[Alpine: 628MB]
              G3[Multi-stage: 30MB]
              G4[Scratch: 15.3MB]
              G1 --&amp;gt; G2 --&amp;gt; G3 --&amp;gt; G4
          end
      end
  




Python vs Go Optimization Characteristics


  
    
      Characteristic
      Python
      Go
    
    
      Optimization Limit
      305MB (due to dependencies)
      15.3MB (static compilation)
    
    
      Complexity
      Medium (dependency management)
      Low (simple build process)
    
    
      Build Time
      Extended (numpy/pandas compilation)
      Fast (native compilation)
    
    
      Debugging Ease
      Good
      Limited (scratch usage)
    
  




Advanced Optimization Techniques



Docker Ignore Configuration

# .dockerignore
.git
.gitignore
README.md
Dockerfile*
.DS_Store
node_modules
npm-debug.log
coverage/
.nyc_output
*.log
.env.local
.env.development.local
.env.test.local
.env.production.local
.pytest_cache/
__pycache__/
*.pyc
*.pyo
*.pyd
.Python
env/
venv/
.venv/
pip-log.txt
pip-delete-this-directory.txt
.coverage
.tox/
.cache
nosetests.xml
coverage.xml
*.cover
*.log
.git
.mypy_cache
.pytest_cache
.hypothesis



  Excluding unnecessary files from build context improves both build speed and image size.




Security Hardening





Build Performance Optimization

# Multi-stage with dependency caching
FROM python:3.12-alpine AS deps

WORKDIR /app

# Copy only dependency files first for better caching
COPY requirements.txt ./
RUN pip install --no-cache-dir --user -r requirements.txt

# Build stage
FROM python:3.12-alpine AS builder

WORKDIR /app

# Copy dependencies from deps stage
COPY --from=deps /root/.local /root/.local

# Copy application code
COPY . .

# Runtime stage
FROM python:3.12-alpine

WORKDIR /app

RUN apk add --no-cache libstdc++

COPY --from=builder /root/.local /root/.local
COPY --from=builder /app .

ENV PATH=/root/.local/bin:$PATH

EXPOSE 8000
CMD [&quot;python&quot;, &quot;main.py&quot;]




Production Recommendations



Python Projects


  Multi-stage Alpine (305MB) represents the practical optimization limit
  Without ML libraries, images can achieve ~50MB
  Distroless images offer minimal complexity-to-benefit ratio




Go Projects


  Scratch base (15.3MB) strongly recommended for production
  Consider Alpine (30MB) when external C libraries required
  Use Alpine for development environments requiring debugging capabilities




Decision Framework

  
  
  flowchart TD
      Start[New Container Project] --&amp;gt; Lang{Language?}
      
      Lang --&amp;gt;|Python| PyDeps{Heavy Dependencies?}
      Lang --&amp;gt;|Go| GoCLib{C Libraries?}
      Lang --&amp;gt;|Node.js| NodeApproach[Alpine + Multi-stage]
      
      PyDeps --&amp;gt;|Yes ML/Data| PyML[Alpine Multi-stage~300MB]
      PyDeps --&amp;gt;|Lightweight| PyLight[Slim Multi-stage~50MB]
      
      GoCLib --&amp;gt;|Yes| GoAlpine[Alpine Multi-stage~30MB]
      GoCLib --&amp;gt;|No| GoScratch[Scratch~15MB]
      
      PyML --&amp;gt; Security[Add Security Hardening]
      PyLight --&amp;gt; Security
      GoAlpine --&amp;gt; Security
      GoScratch --&amp;gt; Security
      NodeApproach --&amp;gt; Security
      
      Security --&amp;gt; Monitor[Implement Size Monitoring]
  




Monitoring and Automation



CI/CD Integration





Image Size Tracking Script





Performance Impact Analysis



Build Time Comparison


  
    
      Optimization Stage
      Python Build Time
      Go Build Time
      Cache Hit Impact
    
    
      Base Image
      3m 45s
      2m 15s
      Low
    
    
      Slim/Alpine
      8m 30s
      1m 45s
      Medium
    
    
      Multi-stage
      6m 20s
      1m 30s
      High
    
    
      Optimized
      4m 10s
      1m 10s
      Very High
    
  




Registry Storage Impact





Common Pitfalls and Solutions



Layer Caching Mistakes

Problem: Poor layer ordering causing cache invalidation
# Bad: Changes frequently, invalidates all subsequent layers
FROM python:3.12-slim
COPY . .
RUN pip install -r requirements.txt


Solution: Separate dependency installation from code copying
# Good: Dependencies cached separately from application code
FROM python:3.12-slim
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY . .




Alpine Package Issues

Problem: Missing libraries in Alpine causing runtime failures
FROM python:3.12-alpine
# Missing: musl-dev, gcc for some Python packages
RUN pip install pandas  # May fail


Solution: Install necessary build dependencies
FROM python:3.12-alpine
RUN apk add --no-cache gcc musl-dev g++
RUN pip install pandas
RUN apk del gcc musl-dev g++  # Clean up after install




Multi-stage Copy Errors

Problem: Incomplete file copying between stages
FROM golang:alpine AS builder
RUN go build -o app .

FROM scratch
COPY --from=builder /app/app .  # Missing supporting files


Solution: Copy all necessary runtime files
FROM golang:alpine AS builder
RUN apk add --no-cache ca-certificates tzdata
RUN go build -o app .

FROM scratch
COPY --from=builder /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/
COPY --from=builder /usr/share/zoneinfo /usr/share/zoneinfo
COPY --from=builder /app/app .




Security Considerations



Vulnerability Scanning Integration

# docker-compose.security.yml
version: &apos;3.8&apos;
services:
  security-scan:
    image: anchore/syft:latest
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    command: |
      sh -c &quot;
        syft packages docker:my-app:latest -o json &amp;gt; /tmp/sbom.json &amp;amp;&amp;amp;
        grype sbom:/tmp/sbom.json --fail-on medium
      &quot;




Minimal Attack Surface

# Security-hardened minimal image
FROM golang:1.21-alpine AS builder

# Install only essential build tools
RUN apk add --no-cache ca-certificates git

WORKDIR /app
COPY go.mod go.sum ./
RUN go mod download

COPY . .
RUN CGO_ENABLED=0 GOOS=linux go build -ldflags=&quot;-X main.version=$(git describe --tags)&quot; -o app .

# Distroless runtime (even smaller than Alpine)
FROM gcr.io/distroless/static-debian11

COPY --from=builder /app/app /
COPY --from=builder /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/

USER 65534:65534
EXPOSE 8080
ENTRYPOINT [&quot;/app&quot;]




Real-World Case Studies



E-commerce Microservice

Before Optimization: 2.1GB Node.js application

  Base: node:18 (940MB)
  Dependencies: 890MB
  Application code: 270MB


After Optimization: 145MB
FROM node:18-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production &amp;amp;&amp;amp; npm cache clean --force

FROM node:18-alpine
RUN apk add --no-cache dumb-init
WORKDIR /app
COPY --from=builder /app/node_modules ./node_modules
COPY . .
USER node
EXPOSE 3000
CMD [&quot;dumb-init&quot;, &quot;node&quot;, &quot;server.js&quot;]


Results:

  93% size reduction
  5x faster deployment
  40% reduction in CVE count




Machine Learning Pipeline

Challenge: TensorFlow + Jupyter environment (3.8GB)

Solution: Separate training and inference images
# Training image (kept large for flexibility)
FROM tensorflow/tensorflow:2.13-gpu-jupyter AS training
# ... full development environment

# Inference image (optimized for production)
FROM python:3.11-slim AS inference
RUN pip install tensorflow-cpu==2.13.0 --no-deps
COPY --from=training /app/model /app/model
COPY inference_server.py /app/
CMD [&quot;python&quot;, &quot;/app/inference_server.py&quot;]



  Results: Production inference image reduced from 3.8GB to 890MB




Automation and Tooling



Docker Build Optimization Script





Image Size Monitoring





Performance Testing



Load Test with Optimized Images

# k6-load-test.js
import http from &apos;k6/http&apos;;
import { check } from &apos;k6&apos;;

export let options = {
  stages: [
    { duration: &apos;2m&apos;, target: 100 },
    { duration: &apos;5m&apos;, target: 200 },
    { duration: &apos;2m&apos;, target: 0 },
  ],
};

export default function() {
  let response = http.get(&apos;http://localhost:8000/health&apos;);
  
  check(response, {
    &apos;status is 200&apos;: (r) =&amp;gt; r.status === 200,
    &apos;response time &amp;lt; 200ms&apos;: (r) =&amp;gt; r.timings.duration &amp;lt; 200,
  });
}




Deployment Speed Comparison

#!/bin/bash
# deployment-speed-test.sh

IMAGES=(&quot;app:large&quot; &quot;app:medium&quot; &quot;app:small&quot;)

for image in &quot;${IMAGES[@]}&quot;; do
  echo &quot;Testing deployment speed for $image&quot;
  
  # Clear local cache
  docker rmi &quot;$image&quot; 2&amp;gt;/dev/null || true
  
  # Time the pull and start
  start_time=$(date +%s.%N)
  
  docker run -d --name &quot;test-$image&quot; -p 8000:8000 &quot;$image&quot;
  
  # Wait for health check
  while ! curl -sf http://localhost:8000/health &amp;gt;/dev/null 2&amp;gt;&amp;amp;1; do
    sleep 0.1
  done
  
  end_time=$(date +%s.%N)
  duration=$(echo &quot;$end_time - $start_time&quot; | bc)
  
  echo &quot;$image: ${duration}s&quot;
  
  # Cleanup
  docker stop &quot;test-$image&quot; &amp;amp;&amp;amp; docker rm &quot;test-$image&quot;
  
  echo &quot;---&quot;
done




Future Considerations



Emerging Technologies

WebAssembly (WASM) Integration
# Future: WASM-based containers
FROM scratch
COPY app.wasm /app.wasm
COPY wasmtime /wasmtime
ENTRYPOINT [&quot;/wasmtime&quot;, &quot;/app.wasm&quot;]


OCI Artifacts and Supply Chain

  Image signing with Cosign
  Software Bill of Materials (SBOM) integration
  Vulnerability attestation




Platform-Specific Optimizations

# Multi-architecture optimization
FROM --platform=$BUILDPLATFORM golang:1.21-alpine AS builder
ARG TARGETPLATFORM
ARG BUILDPLATFORM
ARG TARGETOS
ARG TARGETARCH

WORKDIR /app
COPY go.mod go.sum ./
RUN go mod download

COPY . .
RUN CGO_ENABLED=0 GOOS=$TARGETOS GOARCH=$TARGETARCH go build -o app .

FROM scratch
COPY --from=builder /app/app .
ENTRYPOINT [&quot;./app&quot;]




Conclusion

Docker image optimization represents a critical DevOps practice that extends far beyond simple size reduction. Through systematic application of language-specific strategies, organizations achieve substantial improvements in deployment velocity, infrastructure costs, and security posture.



Core Optimization Principles

Language-Specific Approaches: Python optimization focuses on dependency management and build environment separation, while Go leverages static compilation advantages for minimal runtime footprints.

Incremental Optimization: Successful optimization requires methodical progression through multiple stages rather than attempting comprehensive changes simultaneously.

Practical Balance: The optimal image size balances complexity, maintainability, and performance requirements rather than pursuing minimal size at any cost.

Continuous Monitoring: Automated size tracking and security scanning integration prevents optimization regression and maintains security standards.



Key Achievements

The optimization experiments demonstrated significant practical benefits:

  Python FastAPI: 84% size reduction (1.96GB → 305MB)
  Go API Server: 99% size reduction (1.54GB → 15.3MB)
  Security: Substantial CVE reduction through minimal attack surfaces
  Performance: Improved deployment speeds and resource utilization




Implementation Recommendations

Start with base image selection and dependency optimization before pursuing advanced multi-stage builds. Implement monitoring and automation early to maintain optimization gains over time. Focus on security hardening alongside size reduction to achieve comprehensive container optimization.

The investment in systematic Docker image optimization yields compound returns through improved deployment reliability, reduced infrastructure costs, and enhanced security posture across the entire application lifecycle.





References


  Docker Best Practices Documentation
  Google Distroless Images
  Python Docker Hub Official Images
  Python Speed - Smaller Docker Images
  Docker BuildKit Documentation
  Container Security Best Practices
  Multi-stage Build Documentation
  Docker Layer Caching Guide
  Go Binary Size Optimization
  Alpine Linux Package Management

",
            "wordcount": "5296",
            "inLanguage": "en",
            "dateCreated": "2026-02-07/",
            "datePublished": "2026-02-07/",
            "dateModified": "2026-02-07/",
            "author": {
                "@type": "Person",
                "name": "Somaz",
                
                "image": "/assets/img/uploads/profile.png",
                
                "jobTitle": "DevOps Engineer",
                "url": "https://somaz.blog/authors/somaz/",
                "sameAs": [
                    "https://github.com/somaz94","https://www.linkedin.com/in/somaz"
                ]
            },
            "publisher": {
                "@type": "Organization",
                "name": "somaz",
                "url": "https://somaz.blog/",
                "logo": {
                    "@type": "ImageObject",
                    "url": "https://somaz.blog/assets/img/blog-image.png",
                    "width": "600",
                    "height": "315"
                }
            },
            "mainEntityOfPage": "True",
            "genre": "CONTAINER",
            "articleSection": "CONTAINER",
            "keywords": ["docker","containerization","optimization","golang","python","fastapi","devops","security"]
        }
        </script>
    </body>
</html>
