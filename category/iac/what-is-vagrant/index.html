<!DOCTYPE html>
<html lang="en" class="no-js">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    

    
    

    
    

    
    

    <!-- ✅ Google Tag Manager 추가 -->
    <script>
        (function(w,d,s,l,i){
            w[l]=w[l]||[];
            w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
            var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
            j.async=true;
            j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
            f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-MBP83N4Q');
    </script>
      <!-- ✅ End Google Tag Manager -->

    <!-- Mermaid.js 직접 로드 -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>

    <title>Vagrant with KVM: Complete Infrastructure Automation for Development Environments | somaz</title>
    <meta name="description" content="Step-by-step tutorial covering KVM setup, Vagrant installation, Vagrantfile configuration, and VM lifecycle management for automated development environment ...">
    
        <meta name="keywords" content="vagrant, kvm, virtualization, infrastructure-as-code, automation, development-environment, libvirt, provisioning, devops">
    

    <!-- Social: Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Vagrant with KVM: Complete Infrastructure Automation for Development Environments | somaz">
    <meta name="twitter:description" content="Step-by-step tutorial covering KVM setup, Vagrant installation, Vagrantfile configuration, and VM lifecycle management for automated development environment ...">

    
        <meta property="twitter:image" content="https://res.cloudinary.com/dkcm26aem/image/upload/v1755134513/vagrant-1_y7g1uh.png">
    
    
    
        <meta name="twitter:site" content="@twitter_username">
    

    <!-- Social: Facebook / Open Graph -->
    <meta property="og:url" content="https://somaz.blog/category/iac/what-is-vagrant/">
    <meta property="og:title" content="Vagrant with KVM: Complete Infrastructure Automation for Development Environments | somaz">
    <meta property="og:image" content="https://res.cloudinary.com/dkcm26aem/image/upload/v1755134513/vagrant-1_y7g1uh.png">
    <meta property="og:description" content="Step-by-step tutorial covering KVM setup, Vagrant installation, Vagrantfile configuration, and VM lifecycle management for automated development environment ...">
    <meta property="og:site_name" content="Somaz Tech Blog">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/assets/img/icons/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/img/icons/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/img/icons/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/img/icons/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/img/icons/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/img/icons/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/img/icons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/icons/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/img/icons/apple-touch-icon-152x152.png" />

    <!-- Windows 8 Tile Icons -->
    <meta name="application-name" content="somaz">
    <meta name="msapplication-TileColor" content="#141414">
    <meta name="msapplication-square70x70logo" content="smalltile.png" />
    <meta name="msapplication-square150x150logo" content="mediumtile.png" />
    <meta name="msapplication-wide310x150logo" content="widetile.png" />
    <meta name="msapplication-square310x310logo" content="largetile.png" />
    
    <!-- Android Lolipop Theme Color -->
    <meta name="theme-color" content="#141414">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Titillium+Web:300,400,700" rel="stylesheet">

    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="canonical" href="https://somaz.blog/category/iac/what-is-vagrant/">
    <link rel="alternate" type="application/rss+xml" title="Somaz Tech Blog" href="https://somaz.blog/feed.xml" />

    <!-- Include extra styles -->
    

    <!-- JavaScript enabled/disabled -->
    <script>
        document.querySelector('html').classList.remove('no-js');
    </script>

    <!-- Google Adsense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8725590811736154"
        crossorigin="anonymous"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"> -->
    <!-- <link href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/variable/woff2/SUIT-Variable.css" rel="stylesheet"> -->
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- <link href="https://fonts.googleapis.com/css2?family=Albert+Sans:wght@400;500;700&display=swap" rel="stylesheet"> -->

    <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml" />

</head>
<!-- ✅ Google Tag Manager (noscript) -->
<noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MBP83N4Q"
            height="0" width="0" style="display:none;visibility:hidden">
    </iframe>
</noscript>
<!-- ✅ End Google Tag Manager (noscript) -->
    <body class="has-push-menu">
        





        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" display="none" version="1.1"><defs><symbol id="icon-menu" viewBox="0 0 1024 1024"><path class="path1" d="M128 213.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 725.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 469.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5z"/></symbol><symbol id="icon-search" viewBox="0 0 951 1024"><path class="path1" d="M658.286 475.429q0-105.714-75.143-180.857t-180.857-75.143-180.857 75.143-75.143 180.857 75.143 180.857 180.857 75.143 180.857-75.143 75.143-180.857zM950.857 950.857q0 29.714-21.714 51.429t-51.429 21.714q-30.857 0-51.429-21.714l-196-195.429q-102.286 70.857-228 70.857-81.714 0-156.286-31.714t-128.571-85.714-85.714-128.571-31.714-156.286 31.714-156.286 85.714-128.571 128.571-85.714 156.286-31.714 156.286 31.714 128.571 85.714 85.714 128.571 31.714 156.286q0 125.714-70.857 228l196 196q21.143 21.143 21.143 51.429z"/></symbol><symbol id="icon-close" viewBox="0 0 1000 1000"><path d="M969.8,870.3c27,27.7,27,71.8,0,99.1C955.7,983,937.9,990,920,990c-17.9,0-35.7-7-49.7-20.7L500,599L129.6,969.4C115.6,983,97.8,990,79.9,990s-35.7-7-49.7-20.7c-27-27.3-27-71.4,0-99.1L400.9,500L30.3,129.3c-27-27.3-27-71.4,0-99.1c27.3-27,71.8-27,99.4,0L500,400.9L870.4,30.2c27.7-27,71.8-27,99.4,0c27,27.7,27,71.8,0,99.1L599.1,500L969.8,870.3z"/></symbol><symbol id="icon-twitter" viewBox="0 0 951 1024"><path class="path1" d="M925.714 233.143q-38.286 56-92.571 95.429 0.571 8 0.571 24 0 74.286-21.714 148.286t-66 142-105.429 120.286-147.429 83.429-184.571 31.143q-154.857 0-283.429-82.857 20 2.286 44.571 2.286 128.571 0 229.143-78.857-60-1.143-107.429-36.857t-65.143-91.143q18.857 2.857 34.857 2.857 24.571 0 48.571-6.286-64-13.143-106-63.714t-42-117.429v-2.286q38.857 21.714 83.429 23.429-37.714-25.143-60-65.714t-22.286-88q0-50.286 25.143-93.143 69.143 85.143 168.286 136.286t212.286 56.857q-4.571-21.714-4.571-42.286 0-76.571 54-130.571t130.571-54q80 0 134.857 58.286 62.286-12 117.143-44.571-21.143 65.714-81.143 101.714 53.143-5.714 106.286-28.571z"/></symbol><symbol id="icon-facebook" viewBox="0 0 585 1024"><path class="path1" d="M548 6.857v150.857h-89.714q-49.143 0-66.286 20.571t-17.143 61.714v108h167.429l-22.286 169.143h-145.143v433.714h-174.857v-433.714h-145.714v-169.143h145.714v-124.571q0-106.286 59.429-164.857t158.286-58.571q84 0 130.286 6.857z"/></symbol><symbol id="icon-clock" viewBox="0 0 1000 1000"><path d="M500,10C229.8,10,10,229.8,10,500c0,270.2,219.8,490,490,490c270.2,0,490-219.8,490-490C990,229.8,770.2,10,500,10z M500,910.2c-226.2,0-410.2-184-410.2-410.2c0-226.2,184-410.2,410.2-410.2c226.2,0,410.2,184,410.2,410.2C910.2,726.1,726.2,910.2,500,910.2z M753.1,374c8.2,11.9,5.2,28.1-6.6,36.3L509.9,573.7c-4.4,3.1-9.6,4.6-14.8,4.6c-4.1,0-8.3-1-12.1-3c-8.6-4.5-14-13.4-14-23.1V202.5c0-14.4,11.7-26.1,26.1-26.1c14.4,0,26.1,11.7,26.1,26.1v300l195.6-135.1C728.7,359.2,744.9,362.1,753.1,374z"/></symbol><symbol id="icon-calendar" viewBox="0 0 1000 1000"><path d="M920,500v420H80V500H920 M990,430H10v490c0,38.7,31.3,70,70,70h840c38.7,0,70-31.3,70-70V430L990,430z"/><path d="M850,80v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80H360v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80C72.8,80,10,142.7,10,220v140h980V220C990,142.7,927.2,80,850,80z"/><path d="M255,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C290,25.8,274.3,10,255,10z"/><path d="M745,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C780,25.8,764.3,10,745,10z"/></symbol><symbol id="icon-github" viewBox="0 0 12 14"><path d="M6 1q1.633 0 3.012 0.805t2.184 2.184 0.805 3.012q0 1.961-1.145 3.527t-2.957 2.168q-0.211 0.039-0.312-0.055t-0.102-0.234q0-0.023 0.004-0.598t0.004-1.051q0-0.758-0.406-1.109 0.445-0.047 0.801-0.141t0.734-0.305 0.633-0.52 0.414-0.82 0.16-1.176q0-0.93-0.617-1.609 0.289-0.711-0.062-1.594-0.219-0.070-0.633 0.086t-0.719 0.344l-0.297 0.187q-0.727-0.203-1.5-0.203t-1.5 0.203q-0.125-0.086-0.332-0.211t-0.652-0.301-0.664-0.105q-0.352 0.883-0.062 1.594-0.617 0.68-0.617 1.609 0 0.664 0.16 1.172t0.41 0.82 0.629 0.523 0.734 0.305 0.801 0.141q-0.305 0.281-0.383 0.805-0.164 0.078-0.352 0.117t-0.445 0.039-0.512-0.168-0.434-0.488q-0.148-0.25-0.379-0.406t-0.387-0.187l-0.156-0.023q-0.164 0-0.227 0.035t-0.039 0.090 0.070 0.109 0.102 0.094l0.055 0.039q0.172 0.078 0.34 0.297t0.246 0.398l0.078 0.18q0.102 0.297 0.344 0.48t0.523 0.234 0.543 0.055 0.434-0.027l0.18-0.031q0 0.297 0.004 0.691t0.004 0.426q0 0.141-0.102 0.234t-0.312 0.055q-1.812-0.602-2.957-2.168t-1.145-3.527q0-1.633 0.805-3.012t2.184-2.184 3.012-0.805zM2.273 9.617q0.023-0.055-0.055-0.094-0.078-0.023-0.102 0.016-0.023 0.055 0.055 0.094 0.070 0.047 0.102-0.016zM2.516 9.883q0.055-0.039-0.016-0.125-0.078-0.070-0.125-0.023-0.055 0.039 0.016 0.125 0.078 0.078 0.125 0.023zM2.75 10.234q0.070-0.055 0-0.148-0.062-0.102-0.133-0.047-0.070 0.039 0 0.141t0.133 0.055zM3.078 10.562q0.062-0.062-0.031-0.148-0.094-0.094-0.156-0.023-0.070 0.062 0.031 0.148 0.094 0.094 0.156 0.023zM3.523 10.758q0.023-0.086-0.102-0.125-0.117-0.031-0.148 0.055t0.102 0.117q0.117 0.047 0.148-0.047zM4.016 10.797q0-0.102-0.133-0.086-0.125 0-0.125 0.086 0 0.102 0.133 0.086 0.125 0 0.125-0.086zM4.469 10.719q-0.016-0.086-0.141-0.070-0.125 0.023-0.109 0.117t0.141 0.062 0.109-0.109z"></path></symbol><symbol id="icon-medium" viewBox="0 0 1000 1000"><path d="M336.5,240.2v641.5c0,9.1-2.3,16.9-6.8,23.2s-11.2,9.6-20,9.6c-6.2,0-12.2-1.5-18-4.4L37.3,782.7c-7.7-3.6-14.1-9.8-19.4-18.3S10,747.4,10,739V115.5c0-7.3,1.8-13.5,5.5-18.6c3.6-5.1,8.9-7.7,15.9-7.7c5.1,0,13.1,2.7,24.1,8.2l279.5,140C335.9,238.6,336.5,239.5,336.5,240.2L336.5,240.2z M371.5,295.5l292,473.6l-292-145.5V295.5z M990,305.3v576.4c0,9.1-2.6,16.5-7.7,22.1c-5.1,5.7-12,8.5-20.8,8.5s-17.3-2.4-25.7-7.1L694.7,784.9L990,305.3z M988.4,239.7c0,1.1-46.8,77.6-140.3,229.4C754.6,621,699.8,709.8,683.8,735.7L470.5,389l177.2-288.2c6.2-10.2,15.7-15.3,28.4-15.3c5.1,0,9.8,1.1,14.2,3.3l295.9,147.7C987.6,237.1,988.4,238.2,988.4,239.7L988.4,239.7z"/></symbol><symbol id="icon-instagram" viewBox="0 0 489.84 489.84"><path d="M249.62,50.46c65.4,0,73.14.25,99,1.43C372.47,53,385.44,57,394.07,60.32a75.88,75.88,0,0,1,28.16,18.32,75.88,75.88,0,0,1,18.32,28.16c3.35,8.63,7.34,21.6,8.43,45.48,1.18,25.83,1.43,33.57,1.43,99s-0.25,73.14-1.43,99c-1.09,23.88-5.08,36.85-8.43,45.48a81.11,81.11,0,0,1-46.48,46.48c-8.63,3.35-21.6,7.34-45.48,8.43-25.82,1.18-33.57,1.43-99,1.43s-73.15-.25-99-1.43c-23.88-1.09-36.85-5.08-45.48-8.43A75.88,75.88,0,0,1,77,423.86,75.88,75.88,0,0,1,58.69,395.7c-3.35-8.63-7.34-21.6-8.43-45.48-1.18-25.83-1.43-33.57-1.43-99s0.25-73.14,1.43-99c1.09-23.88,5.08-36.85,8.43-45.48A75.88,75.88,0,0,1,77,78.64a75.88,75.88,0,0,1,28.16-18.32c8.63-3.35,21.6-7.34,45.48-8.43,25.83-1.18,33.57-1.43,99-1.43m0-44.13c-66.52,0-74.86.28-101,1.47s-43.87,5.33-59.45,11.38A120.06,120.06,0,0,0,45.81,47.44,120.06,120.06,0,0,0,17.56,90.82C11.5,106.4,7.36,124.2,6.17,150.27s-1.47,34.46-1.47,101,0.28,74.86,1.47,101,5.33,43.87,11.38,59.45a120.06,120.06,0,0,0,28.25,43.38,120.06,120.06,0,0,0,43.38,28.25c15.58,6.05,33.38,10.19,59.45,11.38s34.46,1.47,101,1.47,74.86-.28,101-1.47,43.87-5.33,59.45-11.38a125.24,125.24,0,0,0,71.63-71.63c6.05-15.58,10.19-33.38,11.38-59.45s1.47-34.46,1.47-101-0.28-74.86-1.47-101-5.33-43.87-11.38-59.45a120.06,120.06,0,0,0-28.25-43.38,120.06,120.06,0,0,0-43.38-28.25C394.47,13.13,376.67,9,350.6,7.8s-34.46-1.47-101-1.47h0Z" transform="translate(-4.7 -6.33)" /><path d="M249.62,125.48A125.77,125.77,0,1,0,375.39,251.25,125.77,125.77,0,0,0,249.62,125.48Zm0,207.41a81.64,81.64,0,1,1,81.64-81.64A81.64,81.64,0,0,1,249.62,332.89Z" transform="translate(-4.7 -6.33)"/><circle cx="375.66" cy="114.18" r="29.39" /></symbol><symbol id="icon-linkedin" viewBox="0 0 12 14"><path d="M2.727 4.883v7.742h-2.578v-7.742h2.578zM2.891 2.492q0.008 0.57-0.395 0.953t-1.059 0.383h-0.016q-0.641 0-1.031-0.383t-0.391-0.953q0-0.578 0.402-0.957t1.051-0.379 1.039 0.379 0.398 0.957zM12 8.187v4.437h-2.57v-4.141q0-0.82-0.316-1.285t-0.988-0.465q-0.492 0-0.824 0.27t-0.496 0.668q-0.086 0.234-0.086 0.633v4.32h-2.57q0.016-3.117 0.016-5.055t-0.008-2.313l-0.008-0.375h2.57v1.125h-0.016q0.156-0.25 0.32-0.438t0.441-0.406 0.68-0.34 0.895-0.121q1.336 0 2.148 0.887t0.813 2.598z"></path></symbol><symbol id="icon-heart" viewBox="0 0 34 30"><path d="M17,29.7 L16.4,29.2 C3.5,18.7 0,15 0,9 C0,4 4,0 9,0 C13.1,0 15.4,2.3 17,4.1 C18.6,2.3 20.9,0 25,0 C30,0 34,4 34,9 C34,15 30.5,18.7 17.6,29.2 L17,29.7 Z M9,2 C5.1,2 2,5.1 2,9 C2,14.1 5.2,17.5 17,27.1 C28.8,17.5 32,14.1 32,9 C32,5.1 28.9,2 25,2 C21.5,2 19.6,4.1 18.1,5.8 L17,7.1 L15.9,5.8 C14.4,4.1 12.5,2 9,2 Z" id="Shape"></path></symbol><symbol id="icon-arrow-right" viewBox="0 0 25.452 25.452"><path d="M4.471,24.929v-2.004l12.409-9.788c0.122-0.101,0.195-0.251,0.195-0.411c0-0.156-0.073-0.31-0.195-0.409L4.471,2.526V0.522c0-0.2,0.115-0.384,0.293-0.469c0.18-0.087,0.396-0.066,0.552,0.061l15.47,12.202c0.123,0.1,0.195,0.253,0.195,0.409c0,0.16-0.072,0.311-0.195,0.411L5.316,25.34c-0.155,0.125-0.372,0.147-0.552,0.061C4.586,25.315,4.471,25.13,4.471,24.929z"/></symbol><symbol id="icon-star" viewBox="0 0 48 48"><path fill="currentColor" d="M44,24c0,11.045-8.955,20-20,20S4,35.045,4,24S12.955,4,24,4S44,12.955,44,24z"/><path fill="#ffffff" d="M24,11l3.898,7.898l8.703,1.301l-6.301,6.102l1.5,8.699L24,30.898L16.199,35l1.5-8.699l-6.301-6.102  l8.703-1.301L24,11z"/></symbol><symbol id="icon-read" viewBox="0 0 32 32"><path fill="currentColor" d="M29,4H3C1.343,4,0,5.343,0,7v18c0,1.657,1.343,3,3,3h10c0,0.552,0.448,1,1,1h4c0.552,0,1-0.448,1-1h10  c1.657,0,3-1.343,3-3V7C32,5.343,30.657,4,29,4z M29,5v20H18.708c-0.618,0-1.236,0.146-1.789,0.422l-0.419,0.21V5H29z M15.5,5  v20.632l-0.419-0.21C14.528,25.146,13.91,25,13.292,25H3V5H15.5z M31,25c0,1.103-0.897,2-2,2H18v1h-4v-1H3c-1.103,0-2-0.897-2-2V7  c0-0.737,0.405-1.375,1-1.722V25c0,0.552,0.448,1,1,1h10.292c0.466,0,0.925,0.108,1.342,0.317l0.919,0.46  c0.141,0.07,0.294,0.106,0.447,0.106c0.153,0,0.306-0.035,0.447-0.106l0.919-0.46C17.783,26.108,18.242,26,18.708,26H29  c0.552,0,1-0.448,1-1V5.278C30.595,5.625,31,6.263,31,7V25z M6,12.5C6,12.224,6.224,12,6.5,12h5c0.276,0,0.5,0.224,0.5,0.5  S11.776,13,11.5,13h-5C6.224,13,6,12.776,6,12.5z M6,14.5C6,14.224,6.224,14,6.5,14h5c0.276,0,0.5,0.224,0.5,0.5S11.776,15,11.5,15  h-5C6.224,15,6,14.776,6,14.5z M6,16.5C6,16.224,6.224,16,6.5,16h5c0.276,0,0.5,0.224,0.5,0.5S11.776,17,11.5,17h-5  C6.224,17,6,16.776,6,16.5z M20,12.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,13,25.5,13h-5  C20.224,13,20,12.776,20,12.5z M20,14.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,15,25.5,15h-5  C20.224,15,20,14.776,20,14.5z M20,16.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,17,25.5,17h-5  C20.224,17,20,16.776,20,16.5z"></path></symbol><symbol id="icon-tistory" viewBox="0 0 24 24"><path d="M4 4h16v3h-6v13h-4V7H4V4z"/></symbol></defs></svg>

        <header class="bar-header">
    <a id="menu" role="button">
        <svg id="open" class="icon-menu"><use xlink:href="#icon-menu"></use></svg>
    </a>
    <h1 class="logo">
        <a href="/">
            
                somaz <span class="version">v3.1.2</span>
            
        </a>
    </h1>
    <a id="search" class="dosearch" role="button">
        <svg class="icon-search"><use xlink:href="#icon-search"></use></svg>
    </a>
    
        <a href="https://github.com/thiagorossener/jekflix-template" class="get-theme" role="button">
            Get this theme!
        </a>
    
</header>

<div id="mask" class="overlay"></div>

<aside class="sidebar" id="sidebar">
    <nav id="navigation">
      <h2>Menu</h2>
      <ul>
  
    
      <li>
        <a href="https://somaz.blog/">Home</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/about">About</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/category">Category</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/contact">Contact</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/feed.xml">Feed</a>
      </li>
    
  
</ul>

    </nav>
</aside>

<div class="search-wrapper">
    <div class="search-form">
        <input type="text" class="search-field" placeholder="Search">
        <svg class="icon-remove-sign"><use xlink:href="#icon-close"></use></svg>
        <ul class="search-results search-list"></ul>
    </div>
</div>



        <section class="post two-columns">
            <article role="article" class="post-content">
                <p class="post-info">
                    
                        <svg class="icon-calendar" id="date"><use xlink:href="#icon-calendar"></use></svg>
                        <time class="date" datetime="2025-08-28T00:00:00+00:00">
                            


August 28, 2025

                        </time>
                    
                    <svg id="clock" class="icon-clock"><use xlink:href="#icon-clock"></use></svg>
                    <span>25 min to read</span>
                </p>
                <h1 class="post-title">Vagrant with KVM: Complete Infrastructure Automation for Development Environments</h1>
                <p class="post-subtitle">Comprehensive guide to setting up and managing virtual machines using Vagrant with KVM backend for efficient development workflows</p>

                
                    <img src="https://res.cloudinary.com/dkcm26aem/image/upload/v1755134513/vagrant-1_y7g1uh.png" alt="Featured image" class="post-cover">
                

                <!-- Pagination links -->



                <!-- Add your table of contents here -->


                <p><br /></p>

<hr />

<h2 id="overview">Overview</h2>

<p>In modern software development, maintaining consistent and reproducible development environments across teams remains a significant challenge.</p>

<p><strong>Vagrant</strong> addresses this challenge by providing a powerful automation tool for building and managing virtual machine environments with minimal configuration overhead.</p>

<p>This comprehensive guide focuses on <strong>Vagrant integration with KVM (Kernel-based Virtual Machine)</strong> as the virtualization backend, offering superior performance compared to traditional solutions.</p>

<p>We’ll cover everything from KVM setup and configuration to advanced Vagrant workflows, including multi-machine environments and automated provisioning.</p>

<p>Vagrant excels at project-based VM management, enabling developers to create, destroy, and configure development environments with simple commands.</p>

<p>When combined with <strong>Ansible, Terraform, and other DevOps tools</strong>, Vagrant becomes a cornerstone of infrastructure automation workflows.</p>

<p><br /></p>

<hr />

<h2 id="what-is-vagrant">What is Vagrant?</h2>

<p>Vagrant is an <strong>open-source tool for building and managing virtual machine environments</strong> in a single workflow.</p>

<p>With an easy-to-use interface and focus on automation, Vagrant lowers development environment setup time, increases production parity, and makes the “works on my machine” excuse a relic of the past.</p>

<p><br /></p>

<h3 id="core-features">Core Features:</h3>

<ul>
  <li><strong>Automated VM Environment Setup</strong>: Single command deployment</li>
  <li><strong>Multiple Provider Support</strong>: KVM, VirtualBox, Docker, AWS, and more</li>
  <li><strong>Provisioning Integration</strong>: Ansible, Puppet, Chef, Shell scripts</li>
  <li><strong>Project-based Management</strong>: Isolated environments per project</li>
  <li><strong>Version Control Friendly</strong>: Infrastructure as Code principles</li>
  <li><strong>Cross-platform Compatibility</strong>: Windows, macOS, Linux support</li>
</ul>

<p><br /></p>

<h3 id="use-cases">Use Cases:</h3>

<h4 id="development-environment-standardization">Development Environment Standardization</h4>
<ul>
  <li>Consistent development stacks across team members</li>
  <li>Isolated testing environments for different projects</li>
  <li>Rapid onboarding for new team members</li>
</ul>

<h5 id="infrastructure-testing">Infrastructure Testing</h5>
<ul>
  <li>Multi-node cluster simulation</li>
  <li>Network topology testing</li>
  <li>Disaster recovery scenarios</li>
</ul>

<h4 id="cicd-integration">CI/CD Integration</h4>
<ul>
  <li>Automated testing environments</li>
  <li>Build and deployment pipelines</li>
  <li>Quality assurance workflows</li>
</ul>

<p><br /></p>

<hr />

<h2 id="kvm-installation-and-configuration">KVM Installation and Configuration</h2>

<p><br /></p>

<h3 id="step-1-install-kvm-virtualization-host">Step 1: Install KVM Virtualization Host</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Install virtualization packages</span>
yum <span class="nt">-y</span> group <span class="nb">install</span> <span class="s1">'Virtualization Host'</span>

<span class="c"># Alternative for Ubuntu/Debian systems</span>
apt-get <span class="nb">install</span> <span class="nt">-y</span> qemu-kvm libvirt-daemon-system libvirt-clients bridge-utils

<span class="c"># Verify KVM module availability</span>
lsmod | <span class="nb">grep </span>kvm
<span class="c"># Expected output:</span>
<span class="c"># kvm_intel (or kvm_amd)</span>
<span class="c"># kvm</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="step-2-configure-nested-virtualization">Step 2: Configure Nested Virtualization</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Check current nested virtualization status</span>
<span class="nb">cat</span> /sys/module/kvm_intel/parameters/nested
<span class="c"># Y = enabled, N = disabled</span>

<span class="c"># Enable nested virtualization for Intel processors</span>
<span class="nb">cat</span> <span class="o">&gt;</span> /etc/modprobe.d/kvm-nested.conf <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
options kvm-intel nested=1
options kvm-intel enable_shadow_vmcs=1
options kvm-intel enable_apicv=1
options kvm-intel ept=1
</span><span class="no">EOF

</span><span class="c"># For AMD processors</span>
<span class="nb">cat</span> <span class="o">&gt;</span> /etc/modprobe.d/kvm-nested.conf <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
options kvm-amd nested=1
</span><span class="no">EOF
</span></code></pre></div></div>

<p><br /></p>

<h3 id="step-3-apply-kernel-module-changes">Step 3: Apply Kernel Module Changes</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Remove and reload KVM modules</span>
modprobe <span class="nt">-r</span> kvm_intel  <span class="c"># or kvm_amd for AMD</span>
modprobe <span class="nt">-a</span> kvm_intel  <span class="c"># or kvm_amd for AMD</span>

<span class="c"># Verify nested virtualization is enabled</span>
<span class="nb">cat</span> /sys/module/kvm_intel/parameters/nested
<span class="c"># Should return: Y</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="step-4-configure-pci-passthrough-and-sr-iov">Step 4: Configure PCI Passthrough and SR-IOV</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Edit GRUB configuration for hardware passthrough</span>
vi /etc/default/grub

<span class="c"># Add IOMMU support to GRUB_CMDLINE_LINUX</span>
<span class="nv">GRUB_CMDLINE_LINUX</span><span class="o">=</span><span class="s2">"nofb splash=quiet console=tty0 intel_iommu=on iommu=pt"</span>

<span class="c"># For AMD systems, use:</span>
<span class="c"># GRUB_CMDLINE_LINUX="nofb splash=quiet console=tty0 amd_iommu=on iommu=pt"</span>

<span class="c"># Update GRUB configuration</span>
grub2-mkconfig <span class="nt">-o</span> /boot/grub2/grub.cfg

<span class="c"># For Ubuntu/Debian systems:</span>
<span class="c"># update-grub</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="step-5-enable-ipv4-forwarding">Step 5: Enable IPv4 Forwarding</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Configure permanent IPv4 forwarding</span>
<span class="nb">echo</span> <span class="s1">'net.ipv4.ip_forward = 1'</span> <span class="o">&gt;&gt;</span> /etc/sysctl.conf

<span class="c"># Apply immediately without reboot</span>
sysctl <span class="nt">-p</span>

<span class="c"># Verify setting</span>
sysctl net.ipv4.ip_forward
<span class="c"># Should return: net.ipv4.ip_forward = 1</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="step-6-system-restart-and-validation">Step 6: System Restart and Validation</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Restart system to apply all changes</span>
systemctl reboot

<span class="c"># After reboot, validate KVM environment</span>
virt-host-validate

<span class="c"># Expected output should show all PASS results:</span>
<span class="c"># QEMU: Checking for hardware virtualization: PASS</span>
<span class="c"># QEMU: Checking if device /dev/kvm exists: PASS</span>
<span class="c"># QEMU: Checking if device /dev/kvm is accessible: PASS</span>
<span class="c"># LXC: Checking for Linux &gt;= 2.6.26: PASS</span>
</code></pre></div></div>

<p><br /></p>

<hr />

<h2 id="vagrant-installation-and-setup">Vagrant Installation and Setup</h2>

<p><br /></p>

<h3 id="step-1-install-vagrant-and-dependencies">Step 1: Install Vagrant and Dependencies</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Add HashiCorp repository</span>
<span class="nb">sudo </span>yum-config-manager <span class="nt">--add-repo</span> https://rpm.releases.hashicorp.com/RHEL/hashicorp.repo

<span class="c"># Install Vagrant</span>
<span class="nb">sudo </span>yum <span class="nt">-y</span> <span class="nb">install </span>vagrant

<span class="c"># Install required development packages</span>
<span class="nb">sudo </span>yum <span class="nt">-y</span> <span class="nb">install </span>qemu libvirt libvirt-devel ruby-devel gcc qemu-kvm libguestfs-tools

<span class="c"># For Ubuntu/Debian systems:</span>
<span class="c"># curl -fsSL https://apt.releases.hashicorp.com/gpg | sudo apt-key add -</span>
<span class="c"># sudo apt-add-repository "deb [arch=amd64] https://apt.releases.hashicorp.com $(lsb_release -cs) main"</span>
<span class="c"># sudo apt-get update &amp;&amp; sudo apt-get install vagrant</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="step-2-install-vagrant-plugins">Step 2: Install Vagrant Plugins</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Install libvirt provider plugin</span>
vagrant plugin <span class="nb">install </span>vagrant-libvirt

<span class="c"># Install image conversion plugin</span>
vagrant plugin <span class="nb">install </span>vagrant-mutate

<span class="c"># Install additional useful plugins</span>
vagrant plugin <span class="nb">install </span>vagrant-reload
vagrant plugin <span class="nb">install </span>vagrant-vbguest

<span class="c"># Verify installed plugins</span>
vagrant plugin list
</code></pre></div></div>

<p><br /></p>

<h3 id="step-3-configure-kvm-storage-pool-for-vagrant">Step 3: Configure KVM Storage Pool for Vagrant</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Prepare dedicated storage for Vagrant VMs (optional but recommended)</span>
<span class="c"># Assume /dev/sdb1 is available for VM storage</span>
mkfs.xfs /dev/sdb1

<span class="c"># Create mount point</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> /var/lib/libvirt/vagrant

<span class="c"># Add to fstab for persistent mounting</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="si">$(</span>blkid /dev/sdb1 <span class="nt">-o</span> <span class="nb">export</span> | <span class="nb">grep</span> ^UUID<span class="si">)</span><span class="s2"> /var/lib/libvirt/vagrant xfs defaults 0 0"</span> <span class="o">&gt;&gt;</span> /etc/fstab

<span class="c"># Mount the filesystem</span>
mount <span class="nt">-a</span>

<span class="c"># Create libvirt storage pool</span>
virsh pool-define-as <span class="nt">--name</span> vagrant <span class="nt">--type</span> <span class="nb">dir</span> <span class="nt">--target</span> /var/lib/libvirt/vagrant

<span class="c"># Start and enable autostart for the pool</span>
virsh pool-start vagrant
virsh pool-autostart vagrant

<span class="c"># Verify pool creation</span>
virsh pool-list <span class="nt">--all</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="step-4-configure-libvirt-service">Step 4: Configure Libvirt Service</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Start and enable libvirt services</span>
systemctl start libvirtd
systemctl <span class="nb">enable </span>libvirtd

<span class="c"># Add user to libvirt group</span>
usermod <span class="nt">-a</span> <span class="nt">-G</span> libvirt <span class="si">$(</span><span class="nb">whoami</span><span class="si">)</span>

<span class="c"># Configure libvirt for user access</span>
<span class="nb">echo</span> <span class="s1">'unix_sock_group = "libvirt"'</span> <span class="o">&gt;&gt;</span> /etc/libvirt/libvirtd.conf
<span class="nb">echo</span> <span class="s1">'unix_sock_rw_perms = "0770"'</span> <span class="o">&gt;&gt;</span> /etc/libvirt/libvirtd.conf

<span class="c"># Restart libvirt service</span>
systemctl restart libvirtd
</code></pre></div></div>

<p><br /></p>

<hr />

<h2 id="vagrant-project-structure-and-workflow">Vagrant Project Structure and Workflow</h2>

<p><br /></p>

<h3 id="understanding-vagrant-project-structure">Understanding Vagrant Project Structure</h3>

<p>Vagrant operates on a <strong>project-based approach</strong> where each directory containing a <code class="language-plaintext highlighter-rouge">Vagrantfile</code> represents a separate project environment:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Typical Vagrant project structure</span>
my-vagrant-project/
├── Vagrantfile              <span class="c"># Main configuration file</span>
├── provisioning/            <span class="c"># Provisioning scripts directory</span>
│   ├── bootstrap.sh        <span class="c"># Initial setup script</span>
│   ├── install-docker.sh   <span class="c"># Application-specific scripts</span>
│   └── ansible/            <span class="c"># Ansible playbooks</span>
│       ├── playbook.yml
│       └── inventory/
├── shared/                  <span class="c"># Shared folders content</span>
│   └── application-code/
└── .vagrant/               <span class="c"># Vagrant metadata (auto-generated)</span>
    ├── machines/
    └── provisioners/
</code></pre></div></div>

<p><br /></p>

<h3 id="project-initialization">Project Initialization</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Create new project directory</span>
<span class="nb">mkdir </span>my-development-environment
<span class="nb">cd </span>my-development-environment

<span class="c"># Initialize Vagrant environment</span>
vagrant init

<span class="c"># This creates a basic Vagrantfile with default configuration</span>
<span class="c"># The current directory becomes the Vagrant project root</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="vagrant-commands-overview">Vagrant Commands Overview</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Core Vagrant commands</span>
vagrant init <span class="o">[</span>box-name]      <span class="c"># Initialize new Vagrant environment</span>
vagrant up                   <span class="c"># Create and provision VM</span>
vagrant halt                 <span class="c"># Gracefully shutdown VM</span>
vagrant destroy              <span class="c"># Delete VM and resources</span>
vagrant ssh                  <span class="c"># SSH into running VM</span>
vagrant reload               <span class="c"># Restart VM with new configuration</span>
vagrant provision            <span class="c"># Run provisioning scripts</span>
vagrant status               <span class="c"># Show VM status</span>
vagrant global-status        <span class="c"># Show all Vagrant environments</span>
</code></pre></div></div>

<p><br /></p>

<hr />

<h2 id="vagrantfile-configuration">Vagrantfile Configuration</h2>

<p><br /></p>

<h3 id="basic-single-vm-configuration">Basic Single-VM Configuration</h3>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># -*- mode: ruby -*-</span>
<span class="c1"># vi: set ft=ruby :</span>

<span class="c1"># Set default provider to libvirt</span>
<span class="no">ENV</span><span class="p">[</span><span class="s1">'VAGRANT_DEFAULT_PROVIDER'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'libvirt'</span>

<span class="no">Vagrant</span><span class="p">.</span><span class="nf">configure</span><span class="p">(</span><span class="s2">"2"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="c1"># Base box configuration</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box</span> <span class="o">=</span> <span class="s2">"generic/ubuntu2004"</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box_version</span> <span class="o">=</span> <span class="s2">"3.6.8"</span>
  
  <span class="c1"># VM hostname</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">hostname</span> <span class="o">=</span> <span class="s2">"dev-server"</span>
  
  <span class="c1"># Disable default shared folder</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">synced_folder</span> <span class="s2">"."</span><span class="p">,</span> <span class="s2">"/vagrant"</span><span class="p">,</span> <span class="ss">disabled: </span><span class="kp">true</span>
  
  <span class="c1"># Network configuration</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"private_network"</span><span class="p">,</span> 
    <span class="ss">ip: </span><span class="s2">"192.168.56.10"</span><span class="p">,</span>
    <span class="ss">libvirt__network_name: </span><span class="s2">"development"</span><span class="p">,</span>
    <span class="ss">libvirt__forward_mode: </span><span class="s2">"nat"</span><span class="p">,</span>
    <span class="ss">libvirt__dhcp_enabled: </span><span class="kp">false</span>
  
  <span class="c1"># Port forwarding</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"forwarded_port"</span><span class="p">,</span> <span class="ss">guest: </span><span class="mi">80</span><span class="p">,</span> <span class="ss">host: </span><span class="mi">8080</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"forwarded_port"</span><span class="p">,</span> <span class="ss">guest: </span><span class="mi">22</span><span class="p">,</span> <span class="ss">host: </span><span class="mi">2222</span>
  
  <span class="c1"># Provider-specific configuration</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provider</span> <span class="s2">"libvirt"</span> <span class="k">do</span> <span class="o">|</span><span class="n">libvirt</span><span class="o">|</span>
    <span class="n">libvirt</span><span class="p">.</span><span class="nf">memory</span> <span class="o">=</span> <span class="mi">4096</span>
    <span class="n">libvirt</span><span class="p">.</span><span class="nf">cpus</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">libvirt</span><span class="p">.</span><span class="nf">storage_pool_name</span> <span class="o">=</span> <span class="s2">"vagrant"</span>
    <span class="n">libvirt</span><span class="p">.</span><span class="nf">machine_virtual_size</span> <span class="o">=</span> <span class="mi">40</span>  <span class="c1"># GB</span>
    <span class="n">libvirt</span><span class="p">.</span><span class="nf">graphics_ip</span> <span class="o">=</span> <span class="s2">"0.0.0.0"</span>
    <span class="n">libvirt</span><span class="p">.</span><span class="nf">graphics_port</span> <span class="o">=</span> <span class="mi">5900</span>
    <span class="n">libvirt</span><span class="p">.</span><span class="nf">video_type</span> <span class="o">=</span> <span class="s2">"qxl"</span>
  <span class="k">end</span>
  
  <span class="c1"># Provisioning</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provision</span> <span class="s2">"shell"</span><span class="p">,</span> <span class="ss">inline: </span><span class="o">&lt;&lt;-</span><span class="no">SHELL</span><span class="sh">
    apt-get update
    apt-get install -y nginx
    systemctl start nginx
    systemctl enable nginx
</span><span class="no">  SHELL</span>
<span class="k">end</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="advanced-multi-vm-configuration">Advanced Multi-VM Configuration</h3>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># -*- mode: ruby -*-</span>
<span class="c1"># vi: set ft=ruby :</span>

<span class="no">ENV</span><span class="p">[</span><span class="s1">'VAGRANT_DEFAULT_PROVIDER'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'libvirt'</span>

<span class="no">Vagrant</span><span class="p">.</span><span class="nf">configure</span><span class="p">(</span><span class="s2">"2"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="c1"># Environment variables</span>
  <span class="no">CONTROL_COUNT</span> <span class="o">=</span> <span class="mi">3</span>
  <span class="no">WORKER_COUNT</span> <span class="o">=</span> <span class="mi">2</span>
  <span class="no">STORAGE_COUNT</span> <span class="o">=</span> <span class="mi">1</span>
  
  <span class="c1"># Base configuration for all VMs</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box</span> <span class="o">=</span> <span class="s2">"generic/centos8"</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">synced_folder</span> <span class="s2">"."</span><span class="p">,</span> <span class="s2">"/vagrant"</span><span class="p">,</span> <span class="ss">disabled: </span><span class="kp">true</span>
  
  <span class="c1"># Control plane nodes</span>
  <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="no">CONTROL_COUNT</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
    <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">define</span> <span class="s2">"control</span><span class="si">#{</span><span class="n">i</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'0'</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span> <span class="k">do</span> <span class="o">|</span><span class="n">control</span><span class="o">|</span>
      <span class="n">control</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">hostname</span> <span class="o">=</span> <span class="s2">"control</span><span class="si">#{</span><span class="n">i</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'0'</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
      
      <span class="c1"># Network configuration</span>
      <span class="n">control</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"private_network"</span><span class="p">,</span>
        <span class="ss">ip: </span><span class="s2">"192.168.100.1</span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
        <span class="ss">libvirt__network_name: </span><span class="s2">"k8s-cluster"</span><span class="p">,</span>
        <span class="ss">libvirt__forward_mode: </span><span class="s2">"nat"</span><span class="p">,</span>
        <span class="ss">libvirt__dhcp_enabled: </span><span class="kp">false</span>
      
      <span class="c1"># Management network</span>
      <span class="n">control</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"private_network"</span><span class="p">,</span>
        <span class="ss">ip: </span><span class="s2">"10.0.0.1</span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
        <span class="ss">libvirt__network_name: </span><span class="s2">"management"</span><span class="p">,</span>
        <span class="ss">libvirt__forward_mode: </span><span class="s2">"none"</span><span class="p">,</span>
        <span class="ss">libvirt__dhcp_enabled: </span><span class="kp">false</span>
      
      <span class="c1"># Provider configuration</span>
      <span class="n">control</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provider</span> <span class="s2">"libvirt"</span> <span class="k">do</span> <span class="o">|</span><span class="n">libvirt</span><span class="o">|</span>
        <span class="n">libvirt</span><span class="p">.</span><span class="nf">memory</span> <span class="o">=</span> <span class="mi">8192</span>
        <span class="n">libvirt</span><span class="p">.</span><span class="nf">cpus</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">libvirt</span><span class="p">.</span><span class="nf">storage_pool_name</span> <span class="o">=</span> <span class="s2">"vagrant"</span>
        <span class="n">libvirt</span><span class="p">.</span><span class="nf">machine_virtual_size</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">libvirt</span><span class="p">.</span><span class="nf">management_network_name</span> <span class="o">=</span> <span class="s2">"management"</span>
        <span class="n">libvirt</span><span class="p">.</span><span class="nf">management_network_mac</span> <span class="o">=</span> <span class="s2">"52:54:00:</span><span class="si">#{</span><span class="nb">sprintf</span><span class="p">(</span><span class="s1">'%02x'</span><span class="p">,</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span><span class="si">}</span><span class="s2">:</span><span class="si">#{</span><span class="nb">sprintf</span><span class="p">(</span><span class="s1">'%02x'</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span><span class="si">}</span><span class="s2">:01"</span>
      <span class="k">end</span>
      
      <span class="c1"># Port forwarding for API server</span>
      <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="n">control</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"forwarded_port"</span><span class="p">,</span> <span class="ss">guest: </span><span class="mi">6443</span><span class="p">,</span> <span class="ss">host: </span><span class="mi">6443</span>
      <span class="k">end</span>
      
      <span class="c1"># Provisioning</span>
      <span class="n">control</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provision</span> <span class="s2">"shell"</span><span class="p">,</span> <span class="ss">path: </span><span class="s2">"scripts/common-setup.sh"</span>
      <span class="n">control</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provision</span> <span class="s2">"shell"</span><span class="p">,</span> <span class="ss">path: </span><span class="s2">"scripts/control-plane-setup.sh"</span><span class="p">,</span> 
        <span class="ss">args: </span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="no">CONTROL_COUNT</span><span class="p">,</span> <span class="no">WORKER_COUNT</span><span class="p">]</span>
    <span class="k">end</span>
  <span class="k">end</span>
  
  <span class="c1"># Worker nodes</span>
  <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="no">WORKER_COUNT</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
    <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">define</span> <span class="s2">"worker</span><span class="si">#{</span><span class="n">i</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'0'</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span> <span class="k">do</span> <span class="o">|</span><span class="n">worker</span><span class="o">|</span>
      <span class="n">worker</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">hostname</span> <span class="o">=</span> <span class="s2">"worker</span><span class="si">#{</span><span class="n">i</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'0'</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
      
      <span class="n">worker</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"private_network"</span><span class="p">,</span>
        <span class="ss">ip: </span><span class="s2">"192.168.100.2</span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
        <span class="ss">libvirt__network_name: </span><span class="s2">"k8s-cluster"</span><span class="p">,</span>
        <span class="ss">libvirt__forward_mode: </span><span class="s2">"nat"</span><span class="p">,</span>
        <span class="ss">libvirt__dhcp_enabled: </span><span class="kp">false</span>
      
      <span class="n">worker</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provider</span> <span class="s2">"libvirt"</span> <span class="k">do</span> <span class="o">|</span><span class="n">libvirt</span><span class="o">|</span>
        <span class="n">libvirt</span><span class="p">.</span><span class="nf">memory</span> <span class="o">=</span> <span class="mi">16384</span>
        <span class="n">libvirt</span><span class="p">.</span><span class="nf">cpus</span> <span class="o">=</span> <span class="mi">8</span>
        <span class="n">libvirt</span><span class="p">.</span><span class="nf">storage_pool_name</span> <span class="o">=</span> <span class="s2">"vagrant"</span>
        <span class="n">libvirt</span><span class="p">.</span><span class="nf">machine_virtual_size</span> <span class="o">=</span> <span class="mi">200</span>
      <span class="k">end</span>
      
      <span class="n">worker</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provision</span> <span class="s2">"shell"</span><span class="p">,</span> <span class="ss">path: </span><span class="s2">"scripts/common-setup.sh"</span>
      <span class="n">worker</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provision</span> <span class="s2">"shell"</span><span class="p">,</span> <span class="ss">path: </span><span class="s2">"scripts/worker-setup.sh"</span>
    <span class="k">end</span>
  <span class="k">end</span>
  
  <span class="c1"># Storage nodes</span>
  <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="no">STORAGE_COUNT</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
    <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">define</span> <span class="s2">"storage</span><span class="si">#{</span><span class="n">i</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'0'</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span> <span class="k">do</span> <span class="o">|</span><span class="n">storage</span><span class="o">|</span>
      <span class="n">storage</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">hostname</span> <span class="o">=</span> <span class="s2">"storage</span><span class="si">#{</span><span class="n">i</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'0'</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
      
      <span class="n">storage</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"private_network"</span><span class="p">,</span>
        <span class="ss">ip: </span><span class="s2">"192.168.100.3</span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
        <span class="ss">libvirt__network_name: </span><span class="s2">"k8s-cluster"</span><span class="p">,</span>
        <span class="ss">libvirt__forward_mode: </span><span class="s2">"nat"</span><span class="p">,</span>
        <span class="ss">libvirt__dhcp_enabled: </span><span class="kp">false</span>
      
      <span class="n">storage</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provider</span> <span class="s2">"libvirt"</span> <span class="k">do</span> <span class="o">|</span><span class="n">libvirt</span><span class="o">|</span>
        <span class="n">libvirt</span><span class="p">.</span><span class="nf">memory</span> <span class="o">=</span> <span class="mi">32768</span>
        <span class="n">libvirt</span><span class="p">.</span><span class="nf">cpus</span> <span class="o">=</span> <span class="mi">16</span>
        <span class="n">libvirt</span><span class="p">.</span><span class="nf">storage_pool_name</span> <span class="o">=</span> <span class="s2">"vagrant"</span>
        <span class="n">libvirt</span><span class="p">.</span><span class="nf">machine_virtual_size</span> <span class="o">=</span> <span class="mi">100</span>
        
        <span class="c1"># Additional storage disks for Ceph</span>
        <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">3</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">disk</span><span class="o">|</span>
          <span class="n">libvirt</span><span class="p">.</span><span class="nf">storage</span> <span class="ss">:file</span><span class="p">,</span> 
            <span class="ss">size: </span><span class="s2">"50G"</span><span class="p">,</span> 
            <span class="ss">path: </span><span class="s2">"storage</span><span class="si">#{</span><span class="n">i</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'0'</span><span class="p">)</span><span class="si">}</span><span class="s2">-disk</span><span class="si">#{</span><span class="n">disk</span><span class="si">}</span><span class="s2">.qcow2"</span><span class="p">,</span>
            <span class="ss">bus: </span><span class="s2">"virtio"</span>
        <span class="k">end</span>
      <span class="k">end</span>
      
      <span class="n">storage</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provision</span> <span class="s2">"shell"</span><span class="p">,</span> <span class="ss">path: </span><span class="s2">"scripts/common-setup.sh"</span>
      <span class="n">storage</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provision</span> <span class="s2">"shell"</span><span class="p">,</span> <span class="ss">path: </span><span class="s2">"scripts/storage-setup.sh"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="provisioning-script-examples">Provisioning Script Examples</h3>

<script src="https://gist.github.com/somaz94/f625d5d7fb19e6f24bf50f6649f3a80d.js"></script>

<p><br /></p>

<hr />

<h2 id="vagrant-box-management">Vagrant Box Management</h2>

<p><br /></p>

<h3 id="working-with-vagrant-boxes">Working with Vagrant Boxes</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># List available boxes</span>
vagrant box list

<span class="c"># Add a new box</span>
vagrant box add generic/ubuntu2004

<span class="c"># Add box with specific provider</span>
vagrant box add generic/centos8 <span class="nt">--provider</span> libvirt

<span class="c"># Update existing box</span>
vagrant box update <span class="nt">--box</span> generic/ubuntu2004

<span class="c"># Remove old box versions</span>
vagrant box prune

<span class="c"># Create custom box from existing VM</span>
vagrant package <span class="nt">--output</span> my-custom-box.box
vagrant box add my-custom-box my-custom-box.box
</code></pre></div></div>

<p><br /></p>

<h3 id="box-version-management">Box Version Management</h3>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Vagrantfile with version constraints</span>
<span class="no">Vagrant</span><span class="p">.</span><span class="nf">configure</span><span class="p">(</span><span class="s2">"2"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box</span> <span class="o">=</span> <span class="s2">"generic/ubuntu2004"</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box_version</span> <span class="o">=</span> <span class="s2">"&gt;= 3.6.0, &lt; 4.0"</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box_check_update</span> <span class="o">=</span> <span class="kp">true</span>
  
  <span class="c1"># Box download configuration</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box_download_checksum</span> <span class="o">=</span> <span class="s2">"sha256_checksum_here"</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box_download_checksum_type</span> <span class="o">=</span> <span class="s2">"sha256"</span>
<span class="k">end</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="custom-box-creation">Custom Box Creation</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Create custom box from existing VM</span>
vagrant package <span class="nt">--vagrantfile</span> Vagrantfile.pkg <span class="nt">--output</span> custom-dev-env.box

<span class="c"># Vagrantfile.pkg example</span>
Vagrant.configure<span class="o">(</span><span class="s2">"2"</span><span class="o">)</span> <span class="k">do</span> |config|
  config.vm.base_mac <span class="o">=</span> <span class="s2">"080027D14C66"</span>
  config.ssh.username <span class="o">=</span> <span class="s2">"vagrant"</span>
  config.ssh.password <span class="o">=</span> <span class="s2">"vagrant"</span>
end

<span class="c"># Add custom box to local repository</span>
vagrant box add custom-dev-env custom-dev-env.box
</code></pre></div></div>

<p><br /></p>

<hr />

<h2 id="advanced-vagrant-features">Advanced Vagrant Features</h2>

<p><br /></p>

<h3 id="multi-provider-support">Multi-Provider Support</h3>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Vagrantfile with multiple provider configurations</span>
<span class="no">Vagrant</span><span class="p">.</span><span class="nf">configure</span><span class="p">(</span><span class="s2">"2"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box</span> <span class="o">=</span> <span class="s2">"generic/ubuntu2004"</span>
  
  <span class="c1"># VirtualBox provider</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provider</span> <span class="s2">"virtualbox"</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>
    <span class="n">vb</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s2">"ubuntu-dev-vbox"</span>
    <span class="n">vb</span><span class="p">.</span><span class="nf">memory</span> <span class="o">=</span> <span class="s2">"4096"</span>
    <span class="n">vb</span><span class="p">.</span><span class="nf">cpus</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">vb</span><span class="p">.</span><span class="nf">gui</span> <span class="o">=</span> <span class="kp">false</span>
  <span class="k">end</span>
  
  <span class="c1"># Libvirt provider</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provider</span> <span class="s2">"libvirt"</span> <span class="k">do</span> <span class="o">|</span><span class="n">lv</span><span class="o">|</span>
    <span class="n">lv</span><span class="p">.</span><span class="nf">memory</span> <span class="o">=</span> <span class="mi">4096</span>
    <span class="n">lv</span><span class="p">.</span><span class="nf">cpus</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">lv</span><span class="p">.</span><span class="nf">storage_pool_name</span> <span class="o">=</span> <span class="s2">"vagrant"</span>
    <span class="n">lv</span><span class="p">.</span><span class="nf">machine_virtual_size</span> <span class="o">=</span> <span class="mi">40</span>
  <span class="k">end</span>
  
  <span class="c1"># Docker provider</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provider</span> <span class="s2">"docker"</span> <span class="k">do</span> <span class="o">|</span><span class="n">d</span><span class="o">|</span>
    <span class="n">d</span><span class="p">.</span><span class="nf">image</span> <span class="o">=</span> <span class="s2">"ubuntu:20.04"</span>
    <span class="n">d</span><span class="p">.</span><span class="nf">remains_running</span> <span class="o">=</span> <span class="kp">true</span>
    <span class="n">d</span><span class="p">.</span><span class="nf">has_ssh</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="ansible-integration">Ansible Integration</h3>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Ansible provisioning configuration</span>
<span class="no">Vagrant</span><span class="p">.</span><span class="nf">configure</span><span class="p">(</span><span class="s2">"2"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provision</span> <span class="s2">"ansible"</span> <span class="k">do</span> <span class="o">|</span><span class="n">ansible</span><span class="o">|</span>
    <span class="n">ansible</span><span class="p">.</span><span class="nf">playbook</span> <span class="o">=</span> <span class="s2">"provisioning/site.yml"</span>
    <span class="n">ansible</span><span class="p">.</span><span class="nf">inventory_path</span> <span class="o">=</span> <span class="s2">"provisioning/inventory"</span>
    <span class="n">ansible</span><span class="p">.</span><span class="nf">limit</span> <span class="o">=</span> <span class="s2">"all"</span>
    <span class="n">ansible</span><span class="p">.</span><span class="nf">extra_vars</span> <span class="o">=</span> <span class="p">{</span>
      <span class="ss">ansible_ssh_user: </span><span class="s1">'vagrant'</span><span class="p">,</span>
      <span class="ss">ansible_ssh_private_key_file: </span><span class="s2">"~/.vagrant.d/insecure_private_key"</span>
    <span class="p">}</span>
    <span class="n">ansible</span><span class="p">.</span><span class="nf">groups</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s2">"webservers"</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"web[1:2]"</span><span class="p">],</span>
      <span class="s2">"dbservers"</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"db"</span><span class="p">],</span>
      <span class="s2">"monitoring"</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"monitor"</span><span class="p">],</span>
      <span class="s2">"all_groups:children"</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"webservers"</span><span class="p">,</span> <span class="s2">"dbservers"</span><span class="p">,</span> <span class="s2">"monitoring"</span><span class="p">]</span>
    <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="file-synchronization-options">File Synchronization Options</h3>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Various sync folder configurations</span>
<span class="no">Vagrant</span><span class="p">.</span><span class="nf">configure</span><span class="p">(</span><span class="s2">"2"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="c1"># NFS sync (fast, requires NFS server)</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">synced_folder</span> <span class="s2">"."</span><span class="p">,</span> <span class="s2">"/vagrant"</span><span class="p">,</span> 
    <span class="ss">type: </span><span class="s2">"nfs"</span><span class="p">,</span>
    <span class="ss">nfs_udp: </span><span class="kp">false</span><span class="p">,</span>
    <span class="ss">nfs_version: </span><span class="mi">4</span>

  <span class="c1"># rsync (one-way sync)</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">synced_folder</span> <span class="s2">"src/"</span><span class="p">,</span> <span class="s2">"/home/vagrant/src"</span><span class="p">,</span>
    <span class="ss">type: </span><span class="s2">"rsync"</span><span class="p">,</span>
    <span class="ss">rsync__exclude: </span><span class="p">[</span><span class="s2">".git/"</span><span class="p">,</span> <span class="s2">"node_modules/"</span><span class="p">,</span> <span class="s2">"*.tmp"</span><span class="p">],</span>
    <span class="ss">rsync__auto: </span><span class="kp">true</span>

  <span class="c1"># SMB sync (Windows hosts)</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">synced_folder</span> <span class="s2">"."</span><span class="p">,</span> <span class="s2">"/vagrant"</span><span class="p">,</span>
    <span class="ss">type: </span><span class="s2">"smb"</span><span class="p">,</span>
    <span class="ss">smb_username: </span><span class="no">ENV</span><span class="p">[</span><span class="s1">'USER'</span><span class="p">],</span>
    <span class="ss">smb_password: </span><span class="no">ENV</span><span class="p">[</span><span class="s1">'PASS'</span><span class="p">]</span>
<span class="k">end</span>
</code></pre></div></div>

<p><br /></p>

<hr />

<h2 id="performance-optimization-and-troubleshooting">Performance Optimization and Troubleshooting</h2>

<p><br /></p>

<h3 id="performance-tuning">Performance Tuning</h3>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Performance-optimized Vagrantfile</span>
<span class="no">Vagrant</span><span class="p">.</span><span class="nf">configure</span><span class="p">(</span><span class="s2">"2"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provider</span> <span class="s2">"libvirt"</span> <span class="k">do</span> <span class="o">|</span><span class="n">libvirt</span><span class="o">|</span>
    <span class="c1"># CPU optimization</span>
    <span class="n">libvirt</span><span class="p">.</span><span class="nf">cpus</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">libvirt</span><span class="p">.</span><span class="nf">cpu_mode</span> <span class="o">=</span> <span class="s2">"host-passthrough"</span>
    <span class="n">libvirt</span><span class="p">.</span><span class="nf">nested</span> <span class="o">=</span> <span class="kp">true</span>
    
    <span class="c1"># Memory optimization</span>
    <span class="n">libvirt</span><span class="p">.</span><span class="nf">memory</span> <span class="o">=</span> <span class="mi">8192</span>
    <span class="n">libvirt</span><span class="p">.</span><span class="nf">memorybacking</span> <span class="ss">:hugepages</span><span class="p">,</span> <span class="ss">:size</span> <span class="o">=&gt;</span> <span class="s2">"2048"</span><span class="p">,</span> <span class="ss">:unit</span> <span class="o">=&gt;</span> <span class="s2">"KiB"</span>
    
    <span class="c1"># Storage optimization</span>
    <span class="n">libvirt</span><span class="p">.</span><span class="nf">storage_pool_name</span> <span class="o">=</span> <span class="s2">"fast-nvme-pool"</span>
    <span class="n">libvirt</span><span class="p">.</span><span class="nf">machine_virtual_size</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">libvirt</span><span class="p">.</span><span class="nf">disk_bus</span> <span class="o">=</span> <span class="s2">"virtio"</span>
    <span class="n">libvirt</span><span class="p">.</span><span class="nf">nic_model_type</span> <span class="o">=</span> <span class="s2">"virtio"</span>
    
    <span class="c1"># Graphics optimization (disable for headless)</span>
    <span class="n">libvirt</span><span class="p">.</span><span class="nf">graphics_type</span> <span class="o">=</span> <span class="s2">"none"</span>
    
    <span class="c1"># NUMA optimization</span>
    <span class="n">libvirt</span><span class="p">.</span><span class="nf">numa_nodes</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">{</span><span class="ss">:cpus</span> <span class="o">=&gt;</span> <span class="s2">"0-1"</span><span class="p">,</span> <span class="ss">:memory</span> <span class="o">=&gt;</span> <span class="s2">"4096"</span><span class="p">},</span>
      <span class="p">{</span><span class="ss">:cpus</span> <span class="o">=&gt;</span> <span class="s2">"2-3"</span><span class="p">,</span> <span class="ss">:memory</span> <span class="o">=&gt;</span> <span class="s2">"4096"</span><span class="p">}</span>
    <span class="p">]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="common-troubleshooting">Common Troubleshooting</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Debug Vagrant issues</span>
<span class="nb">export </span><span class="nv">VAGRANT_LOG</span><span class="o">=</span>debug
vagrant up

<span class="c"># Check libvirt status</span>
systemctl status libvirtd
virsh list <span class="nt">--all</span>

<span class="c"># Network troubleshooting</span>
virsh net-list <span class="nt">--all</span>
virsh net-info default

<span class="c"># Storage pool issues</span>
virsh pool-list <span class="nt">--all</span>
virsh pool-info vagrant

<span class="c"># Clean up failed VMs</span>
vagrant destroy <span class="nt">-f</span>
virsh list <span class="nt">--all</span>
virsh undefine &lt;vm-name&gt; <span class="nt">--remove-all-storage</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="monitoring-and-logging">Monitoring and Logging</h3>

<script src="https://gist.github.com/somaz94/472753d6005a3f1f8881b1b558b308de.js"></script>

<p><br /></p>

<hr />

<h2 id="integration-with-devops-tools">Integration with DevOps Tools</h2>

<p><br /></p>

<h3 id="terraform-integration">Terraform Integration</h3>

<script src="https://gist.github.com/somaz94/24ef9d7752856df178a01e898311938f.js"></script>

<p><br /></p>

<h3 id="cicd-pipeline-integration">CI/CD Pipeline Integration</h3>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># .github/workflows/vagrant-test.yml</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">Vagrant Environment Testing</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span> <span class="nv">main</span><span class="pi">,</span> <span class="nv">develop</span> <span class="pi">]</span>
  <span class="na">pull_request</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span> <span class="nv">main</span> <span class="pi">]</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">test-vagrant-environment</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    
    <span class="na">steps</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v3</span>
    
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Setup Vagrant</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">curl -fsSL https://apt.releases.hashicorp.com/gpg | sudo apt-key add -</span>
        <span class="s">sudo apt-add-repository "deb [arch=amd64] https://apt.releases.hashicorp.com $(lsb_release -cs) main"</span>
        <span class="s">sudo apt-get update &amp;&amp; sudo apt-get install vagrant</span>
        
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install VirtualBox</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">sudo apt-get update</span>
        <span class="s">sudo apt-get install virtualbox</span>
        
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Validate Vagrantfile</span>
      <span class="na">run</span><span class="pi">:</span> <span class="s">vagrant validate</span>
      
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Test VM Creation</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">vagrant up</span>
        <span class="s">vagrant ssh -c "echo 'VM is accessible'"</span>
        <span class="s">vagrant destroy -f</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="ansible-playbook-example">Ansible Playbook Example</h3>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># provisioning/site.yml</span>
<span class="nn">---</span>
<span class="pi">-</span> <span class="na">hosts</span><span class="pi">:</span> <span class="s">all</span>
  <span class="na">become</span><span class="pi">:</span> <span class="s">yes</span>
  <span class="na">gather_facts</span><span class="pi">:</span> <span class="s">yes</span>
  
  <span class="na">pre_tasks</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Update package cache</span>
      <span class="na">yum</span><span class="pi">:</span>
        <span class="na">update_cache</span><span class="pi">:</span> <span class="s">yes</span>
      <span class="na">when</span><span class="pi">:</span> <span class="s">ansible_os_family == "RedHat"</span>
      
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Update package cache</span>
      <span class="na">apt</span><span class="pi">:</span>
        <span class="na">update_cache</span><span class="pi">:</span> <span class="s">yes</span>
      <span class="na">when</span><span class="pi">:</span> <span class="s">ansible_os_family == "Debian"</span>

  <span class="na">roles</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">common</span>
    <span class="pi">-</span> <span class="s">security</span>
    <span class="pi">-</span> <span class="s">monitoring</span>

  <span class="na">post_tasks</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Verify services are running</span>
      <span class="na">service</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">state</span><span class="pi">:</span> <span class="s">started</span>
      <span class="na">loop</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">sshd</span>
        <span class="pi">-</span> <span class="s">chrony</span>
</code></pre></div></div>

<p><br /></p>

<hr />

<h2 id="best-practices-and-recommendations">Best Practices and Recommendations</h2>

<p><br /></p>

<h3 id="development-workflow-optimization">Development Workflow Optimization</h3>

<ol>
  <li><strong>Project Organization</strong>
    <ul>
      <li>Use separate directories for different environments</li>
      <li>Implement consistent naming conventions</li>
      <li>Version control all Vagrantfiles and provisioning scripts</li>
    </ul>
  </li>
  <li><strong>Resource Management</strong>
    <ul>
      <li>Monitor host system resources</li>
      <li>Use appropriate VM sizing for workloads</li>
      <li>Implement automated cleanup procedures</li>
    </ul>
  </li>
  <li><strong>Security Considerations</strong>
    <ul>
      <li>Change default passwords and SSH keys</li>
      <li>Implement proper network isolation</li>
      <li>Use encrypted storage when handling sensitive data</li>
    </ul>
  </li>
</ol>

<p><br /></p>

<h3 id="performance-best-practices">Performance Best Practices</h3>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Performance-optimized configuration template</span>
<span class="no">Vagrant</span><span class="p">.</span><span class="nf">configure</span><span class="p">(</span><span class="s2">"2"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="c1"># Disable unnecessary features</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">synced_folder</span> <span class="s2">"."</span><span class="p">,</span> <span class="s2">"/vagrant"</span><span class="p">,</span> <span class="ss">disabled: </span><span class="kp">true</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box_check_update</span> <span class="o">=</span> <span class="kp">false</span>
  
  <span class="c1"># Optimize provider settings</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provider</span> <span class="s2">"libvirt"</span> <span class="k">do</span> <span class="o">|</span><span class="n">libvirt</span><span class="o">|</span>
    <span class="c1"># Use host CPU features</span>
    <span class="n">libvirt</span><span class="p">.</span><span class="nf">cpu_mode</span> <span class="o">=</span> <span class="s2">"host-passthrough"</span>
    
    <span class="c1"># Optimize memory allocation</span>
    <span class="n">libvirt</span><span class="p">.</span><span class="nf">memory</span> <span class="o">=</span> <span class="mi">8192</span>
    <span class="n">libvirt</span><span class="p">.</span><span class="nf">memorybacking</span> <span class="ss">:hugepages</span>
    
    <span class="c1"># Use fast storage</span>
    <span class="n">libvirt</span><span class="p">.</span><span class="nf">machine_virtual_size</span> <span class="o">=</span> <span class="mi">40</span>
    <span class="n">libvirt</span><span class="p">.</span><span class="nf">disk_bus</span> <span class="o">=</span> <span class="s2">"virtio"</span>
    <span class="n">libvirt</span><span class="p">.</span><span class="nf">nic_model_type</span> <span class="o">=</span> <span class="s2">"virtio"</span>
    
    <span class="c1"># Disable graphics for headless operation</span>
    <span class="n">libvirt</span><span class="p">.</span><span class="nf">graphics_type</span> <span class="o">=</span> <span class="s2">"none"</span>
  <span class="k">end</span>
  
  <span class="c1"># Minimize provisioning time</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provision</span> <span class="s2">"shell"</span><span class="p">,</span> 
    <span class="ss">inline: </span><span class="s2">"echo 'Fast provisioning complete'"</span><span class="p">,</span>
    <span class="ss">run: </span><span class="s2">"once"</span>
<span class="k">end</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="maintenance-and-cleanup">Maintenance and Cleanup</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Create maintenance script</span>
<span class="nb">cat</span> <span class="o">&gt;</span> /usr/local/bin/vagrant-cleanup.sh <span class="o">&lt;&lt;</span> <span class="sh">'</span><span class="no">EOF</span><span class="sh">'
#!/bin/bash

echo "=== Vagrant Environment Cleanup ==="

# Remove unused boxes
vagrant box prune --force

# Clean up orphaned VMs
for vm in </span><span class="si">$(</span>virsh list <span class="nt">--name</span> <span class="nt">--all</span> | <span class="nb">grep </span>vagrant<span class="si">)</span><span class="sh">; do
    if ! vagrant status </span><span class="nv">$vm</span><span class="sh"> &gt; /dev/null 2&gt;&amp;1; then
        echo "Removing orphaned VM: </span><span class="nv">$vm</span><span class="sh">"
        virsh destroy </span><span class="nv">$vm</span><span class="sh"> 2&gt;/dev/null
        virsh undefine </span><span class="nv">$vm</span><span class="sh"> --remove-all-storage 2&gt;/dev/null
    fi
done

# Clean up unused networks
for net in </span><span class="si">$(</span>virsh net-list <span class="nt">--name</span> <span class="nt">--all</span> | <span class="nb">grep </span>vagrant<span class="si">)</span><span class="sh">; do
    if [ </span><span class="si">$(</span>virsh net-info <span class="nv">$net</span> | <span class="nb">grep</span> <span class="s1">'Active:'</span> | <span class="nb">awk</span> <span class="s1">'{print $2}'</span><span class="si">)</span><span class="sh"> == "no" ]; then
        echo "Removing unused network: </span><span class="nv">$net</span><span class="sh">"
        virsh net-undefine </span><span class="nv">$net</span><span class="sh">
    fi
done

# Clean up storage pools
virsh pool-refresh vagrant
echo "Cleanup completed"
</span><span class="no">EOF

</span><span class="nb">chmod</span> +x /usr/local/bin/vagrant-cleanup.sh

<span class="c"># Schedule weekly cleanup</span>
<span class="nb">echo</span> <span class="s2">"0 2 * * 0 root /usr/local/bin/vagrant-cleanup.sh"</span> <span class="o">&gt;&gt;</span> /etc/crontab
</code></pre></div></div>

<p><br /></p>

<hr />

<h2 id="conclusion">Conclusion</h2>

<p>Vagrant represents a paradigm shift in development environment management, offering <strong>unprecedented consistency and automation</strong> for virtual machine workflows. The integration with KVM provides enterprise-grade performance while maintaining the simplicity and flexibility that makes Vagrant indispensable for modern development teams.</p>

<p><br /></p>

<h3 id="key-achievements">Key Achievements:</h3>

<ol>
  <li><strong>Automated Environment Setup</strong>: Single-command environment deployment</li>
  <li><strong>Infrastructure as Code</strong>: Version-controlled, reproducible configurations</li>
  <li><strong>Cross-platform Consistency</strong>: Identical environments across different hosts</li>
  <li><strong>DevOps Integration</strong>: Seamless integration with Ansible, Terraform, and CI/CD pipelines</li>
</ol>

<p><br /></p>

<h3 id="operational-benefits">Operational Benefits:</h3>

<ul>
  <li><strong>Reduced Onboarding Time</strong>: New team members productive immediately</li>
  <li><strong>Environment Parity</strong>: Development environments match production</li>
  <li><strong>Resource Optimization</strong>: Efficient use of hardware resources</li>
  <li><strong>Automated Testing</strong>: Consistent testing environments for CI/CD</li>
</ul>

<h4 id="future-enhancements">Future Enhancements:</h4>
<ul>
  <li>Implement container-based development environments with Vagrant Docker provider</li>
  <li>Integrate with cloud providers for hybrid development workflows</li>
  <li>Develop custom plugins for specific organizational needs</li>
  <li>Explore integration with emerging virtualization technologies</li>
</ul>

<p>Mastering Vagrant with KVM creates a solid foundation for infrastructure automation, enabling teams to focus on development rather than environment management. The combination of <strong>powerful virtualization, automated provisioning, and flexible configuration</strong> makes this stack essential for modern software development workflows.</p>

<blockquote>
  <p><em>“Vagrant transforms the traditional approach to development environments, making ‘it works on my machine’ a statement of confidence rather than an excuse.”</em></p>
</blockquote>

<p><br /></p>

<hr />

<h2 id="references">References</h2>

<ul>
  <li><a href="https://www.vagrantup.com/docs">Vagrant Official Documentation</a></li>
  <li><a href="https://github.com/vagrant-libvirt/vagrant-libvirt">Vagrant Libvirt Provider</a></li>
  <li><a href="https://www.linux-kvm.org/page/Main_Page">KVM Virtualization Guide</a></li>
  <li><a href="https://libvirt.org/docs.html">Libvirt Documentation</a></li>
  <li><a href="https://app.vagrantup.com/boxes/search">Vagrant Box Catalog</a></li>
  <li><a href="https://github.com/somaz94/vagrant-packer">Example Project Repository</a></li>
</ul>


                <!-- Pagination links -->


            </article>

            
                <aside class="see-also">
                    <h2>See also</h2>
                    <ul>
                        
                        
                        
                            <li>
                                <a href="/category/troubleshooting/db-connection-econnreset-resolution/">
                                    
                                        <img src="https://blog.kakaocdn.net/dna/s4D8a/btsOxNLMqM4/AAAAAAAAAAAAAAAAAAAAAORE6t2MVeHlg6zCJA1t5NVNNR4Wh10RQLa4nfpWBDNv/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1756652399&allow_ip=&allow_referer=&signature=BU3QjfHpdR4%2FWl2hapEWOzOIy2I%3D">
                                    
                                    <h3>Resolving DB Connection Error (ECONNRESET) Issues</h3>
                                </a>
                            </li>
                        
                            <li>
                                <a href="/category/openstack/openstack-trove/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1756185482/openstack-trove-1_ggheju.png">
                                    
                                    <h3>Deep Dive into OpenStack Trove</h3>
                                </a>
                            </li>
                        
                            <li>
                                <a href="/category/database/database-normalization/">
                                    
                                        <img src="https://blog.kakaocdn.net/dn/GY9Lf/btsMP5uevn7/JNMOge6dsyn4R6Lx0CbQF1/img.png">
                                    
                                    <h3>Database Normalization and Denormalization: A Complete Guide</h3>
                                </a>
                            </li>
                        
                    </ul>
                </aside>
            

        </section>

        <!-- Add time bar only for pages without pagination -->
        
            <div class="time-bar" data-minutes="25">
    <span class="time-completed"></span>
    <span class="time-remaining"></span>
    <div class="bar">
        <span class="completed" style="width:0%;"></span>
        <span class="remaining" style="width:100%;"></span>
    </div>
</div>

            <button class="toggle-preview" onclick="togglePreview()">
    <span>Hide Preview ▼</span>
</button>

<div id="recommendationSection" class="recommendation">
    <div class="message">
        <strong>Why don't you read something next?</strong>
        <div>
            <button>
                <svg><use xlink:href="#icon-arrow-right"></use></svg>
                <span>Go back to top</span>
            </button>
        </div>
    </div>
    <div id="previewSection" class="preview-section">
        
        <a href="/category/database/nosql-data-modeling/" class="post-preview">
            <div class="image">
                
                    <img src="https://blog.kakaocdn.net/dn/2zEse/btsM0w4F848/EJO0OKPuXbjUSYdpEkyipK/img.png">
                
            </div>
            <h3 class="title">NoSQL Data Modeling: A Comprehensive Guide</h3>
        </a>
    </div>
</div>

<style>
.toggle-preview {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #333;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 4px;
    cursor: pointer;
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.toggle-preview:hover {
    background: #444;
}

.toggle-preview.visible {
    opacity: 1;
}

.recommendation {
    margin-top: 1000px;
    display: block;
    transition: all 0.3s ease;
}

.recommendation.hidden {
    display: none;
}

.hide-preview {
    margin-left: 10px;
    background: none;
    border: 1px solid #666;
    color: #666;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
}

.hide-preview:hover {
    background: #f0f0f0;
}

.preview-section {
    max-height: 1000px;
    overflow: hidden;
    transition: max-height 0.3s ease-out;
}

.preview-section.hidden {
    max-height: 0;
}
</style>

<script>
function togglePreview() {
    const recommendation = document.getElementById('recommendationSection');
    const button = document.querySelector('.toggle-preview span');
    
    if (recommendation.classList.contains('hidden')) {
        recommendation.classList.remove('hidden');
        button.textContent = 'Hide Preview ▼';
    } else {
        recommendation.classList.add('hidden');
        button.textContent = 'Show Preview ▲';
    }
}

window.addEventListener('scroll', function() {
    const toggleButton = document.querySelector('.toggle-preview');
    const recommendation = document.getElementById('recommendationSection');
    const rect = recommendation.getBoundingClientRect();
    
    if (rect.top <= window.innerHeight) {
        toggleButton.classList.add('visible');
    } else {
        toggleButton.classList.remove('visible');
    }
});
</script>

        

        <!-- Show modal if the post is the last one -->
        

        <!-- Show modal before user leaves the page -->
        

        <!-- Add your newsletter subscription form here -->

        <section class="share">
    <h3>Share</h3>
    <a aria-label="Share on Twitter" href="https://twitter.com/intent/tweet?text=&quot;Step-by-step tutorial covering KVM setup, Vagrant installation, Vagrantfile configuration, and VM lifecycle management for automated development environment provisioning.&quot;%20https://somaz.blog/category/iac/what-is-vagrant/%20via%20&#64;twitter_username&hashtags=vagrant,kvm,virtualization,infrastructure-as-code,automation,development-environment,libvirt,provisioning,devops"
    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Share on Twitter">
        <svg class="icon icon-twitter"><use xlink:href="#icon-twitter"></use></svg>
    </a>
    <a aria-label="Share on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://somaz.blog/category/iac/what-is-vagrant/"
    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook">
        <svg class="icon icon-facebook"><use xlink:href="#icon-facebook"></use></svg>
    </a>
</section>

        

  <section class="author">
    <div class="details">
      
        <img class="img-rounded" src="/assets/img/uploads/profile.png" alt="Somaz">
      
      <p class="def">Author</p>
      <h3 class="name">
        <a href="/authors/somaz/">Somaz</a>
      </h3>
      <p class="desc">DevOps engineer focused on cloud infrastructure and automation</p>
      <p>
        
          <a href="https://github.com/somaz94" title="Github">
            <svg><use xlink:href="#icon-github"></use></svg>
          </a>
        
        
        
        
        
        
          <a href="https://www.linkedin.com/in/somaz" title="LinkedIn">
            <svg><use xlink:href="#icon-linkedin"></use></svg>
          </a>
        
        
          <a href="https://somaz.tistory.com" title="Tistory">
            <svg><use xlink:href="#icon-tistory"></use></svg>
          </a>
        
      </p>
    </div>
  </section>

  
  
  
  
  
  
  
  

  <script type="application/ld+json">
  {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "Somaz",
      
      "image": "/assets/img/uploads/profile.png",
      
      "jobTitle": "DevOps Engineer",
      "url": "https://somaz.blog/authors/somaz/",
      "sameAs": [
        "https://github.com/somaz94","https://www.linkedin.com/in/somaz","https://{{ author.tistory_username }}.tistory.com"
      ]
  }
  </script>


        

<section class="comments">
    <h3>Comments</h3>
    <div id="disqus_thread"></div>
</section>
<script type="text/javascript">
    var disqus_loaded = false;

    function load_disqus()
    {
        disqus_loaded = true;
        var disqus_shortname = 'https-somaz94-github-io';
        var disqus_title = '';
        var disqus_url = '/category/iac/what-is-vagrant/';
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        var ldr = document.getElementById('disqus_loader');
    };
    window.onscroll = function(e) {
        if ((window.innerHeight + window.scrollY) >= (document.body.offsetHeight - 800)) {
            //hit bottom of page
            if (disqus_loaded==false)
                load_disqus()
        }
    };
</script>



        <footer>
    <p>
      
        <a href="https://github.com/somaz94" title="Github">
          <svg><use xlink:href="#icon-github"></use></svg>
        </a>
      
      
        <a href="https://www.facebook.com/facebook_username" title="Facebook">
          <svg><use xlink:href="#icon-facebook"></use></svg>
        </a>
      
      
        <a href="https://twitter.com/twitter_username" title="Twitter">
          <svg><use xlink:href="#icon-twitter"></use></svg>
        </a>
      
      
        <a href="https://medium.com/@medium_username" title="Medium">
          <svg><use xlink:href="#icon-medium"></use></svg>
        </a>
      
      
        <a href="https://www.instagram.com/instagram_username" title="Instagram">
          <svg><use xlink:href="#icon-instagram"></use></svg>
        </a>
      
      
        <a href="https://www.linkedin.com/in/somaz" title="LinkedIn">
          <svg><use xlink:href="#icon-linkedin"></use></svg>
        </a>
      
      
        <a href="https://somaz.tistory.com" title="Tistory">
          <svg><use xlink:href="#icon-tistory"></use></svg>
        </a>
      
    </p>

    <ul>
  
    
      <li>
        <a href="https://somaz.blog/">Home</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/about">About</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/category">Category</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/contact">Contact</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/feed.xml">Feed</a>
      </li>
    
  
</ul>


    <p>
      <a href="https://somaz.blog/sitemap.xml" title="sitemap">Sitemap</a> |
      <a href="https://somaz.blog/privacy-policy" title="Privacy Policy">Privacy Policy</a>
    </p>

    <p>
      <span>Somaz Tech Blog</span> <svg class="love"><use xlink:href="#icon-heart"></use></svg>
    </p>
</footer>










<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "somaz",
  "description": "DevOps engineer's tech blog.",
  "url": "https://somaz.blog/",
  "logo": {
      "@type": "ImageObject",
      "url": "https://somaz.blog/assets/img/icons/mediumtile.png",
      "width": "600",
      "height": "315"
  },
  "sameAs": [
    "https://github.com/somaz94","https://www.facebook.com/facebook_username","https://twitter.com/twitter_username","https://medium.com/@medium_username","https://www.instagram.com/instagram_username","https://www.linkedin.com/in/somaz","https://{{ site.tistory_username }}.tistory.com"
  ]
}
</script>

<!-- Include the script that allows Netlify CMS login -->
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

<!-- Include the website scripts -->
<script src="/assets/js/scripts.min.js"></script>

<!-- Include Google Analytics script -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-XXXXXXXX-X"></script>
<script>
  var host = window.location.hostname;
  if (host != 'localhost') {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-XXXXXXXX-X');
  }
</script>
  


<!-- Include extra scripts -->



        

        
        
        
        
        
        
        
        
        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "BlogPosting",
            "name": "Vagrant with KVM: Complete Infrastructure Automation for Development Environments",
            "headline": "Comprehensive guide to setting up and managing virtual machines using Vagrant with KVM backend for efficient development workflows",
            "description": "Step-by-step tutorial covering KVM setup, Vagrant installation, Vagrantfile configuration, and VM lifecycle management for automated development environment provisioning.",
            "image": "https://res.cloudinary.com/dkcm26aem/image/upload/v1755134513/vagrant-1_y7g1uh.png",
            "url": "https://somaz.blog/category/iac/what-is-vagrant/",
            "articleBody": "



Overview

In modern software development, maintaining consistent and reproducible development environments across teams remains a significant challenge.

Vagrant addresses this challenge by providing a powerful automation tool for building and managing virtual machine environments with minimal configuration overhead.

This comprehensive guide focuses on Vagrant integration with KVM (Kernel-based Virtual Machine) as the virtualization backend, offering superior performance compared to traditional solutions.

We’ll cover everything from KVM setup and configuration to advanced Vagrant workflows, including multi-machine environments and automated provisioning.

Vagrant excels at project-based VM management, enabling developers to create, destroy, and configure development environments with simple commands.

When combined with Ansible, Terraform, and other DevOps tools, Vagrant becomes a cornerstone of infrastructure automation workflows.





What is Vagrant?

Vagrant is an open-source tool for building and managing virtual machine environments in a single workflow.

With an easy-to-use interface and focus on automation, Vagrant lowers development environment setup time, increases production parity, and makes the “works on my machine” excuse a relic of the past.



Core Features:


  Automated VM Environment Setup: Single command deployment
  Multiple Provider Support: KVM, VirtualBox, Docker, AWS, and more
  Provisioning Integration: Ansible, Puppet, Chef, Shell scripts
  Project-based Management: Isolated environments per project
  Version Control Friendly: Infrastructure as Code principles
  Cross-platform Compatibility: Windows, macOS, Linux support




Use Cases:

Development Environment Standardization

  Consistent development stacks across team members
  Isolated testing environments for different projects
  Rapid onboarding for new team members


Infrastructure Testing

  Multi-node cluster simulation
  Network topology testing
  Disaster recovery scenarios


CI/CD Integration

  Automated testing environments
  Build and deployment pipelines
  Quality assurance workflows






KVM Installation and Configuration



Step 1: Install KVM Virtualization Host

# Install virtualization packages
yum -y group install &apos;Virtualization Host&apos;

# Alternative for Ubuntu/Debian systems
apt-get install -y qemu-kvm libvirt-daemon-system libvirt-clients bridge-utils

# Verify KVM module availability
lsmod | grep kvm
# Expected output:
# kvm_intel (or kvm_amd)
# kvm




Step 2: Configure Nested Virtualization

# Check current nested virtualization status
cat /sys/module/kvm_intel/parameters/nested
# Y = enabled, N = disabled

# Enable nested virtualization for Intel processors
cat &amp;gt; /etc/modprobe.d/kvm-nested.conf &amp;lt;&amp;lt; &apos;EOF&apos;
options kvm-intel nested=1
options kvm-intel enable_shadow_vmcs=1
options kvm-intel enable_apicv=1
options kvm-intel ept=1
EOF

# For AMD processors
cat &amp;gt; /etc/modprobe.d/kvm-nested.conf &amp;lt;&amp;lt; &apos;EOF&apos;
options kvm-amd nested=1
EOF




Step 3: Apply Kernel Module Changes

# Remove and reload KVM modules
modprobe -r kvm_intel  # or kvm_amd for AMD
modprobe -a kvm_intel  # or kvm_amd for AMD

# Verify nested virtualization is enabled
cat /sys/module/kvm_intel/parameters/nested
# Should return: Y




Step 4: Configure PCI Passthrough and SR-IOV

# Edit GRUB configuration for hardware passthrough
vi /etc/default/grub

# Add IOMMU support to GRUB_CMDLINE_LINUX
GRUB_CMDLINE_LINUX=&quot;nofb splash=quiet console=tty0 intel_iommu=on iommu=pt&quot;

# For AMD systems, use:
# GRUB_CMDLINE_LINUX=&quot;nofb splash=quiet console=tty0 amd_iommu=on iommu=pt&quot;

# Update GRUB configuration
grub2-mkconfig -o /boot/grub2/grub.cfg

# For Ubuntu/Debian systems:
# update-grub




Step 5: Enable IPv4 Forwarding

# Configure permanent IPv4 forwarding
echo &apos;net.ipv4.ip_forward = 1&apos; &amp;gt;&amp;gt; /etc/sysctl.conf

# Apply immediately without reboot
sysctl -p

# Verify setting
sysctl net.ipv4.ip_forward
# Should return: net.ipv4.ip_forward = 1




Step 6: System Restart and Validation

# Restart system to apply all changes
systemctl reboot

# After reboot, validate KVM environment
virt-host-validate

# Expected output should show all PASS results:
# QEMU: Checking for hardware virtualization: PASS
# QEMU: Checking if device /dev/kvm exists: PASS
# QEMU: Checking if device /dev/kvm is accessible: PASS
# LXC: Checking for Linux &amp;gt;= 2.6.26: PASS






Vagrant Installation and Setup



Step 1: Install Vagrant and Dependencies

# Add HashiCorp repository
sudo yum-config-manager --add-repo https://rpm.releases.hashicorp.com/RHEL/hashicorp.repo

# Install Vagrant
sudo yum -y install vagrant

# Install required development packages
sudo yum -y install qemu libvirt libvirt-devel ruby-devel gcc qemu-kvm libguestfs-tools

# For Ubuntu/Debian systems:
# curl -fsSL https://apt.releases.hashicorp.com/gpg | sudo apt-key add -
# sudo apt-add-repository &quot;deb [arch=amd64] https://apt.releases.hashicorp.com $(lsb_release -cs) main&quot;
# sudo apt-get update &amp;amp;&amp;amp; sudo apt-get install vagrant




Step 2: Install Vagrant Plugins

# Install libvirt provider plugin
vagrant plugin install vagrant-libvirt

# Install image conversion plugin
vagrant plugin install vagrant-mutate

# Install additional useful plugins
vagrant plugin install vagrant-reload
vagrant plugin install vagrant-vbguest

# Verify installed plugins
vagrant plugin list




Step 3: Configure KVM Storage Pool for Vagrant

# Prepare dedicated storage for Vagrant VMs (optional but recommended)
# Assume /dev/sdb1 is available for VM storage
mkfs.xfs /dev/sdb1

# Create mount point
mkdir -p /var/lib/libvirt/vagrant

# Add to fstab for persistent mounting
echo &quot;$(blkid /dev/sdb1 -o export | grep ^UUID) /var/lib/libvirt/vagrant xfs defaults 0 0&quot; &amp;gt;&amp;gt; /etc/fstab

# Mount the filesystem
mount -a

# Create libvirt storage pool
virsh pool-define-as --name vagrant --type dir --target /var/lib/libvirt/vagrant

# Start and enable autostart for the pool
virsh pool-start vagrant
virsh pool-autostart vagrant

# Verify pool creation
virsh pool-list --all




Step 4: Configure Libvirt Service

# Start and enable libvirt services
systemctl start libvirtd
systemctl enable libvirtd

# Add user to libvirt group
usermod -a -G libvirt $(whoami)

# Configure libvirt for user access
echo &apos;unix_sock_group = &quot;libvirt&quot;&apos; &amp;gt;&amp;gt; /etc/libvirt/libvirtd.conf
echo &apos;unix_sock_rw_perms = &quot;0770&quot;&apos; &amp;gt;&amp;gt; /etc/libvirt/libvirtd.conf

# Restart libvirt service
systemctl restart libvirtd






Vagrant Project Structure and Workflow



Understanding Vagrant Project Structure

Vagrant operates on a project-based approach where each directory containing a Vagrantfile represents a separate project environment:

# Typical Vagrant project structure
my-vagrant-project/
├── Vagrantfile              # Main configuration file
├── provisioning/            # Provisioning scripts directory
│   ├── bootstrap.sh        # Initial setup script
│   ├── install-docker.sh   # Application-specific scripts
│   └── ansible/            # Ansible playbooks
│       ├── playbook.yml
│       └── inventory/
├── shared/                  # Shared folders content
│   └── application-code/
└── .vagrant/               # Vagrant metadata (auto-generated)
    ├── machines/
    └── provisioners/




Project Initialization

# Create new project directory
mkdir my-development-environment
cd my-development-environment

# Initialize Vagrant environment
vagrant init

# This creates a basic Vagrantfile with default configuration
# The current directory becomes the Vagrant project root




Vagrant Commands Overview

# Core Vagrant commands
vagrant init [box-name]      # Initialize new Vagrant environment
vagrant up                   # Create and provision VM
vagrant halt                 # Gracefully shutdown VM
vagrant destroy              # Delete VM and resources
vagrant ssh                  # SSH into running VM
vagrant reload               # Restart VM with new configuration
vagrant provision            # Run provisioning scripts
vagrant status               # Show VM status
vagrant global-status        # Show all Vagrant environments






Vagrantfile Configuration



Basic Single-VM Configuration

# -*- mode: ruby -*-
# vi: set ft=ruby :

# Set default provider to libvirt
ENV[&apos;VAGRANT_DEFAULT_PROVIDER&apos;] = &apos;libvirt&apos;

Vagrant.configure(&quot;2&quot;) do |config|
  # Base box configuration
  config.vm.box = &quot;generic/ubuntu2004&quot;
  config.vm.box_version = &quot;3.6.8&quot;
  
  # VM hostname
  config.vm.hostname = &quot;dev-server&quot;
  
  # Disable default shared folder
  config.vm.synced_folder &quot;.&quot;, &quot;/vagrant&quot;, disabled: true
  
  # Network configuration
  config.vm.network &quot;private_network&quot;, 
    ip: &quot;192.168.56.10&quot;,
    libvirt__network_name: &quot;development&quot;,
    libvirt__forward_mode: &quot;nat&quot;,
    libvirt__dhcp_enabled: false
  
  # Port forwarding
  config.vm.network &quot;forwarded_port&quot;, guest: 80, host: 8080
  config.vm.network &quot;forwarded_port&quot;, guest: 22, host: 2222
  
  # Provider-specific configuration
  config.vm.provider &quot;libvirt&quot; do |libvirt|
    libvirt.memory = 4096
    libvirt.cpus = 2
    libvirt.storage_pool_name = &quot;vagrant&quot;
    libvirt.machine_virtual_size = 40  # GB
    libvirt.graphics_ip = &quot;0.0.0.0&quot;
    libvirt.graphics_port = 5900
    libvirt.video_type = &quot;qxl&quot;
  end
  
  # Provisioning
  config.vm.provision &quot;shell&quot;, inline: &amp;lt;&amp;lt;-SHELL
    apt-get update
    apt-get install -y nginx
    systemctl start nginx
    systemctl enable nginx
  SHELL
end




Advanced Multi-VM Configuration

# -*- mode: ruby -*-
# vi: set ft=ruby :

ENV[&apos;VAGRANT_DEFAULT_PROVIDER&apos;] = &apos;libvirt&apos;

Vagrant.configure(&quot;2&quot;) do |config|
  # Environment variables
  CONTROL_COUNT = 3
  WORKER_COUNT = 2
  STORAGE_COUNT = 1
  
  # Base configuration for all VMs
  config.vm.box = &quot;generic/centos8&quot;
  config.vm.synced_folder &quot;.&quot;, &quot;/vagrant&quot;, disabled: true
  
  # Control plane nodes
  (1..CONTROL_COUNT).each do |i|
    config.vm.define &quot;control#{i.to_s.rjust(2, &apos;0&apos;)}&quot; do |control|
      control.vm.hostname = &quot;control#{i.to_s.rjust(2, &apos;0&apos;)}&quot;
      
      # Network configuration
      control.vm.network &quot;private_network&quot;,
        ip: &quot;192.168.100.1#{i}&quot;,
        libvirt__network_name: &quot;k8s-cluster&quot;,
        libvirt__forward_mode: &quot;nat&quot;,
        libvirt__dhcp_enabled: false
      
      # Management network
      control.vm.network &quot;private_network&quot;,
        ip: &quot;10.0.0.1#{i}&quot;,
        libvirt__network_name: &quot;management&quot;,
        libvirt__forward_mode: &quot;none&quot;,
        libvirt__dhcp_enabled: false
      
      # Provider configuration
      control.vm.provider &quot;libvirt&quot; do |libvirt|
        libvirt.memory = 8192
        libvirt.cpus = 4
        libvirt.storage_pool_name = &quot;vagrant&quot;
        libvirt.machine_virtual_size = 100
        libvirt.management_network_name = &quot;management&quot;
        libvirt.management_network_mac = &quot;52:54:00:#{sprintf(&apos;%02x&apos;, 10 + i)}:#{sprintf(&apos;%02x&apos;, i)}:01&quot;
      end
      
      # Port forwarding for API server
      if i == 1
        control.vm.network &quot;forwarded_port&quot;, guest: 6443, host: 6443
      end
      
      # Provisioning
      control.vm.provision &quot;shell&quot;, path: &quot;scripts/common-setup.sh&quot;
      control.vm.provision &quot;shell&quot;, path: &quot;scripts/control-plane-setup.sh&quot;, 
        args: [i, CONTROL_COUNT, WORKER_COUNT]
    end
  end
  
  # Worker nodes
  (1..WORKER_COUNT).each do |i|
    config.vm.define &quot;worker#{i.to_s.rjust(2, &apos;0&apos;)}&quot; do |worker|
      worker.vm.hostname = &quot;worker#{i.to_s.rjust(2, &apos;0&apos;)}&quot;
      
      worker.vm.network &quot;private_network&quot;,
        ip: &quot;192.168.100.2#{i}&quot;,
        libvirt__network_name: &quot;k8s-cluster&quot;,
        libvirt__forward_mode: &quot;nat&quot;,
        libvirt__dhcp_enabled: false
      
      worker.vm.provider &quot;libvirt&quot; do |libvirt|
        libvirt.memory = 16384
        libvirt.cpus = 8
        libvirt.storage_pool_name = &quot;vagrant&quot;
        libvirt.machine_virtual_size = 200
      end
      
      worker.vm.provision &quot;shell&quot;, path: &quot;scripts/common-setup.sh&quot;
      worker.vm.provision &quot;shell&quot;, path: &quot;scripts/worker-setup.sh&quot;
    end
  end
  
  # Storage nodes
  (1..STORAGE_COUNT).each do |i|
    config.vm.define &quot;storage#{i.to_s.rjust(2, &apos;0&apos;)}&quot; do |storage|
      storage.vm.hostname = &quot;storage#{i.to_s.rjust(2, &apos;0&apos;)}&quot;
      
      storage.vm.network &quot;private_network&quot;,
        ip: &quot;192.168.100.3#{i}&quot;,
        libvirt__network_name: &quot;k8s-cluster&quot;,
        libvirt__forward_mode: &quot;nat&quot;,
        libvirt__dhcp_enabled: false
      
      storage.vm.provider &quot;libvirt&quot; do |libvirt|
        libvirt.memory = 32768
        libvirt.cpus = 16
        libvirt.storage_pool_name = &quot;vagrant&quot;
        libvirt.machine_virtual_size = 100
        
        # Additional storage disks for Ceph
        (1..3).each do |disk|
          libvirt.storage :file, 
            size: &quot;50G&quot;, 
            path: &quot;storage#{i.to_s.rjust(2, &apos;0&apos;)}-disk#{disk}.qcow2&quot;,
            bus: &quot;virtio&quot;
        end
      end
      
      storage.vm.provision &quot;shell&quot;, path: &quot;scripts/common-setup.sh&quot;
      storage.vm.provision &quot;shell&quot;, path: &quot;scripts/storage-setup.sh&quot;
    end
  end
end




Provisioning Script Examples







Vagrant Box Management



Working with Vagrant Boxes

# List available boxes
vagrant box list

# Add a new box
vagrant box add generic/ubuntu2004

# Add box with specific provider
vagrant box add generic/centos8 --provider libvirt

# Update existing box
vagrant box update --box generic/ubuntu2004

# Remove old box versions
vagrant box prune

# Create custom box from existing VM
vagrant package --output my-custom-box.box
vagrant box add my-custom-box my-custom-box.box




Box Version Management

# Vagrantfile with version constraints
Vagrant.configure(&quot;2&quot;) do |config|
  config.vm.box = &quot;generic/ubuntu2004&quot;
  config.vm.box_version = &quot;&amp;gt;= 3.6.0, &amp;lt; 4.0&quot;
  config.vm.box_check_update = true
  
  # Box download configuration
  config.vm.box_download_checksum = &quot;sha256_checksum_here&quot;
  config.vm.box_download_checksum_type = &quot;sha256&quot;
end




Custom Box Creation

# Create custom box from existing VM
vagrant package --vagrantfile Vagrantfile.pkg --output custom-dev-env.box

# Vagrantfile.pkg example
Vagrant.configure(&quot;2&quot;) do |config|
  config.vm.base_mac = &quot;080027D14C66&quot;
  config.ssh.username = &quot;vagrant&quot;
  config.ssh.password = &quot;vagrant&quot;
end

# Add custom box to local repository
vagrant box add custom-dev-env custom-dev-env.box






Advanced Vagrant Features



Multi-Provider Support

# Vagrantfile with multiple provider configurations
Vagrant.configure(&quot;2&quot;) do |config|
  config.vm.box = &quot;generic/ubuntu2004&quot;
  
  # VirtualBox provider
  config.vm.provider &quot;virtualbox&quot; do |vb|
    vb.name = &quot;ubuntu-dev-vbox&quot;
    vb.memory = &quot;4096&quot;
    vb.cpus = 2
    vb.gui = false
  end
  
  # Libvirt provider
  config.vm.provider &quot;libvirt&quot; do |lv|
    lv.memory = 4096
    lv.cpus = 2
    lv.storage_pool_name = &quot;vagrant&quot;
    lv.machine_virtual_size = 40
  end
  
  # Docker provider
  config.vm.provider &quot;docker&quot; do |d|
    d.image = &quot;ubuntu:20.04&quot;
    d.remains_running = true
    d.has_ssh = true
  end
end




Ansible Integration

# Ansible provisioning configuration
Vagrant.configure(&quot;2&quot;) do |config|
  config.vm.provision &quot;ansible&quot; do |ansible|
    ansible.playbook = &quot;provisioning/site.yml&quot;
    ansible.inventory_path = &quot;provisioning/inventory&quot;
    ansible.limit = &quot;all&quot;
    ansible.extra_vars = {
      ansible_ssh_user: &apos;vagrant&apos;,
      ansible_ssh_private_key_file: &quot;~/.vagrant.d/insecure_private_key&quot;
    }
    ansible.groups = {
      &quot;webservers&quot; =&amp;gt; [&quot;web[1:2]&quot;],
      &quot;dbservers&quot; =&amp;gt; [&quot;db&quot;],
      &quot;monitoring&quot; =&amp;gt; [&quot;monitor&quot;],
      &quot;all_groups:children&quot; =&amp;gt; [&quot;webservers&quot;, &quot;dbservers&quot;, &quot;monitoring&quot;]
    }
  end
end




File Synchronization Options

# Various sync folder configurations
Vagrant.configure(&quot;2&quot;) do |config|
  # NFS sync (fast, requires NFS server)
  config.vm.synced_folder &quot;.&quot;, &quot;/vagrant&quot;, 
    type: &quot;nfs&quot;,
    nfs_udp: false,
    nfs_version: 4

  # rsync (one-way sync)
  config.vm.synced_folder &quot;src/&quot;, &quot;/home/vagrant/src&quot;,
    type: &quot;rsync&quot;,
    rsync__exclude: [&quot;.git/&quot;, &quot;node_modules/&quot;, &quot;*.tmp&quot;],
    rsync__auto: true

  # SMB sync (Windows hosts)
  config.vm.synced_folder &quot;.&quot;, &quot;/vagrant&quot;,
    type: &quot;smb&quot;,
    smb_username: ENV[&apos;USER&apos;],
    smb_password: ENV[&apos;PASS&apos;]
end






Performance Optimization and Troubleshooting



Performance Tuning

# Performance-optimized Vagrantfile
Vagrant.configure(&quot;2&quot;) do |config|
  config.vm.provider &quot;libvirt&quot; do |libvirt|
    # CPU optimization
    libvirt.cpus = 4
    libvirt.cpu_mode = &quot;host-passthrough&quot;
    libvirt.nested = true
    
    # Memory optimization
    libvirt.memory = 8192
    libvirt.memorybacking :hugepages, :size =&amp;gt; &quot;2048&quot;, :unit =&amp;gt; &quot;KiB&quot;
    
    # Storage optimization
    libvirt.storage_pool_name = &quot;fast-nvme-pool&quot;
    libvirt.machine_virtual_size = 100
    libvirt.disk_bus = &quot;virtio&quot;
    libvirt.nic_model_type = &quot;virtio&quot;
    
    # Graphics optimization (disable for headless)
    libvirt.graphics_type = &quot;none&quot;
    
    # NUMA optimization
    libvirt.numa_nodes = [
      {:cpus =&amp;gt; &quot;0-1&quot;, :memory =&amp;gt; &quot;4096&quot;},
      {:cpus =&amp;gt; &quot;2-3&quot;, :memory =&amp;gt; &quot;4096&quot;}
    ]
  end
end




Common Troubleshooting

# Debug Vagrant issues
export VAGRANT_LOG=debug
vagrant up

# Check libvirt status
systemctl status libvirtd
virsh list --all

# Network troubleshooting
virsh net-list --all
virsh net-info default

# Storage pool issues
virsh pool-list --all
virsh pool-info vagrant

# Clean up failed VMs
vagrant destroy -f
virsh list --all
virsh undefine &amp;lt;vm-name&amp;gt; --remove-all-storage




Monitoring and Logging







Integration with DevOps Tools



Terraform Integration





CI/CD Pipeline Integration

# .github/workflows/vagrant-test.yml
name: Vagrant Environment Testing

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test-vagrant-environment:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Vagrant
      run: |
        curl -fsSL https://apt.releases.hashicorp.com/gpg | sudo apt-key add -
        sudo apt-add-repository &quot;deb [arch=amd64] https://apt.releases.hashicorp.com $(lsb_release -cs) main&quot;
        sudo apt-get update &amp;amp;&amp;amp; sudo apt-get install vagrant
        
    - name: Install VirtualBox
      run: |
        sudo apt-get update
        sudo apt-get install virtualbox
        
    - name: Validate Vagrantfile
      run: vagrant validate
      
    - name: Test VM Creation
      run: |
        vagrant up
        vagrant ssh -c &quot;echo &apos;VM is accessible&apos;&quot;
        vagrant destroy -f




Ansible Playbook Example

# provisioning/site.yml
---
- hosts: all
  become: yes
  gather_facts: yes
  
  pre_tasks:
    - name: Update package cache
      yum:
        update_cache: yes
      when: ansible_os_family == &quot;RedHat&quot;
      
    - name: Update package cache
      apt:
        update_cache: yes
      when: ansible_os_family == &quot;Debian&quot;

  roles:
    - common
    - security
    - monitoring

  post_tasks:
    - name: Verify services are running
      service:
        name: &quot;&quot;
        state: started
      loop:
        - sshd
        - chrony






Best Practices and Recommendations



Development Workflow Optimization


  Project Organization
    
      Use separate directories for different environments
      Implement consistent naming conventions
      Version control all Vagrantfiles and provisioning scripts
    
  
  Resource Management
    
      Monitor host system resources
      Use appropriate VM sizing for workloads
      Implement automated cleanup procedures
    
  
  Security Considerations
    
      Change default passwords and SSH keys
      Implement proper network isolation
      Use encrypted storage when handling sensitive data
    
  




Performance Best Practices

# Performance-optimized configuration template
Vagrant.configure(&quot;2&quot;) do |config|
  # Disable unnecessary features
  config.vm.synced_folder &quot;.&quot;, &quot;/vagrant&quot;, disabled: true
  config.vm.box_check_update = false
  
  # Optimize provider settings
  config.vm.provider &quot;libvirt&quot; do |libvirt|
    # Use host CPU features
    libvirt.cpu_mode = &quot;host-passthrough&quot;
    
    # Optimize memory allocation
    libvirt.memory = 8192
    libvirt.memorybacking :hugepages
    
    # Use fast storage
    libvirt.machine_virtual_size = 40
    libvirt.disk_bus = &quot;virtio&quot;
    libvirt.nic_model_type = &quot;virtio&quot;
    
    # Disable graphics for headless operation
    libvirt.graphics_type = &quot;none&quot;
  end
  
  # Minimize provisioning time
  config.vm.provision &quot;shell&quot;, 
    inline: &quot;echo &apos;Fast provisioning complete&apos;&quot;,
    run: &quot;once&quot;
end




Maintenance and Cleanup

# Create maintenance script
cat &amp;gt; /usr/local/bin/vagrant-cleanup.sh &amp;lt;&amp;lt; &apos;EOF&apos;
#!/bin/bash

echo &quot;=== Vagrant Environment Cleanup ===&quot;

# Remove unused boxes
vagrant box prune --force

# Clean up orphaned VMs
for vm in $(virsh list --name --all | grep vagrant); do
    if ! vagrant status $vm &amp;gt; /dev/null 2&amp;gt;&amp;amp;1; then
        echo &quot;Removing orphaned VM: $vm&quot;
        virsh destroy $vm 2&amp;gt;/dev/null
        virsh undefine $vm --remove-all-storage 2&amp;gt;/dev/null
    fi
done

# Clean up unused networks
for net in $(virsh net-list --name --all | grep vagrant); do
    if [ $(virsh net-info $net | grep &apos;Active:&apos; | awk &apos;{print $2}&apos;) == &quot;no&quot; ]; then
        echo &quot;Removing unused network: $net&quot;
        virsh net-undefine $net
    fi
done

# Clean up storage pools
virsh pool-refresh vagrant
echo &quot;Cleanup completed&quot;
EOF

chmod +x /usr/local/bin/vagrant-cleanup.sh

# Schedule weekly cleanup
echo &quot;0 2 * * 0 root /usr/local/bin/vagrant-cleanup.sh&quot; &amp;gt;&amp;gt; /etc/crontab






Conclusion

Vagrant represents a paradigm shift in development environment management, offering unprecedented consistency and automation for virtual machine workflows. The integration with KVM provides enterprise-grade performance while maintaining the simplicity and flexibility that makes Vagrant indispensable for modern development teams.



Key Achievements:


  Automated Environment Setup: Single-command environment deployment
  Infrastructure as Code: Version-controlled, reproducible configurations
  Cross-platform Consistency: Identical environments across different hosts
  DevOps Integration: Seamless integration with Ansible, Terraform, and CI/CD pipelines




Operational Benefits:


  Reduced Onboarding Time: New team members productive immediately
  Environment Parity: Development environments match production
  Resource Optimization: Efficient use of hardware resources
  Automated Testing: Consistent testing environments for CI/CD


Future Enhancements:

  Implement container-based development environments with Vagrant Docker provider
  Integrate with cloud providers for hybrid development workflows
  Develop custom plugins for specific organizational needs
  Explore integration with emerging virtualization technologies


Mastering Vagrant with KVM creates a solid foundation for infrastructure automation, enabling teams to focus on development rather than environment management. The combination of powerful virtualization, automated provisioning, and flexible configuration makes this stack essential for modern software development workflows.


  “Vagrant transforms the traditional approach to development environments, making ‘it works on my machine’ a statement of confidence rather than an excuse.”






References


  Vagrant Official Documentation
  Vagrant Libvirt Provider
  KVM Virtualization Guide
  Libvirt Documentation
  Vagrant Box Catalog
  Example Project Repository

",
            "wordcount": "4507",
            "inLanguage": "en",
            "dateCreated": "2025-08-28/",
            "datePublished": "2025-08-28/",
            "dateModified": "2025-08-28/",
            "author": {
                "@type": "Person",
                "name": "Somaz",
                
                "image": "/assets/img/uploads/profile.png",
                
                "jobTitle": "DevOps Engineer",
                "url": "https://somaz.blog/authors/somaz/",
                "sameAs": [
                    "https://github.com/somaz94","https://www.linkedin.com/in/somaz"
                ]
            },
            "publisher": {
                "@type": "Organization",
                "name": "somaz",
                "url": "https://somaz.blog/",
                "logo": {
                    "@type": "ImageObject",
                    "url": "https://somaz.blog/assets/img/blog-image.png",
                    "width": "600",
                    "height": "315"
                }
            },
            "mainEntityOfPage": "True",
            "genre": "IAC",
            "articleSection": "IAC",
            "keywords": ["vagrant","kvm","virtualization","infrastructure-as-code","automation","development-environment","libvirt","provisioning","devops"]
        }
        </script>
    </body>
</html>
