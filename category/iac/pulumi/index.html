<!DOCTYPE html>
<html lang="en" class="no-js">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    

    
    

    
    

    
    

    <!-- âœ… Google Tag Manager ì¶”ê°€ -->
    <script>
        (function(w,d,s,l,i){
            w[l]=w[l]||[];
            w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
            var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
            j.async=true;
            j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
            f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-MBP83N4Q');
    </script>
      <!-- âœ… End Google Tag Manager -->

    <!-- Mermaid.js ì§ì ‘ ë¡œë“œ -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>

    <title>Pulumi: Modern Infrastructure as Code with Programming Languages | somaz</title>
    <meta name="description" content="Complete guide to Pulumi - the modern Infrastructure as Code platform that enables developers to define, deploy, and manage cloud infrastructure using Python...">
    
        <meta name="keywords" content="pulumi, infrastructure-as-code, cloud-automation, python, typescript, gcp, aws, kubernetes, state-management, devops">
    

    <!-- Social: Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Pulumi: Modern Infrastructure as Code with Programming Languages | somaz">
    <meta name="twitter:description" content="Complete guide to Pulumi - the modern Infrastructure as Code platform that enables developers to define, deploy, and manage cloud infrastructure using Python...">

    
        <meta property="twitter:image" content="https://res.cloudinary.com/dkcm26aem/image/upload/v1755152827/pulumi-1_bmpstq.png">
    
    
    
        <meta name="twitter:site" content="@twitter_username">
    

    <!-- Social: Facebook / Open Graph -->
    <meta property="og:url" content="https://somaz.blog/category/iac/pulumi/">
    <meta property="og:title" content="Pulumi: Modern Infrastructure as Code with Programming Languages | somaz">
    <meta property="og:image" content="https://res.cloudinary.com/dkcm26aem/image/upload/v1755152827/pulumi-1_bmpstq.png">
    <meta property="og:description" content="Complete guide to Pulumi - the modern Infrastructure as Code platform that enables developers to define, deploy, and manage cloud infrastructure using Python...">
    <meta property="og:site_name" content="Somaz Tech Blog">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/assets/img/icons/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/img/icons/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/img/icons/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/img/icons/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/img/icons/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/img/icons/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/img/icons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/icons/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/img/icons/apple-touch-icon-152x152.png" />

    <!-- Windows 8 Tile Icons -->
    <meta name="application-name" content="somaz">
    <meta name="msapplication-TileColor" content="#141414">
    <meta name="msapplication-square70x70logo" content="smalltile.png" />
    <meta name="msapplication-square150x150logo" content="mediumtile.png" />
    <meta name="msapplication-wide310x150logo" content="widetile.png" />
    <meta name="msapplication-square310x310logo" content="largetile.png" />
    
    <!-- Android Lolipop Theme Color -->
    <meta name="theme-color" content="#141414">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Titillium+Web:300,400,700" rel="stylesheet">

    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="canonical" href="https://somaz.blog/category/iac/pulumi/">
    <link rel="alternate" type="application/rss+xml" title="Somaz Tech Blog" href="https://somaz.blog/feed.xml" />

    <!-- Include extra styles -->
    

    <!-- JavaScript enabled/disabled -->
    <script>
        document.querySelector('html').classList.remove('no-js');
    </script>

    <!-- Google Adsense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8725590811736154"
        crossorigin="anonymous"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"> -->
    <!-- <link href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/variable/woff2/SUIT-Variable.css" rel="stylesheet"> -->
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- <link href="https://fonts.googleapis.com/css2?family=Albert+Sans:wght@400;500;700&display=swap" rel="stylesheet"> -->

    <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml" />

</head>
<!-- âœ… Google Tag Manager (noscript) -->
<noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MBP83N4Q"
            height="0" width="0" style="display:none;visibility:hidden">
    </iframe>
</noscript>
<!-- âœ… End Google Tag Manager (noscript) -->
    <body class="has-push-menu">
        





        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" display="none" version="1.1"><defs><symbol id="icon-menu" viewBox="0 0 1024 1024"><path class="path1" d="M128 213.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 725.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 469.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5z"/></symbol><symbol id="icon-search" viewBox="0 0 951 1024"><path class="path1" d="M658.286 475.429q0-105.714-75.143-180.857t-180.857-75.143-180.857 75.143-75.143 180.857 75.143 180.857 180.857 75.143 180.857-75.143 75.143-180.857zM950.857 950.857q0 29.714-21.714 51.429t-51.429 21.714q-30.857 0-51.429-21.714l-196-195.429q-102.286 70.857-228 70.857-81.714 0-156.286-31.714t-128.571-85.714-85.714-128.571-31.714-156.286 31.714-156.286 85.714-128.571 128.571-85.714 156.286-31.714 156.286 31.714 128.571 85.714 85.714 128.571 31.714 156.286q0 125.714-70.857 228l196 196q21.143 21.143 21.143 51.429z"/></symbol><symbol id="icon-close" viewBox="0 0 1000 1000"><path d="M969.8,870.3c27,27.7,27,71.8,0,99.1C955.7,983,937.9,990,920,990c-17.9,0-35.7-7-49.7-20.7L500,599L129.6,969.4C115.6,983,97.8,990,79.9,990s-35.7-7-49.7-20.7c-27-27.3-27-71.4,0-99.1L400.9,500L30.3,129.3c-27-27.3-27-71.4,0-99.1c27.3-27,71.8-27,99.4,0L500,400.9L870.4,30.2c27.7-27,71.8-27,99.4,0c27,27.7,27,71.8,0,99.1L599.1,500L969.8,870.3z"/></symbol><symbol id="icon-twitter" viewBox="0 0 951 1024"><path class="path1" d="M925.714 233.143q-38.286 56-92.571 95.429 0.571 8 0.571 24 0 74.286-21.714 148.286t-66 142-105.429 120.286-147.429 83.429-184.571 31.143q-154.857 0-283.429-82.857 20 2.286 44.571 2.286 128.571 0 229.143-78.857-60-1.143-107.429-36.857t-65.143-91.143q18.857 2.857 34.857 2.857 24.571 0 48.571-6.286-64-13.143-106-63.714t-42-117.429v-2.286q38.857 21.714 83.429 23.429-37.714-25.143-60-65.714t-22.286-88q0-50.286 25.143-93.143 69.143 85.143 168.286 136.286t212.286 56.857q-4.571-21.714-4.571-42.286 0-76.571 54-130.571t130.571-54q80 0 134.857 58.286 62.286-12 117.143-44.571-21.143 65.714-81.143 101.714 53.143-5.714 106.286-28.571z"/></symbol><symbol id="icon-facebook" viewBox="0 0 585 1024"><path class="path1" d="M548 6.857v150.857h-89.714q-49.143 0-66.286 20.571t-17.143 61.714v108h167.429l-22.286 169.143h-145.143v433.714h-174.857v-433.714h-145.714v-169.143h145.714v-124.571q0-106.286 59.429-164.857t158.286-58.571q84 0 130.286 6.857z"/></symbol><symbol id="icon-clock" viewBox="0 0 1000 1000"><path d="M500,10C229.8,10,10,229.8,10,500c0,270.2,219.8,490,490,490c270.2,0,490-219.8,490-490C990,229.8,770.2,10,500,10z M500,910.2c-226.2,0-410.2-184-410.2-410.2c0-226.2,184-410.2,410.2-410.2c226.2,0,410.2,184,410.2,410.2C910.2,726.1,726.2,910.2,500,910.2z M753.1,374c8.2,11.9,5.2,28.1-6.6,36.3L509.9,573.7c-4.4,3.1-9.6,4.6-14.8,4.6c-4.1,0-8.3-1-12.1-3c-8.6-4.5-14-13.4-14-23.1V202.5c0-14.4,11.7-26.1,26.1-26.1c14.4,0,26.1,11.7,26.1,26.1v300l195.6-135.1C728.7,359.2,744.9,362.1,753.1,374z"/></symbol><symbol id="icon-calendar" viewBox="0 0 1000 1000"><path d="M920,500v420H80V500H920 M990,430H10v490c0,38.7,31.3,70,70,70h840c38.7,0,70-31.3,70-70V430L990,430z"/><path d="M850,80v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80H360v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80C72.8,80,10,142.7,10,220v140h980V220C990,142.7,927.2,80,850,80z"/><path d="M255,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C290,25.8,274.3,10,255,10z"/><path d="M745,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C780,25.8,764.3,10,745,10z"/></symbol><symbol id="icon-github" viewBox="0 0 12 14"><path d="M6 1q1.633 0 3.012 0.805t2.184 2.184 0.805 3.012q0 1.961-1.145 3.527t-2.957 2.168q-0.211 0.039-0.312-0.055t-0.102-0.234q0-0.023 0.004-0.598t0.004-1.051q0-0.758-0.406-1.109 0.445-0.047 0.801-0.141t0.734-0.305 0.633-0.52 0.414-0.82 0.16-1.176q0-0.93-0.617-1.609 0.289-0.711-0.062-1.594-0.219-0.070-0.633 0.086t-0.719 0.344l-0.297 0.187q-0.727-0.203-1.5-0.203t-1.5 0.203q-0.125-0.086-0.332-0.211t-0.652-0.301-0.664-0.105q-0.352 0.883-0.062 1.594-0.617 0.68-0.617 1.609 0 0.664 0.16 1.172t0.41 0.82 0.629 0.523 0.734 0.305 0.801 0.141q-0.305 0.281-0.383 0.805-0.164 0.078-0.352 0.117t-0.445 0.039-0.512-0.168-0.434-0.488q-0.148-0.25-0.379-0.406t-0.387-0.187l-0.156-0.023q-0.164 0-0.227 0.035t-0.039 0.090 0.070 0.109 0.102 0.094l0.055 0.039q0.172 0.078 0.34 0.297t0.246 0.398l0.078 0.18q0.102 0.297 0.344 0.48t0.523 0.234 0.543 0.055 0.434-0.027l0.18-0.031q0 0.297 0.004 0.691t0.004 0.426q0 0.141-0.102 0.234t-0.312 0.055q-1.812-0.602-2.957-2.168t-1.145-3.527q0-1.633 0.805-3.012t2.184-2.184 3.012-0.805zM2.273 9.617q0.023-0.055-0.055-0.094-0.078-0.023-0.102 0.016-0.023 0.055 0.055 0.094 0.070 0.047 0.102-0.016zM2.516 9.883q0.055-0.039-0.016-0.125-0.078-0.070-0.125-0.023-0.055 0.039 0.016 0.125 0.078 0.078 0.125 0.023zM2.75 10.234q0.070-0.055 0-0.148-0.062-0.102-0.133-0.047-0.070 0.039 0 0.141t0.133 0.055zM3.078 10.562q0.062-0.062-0.031-0.148-0.094-0.094-0.156-0.023-0.070 0.062 0.031 0.148 0.094 0.094 0.156 0.023zM3.523 10.758q0.023-0.086-0.102-0.125-0.117-0.031-0.148 0.055t0.102 0.117q0.117 0.047 0.148-0.047zM4.016 10.797q0-0.102-0.133-0.086-0.125 0-0.125 0.086 0 0.102 0.133 0.086 0.125 0 0.125-0.086zM4.469 10.719q-0.016-0.086-0.141-0.070-0.125 0.023-0.109 0.117t0.141 0.062 0.109-0.109z"></path></symbol><symbol id="icon-medium" viewBox="0 0 1000 1000"><path d="M336.5,240.2v641.5c0,9.1-2.3,16.9-6.8,23.2s-11.2,9.6-20,9.6c-6.2,0-12.2-1.5-18-4.4L37.3,782.7c-7.7-3.6-14.1-9.8-19.4-18.3S10,747.4,10,739V115.5c0-7.3,1.8-13.5,5.5-18.6c3.6-5.1,8.9-7.7,15.9-7.7c5.1,0,13.1,2.7,24.1,8.2l279.5,140C335.9,238.6,336.5,239.5,336.5,240.2L336.5,240.2z M371.5,295.5l292,473.6l-292-145.5V295.5z M990,305.3v576.4c0,9.1-2.6,16.5-7.7,22.1c-5.1,5.7-12,8.5-20.8,8.5s-17.3-2.4-25.7-7.1L694.7,784.9L990,305.3z M988.4,239.7c0,1.1-46.8,77.6-140.3,229.4C754.6,621,699.8,709.8,683.8,735.7L470.5,389l177.2-288.2c6.2-10.2,15.7-15.3,28.4-15.3c5.1,0,9.8,1.1,14.2,3.3l295.9,147.7C987.6,237.1,988.4,238.2,988.4,239.7L988.4,239.7z"/></symbol><symbol id="icon-instagram" viewBox="0 0 489.84 489.84"><path d="M249.62,50.46c65.4,0,73.14.25,99,1.43C372.47,53,385.44,57,394.07,60.32a75.88,75.88,0,0,1,28.16,18.32,75.88,75.88,0,0,1,18.32,28.16c3.35,8.63,7.34,21.6,8.43,45.48,1.18,25.83,1.43,33.57,1.43,99s-0.25,73.14-1.43,99c-1.09,23.88-5.08,36.85-8.43,45.48a81.11,81.11,0,0,1-46.48,46.48c-8.63,3.35-21.6,7.34-45.48,8.43-25.82,1.18-33.57,1.43-99,1.43s-73.15-.25-99-1.43c-23.88-1.09-36.85-5.08-45.48-8.43A75.88,75.88,0,0,1,77,423.86,75.88,75.88,0,0,1,58.69,395.7c-3.35-8.63-7.34-21.6-8.43-45.48-1.18-25.83-1.43-33.57-1.43-99s0.25-73.14,1.43-99c1.09-23.88,5.08-36.85,8.43-45.48A75.88,75.88,0,0,1,77,78.64a75.88,75.88,0,0,1,28.16-18.32c8.63-3.35,21.6-7.34,45.48-8.43,25.83-1.18,33.57-1.43,99-1.43m0-44.13c-66.52,0-74.86.28-101,1.47s-43.87,5.33-59.45,11.38A120.06,120.06,0,0,0,45.81,47.44,120.06,120.06,0,0,0,17.56,90.82C11.5,106.4,7.36,124.2,6.17,150.27s-1.47,34.46-1.47,101,0.28,74.86,1.47,101,5.33,43.87,11.38,59.45a120.06,120.06,0,0,0,28.25,43.38,120.06,120.06,0,0,0,43.38,28.25c15.58,6.05,33.38,10.19,59.45,11.38s34.46,1.47,101,1.47,74.86-.28,101-1.47,43.87-5.33,59.45-11.38a125.24,125.24,0,0,0,71.63-71.63c6.05-15.58,10.19-33.38,11.38-59.45s1.47-34.46,1.47-101-0.28-74.86-1.47-101-5.33-43.87-11.38-59.45a120.06,120.06,0,0,0-28.25-43.38,120.06,120.06,0,0,0-43.38-28.25C394.47,13.13,376.67,9,350.6,7.8s-34.46-1.47-101-1.47h0Z" transform="translate(-4.7 -6.33)" /><path d="M249.62,125.48A125.77,125.77,0,1,0,375.39,251.25,125.77,125.77,0,0,0,249.62,125.48Zm0,207.41a81.64,81.64,0,1,1,81.64-81.64A81.64,81.64,0,0,1,249.62,332.89Z" transform="translate(-4.7 -6.33)"/><circle cx="375.66" cy="114.18" r="29.39" /></symbol><symbol id="icon-linkedin" viewBox="0 0 12 14"><path d="M2.727 4.883v7.742h-2.578v-7.742h2.578zM2.891 2.492q0.008 0.57-0.395 0.953t-1.059 0.383h-0.016q-0.641 0-1.031-0.383t-0.391-0.953q0-0.578 0.402-0.957t1.051-0.379 1.039 0.379 0.398 0.957zM12 8.187v4.437h-2.57v-4.141q0-0.82-0.316-1.285t-0.988-0.465q-0.492 0-0.824 0.27t-0.496 0.668q-0.086 0.234-0.086 0.633v4.32h-2.57q0.016-3.117 0.016-5.055t-0.008-2.313l-0.008-0.375h2.57v1.125h-0.016q0.156-0.25 0.32-0.438t0.441-0.406 0.68-0.34 0.895-0.121q1.336 0 2.148 0.887t0.813 2.598z"></path></symbol><symbol id="icon-heart" viewBox="0 0 34 30"><path d="M17,29.7 L16.4,29.2 C3.5,18.7 0,15 0,9 C0,4 4,0 9,0 C13.1,0 15.4,2.3 17,4.1 C18.6,2.3 20.9,0 25,0 C30,0 34,4 34,9 C34,15 30.5,18.7 17.6,29.2 L17,29.7 Z M9,2 C5.1,2 2,5.1 2,9 C2,14.1 5.2,17.5 17,27.1 C28.8,17.5 32,14.1 32,9 C32,5.1 28.9,2 25,2 C21.5,2 19.6,4.1 18.1,5.8 L17,7.1 L15.9,5.8 C14.4,4.1 12.5,2 9,2 Z" id="Shape"></path></symbol><symbol id="icon-arrow-right" viewBox="0 0 25.452 25.452"><path d="M4.471,24.929v-2.004l12.409-9.788c0.122-0.101,0.195-0.251,0.195-0.411c0-0.156-0.073-0.31-0.195-0.409L4.471,2.526V0.522c0-0.2,0.115-0.384,0.293-0.469c0.18-0.087,0.396-0.066,0.552,0.061l15.47,12.202c0.123,0.1,0.195,0.253,0.195,0.409c0,0.16-0.072,0.311-0.195,0.411L5.316,25.34c-0.155,0.125-0.372,0.147-0.552,0.061C4.586,25.315,4.471,25.13,4.471,24.929z"/></symbol><symbol id="icon-star" viewBox="0 0 48 48"><path fill="currentColor" d="M44,24c0,11.045-8.955,20-20,20S4,35.045,4,24S12.955,4,24,4S44,12.955,44,24z"/><path fill="#ffffff" d="M24,11l3.898,7.898l8.703,1.301l-6.301,6.102l1.5,8.699L24,30.898L16.199,35l1.5-8.699l-6.301-6.102  l8.703-1.301L24,11z"/></symbol><symbol id="icon-read" viewBox="0 0 32 32"><path fill="currentColor" d="M29,4H3C1.343,4,0,5.343,0,7v18c0,1.657,1.343,3,3,3h10c0,0.552,0.448,1,1,1h4c0.552,0,1-0.448,1-1h10  c1.657,0,3-1.343,3-3V7C32,5.343,30.657,4,29,4z M29,5v20H18.708c-0.618,0-1.236,0.146-1.789,0.422l-0.419,0.21V5H29z M15.5,5  v20.632l-0.419-0.21C14.528,25.146,13.91,25,13.292,25H3V5H15.5z M31,25c0,1.103-0.897,2-2,2H18v1h-4v-1H3c-1.103,0-2-0.897-2-2V7  c0-0.737,0.405-1.375,1-1.722V25c0,0.552,0.448,1,1,1h10.292c0.466,0,0.925,0.108,1.342,0.317l0.919,0.46  c0.141,0.07,0.294,0.106,0.447,0.106c0.153,0,0.306-0.035,0.447-0.106l0.919-0.46C17.783,26.108,18.242,26,18.708,26H29  c0.552,0,1-0.448,1-1V5.278C30.595,5.625,31,6.263,31,7V25z M6,12.5C6,12.224,6.224,12,6.5,12h5c0.276,0,0.5,0.224,0.5,0.5  S11.776,13,11.5,13h-5C6.224,13,6,12.776,6,12.5z M6,14.5C6,14.224,6.224,14,6.5,14h5c0.276,0,0.5,0.224,0.5,0.5S11.776,15,11.5,15  h-5C6.224,15,6,14.776,6,14.5z M6,16.5C6,16.224,6.224,16,6.5,16h5c0.276,0,0.5,0.224,0.5,0.5S11.776,17,11.5,17h-5  C6.224,17,6,16.776,6,16.5z M20,12.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,13,25.5,13h-5  C20.224,13,20,12.776,20,12.5z M20,14.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,15,25.5,15h-5  C20.224,15,20,14.776,20,14.5z M20,16.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,17,25.5,17h-5  C20.224,17,20,16.776,20,16.5z"></path></symbol><symbol id="icon-tistory" viewBox="0 0 24 24"><path d="M4 4h16v3h-6v13h-4V7H4V4z"/></symbol></defs></svg>

        <header class="bar-header">
    <a id="menu" role="button">
        <svg id="open" class="icon-menu"><use xlink:href="#icon-menu"></use></svg>
    </a>
    <h1 class="logo">
        <a href="/">
            
                somaz <span class="version">v3.1.2</span>
            
        </a>
    </h1>
    <a id="search" class="dosearch" role="button">
        <svg class="icon-search"><use xlink:href="#icon-search"></use></svg>
    </a>
    
        <a href="https://github.com/thiagorossener/jekflix-template" class="get-theme" role="button">
            Get this theme!
        </a>
    
</header>

<div id="mask" class="overlay"></div>

<aside class="sidebar" id="sidebar">
    <nav id="navigation">
      <h2>Menu</h2>
      <ul>
  
    
      <li>
        <a href="https://somaz.blog/">Home</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/about">About</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/category">Category</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/contact">Contact</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/feed.xml">Feed</a>
      </li>
    
  
</ul>

    </nav>
</aside>

<div class="search-wrapper">
    <div class="search-form">
        <input type="text" class="search-field" placeholder="Search">
        <svg class="icon-remove-sign"><use xlink:href="#icon-close"></use></svg>
        <ul class="search-results search-list"></ul>
    </div>
</div>



        <section class="post two-columns">
            <article role="article" class="post-content">
                <p class="post-info">
                    
                        <svg class="icon-calendar" id="date"><use xlink:href="#icon-calendar"></use></svg>
                        <time class="date" datetime="2025-11-30T00:00:00+00:00">
                            


November 30, 2025

                        </time>
                    
                    <svg id="clock" class="icon-clock"><use xlink:href="#icon-clock"></use></svg>
                    <span>64 min to read</span>
                </p>
                <h1 class="post-title">Pulumi: Modern Infrastructure as Code with Programming Languages</h1>
                <p class="post-subtitle">Build and manage cloud infrastructure using familiar programming languages with Pulumi's developer-first approach</p>

                
                    <img src="https://res.cloudinary.com/dkcm26aem/image/upload/v1755152827/pulumi-1_bmpstq.png" alt="Featured image" class="post-cover">
                

                <!-- Pagination links -->



                <!-- Add your table of contents here -->


                <p><br /></p>

<hr />

<h2 id="overview">Overview</h2>

<p><strong>Pulumi</strong> is a revolutionary <strong>Infrastructure as Code (IaC) platform</strong> that enables developers to <strong>define, deploy, and manage cloud infrastructure using familiar programming languages</strong> like Python, TypeScript, Go, and C#.</p>

<p>Unlike traditional IaC tools that require learning domain-specific languages, <strong>Pulumi leverages the power of general-purpose programming languages</strong>, providing developers with <strong>IDE support, debugging capabilities, testing frameworks, and package management</strong>.</p>

<p>This comprehensive guide explores <strong>Pulumiâ€™s architecture, installation procedures, state management strategies, and production implementation patterns</strong>. Weâ€™ll cover <strong>multi-cloud deployments, advanced configuration management, and enterprise-grade workflows</strong> that enable teams to <strong>scale infrastructure operations efficiently</strong>.</p>

<p><strong>Pulumi bridges the gap between infrastructure and application development</strong>, enabling <strong>true Infrastructure as Software</strong> where infrastructure can be <strong>version controlled, tested, and deployed using the same tools and practices</strong> used for application development.</p>

<p>With support for <strong>major cloud providers including AWS, Google Cloud Platform, Azure, and Kubernetes</strong>, Pulumi has become the <strong>preferred choice for developer-centric organizations</strong> seeking to <strong>modernize their infrastructure management practices</strong>.</p>

<p><br /></p>

<hr />

<h2 id="what-is-pulumi">What is Pulumi?</h2>

<p>Pulumi is a <strong>modern Infrastructure as Code platform</strong> that allows developers to <strong>build, deploy, and manage infrastructure using real programming languages</strong> instead of YAML or domain-specific configuration languages.</p>

<p><br /></p>

<h3 id="key-differentiators-from-traditional-iac">Key Differentiators from Traditional IaC:</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Traditional Terraform approach
</span><span class="n">resource</span> <span class="s">"aws_s3_bucket"</span> <span class="s">"example"</span> <span class="p">{</span>
  <span class="n">bucket</span> <span class="o">=</span> <span class="s">"my-bucket"</span>
  
  <span class="n">website</span> <span class="p">{</span>
    <span class="n">index_document</span> <span class="o">=</span> <span class="s">"index.html"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Pulumi approach with Python
</span><span class="kn">import</span> <span class="nn">pulumi</span>
<span class="kn">import</span> <span class="nn">pulumi_aws</span> <span class="k">as</span> <span class="n">aws</span>

<span class="n">bucket</span> <span class="o">=</span> <span class="n">aws</span><span class="p">.</span><span class="n">s3</span><span class="p">.</span><span class="n">Bucket</span><span class="p">(</span><span class="s">'my-bucket'</span><span class="p">,</span>
    <span class="n">website</span><span class="o">=</span><span class="n">aws</span><span class="p">.</span><span class="n">s3</span><span class="p">.</span><span class="n">BucketWebsiteArgs</span><span class="p">(</span>
        <span class="n">index_document</span><span class="o">=</span><span class="s">"index.html"</span>
    <span class="p">))</span>

<span class="n">pulumi</span><span class="p">.</span><span class="n">export</span><span class="p">(</span><span class="s">'bucket_url'</span><span class="p">,</span> <span class="n">bucket</span><span class="p">.</span><span class="n">bucket_domain_name</span><span class="p">)</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="architecture-and-core-concepts">Architecture and Core Concepts:</h3>

<h4 id="pulumi-engine-and-language-sdks">Pulumi Engine and Language SDKs:</h4>
<ul>
  <li><strong>Declarative Infrastructure</strong>: Write imperative code that compiles to declarative graphs</li>
  <li><strong>Idempotent Operations</strong>: Ensures consistent results across multiple deployments</li>
  <li><strong>Resource Graph</strong>: Automatic dependency resolution and parallel execution</li>
  <li><strong>State Management</strong>: Built-in state storage with encryption and backup capabilities</li>
</ul>

<h4 id="multi-language-support">Multi-Language Support:</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Available SDKs</span>
pulumi new aws-python          <span class="c"># Python</span>
pulumi new aws-typescript      <span class="c"># TypeScript/JavaScript</span>
pulumi new aws-go             <span class="c"># Go</span>
pulumi new aws-csharp         <span class="c"># C#/.NET</span>
pulumi new aws-java           <span class="c"># Java (Preview)</span>
pulumi new aws-yaml           <span class="c"># YAML (for simple cases)</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="pulumi-vs-terraform-comparison">Pulumi vs Terraform Comparison:</h3>

<table>
  <thead>
    <tr>
      <th>Feature</th>
      <th>Pulumi</th>
      <th>Terraform</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Language</strong></td>
      <td>Python, TypeScript, Go, C#, Java</td>
      <td>HCL (HashiCorp Configuration Language)</td>
    </tr>
    <tr>
      <td><strong>Approach</strong></td>
      <td>Imperative code â†’ Declarative execution</td>
      <td>Declarative configuration</td>
    </tr>
    <tr>
      <td><strong>IDE Support</strong></td>
      <td>Full IDE support, IntelliSense, debugging</td>
      <td>Limited syntax highlighting</td>
    </tr>
    <tr>
      <td><strong>Testing</strong></td>
      <td>Unit testing, property testing, integration testing</td>
      <td>Limited testing capabilities</td>
    </tr>
    <tr>
      <td><strong>Modularity</strong></td>
      <td>Native language packages and modules</td>
      <td>Terraform modules</td>
    </tr>
    <tr>
      <td><strong>State Management</strong></td>
      <td>Managed service or self-hosted backends</td>
      <td>Local or remote backends</td>
    </tr>
    <tr>
      <td><strong>Learning Curve</strong></td>
      <td>Familiar for developers</td>
      <td>Easier for ops teams</td>
    </tr>
  </tbody>
</table>

<p><br /></p>

<hr />

<h2 id="installation-and-environment-setup">Installation and Environment Setup</h2>

<p><br /></p>

<h3 id="1-system-requirements-and-prerequisites">1. System Requirements and Prerequisites</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Prerequisites</span>
- Python 3.7+ / Node.js 14+ / Go 1.17+ / .NET 6.0+
- Cloud provider CLI tools <span class="o">(</span>aws, gcloud, az<span class="o">)</span>
- Git <span class="k">for </span>version control
- Docker <span class="o">(</span>optional, <span class="k">for </span>containerized workflows<span class="o">)</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="2-pulumi-cli-installation">2. Pulumi CLI Installation</h3>

<h4 id="method-1-native-installation-recommended">Method 1: Native Installation (Recommended)</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Linux/macOS</span>
curl <span class="nt">-fsSL</span> https://get.pulumi.com | sh

<span class="c"># macOS with Homebrew</span>
brew <span class="nb">install </span>pulumi/tap/pulumi

<span class="c"># Windows with Chocolatey</span>
choco <span class="nb">install </span>pulumi

<span class="c"># Verify installation</span>
pulumi version
</code></pre></div></div>

<h4 id="method-2-package-managers">Method 2: Package Managers</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Ubuntu/Debian</span>
curl <span class="nt">-fsSL</span> https://get.pulumi.com | sh
<span class="nb">echo</span> <span class="s1">'export PATH=$PATH:$HOME/.pulumi/bin'</span> <span class="o">&gt;&gt;</span> ~/.bashrc
<span class="nb">source</span> ~/.bashrc

<span class="c"># Alpine Linux</span>
apk add pulumi

<span class="c"># Docker usage</span>
docker run <span class="nt">--rm</span> <span class="nt">-v</span> <span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span>:/pulumi <span class="nt">-w</span> /pulumi pulumi/pulumi:latest pulumi <span class="nt">--help</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="3-development-environment-configuration">3. Development Environment Configuration</h3>

<h4 id="python-environment-setup">Python Environment Setup:</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Install Python dependencies</span>
<span class="nb">sudo </span>apt-get update <span class="o">&amp;&amp;</span> <span class="nb">sudo </span>apt-get <span class="nb">install</span> <span class="nt">-y</span> <span class="se">\</span>
    python3 python3-pip python3-venv <span class="se">\</span>
    build-essential libssl-dev libffi-dev

<span class="c"># Set up pyenv for version management</span>
curl https://pyenv.run | bash
<span class="nb">echo</span> <span class="s1">'export PATH="$HOME/.pyenv/bin:$PATH"'</span> <span class="o">&gt;&gt;</span> ~/.bashrc
<span class="nb">echo</span> <span class="s1">'eval "$(pyenv init -)"'</span> <span class="o">&gt;&gt;</span> ~/.bashrc
<span class="nb">source</span> ~/.bashrc

<span class="c"># Install and configure Python</span>
pyenv <span class="nb">install </span>3.9.16
pyenv global 3.9.16

<span class="c"># Verify setup</span>
python3 <span class="nt">--version</span>
pip3 <span class="nt">--version</span>
</code></pre></div></div>

<h4 id="cloud-provider-authentication">Cloud Provider Authentication:</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># AWS Configuration</span>
aws configure <span class="nt">--profile</span> pulumi-dev
<span class="nb">export </span><span class="nv">AWS_PROFILE</span><span class="o">=</span>pulumi-dev
<span class="nb">export </span><span class="nv">AWS_REGION</span><span class="o">=</span>us-east-1

<span class="c"># Google Cloud Platform</span>
gcloud auth login
gcloud config <span class="nb">set </span>project your-project-id
<span class="nb">export </span><span class="nv">GOOGLE_PROJECT</span><span class="o">=</span>your-project-id
<span class="nb">export </span><span class="nv">GOOGLE_REGION</span><span class="o">=</span>us-central1

<span class="c"># Alternative: Service Account</span>
<span class="nb">export </span><span class="nv">GOOGLE_APPLICATION_CREDENTIALS</span><span class="o">=</span><span class="s2">"/path/to/service-account.json"</span>

<span class="c"># Azure</span>
az login
az account <span class="nb">set</span> <span class="nt">--subscription</span><span class="o">=</span><span class="s2">"your-subscription-id"</span>
</code></pre></div></div>

<p><br /></p>

<hr />

<h2 id="getting-started-with-pulumi">Getting Started with Pulumi</h2>

<p><br /></p>

<h3 id="1-project-initialization-and-structure">1. Project Initialization and Structure</h3>

<h4 id="creating-your-first-project">Creating Your First Project:</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Create new project directory</span>
<span class="nb">mkdir </span>pulumi-quickstart <span class="o">&amp;&amp;</span> <span class="nb">cd </span>pulumi-quickstart

<span class="c"># Initialize Pulumi project</span>
pulumi new gcp-python

<span class="c"># Project structure created</span>
â”œâ”€â”€ Pulumi.yaml          <span class="c"># Project metadata</span>
â”œâ”€â”€ Pulumi.dev.yaml      <span class="c"># Stack configuration</span>
â”œâ”€â”€ __main__.py          <span class="c"># Main program</span>
â”œâ”€â”€ requirements.txt     <span class="c"># Python dependencies</span>
â””â”€â”€ venv/               <span class="c"># Virtual environment</span>
</code></pre></div></div>

<h4 id="project-configuration-files">Project Configuration Files:</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Pulumi.yaml</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">pulumi-quickstart</span>
<span class="na">runtime</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">python</span>
  <span class="na">options</span><span class="pi">:</span>
    <span class="na">virtualenv</span><span class="pi">:</span> <span class="s">venv</span>
<span class="na">description</span><span class="pi">:</span> <span class="s">A minimal Google Cloud Python Pulumi program</span>
</code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Pulumi.dev.yaml</span>
<span class="na">config</span><span class="pi">:</span>
  <span class="s">gcp:project: your-project-id</span>
  <span class="s">gcp:region: us-central1</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="2-basic-resource-management">2. Basic Resource Management</h3>

<h4 id="simple-gcs-bucket-creation">Simple GCS Bucket Creation:</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># __main__.py
</span><span class="s">"""Google Cloud Python Pulumi program for basic resource management"""</span>

<span class="kn">import</span> <span class="nn">pulumi</span>
<span class="kn">import</span> <span class="nn">pulumi_gcp</span> <span class="k">as</span> <span class="n">gcp</span>

<span class="c1"># Create a GCS bucket with basic configuration
</span><span class="n">bucket</span> <span class="o">=</span> <span class="n">gcp</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="n">Bucket</span><span class="p">(</span><span class="s">'pulumi-quickstart-bucket'</span><span class="p">,</span>
    <span class="n">location</span><span class="o">=</span><span class="s">"US"</span><span class="p">,</span>
    <span class="n">uniform_bucket_level_access</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">versioning</span><span class="o">=</span><span class="n">gcp</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="n">BucketVersioningArgs</span><span class="p">(</span><span class="n">enabled</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>

<span class="c1"># Export bucket information
</span><span class="n">pulumi</span><span class="p">.</span><span class="n">export</span><span class="p">(</span><span class="s">'bucket_name'</span><span class="p">,</span> <span class="n">bucket</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="n">pulumi</span><span class="p">.</span><span class="n">export</span><span class="p">(</span><span class="s">'bucket_url'</span><span class="p">,</span> <span class="n">bucket</span><span class="p">.</span><span class="n">url</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="deploy-and-manage-resources">Deploy and Manage Resources:</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Install dependencies</span>
pip <span class="nb">install</span> <span class="nt">-r</span> requirements.txt

<span class="c"># Preview changes</span>
pulumi preview

<span class="c"># Deploy infrastructure</span>
pulumi up

<span class="c"># View stack outputs</span>
pulumi stack output

<span class="c"># Check deployment status</span>
pulumi stack

<span class="c"># Destroy resources when done</span>
pulumi destroy
</code></pre></div></div>

<p><br /></p>

<h3 id="3-advanced-resource-configuration">3. Advanced Resource Configuration</h3>

<h4 id="static-website-hosting-setup">Static Website Hosting Setup:</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">"""Advanced GCS bucket configuration for static website hosting"""</span>

<span class="kn">import</span> <span class="nn">pulumi</span>
<span class="kn">import</span> <span class="nn">pulumi_gcp</span> <span class="k">as</span> <span class="n">gcp</span>

<span class="c1"># Create bucket with custom configuration
</span><span class="n">bucket</span> <span class="o">=</span> <span class="n">gcp</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="n">Bucket</span><span class="p">(</span><span class="s">'static-website-bucket'</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s">"my-static-website"</span><span class="p">,</span>
    <span class="n">location</span><span class="o">=</span><span class="s">"asia-northeast3"</span><span class="p">,</span>
    <span class="n">website</span><span class="o">=</span><span class="n">gcp</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="n">BucketWebsiteArgs</span><span class="p">(</span>
        <span class="n">main_page_suffix</span><span class="o">=</span><span class="s">"index.html"</span><span class="p">,</span>
        <span class="n">not_found_page</span><span class="o">=</span><span class="s">"404.html"</span>
    <span class="p">),</span>
    <span class="n">uniform_bucket_level_access</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">force_destroy</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># Upload website content
</span><span class="n">index_html</span> <span class="o">=</span> <span class="n">gcp</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="n">BucketObject</span><span class="p">(</span>
    <span class="s">"index.html"</span><span class="p">,</span>
    <span class="n">bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
    <span class="n">source</span><span class="o">=</span><span class="n">pulumi</span><span class="p">.</span><span class="n">FileAsset</span><span class="p">(</span><span class="s">"index.html"</span><span class="p">),</span>
    <span class="n">content_type</span><span class="o">=</span><span class="s">"text/html"</span><span class="p">)</span>

<span class="c1"># Configure public access
</span><span class="n">bucket_iam_binding</span> <span class="o">=</span> <span class="n">gcp</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="n">BucketIAMBinding</span><span class="p">(</span>
    <span class="s">"public-read-binding"</span><span class="p">,</span>
    <span class="n">bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
    <span class="n">role</span><span class="o">=</span><span class="s">"roles/storage.objectViewer"</span><span class="p">,</span>
    <span class="n">members</span><span class="o">=</span><span class="p">[</span><span class="s">"allUsers"</span><span class="p">])</span>

<span class="c1"># Export website endpoint
</span><span class="n">pulumi</span><span class="p">.</span><span class="n">export</span><span class="p">(</span><span class="s">"bucket_name"</span><span class="p">,</span> <span class="n">bucket</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="n">pulumi</span><span class="p">.</span><span class="n">export</span><span class="p">(</span><span class="s">"website_url"</span><span class="p">,</span> <span class="n">pulumi</span><span class="p">.</span><span class="n">Output</span><span class="p">.</span><span class="n">concat</span><span class="p">(</span>
    <span class="s">"https://storage.googleapis.com/"</span><span class="p">,</span> <span class="n">bucket</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="s">"/"</span><span class="p">,</span> <span class="n">index_html</span><span class="p">.</span><span class="n">name</span><span class="p">))</span>
</code></pre></div></div>

<h4 id="html-content-example">HTML Content Example:</h4>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- index.html --&gt;</span>
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1.0"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>Pulumi Static Website<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;style&gt;</span>
        <span class="nt">body</span> <span class="p">{</span>
            <span class="nl">font-family</span><span class="p">:</span> <span class="n">Arial</span><span class="p">,</span> <span class="nb">sans-serif</span><span class="p">;</span>
            <span class="nl">max-width</span><span class="p">:</span> <span class="m">800px</span><span class="p">;</span>
            <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span> <span class="nb">auto</span><span class="p">;</span>
            <span class="nl">padding</span><span class="p">:</span> <span class="m">2rem</span><span class="p">;</span>
            <span class="nl">background</span><span class="p">:</span> <span class="n">linear-gradient</span><span class="p">(</span><span class="m">135deg</span><span class="p">,</span> <span class="m">#667eea</span> <span class="m">0%</span><span class="p">,</span> <span class="m">#764ba2</span> <span class="m">100%</span><span class="p">);</span>
            <span class="nl">color</span><span class="p">:</span> <span class="no">white</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nc">.container</span> <span class="p">{</span>
            <span class="nl">background</span><span class="p">:</span> <span class="n">rgba</span><span class="p">(</span><span class="m">255</span><span class="p">,</span> <span class="m">255</span><span class="p">,</span> <span class="m">255</span><span class="p">,</span> <span class="m">0.1</span><span class="p">);</span>
            <span class="nl">padding</span><span class="p">:</span> <span class="m">2rem</span><span class="p">;</span>
            <span class="nl">border-radius</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
            <span class="py">backdrop-filter</span><span class="p">:</span> <span class="n">blur</span><span class="p">(</span><span class="m">10px</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="nt">&lt;/style&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;h1&gt;</span>ðŸš€ Hello, Pulumi!<span class="nt">&lt;/h1&gt;</span>
        <span class="nt">&lt;p&gt;</span>This website was deployed using Pulumi Infrastructure as Code.<span class="nt">&lt;/p&gt;</span>
        <span class="nt">&lt;p&gt;</span>Powered by Google Cloud Storage and managed with Python.<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p><br /></p>

<hr />

<h2 id="state-management-and-backend-configuration">State Management and Backend Configuration</h2>

<p><br /></p>

<h3 id="1-understanding-pulumi-state">1. Understanding Pulumi State</h3>

<p>Pulumi uses <strong>stacks</strong> to manage infrastructure state, with each stack representing <strong>a separate deployment environment</strong> (development, staging, production). State includes <strong>all managed resources and their current properties</strong> in a serialized format.</p>

<h4 id="backend-storage-options">Backend Storage Options:</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Pulumi Service (Default - Managed)</span>
pulumi login

<span class="c"># Self-managed Object Storage</span>
pulumi login s3://my-pulumi-state-bucket
pulumi login gs://my-pulumi-state-bucket
pulumi login azblob://my-pulumi-state-container

<span class="c"># Local filesystem (Development only)</span>
pulumi login file://~/.pulumi-local
</code></pre></div></div>

<p><br /></p>

<h3 id="2-production-state-management-setup">2. Production State Management Setup</h3>

<h4 id="gcs-backend-configuration">GCS Backend Configuration:</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create dedicated state management bucket
</span><span class="s">"""State management infrastructure setup"""</span>

<span class="kn">import</span> <span class="nn">pulumi</span>
<span class="kn">import</span> <span class="nn">pulumi_gcp</span> <span class="k">as</span> <span class="n">gcp</span>

<span class="c1"># Create state storage bucket with versioning and encryption
</span><span class="n">state_bucket</span> <span class="o">=</span> <span class="n">gcp</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="n">Bucket</span><span class="p">(</span><span class="s">'pulumi-state-bucket'</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s">"pulumi-state-production"</span><span class="p">,</span>
    <span class="n">location</span><span class="o">=</span><span class="s">"us-central1"</span><span class="p">,</span>
    <span class="n">uniform_bucket_level_access</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">versioning</span><span class="o">=</span><span class="n">gcp</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="n">BucketVersioningArgs</span><span class="p">(</span><span class="n">enabled</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    <span class="n">encryption</span><span class="o">=</span><span class="n">gcp</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="n">BucketEncryptionArgs</span><span class="p">(</span>
        <span class="n">default_kms_key_name</span><span class="o">=</span><span class="s">"projects/PROJECT_ID/locations/LOCATION/keyRings/RING_NAME/cryptoKeys/KEY_NAME"</span>
    <span class="p">),</span>
    <span class="n">lifecycle_rules</span><span class="o">=</span><span class="p">[</span><span class="n">gcp</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="n">BucketLifecycleRuleArgs</span><span class="p">(</span>
        <span class="n">condition</span><span class="o">=</span><span class="n">gcp</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="n">BucketLifecycleRuleConditionArgs</span><span class="p">(</span>
            <span class="n">age</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
            <span class="n">with_state</span><span class="o">=</span><span class="s">"ARCHIVED"</span>
        <span class="p">),</span>
        <span class="n">action</span><span class="o">=</span><span class="n">gcp</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="n">BucketLifecycleRuleActionArgs</span><span class="p">(</span>
            <span class="nb">type</span><span class="o">=</span><span class="s">"Delete"</span>
        <span class="p">)</span>
    <span class="p">)])</span>

<span class="n">pulumi</span><span class="p">.</span><span class="n">export</span><span class="p">(</span><span class="s">'state_bucket_name'</span><span class="p">,</span> <span class="n">state_bucket</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="n">pulumi</span><span class="p">.</span><span class="n">export</span><span class="p">(</span><span class="s">'state_bucket_url'</span><span class="p">,</span> <span class="n">state_bucket</span><span class="p">.</span><span class="n">url</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="state-backend-migration">State Backend Migration:</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Deploy state bucket first</span>
pulumi up

<span class="c"># Export current state for backup</span>
pulumi stack <span class="nb">export</span> <span class="o">&gt;</span> state-backup.json

<span class="c"># Login to GCS backend</span>
pulumi login gs://pulumi-state-production

<span class="c"># Create new stack in GCS backend</span>
pulumi stack init production

<span class="c"># Import previous state</span>
pulumi stack import &lt; state-backup.json

<span class="c"># Verify migration</span>
pulumi preview

<span class="c"># Update backend URL for team</span>
<span class="nb">echo</span> <span class="s2">"Team members should run: pulumi login gs://pulumi-state-production"</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="3-multi-environment-state-management">3. Multi-Environment State Management</h3>

<h4 id="environment-specific-stack-configuration">Environment-Specific Stack Configuration:</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Initialize multiple stacks</span>
pulumi stack init development
pulumi stack init staging  
pulumi stack init production

<span class="c"># Configure environment-specific settings</span>
pulumi config <span class="nb">set </span>gcp:project dev-project-123 <span class="nt">--stack</span> development
pulumi config <span class="nb">set </span>gcp:region us-west1 <span class="nt">--stack</span> development

pulumi config <span class="nb">set </span>gcp:project staging-project-456 <span class="nt">--stack</span> staging
pulumi config <span class="nb">set </span>gcp:region us-central1 <span class="nt">--stack</span> staging

pulumi config <span class="nb">set </span>gcp:project prod-project-789 <span class="nt">--stack</span> production
pulumi config <span class="nb">set </span>gcp:region us-east1 <span class="nt">--stack</span> production

<span class="c"># Switch between stacks</span>
pulumi stack <span class="k">select </span>development
pulumi stack <span class="k">select </span>staging
pulumi stack <span class="k">select </span>production
</code></pre></div></div>

<h4 id="advanced-stack-management">Advanced Stack Management:</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">"""Multi-environment configuration with stack references"""</span>

<span class="kn">import</span> <span class="nn">pulumi</span>
<span class="kn">import</span> <span class="nn">pulumi_gcp</span> <span class="k">as</span> <span class="n">gcp</span>

<span class="c1"># Get current stack name
</span><span class="n">stack</span> <span class="o">=</span> <span class="n">pulumi</span><span class="p">.</span><span class="n">get_stack</span><span class="p">()</span>

<span class="c1"># Environment-specific configurations
</span><span class="n">config</span> <span class="o">=</span> <span class="n">pulumi</span><span class="p">.</span><span class="n">Config</span><span class="p">()</span>
<span class="n">project_id</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">require</span><span class="p">(</span><span class="s">"gcp:project"</span><span class="p">)</span>
<span class="n">region</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"gcp:region"</span><span class="p">)</span> <span class="ow">or</span> <span class="s">"us-central1"</span>

<span class="c1"># Environment-specific resource sizing
</span><span class="n">instance_types</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"development"</span><span class="p">:</span> <span class="s">"e2-micro"</span><span class="p">,</span>
    <span class="s">"staging"</span><span class="p">:</span> <span class="s">"e2-small"</span><span class="p">,</span> 
    <span class="s">"production"</span><span class="p">:</span> <span class="s">"e2-standard-2"</span>
<span class="p">}</span>

<span class="c1"># Create environment-specific resources
</span><span class="n">bucket</span> <span class="o">=</span> <span class="n">gcp</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="n">Bucket</span><span class="p">(</span><span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">stack</span><span class="si">}</span><span class="s">-app-bucket'</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s">-</span><span class="si">{</span><span class="n">stack</span><span class="si">}</span><span class="s">-bucket"</span><span class="p">,</span>
    <span class="n">location</span><span class="o">=</span><span class="n">region</span><span class="p">.</span><span class="n">upper</span><span class="p">(),</span>
    <span class="n">uniform_bucket_level_access</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">versioning</span><span class="o">=</span><span class="n">gcp</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="n">BucketVersioningArgs</span><span class="p">(</span><span class="n">enabled</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>

<span class="c1"># Reference resources from other stacks
</span><span class="k">if</span> <span class="n">stack</span> <span class="o">==</span> <span class="s">"production"</span><span class="p">:</span>
    <span class="c1"># Reference shared infrastructure stack
</span>    <span class="n">shared_stack</span> <span class="o">=</span> <span class="n">pulumi</span><span class="p">.</span><span class="n">StackReference</span><span class="p">(</span><span class="s">"organization/shared-infrastructure/production"</span><span class="p">)</span>
    <span class="n">vpc_id</span> <span class="o">=</span> <span class="n">shared_stack</span><span class="p">.</span><span class="n">get_output</span><span class="p">(</span><span class="s">"vpc_id"</span><span class="p">)</span>
    <span class="n">subnet_id</span> <span class="o">=</span> <span class="n">shared_stack</span><span class="p">.</span><span class="n">get_output</span><span class="p">(</span><span class="s">"subnet_id"</span><span class="p">)</span>

<span class="n">pulumi</span><span class="p">.</span><span class="n">export</span><span class="p">(</span><span class="s">'environment'</span><span class="p">,</span> <span class="n">stack</span><span class="p">)</span>
<span class="n">pulumi</span><span class="p">.</span><span class="n">export</span><span class="p">(</span><span class="s">'bucket_name'</span><span class="p">,</span> <span class="n">bucket</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></div>

<p><br /></p>

<hr />

<h2 id="infrastructure-deployment-patterns">Infrastructure Deployment Patterns</h2>

<p><br /></p>

<h3 id="1-vpc-and-networking-infrastructure">1. VPC and Networking Infrastructure</h3>

<h4 id="comprehensive-vpc-setup">Comprehensive VPC Setup:</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">"""Complete VPC and networking infrastructure"""</span>

<span class="kn">import</span> <span class="nn">pulumi</span>
<span class="kn">import</span> <span class="nn">pulumi_gcp</span> <span class="k">as</span> <span class="n">gcp</span>

<span class="c1"># Configuration
</span><span class="n">config</span> <span class="o">=</span> <span class="n">pulumi</span><span class="p">.</span><span class="n">Config</span><span class="p">()</span>
<span class="n">project_id</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">require</span><span class="p">(</span><span class="s">"gcp:project"</span><span class="p">)</span>
<span class="n">region</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"region"</span><span class="p">)</span> <span class="ow">or</span> <span class="s">"us-central1"</span>
<span class="n">zone</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">region</span><span class="si">}</span><span class="s">-a"</span>

<span class="c1"># Create VPC network
</span><span class="n">vpc</span> <span class="o">=</span> <span class="n">gcp</span><span class="p">.</span><span class="n">compute</span><span class="p">.</span><span class="n">Network</span><span class="p">(</span><span class="s">"main-vpc"</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s">-vpc"</span><span class="p">,</span>
    <span class="n">auto_create_subnetworks</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s">"Main VPC for application infrastructure"</span><span class="p">)</span>

<span class="c1"># Create subnet
</span><span class="n">subnet</span> <span class="o">=</span> <span class="n">gcp</span><span class="p">.</span><span class="n">compute</span><span class="p">.</span><span class="n">Subnetwork</span><span class="p">(</span><span class="s">"main-subnet"</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s">-subnet"</span><span class="p">,</span>
    <span class="n">ip_cidr_range</span><span class="o">=</span><span class="s">"10.0.1.0/24"</span><span class="p">,</span>
    <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span>
    <span class="n">network</span><span class="o">=</span><span class="n">vpc</span><span class="p">.</span><span class="nb">id</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s">"Main subnet for application servers"</span><span class="p">)</span>

<span class="c1"># Create Cloud Router for NAT
</span><span class="n">cloud_router</span> <span class="o">=</span> <span class="n">gcp</span><span class="p">.</span><span class="n">compute</span><span class="p">.</span><span class="n">Router</span><span class="p">(</span><span class="s">"main-router"</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s">-router"</span><span class="p">,</span>
    <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span>
    <span class="n">network</span><span class="o">=</span><span class="n">vpc</span><span class="p">.</span><span class="nb">id</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s">"Router for NAT gateway"</span><span class="p">)</span>

<span class="c1"># Create NAT Gateway
</span><span class="n">nat_gateway</span> <span class="o">=</span> <span class="n">gcp</span><span class="p">.</span><span class="n">compute</span><span class="p">.</span><span class="n">RouterNat</span><span class="p">(</span><span class="s">"main-nat"</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s">-nat"</span><span class="p">,</span>
    <span class="n">router</span><span class="o">=</span><span class="n">cloud_router</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
    <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span>
    <span class="n">nat_ip_allocate_option</span><span class="o">=</span><span class="s">"AUTO_ONLY"</span><span class="p">,</span>
    <span class="n">source_subnetwork_ip_ranges_to_nat</span><span class="o">=</span><span class="s">"ALL_SUBNETWORKS_ALL_IP_RANGES"</span><span class="p">)</span>

<span class="c1"># Create firewall rules
</span><span class="n">firewall_ssh</span> <span class="o">=</span> <span class="n">gcp</span><span class="p">.</span><span class="n">compute</span><span class="p">.</span><span class="n">Firewall</span><span class="p">(</span><span class="s">"allow-ssh"</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s">-allow-ssh"</span><span class="p">,</span>
    <span class="n">network</span><span class="o">=</span><span class="n">vpc</span><span class="p">.</span><span class="nb">id</span><span class="p">,</span>
    <span class="n">allows</span><span class="o">=</span><span class="p">[</span><span class="n">gcp</span><span class="p">.</span><span class="n">compute</span><span class="p">.</span><span class="n">FirewallAllowArgs</span><span class="p">(</span>
        <span class="n">protocol</span><span class="o">=</span><span class="s">"tcp"</span><span class="p">,</span>
        <span class="n">ports</span><span class="o">=</span><span class="p">[</span><span class="s">"22"</span><span class="p">]</span>
    <span class="p">)],</span>
    <span class="n">source_ranges</span><span class="o">=</span><span class="p">[</span><span class="s">"0.0.0.0/0"</span><span class="p">],</span>
    <span class="n">target_tags</span><span class="o">=</span><span class="p">[</span><span class="s">"ssh-allowed"</span><span class="p">])</span>

<span class="n">firewall_http</span> <span class="o">=</span> <span class="n">gcp</span><span class="p">.</span><span class="n">compute</span><span class="p">.</span><span class="n">Firewall</span><span class="p">(</span><span class="s">"allow-http"</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s">-allow-http"</span><span class="p">,</span> 
    <span class="n">network</span><span class="o">=</span><span class="n">vpc</span><span class="p">.</span><span class="nb">id</span><span class="p">,</span>
    <span class="n">allows</span><span class="o">=</span><span class="p">[</span><span class="n">gcp</span><span class="p">.</span><span class="n">compute</span><span class="p">.</span><span class="n">FirewallAllowArgs</span><span class="p">(</span>
        <span class="n">protocol</span><span class="o">=</span><span class="s">"tcp"</span><span class="p">,</span>
        <span class="n">ports</span><span class="o">=</span><span class="p">[</span><span class="s">"80"</span><span class="p">,</span> <span class="s">"443"</span><span class="p">]</span>
    <span class="p">)],</span>
    <span class="n">source_ranges</span><span class="o">=</span><span class="p">[</span><span class="s">"0.0.0.0/0"</span><span class="p">],</span>
    <span class="n">target_tags</span><span class="o">=</span><span class="p">[</span><span class="s">"http-allowed"</span><span class="p">])</span>

<span class="c1"># Export network information
</span><span class="n">pulumi</span><span class="p">.</span><span class="n">export</span><span class="p">(</span><span class="s">"vpc_id"</span><span class="p">,</span> <span class="n">vpc</span><span class="p">.</span><span class="nb">id</span><span class="p">)</span>
<span class="n">pulumi</span><span class="p">.</span><span class="n">export</span><span class="p">(</span><span class="s">"vpc_name"</span><span class="p">,</span> <span class="n">vpc</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="n">pulumi</span><span class="p">.</span><span class="n">export</span><span class="p">(</span><span class="s">"subnet_id"</span><span class="p">,</span> <span class="n">subnet</span><span class="p">.</span><span class="nb">id</span><span class="p">)</span>
<span class="n">pulumi</span><span class="p">.</span><span class="n">export</span><span class="p">(</span><span class="s">"subnet_name"</span><span class="p">,</span> <span class="n">subnet</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="2-compute-engine-deployment">2. Compute Engine Deployment</h3>

<h4 id="production-ready-compute-instance">Production-Ready Compute Instance:</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">"""Production Compute Engine instance with best practices"""</span>

<span class="kn">import</span> <span class="nn">pulumi</span>
<span class="kn">import</span> <span class="nn">pulumi_gcp</span> <span class="k">as</span> <span class="n">gcp</span>
<span class="kn">import</span> <span class="nn">base64</span>

<span class="c1"># Instance configuration
</span><span class="n">config</span> <span class="o">=</span> <span class="n">pulumi</span><span class="p">.</span><span class="n">Config</span><span class="p">()</span>
<span class="n">project_id</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">require</span><span class="p">(</span><span class="s">"gcp:project"</span><span class="p">)</span>
<span class="n">region</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"region"</span><span class="p">)</span> <span class="ow">or</span> <span class="s">"us-central1"</span>
<span class="n">zone</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">region</span><span class="si">}</span><span class="s">-a"</span>

<span class="c1"># Create static IP address
</span><span class="n">static_ip</span> <span class="o">=</span> <span class="n">gcp</span><span class="p">.</span><span class="n">compute</span><span class="p">.</span><span class="n">Address</span><span class="p">(</span><span class="s">"instance-ip"</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s">-instance-ip"</span><span class="p">,</span>
    <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s">"Static IP for main application server"</span><span class="p">)</span>

<span class="c1"># Startup script for instance initialization
</span><span class="n">startup_script</span> <span class="o">=</span> <span class="s">"""#!/bin/bash
apt-get update
apt-get install -y nginx docker.io
systemctl start nginx
systemctl enable nginx
systemctl start docker
systemctl enable docker

# Configure nginx
cat &gt; /var/www/html/index.html &lt;&lt; EOF
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Pulumi Deployed Server&lt;/title&gt;
    &lt;style&gt;
        body { font-family: Arial, sans-serif; margin: 40px; }
        .container { max-width: 800px; margin: 0 auto; }
        .status { color: #28a745; font-weight: bold; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="container"&gt;
        &lt;h1&gt;ðŸš€ Server Deployed with Pulumi&lt;/h1&gt;
        &lt;p class="status"&gt;âœ… Server is running successfully&lt;/p&gt;
        &lt;p&gt;Instance ID: $(curl -H "Metadata-Flavor: Google" http://metadata.google.internal/computeMetadata/v1/instance/id)&lt;/p&gt;
        &lt;p&gt;Zone: $(curl -H "Metadata-Flavor: Google" http://metadata.google.internal/computeMetadata/v1/instance/zone | cut -d/ -f4)&lt;/p&gt;
        &lt;p&gt;Deployed at: $(date)&lt;/p&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
EOF

systemctl restart nginx
"""</span>

<span class="c1"># Create service account for instance
</span><span class="n">service_account</span> <span class="o">=</span> <span class="n">gcp</span><span class="p">.</span><span class="n">serviceaccount</span><span class="p">.</span><span class="n">Account</span><span class="p">(</span><span class="s">"instance-sa"</span><span class="p">,</span>
    <span class="n">account_id</span><span class="o">=</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s">-instance-sa"</span><span class="p">,</span>
    <span class="n">display_name</span><span class="o">=</span><span class="s">"Compute Instance Service Account"</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s">"Service account for Pulumi-managed compute instances"</span><span class="p">)</span>

<span class="c1"># Create compute instance
</span><span class="n">instance</span> <span class="o">=</span> <span class="n">gcp</span><span class="p">.</span><span class="n">compute</span><span class="p">.</span><span class="n">Instance</span><span class="p">(</span><span class="s">"main-instance"</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s">-instance"</span><span class="p">,</span>
    <span class="n">machine_type</span><span class="o">=</span><span class="s">"e2-medium"</span><span class="p">,</span>
    <span class="n">zone</span><span class="o">=</span><span class="n">zone</span><span class="p">,</span>
    
    <span class="c1"># Boot disk configuration
</span>    <span class="n">boot_disk</span><span class="o">=</span><span class="n">gcp</span><span class="p">.</span><span class="n">compute</span><span class="p">.</span><span class="n">InstanceBootDiskArgs</span><span class="p">(</span>
        <span class="n">initialize_params</span><span class="o">=</span><span class="n">gcp</span><span class="p">.</span><span class="n">compute</span><span class="p">.</span><span class="n">InstanceBootDiskInitializeParamsArgs</span><span class="p">(</span>
            <span class="n">image</span><span class="o">=</span><span class="s">"ubuntu-os-cloud/ubuntu-2004-lts"</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="s">"pd-ssd"</span>
        <span class="p">)</span>
    <span class="p">),</span>
    
    <span class="c1"># Network configuration
</span>    <span class="n">network_interfaces</span><span class="o">=</span><span class="p">[</span><span class="n">gcp</span><span class="p">.</span><span class="n">compute</span><span class="p">.</span><span class="n">InstanceNetworkInterfaceArgs</span><span class="p">(</span>
        <span class="n">network</span><span class="o">=</span><span class="s">"projects/{}/global/networks/{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">project_id</span><span class="p">,</span> <span class="n">vpc</span><span class="p">.</span><span class="n">name</span><span class="p">),</span>
        <span class="n">subnetwork</span><span class="o">=</span><span class="s">"projects/{}/regions/{}/subnetworks/{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">project_id</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">subnet</span><span class="p">.</span><span class="n">name</span><span class="p">),</span>
        <span class="n">access_configs</span><span class="o">=</span><span class="p">[</span><span class="n">gcp</span><span class="p">.</span><span class="n">compute</span><span class="p">.</span><span class="n">InstanceNetworkInterfaceAccessConfigArgs</span><span class="p">(</span>
            <span class="n">nat_ip</span><span class="o">=</span><span class="n">static_ip</span><span class="p">.</span><span class="n">address</span>
        <span class="p">)]</span>
    <span class="p">)],</span>
    
    <span class="c1"># Service account and scopes
</span>    <span class="n">service_account</span><span class="o">=</span><span class="n">gcp</span><span class="p">.</span><span class="n">compute</span><span class="p">.</span><span class="n">InstanceServiceAccountArgs</span><span class="p">(</span>
        <span class="n">email</span><span class="o">=</span><span class="n">service_account</span><span class="p">.</span><span class="n">email</span><span class="p">,</span>
        <span class="n">scopes</span><span class="o">=</span><span class="p">[</span>
            <span class="s">"https://www.googleapis.com/auth/devstorage.read_only"</span><span class="p">,</span>
            <span class="s">"https://www.googleapis.com/auth/logging.write"</span><span class="p">,</span>
            <span class="s">"https://www.googleapis.com/auth/monitoring.write"</span>
        <span class="p">]</span>
    <span class="p">),</span>
    
    <span class="c1"># Instance metadata and startup script
</span>    <span class="n">metadata</span><span class="o">=</span><span class="p">{</span>
        <span class="s">"startup-script"</span><span class="p">:</span> <span class="n">startup_script</span><span class="p">,</span>
        <span class="s">"ssh-keys"</span><span class="p">:</span> <span class="sa">f</span><span class="s">"pulumi-user:</span><span class="si">{</span><span class="n">config</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'ssh_public_key'</span><span class="p">)</span> <span class="ow">or</span> <span class="s">'ssh-rsa AAAAB3NzaC1yc2E...'</span><span class="si">}</span><span class="s">"</span><span class="p">,</span>
        <span class="s">"enable-oslogin"</span><span class="p">:</span> <span class="s">"TRUE"</span>
    <span class="p">},</span>
    
    <span class="c1"># Security and management
</span>    <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s">"http-allowed"</span><span class="p">,</span> <span class="s">"ssh-allowed"</span><span class="p">],</span>
    <span class="n">allow_stopping_for_update</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    
    <span class="c1"># Resource labels
</span>    <span class="n">labels</span><span class="o">=</span><span class="p">{</span>
        <span class="s">"environment"</span><span class="p">:</span> <span class="n">pulumi</span><span class="p">.</span><span class="n">get_stack</span><span class="p">(),</span>
        <span class="s">"managed-by"</span><span class="p">:</span> <span class="s">"pulumi"</span><span class="p">,</span>
        <span class="s">"project"</span><span class="p">:</span> <span class="n">project_id</span>
    <span class="p">})</span>

<span class="c1"># Export instance information
</span><span class="n">pulumi</span><span class="p">.</span><span class="n">export</span><span class="p">(</span><span class="s">"instance_name"</span><span class="p">,</span> <span class="n">instance</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="n">pulumi</span><span class="p">.</span><span class="n">export</span><span class="p">(</span><span class="s">"instance_external_ip"</span><span class="p">,</span> <span class="n">static_ip</span><span class="p">.</span><span class="n">address</span><span class="p">)</span>
<span class="n">pulumi</span><span class="p">.</span><span class="n">export</span><span class="p">(</span><span class="s">"instance_internal_ip"</span><span class="p">,</span> <span class="n">instance</span><span class="p">.</span><span class="n">network_interfaces</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">network_ip</span><span class="p">)</span>
<span class="n">pulumi</span><span class="p">.</span><span class="n">export</span><span class="p">(</span><span class="s">"ssh_command"</span><span class="p">,</span> <span class="n">pulumi</span><span class="p">.</span><span class="n">Output</span><span class="p">.</span><span class="n">concat</span><span class="p">(</span>
    <span class="s">"ssh -i ~/.ssh/pulumi-key pulumi-user@"</span><span class="p">,</span> <span class="n">static_ip</span><span class="p">.</span><span class="n">address</span><span class="p">))</span>
<span class="n">pulumi</span><span class="p">.</span><span class="n">export</span><span class="p">(</span><span class="s">"web_url"</span><span class="p">,</span> <span class="n">pulumi</span><span class="p">.</span><span class="n">Output</span><span class="p">.</span><span class="n">concat</span><span class="p">(</span><span class="s">"http://"</span><span class="p">,</span> <span class="n">static_ip</span><span class="p">.</span><span class="n">address</span><span class="p">))</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="3-database-and-storage-services">3. Database and Storage Services</h3>

<h4 id="cloud-sql-and-storage-configuration">Cloud SQL and Storage Configuration:</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">"""Database and storage services setup"""</span>

<span class="kn">import</span> <span class="nn">pulumi</span>
<span class="kn">import</span> <span class="nn">pulumi_gcp</span> <span class="k">as</span> <span class="n">gcp</span>
<span class="kn">import</span> <span class="nn">pulumi_random</span> <span class="k">as</span> <span class="n">random</span>

<span class="c1"># Generate random password for database
</span><span class="n">db_password</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">RandomPassword</span><span class="p">(</span><span class="s">"db-password"</span><span class="p">,</span>
    <span class="n">length</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
    <span class="n">special</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># Create Cloud SQL instance
</span><span class="n">sql_instance</span> <span class="o">=</span> <span class="n">gcp</span><span class="p">.</span><span class="n">sql</span><span class="p">.</span><span class="n">DatabaseInstance</span><span class="p">(</span><span class="s">"main-db"</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s">-db-instance"</span><span class="p">,</span>
    <span class="n">database_version</span><span class="o">=</span><span class="s">"POSTGRES_13"</span><span class="p">,</span>
    <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span>
    
    <span class="n">settings</span><span class="o">=</span><span class="n">gcp</span><span class="p">.</span><span class="n">sql</span><span class="p">.</span><span class="n">DatabaseInstanceSettingsArgs</span><span class="p">(</span>
        <span class="n">tier</span><span class="o">=</span><span class="s">"db-f1-micro"</span><span class="p">,</span>  <span class="c1"># Use db-custom-1-3840 for production
</span>        
        <span class="c1"># Backup configuration
</span>        <span class="n">backup_configuration</span><span class="o">=</span><span class="n">gcp</span><span class="p">.</span><span class="n">sql</span><span class="p">.</span><span class="n">DatabaseInstanceSettingsBackupConfigurationArgs</span><span class="p">(</span>
            <span class="n">enabled</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">start_time</span><span class="o">=</span><span class="s">"03:00"</span><span class="p">,</span>
            <span class="n">point_in_time_recovery_enabled</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">backup_retention_settings</span><span class="o">=</span><span class="n">gcp</span><span class="p">.</span><span class="n">sql</span><span class="p">.</span><span class="n">DatabaseInstanceSettingsBackupConfigurationBackupRetentionSettingsArgs</span><span class="p">(</span>
                <span class="n">retained_backups</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
                <span class="n">retention_unit</span><span class="o">=</span><span class="s">"COUNT"</span>
            <span class="p">)</span>
        <span class="p">),</span>
        
        <span class="c1"># High availability
</span>        <span class="n">availability_type</span><span class="o">=</span><span class="s">"REGIONAL"</span> <span class="k">if</span> <span class="n">pulumi</span><span class="p">.</span><span class="n">get_stack</span><span class="p">()</span> <span class="o">==</span> <span class="s">"production"</span> <span class="k">else</span> <span class="s">"ZONAL"</span><span class="p">,</span>
        
        <span class="c1"># Security settings
</span>        <span class="n">ip_configuration</span><span class="o">=</span><span class="n">gcp</span><span class="p">.</span><span class="n">sql</span><span class="p">.</span><span class="n">DatabaseInstanceSettingsIpConfigurationArgs</span><span class="p">(</span>
            <span class="n">ipv4_enabled</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">require_ssl</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">authorized_networks</span><span class="o">=</span><span class="p">[</span><span class="n">gcp</span><span class="p">.</span><span class="n">sql</span><span class="p">.</span><span class="n">DatabaseInstanceSettingsIpConfigurationAuthorizedNetworkArgs</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s">"allow-all"</span><span class="p">,</span>  <span class="c1"># Restrict this in production
</span>                <span class="n">value</span><span class="o">=</span><span class="s">"0.0.0.0/0"</span>
            <span class="p">)]</span>
        <span class="p">),</span>
        
        <span class="c1"># Maintenance window
</span>        <span class="n">maintenance_window</span><span class="o">=</span><span class="n">gcp</span><span class="p">.</span><span class="n">sql</span><span class="p">.</span><span class="n">DatabaseInstanceSettingsMaintenanceWindowArgs</span><span class="p">(</span>
            <span class="n">day</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>  <span class="c1"># Sunday
</span>            <span class="n">hour</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>  <span class="c1"># 3 AM
</span>            <span class="n">update_track</span><span class="o">=</span><span class="s">"stable"</span>
        <span class="p">)</span>
    <span class="p">),</span>
    
    <span class="n">deletion_protection</span><span class="o">=</span><span class="n">pulumi</span><span class="p">.</span><span class="n">get_stack</span><span class="p">()</span> <span class="o">==</span> <span class="s">"production"</span><span class="p">)</span>

<span class="c1"># Create database
</span><span class="n">database</span> <span class="o">=</span> <span class="n">gcp</span><span class="p">.</span><span class="n">sql</span><span class="p">.</span><span class="n">Database</span><span class="p">(</span><span class="s">"app-database"</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s">"application_db"</span><span class="p">,</span>
    <span class="n">instance</span><span class="o">=</span><span class="n">sql_instance</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>

<span class="c1"># Create database user
</span><span class="n">db_user</span> <span class="o">=</span> <span class="n">gcp</span><span class="p">.</span><span class="n">sql</span><span class="p">.</span><span class="n">User</span><span class="p">(</span><span class="s">"app-user"</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s">"app_user"</span><span class="p">,</span>
    <span class="n">instance</span><span class="o">=</span><span class="n">sql_instance</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
    <span class="n">password</span><span class="o">=</span><span class="n">db_password</span><span class="p">.</span><span class="n">result</span><span class="p">)</span>

<span class="c1"># Application storage bucket
</span><span class="n">app_bucket</span> <span class="o">=</span> <span class="n">gcp</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="n">Bucket</span><span class="p">(</span><span class="s">"app-storage"</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s">-app-storage"</span><span class="p">,</span>
    <span class="n">location</span><span class="o">=</span><span class="n">region</span><span class="p">.</span><span class="n">upper</span><span class="p">(),</span>
    
    <span class="c1"># Storage class optimization
</span>    <span class="n">storage_class</span><span class="o">=</span><span class="s">"STANDARD"</span><span class="p">,</span>
    
    <span class="c1"># Lifecycle management
</span>    <span class="n">lifecycle_rules</span><span class="o">=</span><span class="p">[</span>
        <span class="n">gcp</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="n">BucketLifecycleRuleArgs</span><span class="p">(</span>
            <span class="n">condition</span><span class="o">=</span><span class="n">gcp</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="n">BucketLifecycleRuleConditionArgs</span><span class="p">(</span><span class="n">age</span><span class="o">=</span><span class="mi">30</span><span class="p">),</span>
            <span class="n">action</span><span class="o">=</span><span class="n">gcp</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="n">BucketLifecycleRuleActionArgs</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s">"SetStorageClass"</span><span class="p">,</span> <span class="n">storage_class</span><span class="o">=</span><span class="s">"NEARLINE"</span><span class="p">)</span>
        <span class="p">),</span>
        <span class="n">gcp</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="n">BucketLifecycleRuleArgs</span><span class="p">(</span>
            <span class="n">condition</span><span class="o">=</span><span class="n">gcp</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="n">BucketLifecycleRuleConditionArgs</span><span class="p">(</span><span class="n">age</span><span class="o">=</span><span class="mi">365</span><span class="p">),</span>
            <span class="n">action</span><span class="o">=</span><span class="n">gcp</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="n">BucketLifecycleRuleActionArgs</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s">"SetStorageClass"</span><span class="p">,</span> <span class="n">storage_class</span><span class="o">=</span><span class="s">"COLDLINE"</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">],</span>
    
    <span class="c1"># Versioning and retention
</span>    <span class="n">versioning</span><span class="o">=</span><span class="n">gcp</span><span class="p">.</span><span class="n">storage</span><span class="p">.</span><span class="n">BucketVersioningArgs</span><span class="p">(</span><span class="n">enabled</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    <span class="n">uniform_bucket_level_access</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># Export database and storage information
</span><span class="n">pulumi</span><span class="p">.</span><span class="n">export</span><span class="p">(</span><span class="s">"sql_instance_name"</span><span class="p">,</span> <span class="n">sql_instance</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="n">pulumi</span><span class="p">.</span><span class="n">export</span><span class="p">(</span><span class="s">"sql_connection_name"</span><span class="p">,</span> <span class="n">sql_instance</span><span class="p">.</span><span class="n">connection_name</span><span class="p">)</span>
<span class="n">pulumi</span><span class="p">.</span><span class="n">export</span><span class="p">(</span><span class="s">"database_name"</span><span class="p">,</span> <span class="n">database</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="n">pulumi</span><span class="p">.</span><span class="n">export</span><span class="p">(</span><span class="s">"storage_bucket"</span><span class="p">,</span> <span class="n">app_bucket</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></div>

<p><br /></p>

<hr />

<h2 id="production-workflows-and-best-practices">Production Workflows and Best Practices</h2>

<p><br /></p>

<h3 id="1-cicd-pipeline-integration">1. CI/CD Pipeline Integration</h3>

<h4 id="github-actions-workflow">GitHub Actions Workflow:</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># .github/workflows/pulumi.yml</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">Pulumi Infrastructure Deployment</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span> <span class="nv">main</span><span class="pi">,</span> <span class="nv">develop</span> <span class="pi">]</span>
  <span class="na">pull_request</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span> <span class="nv">main</span> <span class="pi">]</span>

<span class="na">env</span><span class="pi">:</span>
  <span class="na">PULUMI_ACCESS_TOKEN</span><span class="pi">:</span> <span class="s">$</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">preview</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">if</span><span class="pi">:</span> <span class="s">github.event_name == 'pull_request'</span>
    
    <span class="na">steps</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v3</span>
    
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Setup Python</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-python@v4</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">python-version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.9'</span>
        
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install dependencies</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">python -m pip install --upgrade pip</span>
        <span class="s">pip install -r requirements.txt</span>
        
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Setup Pulumi</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">pulumi/actions@v4</span>
      
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Configure GCP credentials</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">google-github-actions/setup-gcloud@v1</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">service_account_key</span><span class="pi">:</span> <span class="s">$</span>
        <span class="na">project_id</span><span class="pi">:</span> <span class="s">$</span>
        
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Pulumi Preview</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">pulumi stack select dev</span>
        <span class="s">pulumi preview --diff</span>
      <span class="na">env</span><span class="pi">:</span>
        <span class="na">GOOGLE_CREDENTIALS</span><span class="pi">:</span> <span class="s">$</span>

  <span class="na">deploy</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">if</span><span class="pi">:</span> <span class="s">github.ref == 'refs/heads/main'</span>
    
    <span class="na">steps</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v3</span>
    
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Setup Python</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-python@v4</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">python-version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.9'</span>
        
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install dependencies</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">python -m pip install --upgrade pip</span>
        <span class="s">pip install -r requirements.txt</span>
        
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Setup Pulumi</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">pulumi/actions@v4</span>
      
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Configure GCP credentials</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">google-github-actions/setup-gcloud@v1</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">service_account_key</span><span class="pi">:</span> <span class="s">$</span>
        <span class="na">project_id</span><span class="pi">:</span> <span class="s">$</span>
        
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Deploy to Production</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">pulumi stack select production</span>
        <span class="s">pulumi up --yes --skip-preview</span>
      <span class="na">env</span><span class="pi">:</span>
        <span class="na">GOOGLE_CREDENTIALS</span><span class="pi">:</span> <span class="s">$</span>
        
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Update Stack Tags</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">pulumi stack tag set deployment:commit $</span>
        <span class="s">pulumi stack tag set deployment:branch $</span>
        <span class="s">pulumi stack tag set deployment:timestamp $(date -u +"%Y-%m-%dT%H:%M:%SZ")</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="2-infrastructure-testing-and-validation">2. Infrastructure Testing and Validation</h3>

<h4 id="unit-testing-with-pulumi">Unit Testing with Pulumi:</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># tests/test_infrastructure.py
</span><span class="s">"""Unit tests for Pulumi infrastructure"""</span>

<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>
<span class="kn">import</span> <span class="nn">pulumi</span>

<span class="k">class</span> <span class="nc">InfrastructureTests</span><span class="p">(</span><span class="n">unittest</span><span class="p">.</span><span class="n">TestCase</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">test_bucket_has_versioning_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Test that storage buckets have versioning enabled"""</span>
        
        <span class="k">def</span> <span class="nf">check_bucket</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="n">bucket_args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">versioning</span> <span class="o">=</span> <span class="n">bucket_args</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'versioning'</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">versioning</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">versioning</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'enabled'</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        
        <span class="c1"># Mock Pulumi resource creation
</span>        <span class="n">pulumi</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">set_mocks</span><span class="p">({</span>
            <span class="s">'gcp:storage/bucket:Bucket'</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">args</span><span class="p">:</span> <span class="p">(</span>
                <span class="s">'bucket-id-123'</span><span class="p">,</span>
                <span class="p">{</span>
                    <span class="s">'name'</span><span class="p">:</span> <span class="s">'test-bucket'</span><span class="p">,</span>
                    <span class="s">'versioning'</span><span class="p">:</span> <span class="p">{</span><span class="s">'enabled'</span><span class="p">:</span> <span class="bp">True</span><span class="p">},</span>
                    <span class="s">'location'</span><span class="p">:</span> <span class="s">'US'</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="p">})</span>
        
        <span class="c1"># Import and test the infrastructure module
</span>        <span class="kn">import</span> <span class="nn">__main__</span> <span class="k">as</span> <span class="n">infrastructure</span>
        
        <span class="c1"># Verify bucket configuration
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">check_bucket</span><span class="p">([</span><span class="s">'test-bucket-args'</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">test_compute_instance_has_required_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Test that compute instances have required tags"""</span>
        
        <span class="n">required_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s">'environment'</span><span class="p">,</span> <span class="s">'managed-by'</span><span class="p">,</span> <span class="s">'project'</span><span class="p">]</span>
        
        <span class="k">def</span> <span class="nf">check_instance_tags</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="n">instance_args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="n">instance_args</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'labels'</span><span class="p">,</span> <span class="p">{})</span>
            <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">tag</span> <span class="ow">in</span> <span class="n">labels</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">required_tags</span><span class="p">)</span>
        
        <span class="c1"># Test instance configuration
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">check_instance_tags</span><span class="p">([{</span>
            <span class="s">'labels'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">'environment'</span><span class="p">:</span> <span class="s">'test'</span><span class="p">,</span>
                <span class="s">'managed-by'</span><span class="p">:</span> <span class="s">'pulumi'</span><span class="p">,</span>
                <span class="s">'project'</span><span class="p">:</span> <span class="s">'test-project'</span>
            <span class="p">}</span>
        <span class="p">}]))</span>

    <span class="k">def</span> <span class="nf">test_sql_instance_has_backup_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Test that SQL instances have backup enabled"""</span>
        
        <span class="k">def</span> <span class="nf">check_sql_backup</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="n">instance_args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">settings</span> <span class="o">=</span> <span class="n">instance_args</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'settings'</span><span class="p">,</span> <span class="p">{})</span>
            <span class="n">backup_config</span> <span class="o">=</span> <span class="n">settings</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'backup_configuration'</span><span class="p">,</span> <span class="p">{})</span>
            <span class="k">return</span> <span class="n">backup_config</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'enabled'</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        
        <span class="c1"># Test SQL configuration
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">check_sql_backup</span><span class="p">([{</span>
            <span class="s">'settings'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">'backup_configuration'</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s">'enabled'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                    <span class="s">'start_time'</span><span class="p">:</span> <span class="s">'03:00'</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}]))</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">unittest</span><span class="p">.</span><span class="n">main</span><span class="p">()</span>
</code></pre></div></div>

<h4 id="integration-testing-script">Integration Testing Script:</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># scripts/integration-test.sh</span>

<span class="nb">set</span> <span class="nt">-euo</span> pipefail

<span class="nb">echo</span> <span class="s2">"Starting Pulumi infrastructure integration tests..."</span>

<span class="c"># Test environment variables</span>
<span class="nb">export </span><span class="nv">PULUMI_STACK_NAME</span><span class="o">=</span><span class="s2">"integration-test-</span><span class="si">$(</span><span class="nb">date</span> +%s<span class="si">)</span><span class="s2">"</span>
<span class="nb">export </span><span class="nv">PULUMI_CONFIG_PASSPHRASE</span><span class="o">=</span><span class="s2">"test-passphrase"</span>

<span class="c"># Initialize test stack</span>
pulumi stack init <span class="s2">"</span><span class="nv">$PULUMI_STACK_NAME</span><span class="s2">"</span>

<span class="c"># Set test configuration</span>
pulumi config <span class="nb">set </span>gcp:project integration-test-project
pulumi config <span class="nb">set </span>gcp:region us-central1

<span class="c"># Deploy infrastructure</span>
<span class="nb">echo</span> <span class="s2">"Deploying test infrastructure..."</span>
pulumi up <span class="nt">--yes</span> <span class="nt">--skip-preview</span>

<span class="c"># Run tests against deployed infrastructure</span>
<span class="nb">echo</span> <span class="s2">"Running integration tests..."</span>

<span class="c"># Test 1: Verify bucket accessibility</span>
<span class="nv">BUCKET_NAME</span><span class="o">=</span><span class="si">$(</span>pulumi stack output bucket_name<span class="si">)</span>
<span class="k">if </span>gsutil <span class="nb">ls</span> <span class="s2">"gs://</span><span class="nv">$BUCKET_NAME</span><span class="s2">"</span> <span class="o">&gt;</span> /dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"âœ… Bucket accessibility test passed"</span>
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"âŒ Bucket accessibility test failed"</span>
    <span class="nb">exit </span>1
<span class="k">fi</span>

<span class="c"># Test 2: Verify compute instance connectivity</span>
<span class="nv">INSTANCE_IP</span><span class="o">=</span><span class="si">$(</span>pulumi stack output instance_external_ip<span class="si">)</span>
<span class="k">if </span>curl <span class="nt">-s</span> <span class="nt">--connect-timeout</span> 10 <span class="s2">"http://</span><span class="nv">$INSTANCE_IP</span><span class="s2">"</span> <span class="o">&gt;</span> /dev/null<span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"âœ… Instance connectivity test passed"</span>
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"âŒ Instance connectivity test failed"</span>
    <span class="nb">exit </span>1
<span class="k">fi</span>

<span class="c"># Test 3: Verify database connectivity</span>
<span class="nv">SQL_INSTANCE</span><span class="o">=</span><span class="si">$(</span>pulumi stack output sql_instance_name<span class="si">)</span>
<span class="k">if </span>gcloud sql instances describe <span class="s2">"</span><span class="nv">$SQL_INSTANCE</span><span class="s2">"</span> <span class="nt">--format</span><span class="o">=</span><span class="s2">"value(state)"</span> | <span class="nb">grep</span> <span class="nt">-q</span> <span class="s2">"RUNNABLE"</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"âœ… Database connectivity test passed"</span>
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"âŒ Database connectivity test failed"</span>
    <span class="nb">exit </span>1
<span class="k">fi</span>

<span class="c"># Cleanup test resources</span>
<span class="nb">echo</span> <span class="s2">"Cleaning up test infrastructure..."</span>
pulumi destroy <span class="nt">--yes</span> <span class="nt">--skip-preview</span>
pulumi stack <span class="nb">rm</span> <span class="nt">--yes</span>

<span class="nb">echo</span> <span class="s2">"âœ… All integration tests passed successfully!"</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="3-resource-state-management-and-recovery">3. Resource State Management and Recovery</h3>

<h4 id="state-recovery-procedures">State Recovery Procedures:</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># scripts/state-recovery.sh</span>

<span class="nb">set</span> <span class="nt">-euo</span> pipefail

<span class="nv">STACK_NAME</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">production</span><span class="k">}</span><span class="s2">"</span>
<span class="nv">BACKUP_DIR</span><span class="o">=</span><span class="s2">"./state-backups/</span><span class="si">$(</span><span class="nb">date</span> +%Y%m%d_%H%M%S<span class="si">)</span><span class="s2">"</span>

<span class="nb">echo</span> <span class="s2">"Performing state backup and recovery for stack: </span><span class="nv">$STACK_NAME</span><span class="s2">"</span>

<span class="c"># Create backup directory</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> <span class="s2">"</span><span class="nv">$BACKUP_DIR</span><span class="s2">"</span>

<span class="c"># Export current state</span>
pulumi stack <span class="k">select</span> <span class="s2">"</span><span class="nv">$STACK_NAME</span><span class="s2">"</span>
pulumi stack <span class="nb">export</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$BACKUP_DIR</span><span class="s2">/stack-state.json"</span>

<span class="c"># Export stack configuration</span>
pulumi config <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$BACKUP_DIR</span><span class="s2">/stack-config.txt"</span>

<span class="c"># Create stack metadata</span>
<span class="nb">cat</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$BACKUP_DIR</span><span class="s2">/metadata.json"</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
{
    "stack_name": "</span><span class="nv">$STACK_NAME</span><span class="sh">",
    "backup_timestamp": "</span><span class="si">$(</span><span class="nb">date</span> <span class="nt">-u</span> +%Y-%m-%dT%H:%M:%SZ<span class="si">)</span><span class="sh">",
    "pulumi_version": "</span><span class="si">$(</span>pulumi version<span class="si">)</span><span class="sh">",
    "git_commit": "</span><span class="si">$(</span>git rev-parse HEAD 2&gt;/dev/null <span class="o">||</span> <span class="nb">echo</span> <span class="s1">'unknown'</span><span class="si">)</span><span class="sh">",
    "git_branch": "</span><span class="si">$(</span>git branch <span class="nt">--show-current</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">echo</span> <span class="s1">'unknown'</span><span class="si">)</span><span class="sh">"
}
</span><span class="no">EOF

</span><span class="nb">echo</span> <span class="s2">"âœ… State backup completed: </span><span class="nv">$BACKUP_DIR</span><span class="s2">"</span>

<span class="c"># Validate state integrity</span>
<span class="k">if </span>pulumi stack <span class="nb">export</span> <span class="nt">--file</span> <span class="s2">"</span><span class="nv">$BACKUP_DIR</span><span class="s2">/validation-state.json"</span><span class="p">;</span> <span class="k">then
    if </span>diff <span class="s2">"</span><span class="nv">$BACKUP_DIR</span><span class="s2">/stack-state.json"</span> <span class="s2">"</span><span class="nv">$BACKUP_DIR</span><span class="s2">/validation-state.json"</span> <span class="o">&gt;</span> /dev/null<span class="p">;</span> <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"âœ… State backup integrity verified"</span>
        <span class="nb">rm</span> <span class="s2">"</span><span class="nv">$BACKUP_DIR</span><span class="s2">/validation-state.json"</span>
    <span class="k">else
        </span><span class="nb">echo</span> <span class="s2">"âŒ State backup integrity check failed"</span>
        <span class="nb">exit </span>1
    <span class="k">fi
fi</span>

<span class="c"># Compress backup</span>
<span class="nb">tar</span> <span class="nt">-czf</span> <span class="s2">"</span><span class="nv">$BACKUP_DIR</span><span class="s2">.tar.gz"</span> <span class="nt">-C</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">dirname</span> <span class="s2">"</span><span class="nv">$BACKUP_DIR</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">basename</span> <span class="s2">"</span><span class="nv">$BACKUP_DIR</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span>
<span class="nb">rm</span> <span class="nt">-rf</span> <span class="s2">"</span><span class="nv">$BACKUP_DIR</span><span class="s2">"</span>

<span class="nb">echo</span> <span class="s2">"âœ… Compressed backup created: </span><span class="nv">$BACKUP_DIR</span><span class="s2">.tar.gz"</span>
</code></pre></div></div>

<h4 id="resource-import-and-state-repair">Resource Import and State Repair:</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># scripts/resource-import.py
</span><span class="s">"""Script for importing existing resources into Pulumi state"""</span>

<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span>

<span class="k">def</span> <span class="nf">import_gcp_resources</span><span class="p">(</span><span class="n">project_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">region</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
    <span class="s">"""Import existing GCP resources into Pulumi state"""</span>
    
    <span class="c1"># Resource import mappings
</span>    <span class="n">import_mappings</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s">"resource_type"</span><span class="p">:</span> <span class="s">"gcp:compute/network:Network"</span><span class="p">,</span>
            <span class="s">"pulumi_name"</span><span class="p">:</span> <span class="s">"imported-vpc"</span><span class="p">,</span>
            <span class="s">"gcp_resource"</span><span class="p">:</span> <span class="sa">f</span><span class="s">"projects/</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s">/global/networks/default"</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s">"resource_type"</span><span class="p">:</span> <span class="s">"gcp:storage/bucket:Bucket"</span><span class="p">,</span> 
            <span class="s">"pulumi_name"</span><span class="p">:</span> <span class="s">"imported-bucket"</span><span class="p">,</span>
            <span class="s">"gcp_resource"</span><span class="p">:</span> <span class="sa">f</span><span class="s">"existing-bucket-name"</span>
        <span class="p">}</span>
    <span class="p">]</span>
    
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Importing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">import_mappings</span><span class="p">)</span><span class="si">}</span><span class="s"> resources..."</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">mapping</span> <span class="ow">in</span> <span class="n">import_mappings</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s">"pulumi"</span><span class="p">,</span> <span class="s">"import"</span><span class="p">,</span>
                <span class="n">mapping</span><span class="p">[</span><span class="s">"resource_type"</span><span class="p">],</span>
                <span class="n">mapping</span><span class="p">[</span><span class="s">"pulumi_name"</span><span class="p">],</span> 
                <span class="n">mapping</span><span class="p">[</span><span class="s">"gcp_resource"</span><span class="p">]</span>
            <span class="p">]</span>
            
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">result</span><span class="p">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"âœ… Successfully imported </span><span class="si">{</span><span class="n">mapping</span><span class="p">[</span><span class="s">'pulumi_name'</span><span class="p">]</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"âŒ Failed to import </span><span class="si">{</span><span class="n">mapping</span><span class="p">[</span><span class="s">'pulumi_name'</span><span class="p">]</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">result</span><span class="p">.</span><span class="n">stderr</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"âŒ Error importing </span><span class="si">{</span><span class="n">mapping</span><span class="p">[</span><span class="s">'pulumi_name'</span><span class="p">]</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">validate_imported_state</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="s">"""Validate that imported resources match expected state"""</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Run pulumi preview to check for drift
</span>        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span>
            <span class="p">[</span><span class="s">"pulumi"</span><span class="p">,</span> <span class="s">"preview"</span><span class="p">,</span> <span class="s">"--diff"</span><span class="p">,</span> <span class="s">"--json"</span><span class="p">],</span>
            <span class="n">capture_output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="bp">True</span>
        <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">result</span><span class="p">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">preview_data</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">stdout</span><span class="p">)</span>
            <span class="n">changes</span> <span class="o">=</span> <span class="n">preview_data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"changeSummary"</span><span class="p">,</span> <span class="p">{})</span>
            
            <span class="k">if</span> <span class="n">changes</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"create"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">changes</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"update"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">"âœ… No drift detected - import successful"</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"âš ï¸  Drift detected: </span><span class="si">{</span><span class="n">changes</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"âŒ Preview failed: </span><span class="si">{</span><span class="n">result</span><span class="p">.</span><span class="n">stderr</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
            
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"âŒ Validation error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Usage: python resource-import.py &lt;project_id&gt; &lt;region&gt;"</span><span class="p">)</span>
        <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">project_id</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">region</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    
    <span class="n">import_gcp_resources</span><span class="p">(</span><span class="n">project_id</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">validate_imported_state</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"ðŸŽ‰ Resource import completed successfully!"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"âš ï¸  Import completed with warnings - manual review required"</span><span class="p">)</span>
</code></pre></div></div>

<p><br /></p>

<hr />

<h2 id="advanced-configuration-and-patterns">Advanced Configuration and Patterns</h2>

<p><br /></p>

<h3 id="1-configuration-management-and-secrets">1. Configuration Management and Secrets</h3>

<h4 id="secure-configuration-handling">Secure Configuration Handling:</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># config/environments.py
</span><span class="s">"""Environment-specific configuration management"""</span>

<span class="kn">import</span> <span class="nn">pulumi</span>
<span class="kn">from</span> <span class="nn">pulumi</span> <span class="kn">import</span> <span class="n">Config</span><span class="p">,</span> <span class="n">get_stack</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>

<span class="k">class</span> <span class="nc">EnvironmentConfig</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">stack</span> <span class="o">=</span> <span class="n">get_stack</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">get_environment_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="s">"""Get environment-specific configuration"""</span>
        
        <span class="n">base_config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">"project_id"</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">require</span><span class="p">(</span><span class="s">"gcp:project"</span><span class="p">),</span>
            <span class="s">"region"</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"gcp:region"</span><span class="p">)</span> <span class="ow">or</span> <span class="s">"us-central1"</span><span class="p">,</span>
            <span class="s">"environment"</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">stack</span><span class="p">,</span>
            <span class="s">"common_tags"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">"environment"</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">stack</span><span class="p">,</span>
                <span class="s">"managed_by"</span><span class="p">:</span> <span class="s">"pulumi"</span><span class="p">,</span>
                <span class="s">"project"</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">require</span><span class="p">(</span><span class="s">"gcp:project"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
        <span class="c1"># Environment-specific overrides
</span>        <span class="n">env_configs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">"development"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">"instance_type"</span><span class="p">:</span> <span class="s">"e2-micro"</span><span class="p">,</span>
                <span class="s">"sql_tier"</span><span class="p">:</span> <span class="s">"db-f1-micro"</span><span class="p">,</span>
                <span class="s">"high_availability"</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s">"backup_retention"</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
                <span class="s">"deletion_protection"</span><span class="p">:</span> <span class="bp">False</span>
            <span class="p">},</span>
            <span class="s">"staging"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">"instance_type"</span><span class="p">:</span> <span class="s">"e2-small"</span><span class="p">,</span>
                <span class="s">"sql_tier"</span><span class="p">:</span> <span class="s">"db-g1-small"</span><span class="p">,</span> 
                <span class="s">"high_availability"</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s">"backup_retention"</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
                <span class="s">"deletion_protection"</span><span class="p">:</span> <span class="bp">False</span>
            <span class="p">},</span>
            <span class="s">"production"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">"instance_type"</span><span class="p">:</span> <span class="s">"e2-standard-2"</span><span class="p">,</span>
                <span class="s">"sql_tier"</span><span class="p">:</span> <span class="s">"db-n1-standard-1"</span><span class="p">,</span>
                <span class="s">"high_availability"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                <span class="s">"backup_retention"</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
                <span class="s">"deletion_protection"</span><span class="p">:</span> <span class="bp">True</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
        <span class="n">env_config</span> <span class="o">=</span> <span class="n">env_configs</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">stack</span><span class="p">,</span> <span class="n">env_configs</span><span class="p">[</span><span class="s">"development"</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">{</span><span class="o">**</span><span class="n">base_config</span><span class="p">,</span> <span class="o">**</span><span class="n">env_config</span><span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">get_secrets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="s">"""Get secret configuration values"""</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="s">"db_password"</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">require_secret</span><span class="p">(</span><span class="s">"database_password"</span><span class="p">),</span>
            <span class="s">"api_key"</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">require_secret</span><span class="p">(</span><span class="s">"api_key"</span><span class="p">),</span>
            <span class="s">"ssl_cert"</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">get_secret</span><span class="p">(</span><span class="s">"ssl_certificate"</span><span class="p">),</span>
            <span class="s">"ssl_key"</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">get_secret</span><span class="p">(</span><span class="s">"ssl_private_key"</span><span class="p">)</span>
        <span class="p">}</span>

<span class="c1"># Usage in main program
</span><span class="n">config_manager</span> <span class="o">=</span> <span class="n">EnvironmentConfig</span><span class="p">()</span>
<span class="n">env_config</span> <span class="o">=</span> <span class="n">config_manager</span><span class="p">.</span><span class="n">get_environment_config</span><span class="p">()</span>
<span class="n">secrets</span> <span class="o">=</span> <span class="n">config_manager</span><span class="p">.</span><span class="n">get_secrets</span><span class="p">()</span>
</code></pre></div></div>

<h4 id="secret-management-integration">Secret Management Integration:</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># scripts/setup-secrets.sh</span>

<span class="nb">set</span> <span class="nt">-euo</span> pipefail

<span class="nv">STACK_NAME</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">development</span><span class="k">}</span><span class="s2">"</span>
<span class="nv">SECRET_SOURCE</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">2</span><span class="k">:-</span><span class="nv">local</span><span class="k">}</span><span class="s2">"</span>  <span class="c"># local, gcp-secret-manager, vault</span>

<span class="nb">echo</span> <span class="s2">"Setting up secrets for stack: </span><span class="nv">$STACK_NAME</span><span class="s2">"</span>

pulumi stack <span class="k">select</span> <span class="s2">"</span><span class="nv">$STACK_NAME</span><span class="s2">"</span>

<span class="k">case</span> <span class="s2">"</span><span class="nv">$SECRET_SOURCE</span><span class="s2">"</span> <span class="k">in</span>
    <span class="s2">"local"</span><span class="p">)</span>
        <span class="c"># Set secrets from local environment</span>
        pulumi config <span class="nb">set</span> <span class="nt">--secret</span> database_password <span class="s2">"</span><span class="si">$(</span>openssl rand <span class="nt">-base64</span> 32<span class="si">)</span><span class="s2">"</span>
        pulumi config <span class="nb">set</span> <span class="nt">--secret</span> api_key <span class="s2">"</span><span class="si">$(</span>uuidgen<span class="si">)</span><span class="s2">"</span>
        <span class="p">;;</span>
        
    <span class="s2">"gcp-secret-manager"</span><span class="p">)</span>
        <span class="c"># Retrieve secrets from GCP Secret Manager</span>
        <span class="nv">PROJECT_ID</span><span class="o">=</span><span class="si">$(</span>pulumi config get gcp:project<span class="si">)</span>
        
        <span class="nv">DB_PASSWORD</span><span class="o">=</span><span class="si">$(</span>gcloud secrets versions access latest <span class="nt">--secret</span><span class="o">=</span><span class="s2">"database-password"</span> <span class="nt">--project</span><span class="o">=</span><span class="s2">"</span><span class="nv">$PROJECT_ID</span><span class="s2">"</span><span class="si">)</span>
        <span class="nv">API_KEY</span><span class="o">=</span><span class="si">$(</span>gcloud secrets versions access latest <span class="nt">--secret</span><span class="o">=</span><span class="s2">"api-key"</span> <span class="nt">--project</span><span class="o">=</span><span class="s2">"</span><span class="nv">$PROJECT_ID</span><span class="s2">"</span><span class="si">)</span>
        
        pulumi config <span class="nb">set</span> <span class="nt">--secret</span> database_password <span class="s2">"</span><span class="nv">$DB_PASSWORD</span><span class="s2">"</span>
        pulumi config <span class="nb">set</span> <span class="nt">--secret</span> api_key <span class="s2">"</span><span class="nv">$API_KEY</span><span class="s2">"</span>
        <span class="p">;;</span>
        
    <span class="s2">"vault"</span><span class="p">)</span>
        <span class="c"># Retrieve secrets from HashiCorp Vault</span>
        <span class="nb">export </span><span class="nv">VAULT_ADDR</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">VAULT_ADDR</span><span class="k">:-</span><span class="nv">https</span>://vault.company.com<span class="k">}</span><span class="s2">"</span>
        
        <span class="nv">DB_PASSWORD</span><span class="o">=</span><span class="si">$(</span>vault kv get <span class="nt">-field</span><span class="o">=</span>password secret/database<span class="si">)</span>
        <span class="nv">API_KEY</span><span class="o">=</span><span class="si">$(</span>vault kv get <span class="nt">-field</span><span class="o">=</span>key secret/api<span class="si">)</span>
        
        pulumi config <span class="nb">set</span> <span class="nt">--secret</span> database_password <span class="s2">"</span><span class="nv">$DB_PASSWORD</span><span class="s2">"</span>
        pulumi config <span class="nb">set</span> <span class="nt">--secret</span> api_key <span class="s2">"</span><span class="nv">$API_KEY</span><span class="s2">"</span>
        <span class="p">;;</span>
        
    <span class="k">*</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"Unknown secret source: </span><span class="nv">$SECRET_SOURCE</span><span class="s2">"</span>
        <span class="nb">echo</span> <span class="s2">"Supported sources: local, gcp-secret-manager, vault"</span>
        <span class="nb">exit </span>1
        <span class="p">;;</span>
<span class="k">esac</span>

<span class="nb">echo</span> <span class="s2">"âœ… Secrets configured for stack: </span><span class="nv">$STACK_NAME</span><span class="s2">"</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="2-modular-infrastructure-components">2. Modular Infrastructure Components</h3>

<h4 id="reusable-component-library">Reusable Component Library:</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># components/network.py
</span><span class="s">"""Reusable network infrastructure component"""</span>

<span class="kn">import</span> <span class="nn">pulumi</span>
<span class="kn">import</span> <span class="nn">pulumi_gcp</span> <span class="k">as</span> <span class="n">gcp</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>

<span class="k">class</span> <span class="nc">NetworkComponent</span><span class="p">(</span><span class="n">pulumi</span><span class="p">.</span><span class="n">ComponentResource</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                 <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">project_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">region</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">cidr_block</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">"10.0.0.0/16"</span><span class="p">,</span>
                 <span class="n">enable_nat</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                 <span class="n">firewall_rules</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                 <span class="n">opts</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pulumi</span><span class="p">.</span><span class="n">ResourceOptions</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        
        <span class="nb">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">(</span><span class="s">"custom:network:Network"</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="p">{},</span> <span class="n">opts</span><span class="p">)</span>
        
        <span class="c1"># Create VPC
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">vpc</span> <span class="o">=</span> <span class="n">gcp</span><span class="p">.</span><span class="n">compute</span><span class="p">.</span><span class="n">Network</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">-vpc"</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s">-</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">-vpc"</span><span class="p">,</span>
            <span class="n">auto_create_subnetworks</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">opts</span><span class="o">=</span><span class="n">pulumi</span><span class="p">.</span><span class="n">ResourceOptions</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">))</span>
        
        <span class="c1"># Create subnet
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">subnet</span> <span class="o">=</span> <span class="n">gcp</span><span class="p">.</span><span class="n">compute</span><span class="p">.</span><span class="n">Subnetwork</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">-subnet"</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s">-</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">-subnet"</span><span class="p">,</span>
            <span class="n">ip_cidr_range</span><span class="o">=</span><span class="n">cidr_block</span><span class="p">,</span>
            <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span>
            <span class="n">network</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">vpc</span><span class="p">.</span><span class="nb">id</span><span class="p">,</span>
            <span class="n">opts</span><span class="o">=</span><span class="n">pulumi</span><span class="p">.</span><span class="n">ResourceOptions</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">))</span>
        
        <span class="c1"># Create Cloud Router for NAT (if enabled)
</span>        <span class="k">if</span> <span class="n">enable_nat</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">router</span> <span class="o">=</span> <span class="n">gcp</span><span class="p">.</span><span class="n">compute</span><span class="p">.</span><span class="n">Router</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">-router"</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s">-</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">-router"</span><span class="p">,</span>
                <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span>
                <span class="n">network</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">vpc</span><span class="p">.</span><span class="nb">id</span><span class="p">,</span>
                <span class="n">opts</span><span class="o">=</span><span class="n">pulumi</span><span class="p">.</span><span class="n">ResourceOptions</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">))</span>
            
            <span class="bp">self</span><span class="p">.</span><span class="n">nat</span> <span class="o">=</span> <span class="n">gcp</span><span class="p">.</span><span class="n">compute</span><span class="p">.</span><span class="n">RouterNat</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">-nat"</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s">-</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">-nat"</span><span class="p">,</span>
                <span class="n">router</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">router</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span>
                <span class="n">nat_ip_allocate_option</span><span class="o">=</span><span class="s">"AUTO_ONLY"</span><span class="p">,</span>
                <span class="n">source_subnetwork_ip_ranges_to_nat</span><span class="o">=</span><span class="s">"ALL_SUBNETWORKS_ALL_IP_RANGES"</span><span class="p">,</span>
                <span class="n">opts</span><span class="o">=</span><span class="n">pulumi</span><span class="p">.</span><span class="n">ResourceOptions</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">))</span>
        
        <span class="c1"># Create firewall rules
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">firewall_rules</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">default_rules</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s">"name"</span><span class="p">:</span> <span class="s">"allow-internal"</span><span class="p">,</span>
                <span class="s">"allows"</span><span class="p">:</span> <span class="p">[{</span><span class="s">"protocol"</span><span class="p">:</span> <span class="s">"tcp"</span><span class="p">},</span> <span class="p">{</span><span class="s">"protocol"</span><span class="p">:</span> <span class="s">"udp"</span><span class="p">},</span> <span class="p">{</span><span class="s">"protocol"</span><span class="p">:</span> <span class="s">"icmp"</span><span class="p">}],</span>
                <span class="s">"source_ranges"</span><span class="p">:</span> <span class="p">[</span><span class="n">cidr_block</span><span class="p">],</span>
                <span class="s">"description"</span><span class="p">:</span> <span class="s">"Allow internal communication"</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s">"name"</span><span class="p">:</span> <span class="s">"allow-ssh"</span><span class="p">,</span>
                <span class="s">"allows"</span><span class="p">:</span> <span class="p">[{</span><span class="s">"protocol"</span><span class="p">:</span> <span class="s">"tcp"</span><span class="p">,</span> <span class="s">"ports"</span><span class="p">:</span> <span class="p">[</span><span class="s">"22"</span><span class="p">]}],</span>
                <span class="s">"source_ranges"</span><span class="p">:</span> <span class="p">[</span><span class="s">"0.0.0.0/0"</span><span class="p">],</span>
                <span class="s">"target_tags"</span><span class="p">:</span> <span class="p">[</span><span class="s">"ssh-allowed"</span><span class="p">],</span>
                <span class="s">"description"</span><span class="p">:</span> <span class="s">"Allow SSH access"</span>
            <span class="p">}</span>
        <span class="p">]</span>
        
        <span class="n">rules</span> <span class="o">=</span> <span class="n">firewall_rules</span> <span class="ow">or</span> <span class="n">default_rules</span>
        
        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
            <span class="n">firewall</span> <span class="o">=</span> <span class="n">gcp</span><span class="p">.</span><span class="n">compute</span><span class="p">.</span><span class="n">Firewall</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">-</span><span class="si">{</span><span class="n">rule</span><span class="p">[</span><span class="s">'name'</span><span class="p">]</span><span class="si">}</span><span class="s">"</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s">-</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">-</span><span class="si">{</span><span class="n">rule</span><span class="p">[</span><span class="s">'name'</span><span class="p">]</span><span class="si">}</span><span class="s">"</span><span class="p">,</span>
                <span class="n">network</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">vpc</span><span class="p">.</span><span class="nb">id</span><span class="p">,</span>
                <span class="n">allows</span><span class="o">=</span><span class="p">[</span><span class="n">gcp</span><span class="p">.</span><span class="n">compute</span><span class="p">.</span><span class="n">FirewallAllowArgs</span><span class="p">(</span><span class="o">**</span><span class="n">allow</span><span class="p">)</span> <span class="k">for</span> <span class="n">allow</span> <span class="ow">in</span> <span class="n">rule</span><span class="p">[</span><span class="s">"allows"</span><span class="p">]],</span>
                <span class="n">source_ranges</span><span class="o">=</span><span class="n">rule</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"source_ranges"</span><span class="p">,</span> <span class="p">[]),</span>
                <span class="n">target_tags</span><span class="o">=</span><span class="n">rule</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"target_tags"</span><span class="p">,</span> <span class="p">[]),</span>
                <span class="n">description</span><span class="o">=</span><span class="n">rule</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"description"</span><span class="p">,</span> <span class="s">""</span><span class="p">),</span>
                <span class="n">opts</span><span class="o">=</span><span class="n">pulumi</span><span class="p">.</span><span class="n">ResourceOptions</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">))</span>
            
            <span class="bp">self</span><span class="p">.</span><span class="n">firewall_rules</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">firewall</span><span class="p">)</span>
        
        <span class="c1"># Register outputs
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">register_outputs</span><span class="p">({</span>
            <span class="s">"vpc_id"</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">vpc</span><span class="p">.</span><span class="nb">id</span><span class="p">,</span>
            <span class="s">"vpc_name"</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">vpc</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s">"subnet_id"</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">subnet</span><span class="p">.</span><span class="nb">id</span><span class="p">,</span>
            <span class="s">"subnet_name"</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">subnet</span><span class="p">.</span><span class="n">name</span>
        <span class="p">})</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># components/compute.py
</span><span class="s">"""Reusable compute infrastructure component"""</span>

<span class="kn">import</span> <span class="nn">pulumi</span>
<span class="kn">import</span> <span class="nn">pulumi_gcp</span> <span class="k">as</span> <span class="n">gcp</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>

<span class="k">class</span> <span class="nc">ComputeComponent</span><span class="p">(</span><span class="n">pulumi</span><span class="p">.</span><span class="n">ComponentResource</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">project_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">zone</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">vpc_network</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">subnet_network</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">machine_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">"e2-medium"</span><span class="p">,</span>
                 <span class="n">image</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">"ubuntu-os-cloud/ubuntu-2004-lts"</span><span class="p">,</span>
                 <span class="n">startup_script</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                 <span class="n">ssh_keys</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                 <span class="n">tags</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                 <span class="n">opts</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pulumi</span><span class="p">.</span><span class="n">ResourceOptions</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        
        <span class="nb">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">(</span><span class="s">"custom:compute:Instance"</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="p">{},</span> <span class="n">opts</span><span class="p">)</span>
        
        <span class="c1"># Create static IP
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">static_ip</span> <span class="o">=</span> <span class="n">gcp</span><span class="p">.</span><span class="n">compute</span><span class="p">.</span><span class="n">Address</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">-ip"</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s">-</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">-ip"</span><span class="p">,</span>
            <span class="n">region</span><span class="o">=</span><span class="n">zone</span><span class="p">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s">'-'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">opts</span><span class="o">=</span><span class="n">pulumi</span><span class="p">.</span><span class="n">ResourceOptions</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">))</span>
        
        <span class="c1"># Create service account
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">service_account</span> <span class="o">=</span> <span class="n">gcp</span><span class="p">.</span><span class="n">serviceaccount</span><span class="p">.</span><span class="n">Account</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">-sa"</span><span class="p">,</span>
            <span class="n">account_id</span><span class="o">=</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s">-</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">-sa"</span><span class="p">,</span>
            <span class="n">display_name</span><span class="o">=</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s"> Service Account"</span><span class="p">,</span>
            <span class="n">opts</span><span class="o">=</span><span class="n">pulumi</span><span class="p">.</span><span class="n">ResourceOptions</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">))</span>
        
        <span class="c1"># Default startup script if none provided
</span>        <span class="n">default_startup_script</span> <span class="o">=</span> <span class="s">"""#!/bin/bash
        apt-get update
        apt-get install -y nginx
        systemctl start nginx
        systemctl enable nginx
        """</span>
        
        <span class="c1"># Prepare metadata
</span>        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">"startup-script"</span><span class="p">:</span> <span class="n">startup_script</span> <span class="ow">or</span> <span class="n">default_startup_script</span><span class="p">,</span>
            <span class="s">"enable-oslogin"</span><span class="p">:</span> <span class="s">"TRUE"</span>
        <span class="p">}</span>
        
        <span class="k">if</span> <span class="n">ssh_keys</span><span class="p">:</span>
            <span class="n">metadata</span><span class="p">[</span><span class="s">"ssh-keys"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">ssh_keys</span><span class="p">)</span>
        
        <span class="c1"># Create compute instance
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">instance</span> <span class="o">=</span> <span class="n">gcp</span><span class="p">.</span><span class="n">compute</span><span class="p">.</span><span class="n">Instance</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">-instance"</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s">-</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">-instance"</span><span class="p">,</span>
            <span class="n">machine_type</span><span class="o">=</span><span class="n">machine_type</span><span class="p">,</span>
            <span class="n">zone</span><span class="o">=</span><span class="n">zone</span><span class="p">,</span>
            
            <span class="n">boot_disk</span><span class="o">=</span><span class="n">gcp</span><span class="p">.</span><span class="n">compute</span><span class="p">.</span><span class="n">InstanceBootDiskArgs</span><span class="p">(</span>
                <span class="n">initialize_params</span><span class="o">=</span><span class="n">gcp</span><span class="p">.</span><span class="n">compute</span><span class="p">.</span><span class="n">InstanceBootDiskInitializeParamsArgs</span><span class="p">(</span>
                    <span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
                    <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="s">"pd-ssd"</span>
                <span class="p">)</span>
            <span class="p">),</span>
            
            <span class="n">network_interfaces</span><span class="o">=</span><span class="p">[</span><span class="n">gcp</span><span class="p">.</span><span class="n">compute</span><span class="p">.</span><span class="n">InstanceNetworkInterfaceArgs</span><span class="p">(</span>
                <span class="n">network</span><span class="o">=</span><span class="n">vpc_network</span><span class="p">,</span>
                <span class="n">subnetwork</span><span class="o">=</span><span class="n">subnet_network</span><span class="p">,</span>
                <span class="n">access_configs</span><span class="o">=</span><span class="p">[</span><span class="n">gcp</span><span class="p">.</span><span class="n">compute</span><span class="p">.</span><span class="n">InstanceNetworkInterfaceAccessConfigArgs</span><span class="p">(</span>
                    <span class="n">nat_ip</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">static_ip</span><span class="p">.</span><span class="n">address</span>
                <span class="p">)]</span>
            <span class="p">)],</span>
            
            <span class="n">service_account</span><span class="o">=</span><span class="n">gcp</span><span class="p">.</span><span class="n">compute</span><span class="p">.</span><span class="n">InstanceServiceAccountArgs</span><span class="p">(</span>
                <span class="n">email</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">service_account</span><span class="p">.</span><span class="n">email</span><span class="p">,</span>
                <span class="n">scopes</span><span class="o">=</span><span class="p">[</span>
                    <span class="s">"https://www.googleapis.com/auth/devstorage.read_only"</span><span class="p">,</span>
                    <span class="s">"https://www.googleapis.com/auth/logging.write"</span><span class="p">,</span>
                    <span class="s">"https://www.googleapis.com/auth/monitoring.write"</span>
                <span class="p">]</span>
            <span class="p">),</span>
            
            <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
            <span class="n">tags</span><span class="o">=</span><span class="n">tags</span> <span class="ow">or</span> <span class="p">[],</span>
            <span class="n">allow_stopping_for_update</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            
            <span class="n">labels</span><span class="o">=</span><span class="p">{</span>
                <span class="s">"managed-by"</span><span class="p">:</span> <span class="s">"pulumi"</span><span class="p">,</span>
                <span class="s">"component"</span><span class="p">:</span> <span class="n">name</span>
            <span class="p">},</span>
            
            <span class="n">opts</span><span class="o">=</span><span class="n">pulumi</span><span class="p">.</span><span class="n">ResourceOptions</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">))</span>
        
        <span class="c1"># Register outputs
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">register_outputs</span><span class="p">({</span>
            <span class="s">"instance_id"</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">instance</span><span class="p">.</span><span class="nb">id</span><span class="p">,</span>
            <span class="s">"instance_name"</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">instance</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s">"external_ip"</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">static_ip</span><span class="p">.</span><span class="n">address</span><span class="p">,</span>
            <span class="s">"internal_ip"</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">instance</span><span class="p">.</span><span class="n">network_interfaces</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">network_ip</span>
        <span class="p">})</span>
</code></pre></div></div>

<h4 id="component-usage-example">Component Usage Example:</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># __main__.py - Using reusable components
</span><span class="s">"""Infrastructure deployment using reusable components"""</span>

<span class="kn">import</span> <span class="nn">pulumi</span>
<span class="kn">from</span> <span class="nn">components.network</span> <span class="kn">import</span> <span class="n">NetworkComponent</span>
<span class="kn">from</span> <span class="nn">components.compute</span> <span class="kn">import</span> <span class="n">ComputeComponent</span>
<span class="kn">from</span> <span class="nn">config.environments</span> <span class="kn">import</span> <span class="n">EnvironmentConfig</span>

<span class="c1"># Load configuration
</span><span class="n">config_manager</span> <span class="o">=</span> <span class="n">EnvironmentConfig</span><span class="p">()</span>
<span class="n">env_config</span> <span class="o">=</span> <span class="n">config_manager</span><span class="p">.</span><span class="n">get_environment_config</span><span class="p">()</span>

<span class="c1"># Create network infrastructure
</span><span class="n">network</span> <span class="o">=</span> <span class="n">NetworkComponent</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s">"main"</span><span class="p">,</span>
    <span class="n">project_id</span><span class="o">=</span><span class="n">env_config</span><span class="p">[</span><span class="s">"project_id"</span><span class="p">],</span>
    <span class="n">region</span><span class="o">=</span><span class="n">env_config</span><span class="p">[</span><span class="s">"region"</span><span class="p">],</span>
    <span class="n">cidr_block</span><span class="o">=</span><span class="s">"10.0.0.0/16"</span><span class="p">,</span>
    <span class="n">enable_nat</span><span class="o">=</span><span class="bp">True</span>
<span class="p">)</span>

<span class="c1"># Create compute infrastructure
</span><span class="n">web_server</span> <span class="o">=</span> <span class="n">ComputeComponent</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s">"web"</span><span class="p">,</span>
    <span class="n">project_id</span><span class="o">=</span><span class="n">env_config</span><span class="p">[</span><span class="s">"project_id"</span><span class="p">],</span>
    <span class="n">zone</span><span class="o">=</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">env_config</span><span class="p">[</span><span class="s">'region'</span><span class="p">]</span><span class="si">}</span><span class="s">-a"</span><span class="p">,</span>
    <span class="n">vpc_network</span><span class="o">=</span><span class="n">network</span><span class="p">.</span><span class="n">vpc</span><span class="p">.</span><span class="n">self_link</span><span class="p">,</span>
    <span class="n">subnet_network</span><span class="o">=</span><span class="n">network</span><span class="p">.</span><span class="n">subnet</span><span class="p">.</span><span class="n">self_link</span><span class="p">,</span>
    <span class="n">machine_type</span><span class="o">=</span><span class="n">env_config</span><span class="p">[</span><span class="s">"instance_type"</span><span class="p">],</span>
    <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s">"http-allowed"</span><span class="p">,</span> <span class="s">"ssh-allowed"</span><span class="p">],</span>
    <span class="n">startup_script</span><span class="o">=</span><span class="s">"""#!/bin/bash
    apt-get update
    apt-get install -y nginx
    
    cat &gt; /var/www/html/index.html &lt;&lt; 'EOF'
    &lt;!DOCTYPE html&gt;
    &lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Pulumi Component Demo&lt;/title&gt;
        &lt;style&gt;
            body { font-family: Arial, sans-serif; margin: 40px; text-align: center; }
            .container { max-width: 600px; margin: 0 auto; }
            .status { color: #28a745; font-weight: bold; }
        &lt;/style&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div class="container"&gt;
            &lt;h1&gt;ðŸ—ï¸ Pulumi Component Architecture&lt;/h1&gt;
            &lt;p class="status"&gt;âœ… Deployed using reusable components&lt;/p&gt;
            &lt;p&gt;Environment: {environment}&lt;/p&gt;
            &lt;p&gt;Stack: {stack}&lt;/p&gt;
        &lt;/div&gt;
    &lt;/body&gt;
    &lt;/html&gt;
    EOF
    
    sed -i 's/{environment}/'$PULUMI_STACK'/g' /var/www/html/index.html
    sed -i 's/{stack}/'$PULUMI_STACK'/g' /var/www/html/index.html
    
    systemctl restart nginx
    """</span><span class="p">)</span>

<span class="c1"># Export important outputs
</span><span class="n">pulumi</span><span class="p">.</span><span class="n">export</span><span class="p">(</span><span class="s">"vpc_id"</span><span class="p">,</span> <span class="n">network</span><span class="p">.</span><span class="n">vpc</span><span class="p">.</span><span class="nb">id</span><span class="p">)</span>
<span class="n">pulumi</span><span class="p">.</span><span class="n">export</span><span class="p">(</span><span class="s">"subnet_id"</span><span class="p">,</span> <span class="n">network</span><span class="p">.</span><span class="n">subnet</span><span class="p">.</span><span class="nb">id</span><span class="p">)</span>
<span class="n">pulumi</span><span class="p">.</span><span class="n">export</span><span class="p">(</span><span class="s">"web_server_ip"</span><span class="p">,</span> <span class="n">web_server</span><span class="p">.</span><span class="n">static_ip</span><span class="p">.</span><span class="n">address</span><span class="p">)</span>
<span class="n">pulumi</span><span class="p">.</span><span class="n">export</span><span class="p">(</span><span class="s">"web_server_url"</span><span class="p">,</span> <span class="n">pulumi</span><span class="p">.</span><span class="n">Output</span><span class="p">.</span><span class="n">concat</span><span class="p">(</span><span class="s">"http://"</span><span class="p">,</span> <span class="n">web_server</span><span class="p">.</span><span class="n">static_ip</span><span class="p">.</span><span class="n">address</span><span class="p">))</span>
<span class="n">pulumi</span><span class="p">.</span><span class="n">export</span><span class="p">(</span><span class="s">"environment"</span><span class="p">,</span> <span class="n">env_config</span><span class="p">[</span><span class="s">"environment"</span><span class="p">])</span>
</code></pre></div></div>

<p><br /></p>

<hr />

<h2 id="troubleshooting-and-best-practices">Troubleshooting and Best Practices</h2>

<p><br /></p>

<h3 id="1-common-issues-and-resolution">1. Common Issues and Resolution</h3>

<h4 id="authentication-and-permissions">Authentication and Permissions:</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># scripts/troubleshoot-auth.sh</span>

<span class="nb">echo</span> <span class="s2">"ðŸ” Pulumi Authentication Troubleshooting"</span>

<span class="c"># Check Pulumi login status</span>
<span class="nb">echo</span> <span class="s2">"Checking Pulumi authentication..."</span>
<span class="k">if </span>pulumi <span class="nb">whoami</span> <span class="o">&gt;</span> /dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"âœ… Pulumi authentication: </span><span class="si">$(</span>pulumi <span class="nb">whoami</span><span class="si">)</span><span class="s2">"</span>
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"âŒ Pulumi authentication failed"</span>
    <span class="nb">echo</span> <span class="s2">"Run: pulumi login"</span>
    <span class="nb">exit </span>1
<span class="k">fi</span>

<span class="c"># Check GCP authentication</span>
<span class="nb">echo</span> <span class="s2">"Checking GCP authentication..."</span>
<span class="k">if </span>gcloud auth list <span class="nt">--filter</span><span class="o">=</span>status:ACTIVE <span class="nt">--format</span><span class="o">=</span><span class="s2">"value(account)"</span> | <span class="nb">head</span> <span class="nt">-n1</span> <span class="o">&gt;</span> /dev/null<span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"âœ… GCP authentication: </span><span class="si">$(</span>gcloud auth list <span class="nt">--filter</span><span class="o">=</span>status:ACTIVE <span class="nt">--format</span><span class="o">=</span><span class="s2">"value(account)"</span> | <span class="nb">head</span> <span class="nt">-n1</span><span class="si">)</span><span class="s2">"</span>
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"âŒ GCP authentication failed"</span>
    <span class="nb">echo</span> <span class="s2">"Run: gcloud auth login"</span>
    <span class="nb">exit </span>1
<span class="k">fi</span>

<span class="c"># Check GCP project access</span>
<span class="nv">PROJECT_ID</span><span class="o">=</span><span class="si">$(</span>pulumi config get gcp:project 2&gt;/dev/null <span class="o">||</span> <span class="nb">echo</span> <span class="s2">""</span><span class="si">)</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$PROJECT_ID</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    if </span>gcloud projects describe <span class="s2">"</span><span class="nv">$PROJECT_ID</span><span class="s2">"</span> <span class="o">&gt;</span> /dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"âœ… GCP project access: </span><span class="nv">$PROJECT_ID</span><span class="s2">"</span>
    <span class="k">else
        </span><span class="nb">echo</span> <span class="s2">"âŒ Cannot access GCP project: </span><span class="nv">$PROJECT_ID</span><span class="s2">"</span>
        <span class="nb">echo</span> <span class="s2">"Check project ID and permissions"</span>
        <span class="nb">exit </span>1
    <span class="k">fi
else
    </span><span class="nb">echo</span> <span class="s2">"âš ï¸  No GCP project configured"</span>
    <span class="nb">echo</span> <span class="s2">"Run: pulumi config set gcp:project YOUR_PROJECT_ID"</span>
<span class="k">fi</span>

<span class="c"># Check required APIs</span>
<span class="nb">echo</span> <span class="s2">"Checking required GCP APIs..."</span>
<span class="nv">required_apis</span><span class="o">=(</span>
    <span class="s2">"compute.googleapis.com"</span>
    <span class="s2">"storage.googleapis.com"</span>
    <span class="s2">"sqladmin.googleapis.com"</span>
    <span class="s2">"iam.googleapis.com"</span>
<span class="o">)</span>

<span class="k">for </span>api <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">required_apis</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
    if </span>gcloud services list <span class="nt">--enabled</span> <span class="nt">--filter</span><span class="o">=</span><span class="s2">"name:</span><span class="nv">$api</span><span class="s2">"</span> <span class="nt">--format</span><span class="o">=</span><span class="s2">"value(name)"</span> | <span class="nb">grep</span> <span class="nt">-q</span> <span class="s2">"</span><span class="nv">$api</span><span class="s2">"</span><span class="p">;</span> <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"âœ… API enabled: </span><span class="nv">$api</span><span class="s2">"</span>
    <span class="k">else
        </span><span class="nb">echo</span> <span class="s2">"âŒ API not enabled: </span><span class="nv">$api</span><span class="s2">"</span>
        <span class="nb">echo</span> <span class="s2">"Run: gcloud services enable </span><span class="nv">$api</span><span class="s2">"</span>
    <span class="k">fi
done

</span><span class="nb">echo</span> <span class="s2">"ðŸŽ‰ Authentication troubleshooting complete"</span>
</code></pre></div></div>

<h4 id="state-and-resource-issues">State and Resource Issues:</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># scripts/troubleshoot-state.sh</span>

<span class="nb">set</span> <span class="nt">-euo</span> pipefail

<span class="nv">STACK_NAME</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">1</span><span class="k">:-</span><span class="si">$(</span>pulumi stack <span class="nb">ls</span> <span class="nt">--json</span> | jq <span class="nt">-r</span> <span class="s1">'.[] | select(.current) | .name'</span><span class="si">)</span><span class="k">}</span><span class="s2">"</span>

<span class="nb">echo</span> <span class="s2">"ðŸ” Troubleshooting Pulumi state for stack: </span><span class="nv">$STACK_NAME</span><span class="s2">"</span>

<span class="c"># Check stack status</span>
<span class="nb">echo</span> <span class="s2">"Checking stack status..."</span>
<span class="k">if </span>pulumi stack <span class="k">select</span> <span class="s2">"</span><span class="nv">$STACK_NAME</span><span class="s2">"</span> <span class="o">&gt;</span> /dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"âœ… Stack exists and is accessible: </span><span class="nv">$STACK_NAME</span><span class="s2">"</span>
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"âŒ Cannot access stack: </span><span class="nv">$STACK_NAME</span><span class="s2">"</span>
    pulumi stack <span class="nb">ls
    exit </span>1
<span class="k">fi</span>

<span class="c"># Check for stack locks</span>
<span class="nb">echo</span> <span class="s2">"Checking for stack locks..."</span>
<span class="nv">STACK_INFO</span><span class="o">=</span><span class="si">$(</span>pulumi stack <span class="nt">--show-urns</span> <span class="nt">--json</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">echo</span> <span class="s1">'{}'</span><span class="si">)</span>
<span class="k">if </span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$STACK_INFO</span><span class="s2">"</span> | jq <span class="nt">-e</span> <span class="s1">'.deployment.info.locks'</span> <span class="o">&gt;</span> /dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"âš ï¸  Stack appears to be locked"</span>
    <span class="nb">echo</span> <span class="s2">"If you're sure no operations are running, you can cancel:"</span>
    <span class="nb">echo</span> <span class="s2">"pulumi cancel"</span>
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"âœ… No stack locks detected"</span>
<span class="k">fi</span>

<span class="c"># Validate current state</span>
<span class="nb">echo</span> <span class="s2">"Validating current state..."</span>
<span class="k">if </span>pulumi preview <span class="nt">--diff</span> <span class="o">&gt;</span> /dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"âœ… State is valid and up-to-date"</span>
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"âš ï¸  State validation issues detected"</span>
    <span class="nb">echo</span> <span class="s2">"Run 'pulumi preview --diff' for details"</span>
<span class="k">fi</span>

<span class="c"># Check for orphaned resources</span>
<span class="nb">echo</span> <span class="s2">"Checking for orphaned resources..."</span>
<span class="nv">RESOURCES</span><span class="o">=</span><span class="si">$(</span>pulumi stack <span class="nt">--show-urns</span> <span class="nt">--json</span> | jq <span class="nt">-r</span> <span class="s1">'.deployment.resources[]?.urn // empty'</span> 2&gt;/dev/null <span class="o">||</span> <span class="nb">echo</span> <span class="s2">""</span><span class="si">)</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$RESOURCES</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nv">RESOURCE_COUNT</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$RESOURCES</span><span class="s2">"</span> | <span class="nb">wc</span> <span class="nt">-l</span><span class="si">)</span>
    <span class="nb">echo</span> <span class="s2">"âœ… Found </span><span class="nv">$RESOURCE_COUNT</span><span class="s2"> managed resources"</span>
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"âš ï¸  No managed resources found in state"</span>
<span class="k">fi</span>

<span class="c"># Check backend connectivity</span>
<span class="nb">echo</span> <span class="s2">"Checking backend connectivity..."</span>
<span class="nv">BACKEND_URL</span><span class="o">=</span><span class="si">$(</span>pulumi <span class="nb">whoami</span> <span class="nt">--json</span> | jq <span class="nt">-r</span> <span class="s1">'.url'</span><span class="si">)</span>
<span class="nb">echo</span> <span class="s2">"Backend URL: </span><span class="nv">$BACKEND_URL</span><span class="s2">"</span>

<span class="k">case</span> <span class="s2">"</span><span class="nv">$BACKEND_URL</span><span class="s2">"</span> <span class="k">in</span>
    <span class="s2">"https://app.pulumi.com"</span><span class="k">*</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"âœ… Using Pulumi Service backend"</span>
        <span class="p">;;</span>
    <span class="s2">"gs://"</span><span class="k">*</span><span class="p">)</span>
        <span class="nv">BUCKET_NAME</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$BACKEND_URL</span><span class="s2">"</span> | <span class="nb">sed</span> <span class="s1">'s|gs://||'</span> | <span class="nb">cut</span> <span class="nt">-d</span><span class="s1">'/'</span> <span class="nt">-f1</span><span class="si">)</span>
        <span class="k">if </span>gsutil <span class="nb">ls</span> <span class="s2">"gs://</span><span class="nv">$BUCKET_NAME</span><span class="s2">"</span> <span class="o">&gt;</span> /dev/null 2&gt;&amp;1<span class="p">;</span> <span class="k">then
            </span><span class="nb">echo</span> <span class="s2">"âœ… GCS backend accessible: </span><span class="nv">$BUCKET_NAME</span><span class="s2">"</span>
        <span class="k">else
            </span><span class="nb">echo</span> <span class="s2">"âŒ Cannot access GCS backend: </span><span class="nv">$BUCKET_NAME</span><span class="s2">"</span>
        <span class="k">fi</span>
        <span class="p">;;</span>
    <span class="k">*</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"â„¹ï¸  Using backend: </span><span class="nv">$BACKEND_URL</span><span class="s2">"</span>
        <span class="p">;;</span>
<span class="k">esac</span>

<span class="nb">echo</span> <span class="s2">"ðŸŽ‰ State troubleshooting complete"</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="2-performance-optimization">2. Performance Optimization</h3>

<h4 id="resource-import-and-large-scale-operations">Resource Import and Large-Scale Operations:</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># scripts/bulk-import.py
</span><span class="s">"""Bulk import utility for existing GCP resources"""</span>

<span class="kn">import</span> <span class="nn">concurrent.futures</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="o">@</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">ImportTask</span><span class="p">:</span>
    <span class="n">resource_type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">pulumi_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">gcp_resource_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">depends_on</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>

<span class="k">class</span> <span class="nc">BulkImporter</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">retry_attempts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">max_workers</span> <span class="o">=</span> <span class="n">max_workers</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">retry_attempts</span> <span class="o">=</span> <span class="n">retry_attempts</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">import_results</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">def</span> <span class="nf">import_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="n">ImportTask</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="s">"""Import a single resource with retry logic"""</span>
        
        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">retry_attempts</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="s">"pulumi"</span><span class="p">,</span> <span class="s">"import"</span><span class="p">,</span> 
                    <span class="n">task</span><span class="p">.</span><span class="n">resource_type</span><span class="p">,</span>
                    <span class="n">task</span><span class="p">.</span><span class="n">pulumi_name</span><span class="p">,</span>
                    <span class="n">task</span><span class="p">.</span><span class="n">gcp_resource_id</span>
                <span class="p">]</span>
                
                <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span>
                    <span class="n">cmd</span><span class="p">,</span> 
                    <span class="n">capture_output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> 
                    <span class="n">text</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                    <span class="n">timeout</span><span class="o">=</span><span class="mi">300</span>  <span class="c1"># 5 minute timeout
</span>                <span class="p">)</span>
                
                <span class="k">if</span> <span class="n">result</span><span class="p">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">task</span><span class="p">.</span><span class="n">pulumi_name</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="s">"Success"</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">error_msg</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">stderr</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="s">"already exists"</span> <span class="ow">in</span> <span class="n">error_msg</span><span class="p">.</span><span class="n">lower</span><span class="p">():</span>
                        <span class="k">return</span> <span class="n">task</span><span class="p">.</span><span class="n">pulumi_name</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="s">"Already exists"</span>
                    <span class="k">elif</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="p">.</span><span class="n">retry_attempts</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">attempt</span><span class="p">)</span>  <span class="c1"># Exponential backoff
</span>                        <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">task</span><span class="p">.</span><span class="n">pulumi_name</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">error_msg</span>
                        
            <span class="k">except</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">TimeoutExpired</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="p">.</span><span class="n">retry_attempts</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">attempt</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">task</span><span class="p">.</span><span class="n">pulumi_name</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="s">"Timeout"</span>
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="p">.</span><span class="n">retry_attempts</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">attempt</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">task</span><span class="p">.</span><span class="n">pulumi_name</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">task</span><span class="p">.</span><span class="n">pulumi_name</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="s">"Max retries exceeded"</span>
    
    <span class="k">def</span> <span class="nf">import_resources_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tasks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ImportTask</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">]:</span>
        <span class="s">"""Import multiple resources concurrently"""</span>
        
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Importing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span><span class="si">}</span><span class="s"> resources with </span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">max_workers</span><span class="si">}</span><span class="s"> workers..."</span><span class="p">)</span>
        
        <span class="k">with</span> <span class="n">concurrent</span><span class="p">.</span><span class="n">futures</span><span class="p">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">max_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
            <span class="c1"># Submit all tasks
</span>            <span class="n">future_to_task</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">executor</span><span class="p">.</span><span class="n">submit</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">import_resource</span><span class="p">,</span> <span class="n">task</span><span class="p">):</span> <span class="n">task</span> 
                <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tasks</span>
            <span class="p">}</span>
            
            <span class="c1"># Collect results
</span>            <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">concurrent</span><span class="p">.</span><span class="n">futures</span><span class="p">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">future_to_task</span><span class="p">):</span>
                <span class="n">task</span> <span class="o">=</span> <span class="n">future_to_task</span><span class="p">[</span><span class="n">future</span><span class="p">]</span>
                <span class="n">name</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">future</span><span class="p">.</span><span class="n">result</span><span class="p">()</span>
                
                <span class="bp">self</span><span class="p">.</span><span class="n">import_results</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s">"success"</span><span class="p">:</span> <span class="n">success</span><span class="p">,</span>
                    <span class="s">"message"</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
                    <span class="s">"resource_type"</span><span class="p">:</span> <span class="n">task</span><span class="p">.</span><span class="n">resource_type</span><span class="p">,</span>
                    <span class="s">"gcp_id"</span><span class="p">:</span> <span class="n">task</span><span class="p">.</span><span class="n">gcp_resource_id</span>
                <span class="p">}</span>
                
                <span class="n">status</span> <span class="o">=</span> <span class="s">"âœ…"</span> <span class="k">if</span> <span class="n">success</span> <span class="k">else</span> <span class="s">"âŒ"</span>
                <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">import_results</span>
    
    <span class="k">def</span> <span class="nf">generate_import_report</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="s">"""Generate a summary report of import operations"""</span>
        
        <span class="n">total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">import_results</span><span class="p">)</span>
        <span class="n">successful</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">import_results</span><span class="p">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="s">"success"</span><span class="p">])</span>
        <span class="n">failed</span> <span class="o">=</span> <span class="n">total</span> <span class="o">-</span> <span class="n">successful</span>
        
        <span class="n">report</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"""
Import Summary Report
====================
Total resources: </span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="s">
Successful: </span><span class="si">{</span><span class="n">successful</span><span class="si">}</span><span class="s">
Failed: </span><span class="si">{</span><span class="n">failed</span><span class="si">}</span><span class="s">
Success rate: </span><span class="si">{</span><span class="p">(</span><span class="n">successful</span><span class="o">/</span><span class="n">total</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="n">f</span><span class="si">}</span><span class="s">%

Failed Imports:
"""</span>
        
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">import_results</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">[</span><span class="s">"success"</span><span class="p">]:</span>
                <span class="n">report</span> <span class="o">+=</span> <span class="sa">f</span><span class="s">"- </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s">'message'</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s">"</span>
        
        <span class="k">return</span> <span class="n">report</span>

<span class="c1"># Example usage
</span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">importer</span> <span class="o">=</span> <span class="n">BulkImporter</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    
    <span class="c1"># Define import tasks
</span>    <span class="n">import_tasks</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">ImportTask</span><span class="p">(</span>
            <span class="n">resource_type</span><span class="o">=</span><span class="s">"gcp:compute/network:Network"</span><span class="p">,</span>
            <span class="n">pulumi_name</span><span class="o">=</span><span class="s">"main-vpc"</span><span class="p">,</span>
            <span class="n">gcp_resource_id</span><span class="o">=</span><span class="s">"projects/my-project/global/networks/main-vpc"</span>
        <span class="p">),</span>
        <span class="n">ImportTask</span><span class="p">(</span>
            <span class="n">resource_type</span><span class="o">=</span><span class="s">"gcp:compute/subnetwork:Subnetwork"</span><span class="p">,</span> 
            <span class="n">pulumi_name</span><span class="o">=</span><span class="s">"main-subnet"</span><span class="p">,</span>
            <span class="n">gcp_resource_id</span><span class="o">=</span><span class="s">"projects/my-project/regions/us-central1/subnetworks/main-subnet"</span>
        <span class="p">),</span>
        <span class="n">ImportTask</span><span class="p">(</span>
            <span class="n">resource_type</span><span class="o">=</span><span class="s">"gcp:storage/bucket:Bucket"</span><span class="p">,</span>
            <span class="n">pulumi_name</span><span class="o">=</span><span class="s">"app-storage"</span><span class="p">,</span>
            <span class="n">gcp_resource_id</span><span class="o">=</span><span class="s">"my-app-storage-bucket"</span>
        <span class="p">)</span>
    <span class="p">]</span>
    
    <span class="c1"># Execute imports
</span>    <span class="n">results</span> <span class="o">=</span> <span class="n">importer</span><span class="p">.</span><span class="n">import_resources_batch</span><span class="p">(</span><span class="n">import_tasks</span><span class="p">)</span>
    
    <span class="c1"># Generate report
</span>    <span class="n">report</span> <span class="o">=</span> <span class="n">importer</span><span class="p">.</span><span class="n">generate_import_report</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
    
    <span class="c1"># Save report to file
</span>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"import-report.txt"</span><span class="p">,</span> <span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="3-enterprise-best-practices">3. Enterprise Best Practices</h3>

<h4 id="production-deployment-checklist">Production Deployment Checklist:</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># .pulumi/deployment-checklist.yml</span>
<span class="na">pre_deployment</span><span class="pi">:</span>
  <span class="na">authentication</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Verify cloud provider credentials are valid</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Confirm service account permissions are sufficient</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Test API access to all required services</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Validate Pulumi backend connectivity</span>
  
  <span class="na">configuration</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Review all stack configuration values</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Verify secrets are properly encrypted</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Confirm environment-specific settings</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Validate resource naming conventions</span>
  
  <span class="na">code_quality</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Run unit tests on infrastructure code</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Execute linting and static analysis</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Perform security scanning of configurations</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Review resource dependencies and ordering</span>
  
  <span class="na">state_management</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Backup current state before changes</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Verify state backend accessibility</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Check for state locks or concurrent operations</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Validate state integrity</span>

<span class="na">deployment</span><span class="pi">:</span>
  <span class="na">preview_phase</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Run 'pulumi preview' to review changes</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Analyze resource creation/modification/deletion</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Verify no unexpected changes are present</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Confirm deployment scope matches expectations</span>
  
  <span class="na">execution_phase</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Monitor deployment progress actively</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Watch for error messages or warnings</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Verify critical resources are created successfully</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Check service health after deployment</span>
  
  <span class="na">validation_phase</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Test application functionality</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Verify network connectivity</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Confirm security group rules are working</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Validate monitoring and logging setup</span>

<span class="na">post_deployment</span><span class="pi">:</span>
  <span class="na">documentation</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Update infrastructure documentation</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Record deployment notes and issues</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Update runbooks with any changes</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Communicate changes to relevant teams</span>
  
  <span class="na">monitoring</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Verify monitoring alerts are working</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Check resource utilization metrics</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Confirm backup procedures are operational</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Test disaster recovery procedures</span>
  
  <span class="na">security</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Perform security configuration review</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Validate access controls and permissions</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Check for exposed sensitive data</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Review audit logging configuration</span>

<span class="na">maintenance</span><span class="pi">:</span>
  <span class="na">ongoing_tasks</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Schedule regular state backups</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Plan for periodic security updates</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Monitor for configuration drift</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Review and optimize resource costs</span>
  
  <span class="na">incident_response</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Document rollback procedures</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Test emergency response protocols</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Maintain up-to-date contact information</span>
    <span class="pi">-</span> <span class="pi">[</span> <span class="pi">]</span> <span class="s">Keep disaster recovery documentation current</span>
</code></pre></div></div>

<p><br /></p>

<hr />

<h2 id="conclusion">Conclusion</h2>

<p><strong>Pulumi</strong> represents a <strong>transformative approach to Infrastructure as Code</strong>, enabling developers to <strong>leverage familiar programming languages and tools</strong> for cloud infrastructure management. By bridging the gap between <strong>application development and infrastructure operations</strong>, Pulumi empowers teams to <strong>apply software engineering best practices to infrastructure</strong>.</p>

<p><br /></p>

<h3 id="key-advantages-of-pulumi">Key Advantages of Pulumi:</h3>

<ol>
  <li><strong>Developer Productivity</strong>: Native IDE support, debugging, and testing capabilities</li>
  <li><strong>Language Flexibility</strong>: Choice of Python, TypeScript, Go, C#, and Java</li>
  <li><strong>Enterprise Ready</strong>: Advanced state management, RBAC, and compliance features</li>
  <li><strong>Multi-Cloud Support</strong>: Consistent experience across AWS, GCP, Azure, and Kubernetes</li>
  <li><strong>Component Reusability</strong>: Build and share infrastructure components as packages</li>
</ol>

<p><br /></p>

<h3 id="implementation-success-factors">Implementation Success Factors:</h3>

<ul>
  <li><strong>Strategic Planning</strong>: Start with pilot projects and gradually expand adoption</li>
  <li><strong>Team Training</strong>: Invest in developer education and best practices</li>
  <li><strong>Automation Integration</strong>: Implement CI/CD pipelines for infrastructure deployment</li>
  <li><strong>Security Focus</strong>: Establish secure configuration and secret management practices</li>
  <li><strong>Monitoring</strong>: Implement comprehensive state monitoring and drift detection</li>
</ul>

<h4 id="enterprise-adoption-roadmap">Enterprise Adoption Roadmap:</h4>
<ol>
  <li><strong>Pilot Phase</strong>: Deploy non-critical infrastructure with small teams</li>
  <li><strong>Expansion Phase</strong>: Scale to additional projects and environments</li>
  <li><strong>Standardization Phase</strong>: Establish company-wide patterns and components</li>
  <li><strong>Optimization Phase</strong>: Implement advanced automation and governance</li>
  <li><strong>Innovation Phase</strong>: Explore cutting-edge infrastructure patterns</li>
</ol>

<p><br /></p>

<p><strong>Pulumi enables organizations to treat infrastructure as software</strong>, bringing the same <strong>discipline, reliability, and velocity</strong> that characterizes modern software development to infrastructure management.</p>

<p>By <strong>combining the power of general-purpose programming languages with declarative infrastructure principles</strong>, Pulumi provides a <strong>future-proof foundation for cloud infrastructure automation</strong>.</p>

<blockquote>
  <p><em>â€œPulumi doesnâ€™t just enable Infrastructure as Codeâ€”it enables Infrastructure as Software, where infrastructure becomes a first-class citizen in the software development lifecycle.â€</em></p>
</blockquote>

<p><br /></p>

<hr />

<h2 id="references">References</h2>

<ul>
  <li><a href="https://www.pulumi.com/docs/">Pulumi Official Documentation</a></li>
  <li><a href="https://www.pulumi.com/docs/reference/pkg/python/">Pulumi Python SDK Reference</a></li>
  <li><a href="https://www.pulumi.com/registry/packages/gcp/">Google Cloud Provider for Pulumi</a></li>
  <li><a href="https://github.com/pulumi/examples">Pulumi Examples Repository</a></li>
  <li><a href="https://www.pulumi.com/docs/intro/concepts/organizing-stacks-projects/">Pulumi Best Practices Guide</a></li>
  <li><a href="https://cloud.google.com/iam/docs/using-iam-securely">Google Cloud IAM Best Practices</a></li>
  <li><a href="https://www.pulumi.com/docs/intro/concepts/state/">Pulumi State and Backends</a></li>
  <li><a href="https://www.pulumi.com/docs/guides/testing/">Infrastructure Testing with Pulumi</a></li>
  <li><a href="https://www.pulumi.com/docs/guides/continuous-delivery/">Pulumi CI/CD Integration Guide</a></li>
  <li><a href="https://cloud.google.com/architecture">Google Cloud Architecture Center</a></li>
</ul>


                <!-- Pagination links -->


            </article>

            
                <aside class="see-also">
                    <h2>See also</h2>
                    <ul>
                        
                        
                        
                            <li>
                                <a href="/category/ai/llm-ollama-open-webui/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1770607787/ollama-openwebui-llm-1_dl6rlu.png">
                                    
                                    <h3>Building an On-Premises LLM System with Ollama + Open WebUI</h3>
                                </a>
                            </li>
                        
                            <li>
                                <a href="/category/container/docker-image-optimization/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1767693107/docker-image-opt-1_bfyljd.png">
                                    
                                    <h3>Docker Image Optimization Practical Guide</h3>
                                </a>
                            </li>
                        
                            <li>
                                <a href="/category/aws/aws-nacl-sg/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1767938733/aws-security-group-network-acl-1_tjbvpd.png">
                                    
                                    <h3>AWS Network ACL vs Security Group - Complete Comparison and Implementation Guide</h3>
                                </a>
                            </li>
                        
                    </ul>
                </aside>
            

        </section>

        <!-- Add time bar only for pages without pagination -->
        
            <div class="time-bar" data-minutes="64">
    <span class="time-completed"></span>
    <span class="time-remaining"></span>
    <div class="bar">
        <span class="completed" style="width:0%;"></span>
        <span class="remaining" style="width:100%;"></span>
    </div>
</div>

            <button class="toggle-preview" onclick="togglePreview()">
    <span>Hide Preview â–¼</span>
</button>

<div id="recommendationSection" class="recommendation">
    <div class="message">
        <strong>Why don't you read something next?</strong>
        <div>
            <button>
                <svg><use xlink:href="#icon-arrow-right"></use></svg>
                <span>Go back to top</span>
            </button>
        </div>
    </div>
    <div id="previewSection" class="preview-section">
        
        <a href="/category/data-engineering/airflow/" class="post-preview">
            <div class="image">
                
                    <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1767852742/airflow-1_k0rziq.png">
                
            </div>
            <h3 class="title">What is Apache Airflow and How to Install It?</h3>
        </a>
    </div>
</div>

<style>
.toggle-preview {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #333;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 4px;
    cursor: pointer;
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.toggle-preview:hover {
    background: #444;
}

.toggle-preview.visible {
    opacity: 1;
}

.recommendation {
    margin-top: 1000px;
    display: block;
    transition: all 0.3s ease;
}

.recommendation.hidden {
    display: none;
}

.hide-preview {
    margin-left: 10px;
    background: none;
    border: 1px solid #666;
    color: #666;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
}

.hide-preview:hover {
    background: #f0f0f0;
}

.preview-section {
    max-height: 1000px;
    overflow: hidden;
    transition: max-height 0.3s ease-out;
}

.preview-section.hidden {
    max-height: 0;
}
</style>

<script>
function togglePreview() {
    const recommendation = document.getElementById('recommendationSection');
    const button = document.querySelector('.toggle-preview span');
    
    if (recommendation.classList.contains('hidden')) {
        recommendation.classList.remove('hidden');
        button.textContent = 'Hide Preview â–¼';
    } else {
        recommendation.classList.add('hidden');
        button.textContent = 'Show Preview â–²';
    }
}

window.addEventListener('scroll', function() {
    const toggleButton = document.querySelector('.toggle-preview');
    const recommendation = document.getElementById('recommendationSection');
    const rect = recommendation.getBoundingClientRect();
    
    if (rect.top <= window.innerHeight) {
        toggleButton.classList.add('visible');
    } else {
        toggleButton.classList.remove('visible');
    }
});
</script>

        

        <!-- Show modal if the post is the last one -->
        

        <!-- Show modal before user leaves the page -->
        

        <!-- Add your newsletter subscription form here -->

        <section class="share">
    <h3>Share</h3>
    <a aria-label="Share on Twitter" href="https://twitter.com/intent/tweet?text=&quot;Complete guide to Pulumi - the modern Infrastructure as Code platform that enables developers to define, deploy, and manage cloud infrastructure using Python, TypeScript, Go, and C# instead of domain-specific languages.&quot;%20https://somaz.blog/category/iac/pulumi/%20via%20&#64;twitter_username&hashtags=pulumi,infrastructure-as-code,cloud-automation,python,typescript,gcp,aws,kubernetes,state-management,devops"
    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Share on Twitter">
        <svg class="icon icon-twitter"><use xlink:href="#icon-twitter"></use></svg>
    </a>
    <a aria-label="Share on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://somaz.blog/category/iac/pulumi/"
    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook">
        <svg class="icon icon-facebook"><use xlink:href="#icon-facebook"></use></svg>
    </a>
</section>

        

  <section class="author">
    <div class="details">
      
        <img class="img-rounded" src="/assets/img/uploads/profile.png" alt="Somaz">
      
      <p class="def">Author</p>
      <h3 class="name">
        <a href="/authors/somaz/">Somaz</a>
      </h3>
      <p class="desc">DevOps engineer focused on cloud infrastructure and automation</p>
      <p>
        
          <a href="https://github.com/somaz94" title="Github">
            <svg><use xlink:href="#icon-github"></use></svg>
          </a>
        
        
        
        
        
        
          <a href="https://www.linkedin.com/in/somaz" title="LinkedIn">
            <svg><use xlink:href="#icon-linkedin"></use></svg>
          </a>
        
        
          <a href="https://somaz.tistory.com" title="Tistory">
            <svg><use xlink:href="#icon-tistory"></use></svg>
          </a>
        
      </p>
    </div>
  </section>

  
  
  
  
  
  
  
  

  <script type="application/ld+json">
  {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "Somaz",
      
      "image": "/assets/img/uploads/profile.png",
      
      "jobTitle": "DevOps Engineer",
      "url": "https://somaz.blog/authors/somaz/",
      "sameAs": [
        "https://github.com/somaz94","https://www.linkedin.com/in/somaz","https://{{ author.tistory_username }}.tistory.com"
      ]
  }
  </script>


        

<section class="comments">
    <h3>Comments</h3>
    <div id="disqus_thread"></div>
</section>
<script type="text/javascript">
    var disqus_loaded = false;

    function load_disqus()
    {
        disqus_loaded = true;
        var disqus_shortname = 'https-somaz94-github-io';
        var disqus_title = '';
        var disqus_url = '/category/iac/pulumi/';
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        var ldr = document.getElementById('disqus_loader');
    };
    window.onscroll = function(e) {
        if ((window.innerHeight + window.scrollY) >= (document.body.offsetHeight - 800)) {
            //hit bottom of page
            if (disqus_loaded==false)
                load_disqus()
        }
    };
</script>



        <footer>
    <p>
      
        <a href="https://github.com/somaz94" title="Github">
          <svg><use xlink:href="#icon-github"></use></svg>
        </a>
      
      
        <a href="https://www.facebook.com/facebook_username" title="Facebook">
          <svg><use xlink:href="#icon-facebook"></use></svg>
        </a>
      
      
        <a href="https://twitter.com/twitter_username" title="Twitter">
          <svg><use xlink:href="#icon-twitter"></use></svg>
        </a>
      
      
        <a href="https://medium.com/@medium_username" title="Medium">
          <svg><use xlink:href="#icon-medium"></use></svg>
        </a>
      
      
        <a href="https://www.instagram.com/instagram_username" title="Instagram">
          <svg><use xlink:href="#icon-instagram"></use></svg>
        </a>
      
      
        <a href="https://www.linkedin.com/in/somaz" title="LinkedIn">
          <svg><use xlink:href="#icon-linkedin"></use></svg>
        </a>
      
      
        <a href="https://somaz.tistory.com" title="Tistory">
          <svg><use xlink:href="#icon-tistory"></use></svg>
        </a>
      
    </p>

    <ul>
  
    
      <li>
        <a href="https://somaz.blog/">Home</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/about">About</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/category">Category</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/contact">Contact</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/feed.xml">Feed</a>
      </li>
    
  
</ul>


    <p>
      <a href="https://somaz.blog/sitemap.xml" title="sitemap">Sitemap</a> |
      <a href="https://somaz.blog/privacy-policy" title="Privacy Policy">Privacy Policy</a>
    </p>

    <p>
      <span>Somaz Tech Blog</span> <svg class="love"><use xlink:href="#icon-heart"></use></svg>
    </p>
</footer>










<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "somaz",
  "description": "DevOps engineer's tech blog.",
  "url": "https://somaz.blog/",
  "logo": {
      "@type": "ImageObject",
      "url": "https://somaz.blog/assets/img/icons/mediumtile.png",
      "width": "600",
      "height": "315"
  },
  "sameAs": [
    "https://github.com/somaz94","https://www.facebook.com/facebook_username","https://twitter.com/twitter_username","https://medium.com/@medium_username","https://www.instagram.com/instagram_username","https://www.linkedin.com/in/somaz","https://{{ site.tistory_username }}.tistory.com"
  ]
}
</script>

<!-- Include the script that allows Netlify CMS login -->
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

<!-- Include the website scripts -->
<script src="/assets/js/scripts.min.js"></script>

<!-- Include Google Analytics script -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-XXXXXXXX-X"></script>
<script>
  var host = window.location.hostname;
  if (host != 'localhost') {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-XXXXXXXX-X');
  }
</script>
  


<!-- Include extra scripts -->



        

        
        
        
        
        
        
        
        
        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "BlogPosting",
            "name": "Pulumi: Modern Infrastructure as Code with Programming Languages",
            "headline": "Build and manage cloud infrastructure using familiar programming languages with Pulumi's developer-first approach",
            "description": "Complete guide to Pulumi - the modern Infrastructure as Code platform that enables developers to define, deploy, and manage cloud infrastructure using Python, TypeScript, Go, and C# instead of domain-specific languages.",
            "image": "https://res.cloudinary.com/dkcm26aem/image/upload/v1755152827/pulumi-1_bmpstq.png",
            "url": "https://somaz.blog/category/iac/pulumi/",
            "articleBody": "



Overview

Pulumi is a revolutionary Infrastructure as Code (IaC) platform that enables developers to define, deploy, and manage cloud infrastructure using familiar programming languages like Python, TypeScript, Go, and C#.

Unlike traditional IaC tools that require learning domain-specific languages, Pulumi leverages the power of general-purpose programming languages, providing developers with IDE support, debugging capabilities, testing frameworks, and package management.

This comprehensive guide explores Pulumiâ€™s architecture, installation procedures, state management strategies, and production implementation patterns. Weâ€™ll cover multi-cloud deployments, advanced configuration management, and enterprise-grade workflows that enable teams to scale infrastructure operations efficiently.

Pulumi bridges the gap between infrastructure and application development, enabling true Infrastructure as Software where infrastructure can be version controlled, tested, and deployed using the same tools and practices used for application development.

With support for major cloud providers including AWS, Google Cloud Platform, Azure, and Kubernetes, Pulumi has become the preferred choice for developer-centric organizations seeking to modernize their infrastructure management practices.





What is Pulumi?

Pulumi is a modern Infrastructure as Code platform that allows developers to build, deploy, and manage infrastructure using real programming languages instead of YAML or domain-specific configuration languages.



Key Differentiators from Traditional IaC:

# Traditional Terraform approach
resource &quot;aws_s3_bucket&quot; &quot;example&quot; {
  bucket = &quot;my-bucket&quot;
  
  website {
    index_document = &quot;index.html&quot;
  }
}

# Pulumi approach with Python
import pulumi
import pulumi_aws as aws

bucket = aws.s3.Bucket(&apos;my-bucket&apos;,
    website=aws.s3.BucketWebsiteArgs(
        index_document=&quot;index.html&quot;
    ))

pulumi.export(&apos;bucket_url&apos;, bucket.bucket_domain_name)




Architecture and Core Concepts:

Pulumi Engine and Language SDKs:

  Declarative Infrastructure: Write imperative code that compiles to declarative graphs
  Idempotent Operations: Ensures consistent results across multiple deployments
  Resource Graph: Automatic dependency resolution and parallel execution
  State Management: Built-in state storage with encryption and backup capabilities


Multi-Language Support:
# Available SDKs
pulumi new aws-python          # Python
pulumi new aws-typescript      # TypeScript/JavaScript
pulumi new aws-go             # Go
pulumi new aws-csharp         # C#/.NET
pulumi new aws-java           # Java (Preview)
pulumi new aws-yaml           # YAML (for simple cases)




Pulumi vs Terraform Comparison:


  
    
      Feature
      Pulumi
      Terraform
    
  
  
    
      Language
      Python, TypeScript, Go, C#, Java
      HCL (HashiCorp Configuration Language)
    
    
      Approach
      Imperative code â†’ Declarative execution
      Declarative configuration
    
    
      IDE Support
      Full IDE support, IntelliSense, debugging
      Limited syntax highlighting
    
    
      Testing
      Unit testing, property testing, integration testing
      Limited testing capabilities
    
    
      Modularity
      Native language packages and modules
      Terraform modules
    
    
      State Management
      Managed service or self-hosted backends
      Local or remote backends
    
    
      Learning Curve
      Familiar for developers
      Easier for ops teams
    
  






Installation and Environment Setup



1. System Requirements and Prerequisites

# Prerequisites
- Python 3.7+ / Node.js 14+ / Go 1.17+ / .NET 6.0+
- Cloud provider CLI tools (aws, gcloud, az)
- Git for version control
- Docker (optional, for containerized workflows)




2. Pulumi CLI Installation

Method 1: Native Installation (Recommended)

# Linux/macOS
curl -fsSL https://get.pulumi.com | sh

# macOS with Homebrew
brew install pulumi/tap/pulumi

# Windows with Chocolatey
choco install pulumi

# Verify installation
pulumi version


Method 2: Package Managers

# Ubuntu/Debian
curl -fsSL https://get.pulumi.com | sh
echo &apos;export PATH=$PATH:$HOME/.pulumi/bin&apos; &amp;gt;&amp;gt; ~/.bashrc
source ~/.bashrc

# Alpine Linux
apk add pulumi

# Docker usage
docker run --rm -v $(pwd):/pulumi -w /pulumi pulumi/pulumi:latest pulumi --help




3. Development Environment Configuration

Python Environment Setup:

# Install Python dependencies
sudo apt-get update &amp;amp;&amp;amp; sudo apt-get install -y \
    python3 python3-pip python3-venv \
    build-essential libssl-dev libffi-dev

# Set up pyenv for version management
curl https://pyenv.run | bash
echo &apos;export PATH=&quot;$HOME/.pyenv/bin:$PATH&quot;&apos; &amp;gt;&amp;gt; ~/.bashrc
echo &apos;eval &quot;$(pyenv init -)&quot;&apos; &amp;gt;&amp;gt; ~/.bashrc
source ~/.bashrc

# Install and configure Python
pyenv install 3.9.16
pyenv global 3.9.16

# Verify setup
python3 --version
pip3 --version


Cloud Provider Authentication:

# AWS Configuration
aws configure --profile pulumi-dev
export AWS_PROFILE=pulumi-dev
export AWS_REGION=us-east-1

# Google Cloud Platform
gcloud auth login
gcloud config set project your-project-id
export GOOGLE_PROJECT=your-project-id
export GOOGLE_REGION=us-central1

# Alternative: Service Account
export GOOGLE_APPLICATION_CREDENTIALS=&quot;/path/to/service-account.json&quot;

# Azure
az login
az account set --subscription=&quot;your-subscription-id&quot;






Getting Started with Pulumi



1. Project Initialization and Structure

Creating Your First Project:

# Create new project directory
mkdir pulumi-quickstart &amp;amp;&amp;amp; cd pulumi-quickstart

# Initialize Pulumi project
pulumi new gcp-python

# Project structure created
â”œâ”€â”€ Pulumi.yaml          # Project metadata
â”œâ”€â”€ Pulumi.dev.yaml      # Stack configuration
â”œâ”€â”€ __main__.py          # Main program
â”œâ”€â”€ requirements.txt     # Python dependencies
â””â”€â”€ venv/               # Virtual environment


Project Configuration Files:

# Pulumi.yaml
name: pulumi-quickstart
runtime:
  name: python
  options:
    virtualenv: venv
description: A minimal Google Cloud Python Pulumi program


# Pulumi.dev.yaml
config:
  gcp:project: your-project-id
  gcp:region: us-central1




2. Basic Resource Management

Simple GCS Bucket Creation:

# __main__.py
&quot;&quot;&quot;Google Cloud Python Pulumi program for basic resource management&quot;&quot;&quot;

import pulumi
import pulumi_gcp as gcp

# Create a GCS bucket with basic configuration
bucket = gcp.storage.Bucket(&apos;pulumi-quickstart-bucket&apos;,
    location=&quot;US&quot;,
    uniform_bucket_level_access=True,
    versioning=gcp.storage.BucketVersioningArgs(enabled=True))

# Export bucket information
pulumi.export(&apos;bucket_name&apos;, bucket.name)
pulumi.export(&apos;bucket_url&apos;, bucket.url)


Deploy and Manage Resources:

# Install dependencies
pip install -r requirements.txt

# Preview changes
pulumi preview

# Deploy infrastructure
pulumi up

# View stack outputs
pulumi stack output

# Check deployment status
pulumi stack

# Destroy resources when done
pulumi destroy




3. Advanced Resource Configuration

Static Website Hosting Setup:

&quot;&quot;&quot;Advanced GCS bucket configuration for static website hosting&quot;&quot;&quot;

import pulumi
import pulumi_gcp as gcp

# Create bucket with custom configuration
bucket = gcp.storage.Bucket(&apos;static-website-bucket&apos;,
    name=&quot;my-static-website&quot;,
    location=&quot;asia-northeast3&quot;,
    website=gcp.storage.BucketWebsiteArgs(
        main_page_suffix=&quot;index.html&quot;,
        not_found_page=&quot;404.html&quot;
    ),
    uniform_bucket_level_access=True,
    force_destroy=True)

# Upload website content
index_html = gcp.storage.BucketObject(
    &quot;index.html&quot;,
    bucket=bucket.name,
    source=pulumi.FileAsset(&quot;index.html&quot;),
    content_type=&quot;text/html&quot;)

# Configure public access
bucket_iam_binding = gcp.storage.BucketIAMBinding(
    &quot;public-read-binding&quot;,
    bucket=bucket.name,
    role=&quot;roles/storage.objectViewer&quot;,
    members=[&quot;allUsers&quot;])

# Export website endpoint
pulumi.export(&quot;bucket_name&quot;, bucket.name)
pulumi.export(&quot;website_url&quot;, pulumi.Output.concat(
    &quot;https://storage.googleapis.com/&quot;, bucket.name, &quot;/&quot;, index_html.name))


HTML Content Example:

&amp;lt;!-- index.html --&amp;gt;
&amp;lt;!DOCTYPE html&amp;gt;
&amp;lt;html lang=&quot;en&quot;&amp;gt;
&amp;lt;head&amp;gt;
    &amp;lt;meta charset=&quot;UTF-8&quot;&amp;gt;
    &amp;lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&amp;gt;
    &amp;lt;title&amp;gt;Pulumi Static Website&amp;lt;/title&amp;gt;
    &amp;lt;style&amp;gt;
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 2rem;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
    &amp;lt;/style&amp;gt;
&amp;lt;/head&amp;gt;
&amp;lt;body&amp;gt;
    &amp;lt;div class=&quot;container&quot;&amp;gt;
        &amp;lt;h1&amp;gt;ðŸš€ Hello, Pulumi!&amp;lt;/h1&amp;gt;
        &amp;lt;p&amp;gt;This website was deployed using Pulumi Infrastructure as Code.&amp;lt;/p&amp;gt;
        &amp;lt;p&amp;gt;Powered by Google Cloud Storage and managed with Python.&amp;lt;/p&amp;gt;
    &amp;lt;/div&amp;gt;
&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;






State Management and Backend Configuration



1. Understanding Pulumi State

Pulumi uses stacks to manage infrastructure state, with each stack representing a separate deployment environment (development, staging, production). State includes all managed resources and their current properties in a serialized format.

Backend Storage Options:

# Pulumi Service (Default - Managed)
pulumi login

# Self-managed Object Storage
pulumi login s3://my-pulumi-state-bucket
pulumi login gs://my-pulumi-state-bucket
pulumi login azblob://my-pulumi-state-container

# Local filesystem (Development only)
pulumi login file://~/.pulumi-local




2. Production State Management Setup

GCS Backend Configuration:

# Create dedicated state management bucket
&quot;&quot;&quot;State management infrastructure setup&quot;&quot;&quot;

import pulumi
import pulumi_gcp as gcp

# Create state storage bucket with versioning and encryption
state_bucket = gcp.storage.Bucket(&apos;pulumi-state-bucket&apos;,
    name=&quot;pulumi-state-production&quot;,
    location=&quot;us-central1&quot;,
    uniform_bucket_level_access=True,
    versioning=gcp.storage.BucketVersioningArgs(enabled=True),
    encryption=gcp.storage.BucketEncryptionArgs(
        default_kms_key_name=&quot;projects/PROJECT_ID/locations/LOCATION/keyRings/RING_NAME/cryptoKeys/KEY_NAME&quot;
    ),
    lifecycle_rules=[gcp.storage.BucketLifecycleRuleArgs(
        condition=gcp.storage.BucketLifecycleRuleConditionArgs(
            age=90,
            with_state=&quot;ARCHIVED&quot;
        ),
        action=gcp.storage.BucketLifecycleRuleActionArgs(
            type=&quot;Delete&quot;
        )
    )])

pulumi.export(&apos;state_bucket_name&apos;, state_bucket.name)
pulumi.export(&apos;state_bucket_url&apos;, state_bucket.url)


State Backend Migration:

# Deploy state bucket first
pulumi up

# Export current state for backup
pulumi stack export &amp;gt; state-backup.json

# Login to GCS backend
pulumi login gs://pulumi-state-production

# Create new stack in GCS backend
pulumi stack init production

# Import previous state
pulumi stack import &amp;lt; state-backup.json

# Verify migration
pulumi preview

# Update backend URL for team
echo &quot;Team members should run: pulumi login gs://pulumi-state-production&quot;




3. Multi-Environment State Management

Environment-Specific Stack Configuration:

# Initialize multiple stacks
pulumi stack init development
pulumi stack init staging  
pulumi stack init production

# Configure environment-specific settings
pulumi config set gcp:project dev-project-123 --stack development
pulumi config set gcp:region us-west1 --stack development

pulumi config set gcp:project staging-project-456 --stack staging
pulumi config set gcp:region us-central1 --stack staging

pulumi config set gcp:project prod-project-789 --stack production
pulumi config set gcp:region us-east1 --stack production

# Switch between stacks
pulumi stack select development
pulumi stack select staging
pulumi stack select production


Advanced Stack Management:

&quot;&quot;&quot;Multi-environment configuration with stack references&quot;&quot;&quot;

import pulumi
import pulumi_gcp as gcp

# Get current stack name
stack = pulumi.get_stack()

# Environment-specific configurations
config = pulumi.Config()
project_id = config.require(&quot;gcp:project&quot;)
region = config.get(&quot;gcp:region&quot;) or &quot;us-central1&quot;

# Environment-specific resource sizing
instance_types = {
    &quot;development&quot;: &quot;e2-micro&quot;,
    &quot;staging&quot;: &quot;e2-small&quot;, 
    &quot;production&quot;: &quot;e2-standard-2&quot;
}

# Create environment-specific resources
bucket = gcp.storage.Bucket(f&apos;{stack}-app-bucket&apos;,
    name=f&quot;{project_id}-{stack}-bucket&quot;,
    location=region.upper(),
    uniform_bucket_level_access=True,
    versioning=gcp.storage.BucketVersioningArgs(enabled=True))

# Reference resources from other stacks
if stack == &quot;production&quot;:
    # Reference shared infrastructure stack
    shared_stack = pulumi.StackReference(&quot;organization/shared-infrastructure/production&quot;)
    vpc_id = shared_stack.get_output(&quot;vpc_id&quot;)
    subnet_id = shared_stack.get_output(&quot;subnet_id&quot;)

pulumi.export(&apos;environment&apos;, stack)
pulumi.export(&apos;bucket_name&apos;, bucket.name)






Infrastructure Deployment Patterns



1. VPC and Networking Infrastructure

Comprehensive VPC Setup:

&quot;&quot;&quot;Complete VPC and networking infrastructure&quot;&quot;&quot;

import pulumi
import pulumi_gcp as gcp

# Configuration
config = pulumi.Config()
project_id = config.require(&quot;gcp:project&quot;)
region = config.get(&quot;region&quot;) or &quot;us-central1&quot;
zone = f&quot;{region}-a&quot;

# Create VPC network
vpc = gcp.compute.Network(&quot;main-vpc&quot;,
    name=f&quot;{project_id}-vpc&quot;,
    auto_create_subnetworks=False,
    description=&quot;Main VPC for application infrastructure&quot;)

# Create subnet
subnet = gcp.compute.Subnetwork(&quot;main-subnet&quot;,
    name=f&quot;{project_id}-subnet&quot;,
    ip_cidr_range=&quot;10.0.1.0/24&quot;,
    region=region,
    network=vpc.id,
    description=&quot;Main subnet for application servers&quot;)

# Create Cloud Router for NAT
cloud_router = gcp.compute.Router(&quot;main-router&quot;,
    name=f&quot;{project_id}-router&quot;,
    region=region,
    network=vpc.id,
    description=&quot;Router for NAT gateway&quot;)

# Create NAT Gateway
nat_gateway = gcp.compute.RouterNat(&quot;main-nat&quot;,
    name=f&quot;{project_id}-nat&quot;,
    router=cloud_router.name,
    region=region,
    nat_ip_allocate_option=&quot;AUTO_ONLY&quot;,
    source_subnetwork_ip_ranges_to_nat=&quot;ALL_SUBNETWORKS_ALL_IP_RANGES&quot;)

# Create firewall rules
firewall_ssh = gcp.compute.Firewall(&quot;allow-ssh&quot;,
    name=f&quot;{project_id}-allow-ssh&quot;,
    network=vpc.id,
    allows=[gcp.compute.FirewallAllowArgs(
        protocol=&quot;tcp&quot;,
        ports=[&quot;22&quot;]
    )],
    source_ranges=[&quot;0.0.0.0/0&quot;],
    target_tags=[&quot;ssh-allowed&quot;])

firewall_http = gcp.compute.Firewall(&quot;allow-http&quot;,
    name=f&quot;{project_id}-allow-http&quot;, 
    network=vpc.id,
    allows=[gcp.compute.FirewallAllowArgs(
        protocol=&quot;tcp&quot;,
        ports=[&quot;80&quot;, &quot;443&quot;]
    )],
    source_ranges=[&quot;0.0.0.0/0&quot;],
    target_tags=[&quot;http-allowed&quot;])

# Export network information
pulumi.export(&quot;vpc_id&quot;, vpc.id)
pulumi.export(&quot;vpc_name&quot;, vpc.name)
pulumi.export(&quot;subnet_id&quot;, subnet.id)
pulumi.export(&quot;subnet_name&quot;, subnet.name)




2. Compute Engine Deployment

Production-Ready Compute Instance:

&quot;&quot;&quot;Production Compute Engine instance with best practices&quot;&quot;&quot;

import pulumi
import pulumi_gcp as gcp
import base64

# Instance configuration
config = pulumi.Config()
project_id = config.require(&quot;gcp:project&quot;)
region = config.get(&quot;region&quot;) or &quot;us-central1&quot;
zone = f&quot;{region}-a&quot;

# Create static IP address
static_ip = gcp.compute.Address(&quot;instance-ip&quot;,
    name=f&quot;{project_id}-instance-ip&quot;,
    region=region,
    description=&quot;Static IP for main application server&quot;)

# Startup script for instance initialization
startup_script = &quot;&quot;&quot;#!/bin/bash
apt-get update
apt-get install -y nginx docker.io
systemctl start nginx
systemctl enable nginx
systemctl start docker
systemctl enable docker

# Configure nginx
cat &amp;gt; /var/www/html/index.html &amp;lt;&amp;lt; EOF
&amp;lt;!DOCTYPE html&amp;gt;
&amp;lt;html&amp;gt;
&amp;lt;head&amp;gt;
    &amp;lt;title&amp;gt;Pulumi Deployed Server&amp;lt;/title&amp;gt;
    &amp;lt;style&amp;gt;
        body { font-family: Arial, sans-serif; margin: 40px; }
        .container { max-width: 800px; margin: 0 auto; }
        .status { color: #28a745; font-weight: bold; }
    &amp;lt;/style&amp;gt;
&amp;lt;/head&amp;gt;
&amp;lt;body&amp;gt;
    &amp;lt;div class=&quot;container&quot;&amp;gt;
        &amp;lt;h1&amp;gt;ðŸš€ Server Deployed with Pulumi&amp;lt;/h1&amp;gt;
        &amp;lt;p class=&quot;status&quot;&amp;gt;âœ… Server is running successfully&amp;lt;/p&amp;gt;
        &amp;lt;p&amp;gt;Instance ID: $(curl -H &quot;Metadata-Flavor: Google&quot; http://metadata.google.internal/computeMetadata/v1/instance/id)&amp;lt;/p&amp;gt;
        &amp;lt;p&amp;gt;Zone: $(curl -H &quot;Metadata-Flavor: Google&quot; http://metadata.google.internal/computeMetadata/v1/instance/zone | cut -d/ -f4)&amp;lt;/p&amp;gt;
        &amp;lt;p&amp;gt;Deployed at: $(date)&amp;lt;/p&amp;gt;
    &amp;lt;/div&amp;gt;
&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
EOF

systemctl restart nginx
&quot;&quot;&quot;

# Create service account for instance
service_account = gcp.serviceaccount.Account(&quot;instance-sa&quot;,
    account_id=f&quot;{project_id}-instance-sa&quot;,
    display_name=&quot;Compute Instance Service Account&quot;,
    description=&quot;Service account for Pulumi-managed compute instances&quot;)

# Create compute instance
instance = gcp.compute.Instance(&quot;main-instance&quot;,
    name=f&quot;{project_id}-instance&quot;,
    machine_type=&quot;e2-medium&quot;,
    zone=zone,
    
    # Boot disk configuration
    boot_disk=gcp.compute.InstanceBootDiskArgs(
        initialize_params=gcp.compute.InstanceBootDiskInitializeParamsArgs(
            image=&quot;ubuntu-os-cloud/ubuntu-2004-lts&quot;,
            size=20,
            type=&quot;pd-ssd&quot;
        )
    ),
    
    # Network configuration
    network_interfaces=[gcp.compute.InstanceNetworkInterfaceArgs(
        network=&quot;projects/{}/global/networks/{}&quot;.format(project_id, vpc.name),
        subnetwork=&quot;projects/{}/regions/{}/subnetworks/{}&quot;.format(project_id, region, subnet.name),
        access_configs=[gcp.compute.InstanceNetworkInterfaceAccessConfigArgs(
            nat_ip=static_ip.address
        )]
    )],
    
    # Service account and scopes
    service_account=gcp.compute.InstanceServiceAccountArgs(
        email=service_account.email,
        scopes=[
            &quot;https://www.googleapis.com/auth/devstorage.read_only&quot;,
            &quot;https://www.googleapis.com/auth/logging.write&quot;,
            &quot;https://www.googleapis.com/auth/monitoring.write&quot;
        ]
    ),
    
    # Instance metadata and startup script
    metadata={
        &quot;startup-script&quot;: startup_script,
        &quot;ssh-keys&quot;: f&quot;pulumi-user:{config.get(&apos;ssh_public_key&apos;) or &apos;ssh-rsa AAAAB3NzaC1yc2E...&apos;}&quot;,
        &quot;enable-oslogin&quot;: &quot;TRUE&quot;
    },
    
    # Security and management
    tags=[&quot;http-allowed&quot;, &quot;ssh-allowed&quot;],
    allow_stopping_for_update=True,
    
    # Resource labels
    labels={
        &quot;environment&quot;: pulumi.get_stack(),
        &quot;managed-by&quot;: &quot;pulumi&quot;,
        &quot;project&quot;: project_id
    })

# Export instance information
pulumi.export(&quot;instance_name&quot;, instance.name)
pulumi.export(&quot;instance_external_ip&quot;, static_ip.address)
pulumi.export(&quot;instance_internal_ip&quot;, instance.network_interfaces[0].network_ip)
pulumi.export(&quot;ssh_command&quot;, pulumi.Output.concat(
    &quot;ssh -i ~/.ssh/pulumi-key pulumi-user@&quot;, static_ip.address))
pulumi.export(&quot;web_url&quot;, pulumi.Output.concat(&quot;http://&quot;, static_ip.address))




3. Database and Storage Services

Cloud SQL and Storage Configuration:

&quot;&quot;&quot;Database and storage services setup&quot;&quot;&quot;

import pulumi
import pulumi_gcp as gcp
import pulumi_random as random

# Generate random password for database
db_password = random.RandomPassword(&quot;db-password&quot;,
    length=16,
    special=True)

# Create Cloud SQL instance
sql_instance = gcp.sql.DatabaseInstance(&quot;main-db&quot;,
    name=f&quot;{project_id}-db-instance&quot;,
    database_version=&quot;POSTGRES_13&quot;,
    region=region,
    
    settings=gcp.sql.DatabaseInstanceSettingsArgs(
        tier=&quot;db-f1-micro&quot;,  # Use db-custom-1-3840 for production
        
        # Backup configuration
        backup_configuration=gcp.sql.DatabaseInstanceSettingsBackupConfigurationArgs(
            enabled=True,
            start_time=&quot;03:00&quot;,
            point_in_time_recovery_enabled=True,
            backup_retention_settings=gcp.sql.DatabaseInstanceSettingsBackupConfigurationBackupRetentionSettingsArgs(
                retained_backups=7,
                retention_unit=&quot;COUNT&quot;
            )
        ),
        
        # High availability
        availability_type=&quot;REGIONAL&quot; if pulumi.get_stack() == &quot;production&quot; else &quot;ZONAL&quot;,
        
        # Security settings
        ip_configuration=gcp.sql.DatabaseInstanceSettingsIpConfigurationArgs(
            ipv4_enabled=True,
            require_ssl=True,
            authorized_networks=[gcp.sql.DatabaseInstanceSettingsIpConfigurationAuthorizedNetworkArgs(
                name=&quot;allow-all&quot;,  # Restrict this in production
                value=&quot;0.0.0.0/0&quot;
            )]
        ),
        
        # Maintenance window
        maintenance_window=gcp.sql.DatabaseInstanceSettingsMaintenanceWindowArgs(
            day=7,  # Sunday
            hour=3,  # 3 AM
            update_track=&quot;stable&quot;
        )
    ),
    
    deletion_protection=pulumi.get_stack() == &quot;production&quot;)

# Create database
database = gcp.sql.Database(&quot;app-database&quot;,
    name=&quot;application_db&quot;,
    instance=sql_instance.name)

# Create database user
db_user = gcp.sql.User(&quot;app-user&quot;,
    name=&quot;app_user&quot;,
    instance=sql_instance.name,
    password=db_password.result)

# Application storage bucket
app_bucket = gcp.storage.Bucket(&quot;app-storage&quot;,
    name=f&quot;{project_id}-app-storage&quot;,
    location=region.upper(),
    
    # Storage class optimization
    storage_class=&quot;STANDARD&quot;,
    
    # Lifecycle management
    lifecycle_rules=[
        gcp.storage.BucketLifecycleRuleArgs(
            condition=gcp.storage.BucketLifecycleRuleConditionArgs(age=30),
            action=gcp.storage.BucketLifecycleRuleActionArgs(type=&quot;SetStorageClass&quot;, storage_class=&quot;NEARLINE&quot;)
        ),
        gcp.storage.BucketLifecycleRuleArgs(
            condition=gcp.storage.BucketLifecycleRuleConditionArgs(age=365),
            action=gcp.storage.BucketLifecycleRuleActionArgs(type=&quot;SetStorageClass&quot;, storage_class=&quot;COLDLINE&quot;)
        )
    ],
    
    # Versioning and retention
    versioning=gcp.storage.BucketVersioningArgs(enabled=True),
    uniform_bucket_level_access=True)

# Export database and storage information
pulumi.export(&quot;sql_instance_name&quot;, sql_instance.name)
pulumi.export(&quot;sql_connection_name&quot;, sql_instance.connection_name)
pulumi.export(&quot;database_name&quot;, database.name)
pulumi.export(&quot;storage_bucket&quot;, app_bucket.name)






Production Workflows and Best Practices



1. CI/CD Pipeline Integration

GitHub Actions Workflow:

# .github/workflows/pulumi.yml
name: Pulumi Infrastructure Deployment

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

env:
  PULUMI_ACCESS_TOKEN: $

jobs:
  preview:
    runs-on: ubuntu-latest
    if: github.event_name == &apos;pull_request&apos;
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: &apos;3.9&apos;
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: Setup Pulumi
      uses: pulumi/actions@v4
      
    - name: Configure GCP credentials
      uses: google-github-actions/setup-gcloud@v1
      with:
        service_account_key: $
        project_id: $
        
    - name: Pulumi Preview
      run: |
        pulumi stack select dev
        pulumi preview --diff
      env:
        GOOGLE_CREDENTIALS: $

  deploy:
    runs-on: ubuntu-latest
    if: github.ref == &apos;refs/heads/main&apos;
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: &apos;3.9&apos;
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: Setup Pulumi
      uses: pulumi/actions@v4
      
    - name: Configure GCP credentials
      uses: google-github-actions/setup-gcloud@v1
      with:
        service_account_key: $
        project_id: $
        
    - name: Deploy to Production
      run: |
        pulumi stack select production
        pulumi up --yes --skip-preview
      env:
        GOOGLE_CREDENTIALS: $
        
    - name: Update Stack Tags
      run: |
        pulumi stack tag set deployment:commit $
        pulumi stack tag set deployment:branch $
        pulumi stack tag set deployment:timestamp $(date -u +&quot;%Y-%m-%dT%H:%M:%SZ&quot;)




2. Infrastructure Testing and Validation

Unit Testing with Pulumi:

# tests/test_infrastructure.py
&quot;&quot;&quot;Unit tests for Pulumi infrastructure&quot;&quot;&quot;

import unittest
from typing import Any
import pulumi

class InfrastructureTests(unittest.TestCase):
    
    def test_bucket_has_versioning_enabled(self):
        &quot;&quot;&quot;Test that storage buckets have versioning enabled&quot;&quot;&quot;
        
        def check_bucket(args: list[Any]) -&amp;gt; bool:
            bucket_args = args[0]
            versioning = bucket_args.get(&apos;versioning&apos;)
            return versioning is not None and versioning.get(&apos;enabled&apos;, False)
        
        # Mock Pulumi resource creation
        pulumi.runtime.set_mocks({
            &apos;gcp:storage/bucket:Bucket&apos;: lambda args: (
                &apos;bucket-id-123&apos;,
                {
                    &apos;name&apos;: &apos;test-bucket&apos;,
                    &apos;versioning&apos;: {&apos;enabled&apos;: True},
                    &apos;location&apos;: &apos;US&apos;
                }
            )
        })
        
        # Import and test the infrastructure module
        import __main__ as infrastructure
        
        # Verify bucket configuration
        self.assertTrue(check_bucket([&apos;test-bucket-args&apos;]))

    def test_compute_instance_has_required_tags(self):
        &quot;&quot;&quot;Test that compute instances have required tags&quot;&quot;&quot;
        
        required_tags = [&apos;environment&apos;, &apos;managed-by&apos;, &apos;project&apos;]
        
        def check_instance_tags(args: list[Any]) -&amp;gt; bool:
            instance_args = args[0]
            labels = instance_args.get(&apos;labels&apos;, {})
            return all(tag in labels for tag in required_tags)
        
        # Test instance configuration
        self.assertTrue(check_instance_tags([{
            &apos;labels&apos;: {
                &apos;environment&apos;: &apos;test&apos;,
                &apos;managed-by&apos;: &apos;pulumi&apos;,
                &apos;project&apos;: &apos;test-project&apos;
            }
        }]))

    def test_sql_instance_has_backup_enabled(self):
        &quot;&quot;&quot;Test that SQL instances have backup enabled&quot;&quot;&quot;
        
        def check_sql_backup(args: list[Any]) -&amp;gt; bool:
            instance_args = args[0]
            settings = instance_args.get(&apos;settings&apos;, {})
            backup_config = settings.get(&apos;backup_configuration&apos;, {})
            return backup_config.get(&apos;enabled&apos;, False)
        
        # Test SQL configuration
        self.assertTrue(check_sql_backup([{
            &apos;settings&apos;: {
                &apos;backup_configuration&apos;: {
                    &apos;enabled&apos;: True,
                    &apos;start_time&apos;: &apos;03:00&apos;
                }
            }
        }]))

if __name__ == &apos;__main__&apos;:
    unittest.main()


Integration Testing Script:

#!/bin/bash
# scripts/integration-test.sh

set -euo pipefail

echo &quot;Starting Pulumi infrastructure integration tests...&quot;

# Test environment variables
export PULUMI_STACK_NAME=&quot;integration-test-$(date +%s)&quot;
export PULUMI_CONFIG_PASSPHRASE=&quot;test-passphrase&quot;

# Initialize test stack
pulumi stack init &quot;$PULUMI_STACK_NAME&quot;

# Set test configuration
pulumi config set gcp:project integration-test-project
pulumi config set gcp:region us-central1

# Deploy infrastructure
echo &quot;Deploying test infrastructure...&quot;
pulumi up --yes --skip-preview

# Run tests against deployed infrastructure
echo &quot;Running integration tests...&quot;

# Test 1: Verify bucket accessibility
BUCKET_NAME=$(pulumi stack output bucket_name)
if gsutil ls &quot;gs://$BUCKET_NAME&quot; &amp;gt; /dev/null 2&amp;gt;&amp;amp;1; then
    echo &quot;âœ… Bucket accessibility test passed&quot;
else
    echo &quot;âŒ Bucket accessibility test failed&quot;
    exit 1
fi

# Test 2: Verify compute instance connectivity
INSTANCE_IP=$(pulumi stack output instance_external_ip)
if curl -s --connect-timeout 10 &quot;http://$INSTANCE_IP&quot; &amp;gt; /dev/null; then
    echo &quot;âœ… Instance connectivity test passed&quot;
else
    echo &quot;âŒ Instance connectivity test failed&quot;
    exit 1
fi

# Test 3: Verify database connectivity
SQL_INSTANCE=$(pulumi stack output sql_instance_name)
if gcloud sql instances describe &quot;$SQL_INSTANCE&quot; --format=&quot;value(state)&quot; | grep -q &quot;RUNNABLE&quot;; then
    echo &quot;âœ… Database connectivity test passed&quot;
else
    echo &quot;âŒ Database connectivity test failed&quot;
    exit 1
fi

# Cleanup test resources
echo &quot;Cleaning up test infrastructure...&quot;
pulumi destroy --yes --skip-preview
pulumi stack rm --yes

echo &quot;âœ… All integration tests passed successfully!&quot;




3. Resource State Management and Recovery

State Recovery Procedures:

#!/bin/bash
# scripts/state-recovery.sh

set -euo pipefail

STACK_NAME=&quot;${1:-production}&quot;
BACKUP_DIR=&quot;./state-backups/$(date +%Y%m%d_%H%M%S)&quot;

echo &quot;Performing state backup and recovery for stack: $STACK_NAME&quot;

# Create backup directory
mkdir -p &quot;$BACKUP_DIR&quot;

# Export current state
pulumi stack select &quot;$STACK_NAME&quot;
pulumi stack export &amp;gt; &quot;$BACKUP_DIR/stack-state.json&quot;

# Export stack configuration
pulumi config &amp;gt; &quot;$BACKUP_DIR/stack-config.txt&quot;

# Create stack metadata
cat &amp;gt; &quot;$BACKUP_DIR/metadata.json&quot; &amp;lt;&amp;lt; EOF
{
    &quot;stack_name&quot;: &quot;$STACK_NAME&quot;,
    &quot;backup_timestamp&quot;: &quot;$(date -u +%Y-%m-%dT%H:%M:%SZ)&quot;,
    &quot;pulumi_version&quot;: &quot;$(pulumi version)&quot;,
    &quot;git_commit&quot;: &quot;$(git rev-parse HEAD 2&amp;gt;/dev/null || echo &apos;unknown&apos;)&quot;,
    &quot;git_branch&quot;: &quot;$(git branch --show-current 2&amp;gt;/dev/null || echo &apos;unknown&apos;)&quot;
}
EOF

echo &quot;âœ… State backup completed: $BACKUP_DIR&quot;

# Validate state integrity
if pulumi stack export --file &quot;$BACKUP_DIR/validation-state.json&quot;; then
    if diff &quot;$BACKUP_DIR/stack-state.json&quot; &quot;$BACKUP_DIR/validation-state.json&quot; &amp;gt; /dev/null; then
        echo &quot;âœ… State backup integrity verified&quot;
        rm &quot;$BACKUP_DIR/validation-state.json&quot;
    else
        echo &quot;âŒ State backup integrity check failed&quot;
        exit 1
    fi
fi

# Compress backup
tar -czf &quot;$BACKUP_DIR.tar.gz&quot; -C &quot;$(dirname &quot;$BACKUP_DIR&quot;)&quot; &quot;$(basename &quot;$BACKUP_DIR&quot;)&quot;
rm -rf &quot;$BACKUP_DIR&quot;

echo &quot;âœ… Compressed backup created: $BACKUP_DIR.tar.gz&quot;


Resource Import and State Repair:

# scripts/resource-import.py
&quot;&quot;&quot;Script for importing existing resources into Pulumi state&quot;&quot;&quot;

import subprocess
import json
import sys
from typing import Dict, List

def import_gcp_resources(project_id: str, region: str) -&amp;gt; None:
    &quot;&quot;&quot;Import existing GCP resources into Pulumi state&quot;&quot;&quot;
    
    # Resource import mappings
    import_mappings = [
        {
            &quot;resource_type&quot;: &quot;gcp:compute/network:Network&quot;,
            &quot;pulumi_name&quot;: &quot;imported-vpc&quot;,
            &quot;gcp_resource&quot;: f&quot;projects/{project_id}/global/networks/default&quot;
        },
        {
            &quot;resource_type&quot;: &quot;gcp:storage/bucket:Bucket&quot;, 
            &quot;pulumi_name&quot;: &quot;imported-bucket&quot;,
            &quot;gcp_resource&quot;: f&quot;existing-bucket-name&quot;
        }
    ]
    
    print(f&quot;Importing {len(import_mappings)} resources...&quot;)
    
    for mapping in import_mappings:
        try:
            cmd = [
                &quot;pulumi&quot;, &quot;import&quot;,
                mapping[&quot;resource_type&quot;],
                mapping[&quot;pulumi_name&quot;], 
                mapping[&quot;gcp_resource&quot;]
            ]
            
            result = subprocess.run(cmd, capture_output=True, text=True)
            
            if result.returncode == 0:
                print(f&quot;âœ… Successfully imported {mapping[&apos;pulumi_name&apos;]}&quot;)
            else:
                print(f&quot;âŒ Failed to import {mapping[&apos;pulumi_name&apos;]}: {result.stderr}&quot;)
                
        except Exception as e:
            print(f&quot;âŒ Error importing {mapping[&apos;pulumi_name&apos;]}: {str(e)}&quot;)

def validate_imported_state() -&amp;gt; bool:
    &quot;&quot;&quot;Validate that imported resources match expected state&quot;&quot;&quot;
    
    try:
        # Run pulumi preview to check for drift
        result = subprocess.run(
            [&quot;pulumi&quot;, &quot;preview&quot;, &quot;--diff&quot;, &quot;--json&quot;],
            capture_output=True,
            text=True
        )
        
        if result.returncode == 0:
            preview_data = json.loads(result.stdout)
            changes = preview_data.get(&quot;changeSummary&quot;, {})
            
            if changes.get(&quot;create&quot;, 0) == 0 and changes.get(&quot;update&quot;, 0) == 0:
                print(&quot;âœ… No drift detected - import successful&quot;)
                return True
            else:
                print(f&quot;âš ï¸  Drift detected: {changes}&quot;)
                return False
        else:
            print(f&quot;âŒ Preview failed: {result.stderr}&quot;)
            return False
            
    except Exception as e:
        print(f&quot;âŒ Validation error: {str(e)}&quot;)
        return False

if __name__ == &quot;__main__&quot;:
    if len(sys.argv) != 3:
        print(&quot;Usage: python resource-import.py &amp;lt;project_id&amp;gt; &amp;lt;region&amp;gt;&quot;)
        sys.exit(1)
    
    project_id = sys.argv[1]
    region = sys.argv[2]
    
    import_gcp_resources(project_id, region)
    
    if validate_imported_state():
        print(&quot;ðŸŽ‰ Resource import completed successfully!&quot;)
    else:
        print(&quot;âš ï¸  Import completed with warnings - manual review required&quot;)






Advanced Configuration and Patterns



1. Configuration Management and Secrets

Secure Configuration Handling:

# config/environments.py
&quot;&quot;&quot;Environment-specific configuration management&quot;&quot;&quot;

import pulumi
from pulumi import Config, get_stack
from typing import Dict, Any

class EnvironmentConfig:
    def __init__(self):
        self.config = Config()
        self.stack = get_stack()
        
    def get_environment_config(self) -&amp;gt; Dict[str, Any]:
        &quot;&quot;&quot;Get environment-specific configuration&quot;&quot;&quot;
        
        base_config = {
            &quot;project_id&quot;: self.config.require(&quot;gcp:project&quot;),
            &quot;region&quot;: self.config.get(&quot;gcp:region&quot;) or &quot;us-central1&quot;,
            &quot;environment&quot;: self.stack,
            &quot;common_tags&quot;: {
                &quot;environment&quot;: self.stack,
                &quot;managed_by&quot;: &quot;pulumi&quot;,
                &quot;project&quot;: self.config.require(&quot;gcp:project&quot;)
            }
        }
        
        # Environment-specific overrides
        env_configs = {
            &quot;development&quot;: {
                &quot;instance_type&quot;: &quot;e2-micro&quot;,
                &quot;sql_tier&quot;: &quot;db-f1-micro&quot;,
                &quot;high_availability&quot;: False,
                &quot;backup_retention&quot;: 7,
                &quot;deletion_protection&quot;: False
            },
            &quot;staging&quot;: {
                &quot;instance_type&quot;: &quot;e2-small&quot;,
                &quot;sql_tier&quot;: &quot;db-g1-small&quot;, 
                &quot;high_availability&quot;: False,
                &quot;backup_retention&quot;: 14,
                &quot;deletion_protection&quot;: False
            },
            &quot;production&quot;: {
                &quot;instance_type&quot;: &quot;e2-standard-2&quot;,
                &quot;sql_tier&quot;: &quot;db-n1-standard-1&quot;,
                &quot;high_availability&quot;: True,
                &quot;backup_retention&quot;: 30,
                &quot;deletion_protection&quot;: True
            }
        }
        
        env_config = env_configs.get(self.stack, env_configs[&quot;development&quot;])
        return {**base_config, **env_config}
    
    def get_secrets(self) -&amp;gt; Dict[str, str]:
        &quot;&quot;&quot;Get secret configuration values&quot;&quot;&quot;
        
        return {
            &quot;db_password&quot;: self.config.require_secret(&quot;database_password&quot;),
            &quot;api_key&quot;: self.config.require_secret(&quot;api_key&quot;),
            &quot;ssl_cert&quot;: self.config.get_secret(&quot;ssl_certificate&quot;),
            &quot;ssl_key&quot;: self.config.get_secret(&quot;ssl_private_key&quot;)
        }

# Usage in main program
config_manager = EnvironmentConfig()
env_config = config_manager.get_environment_config()
secrets = config_manager.get_secrets()


Secret Management Integration:

#!/bin/bash
# scripts/setup-secrets.sh

set -euo pipefail

STACK_NAME=&quot;${1:-development}&quot;
SECRET_SOURCE=&quot;${2:-local}&quot;  # local, gcp-secret-manager, vault

echo &quot;Setting up secrets for stack: $STACK_NAME&quot;

pulumi stack select &quot;$STACK_NAME&quot;

case &quot;$SECRET_SOURCE&quot; in
    &quot;local&quot;)
        # Set secrets from local environment
        pulumi config set --secret database_password &quot;$(openssl rand -base64 32)&quot;
        pulumi config set --secret api_key &quot;$(uuidgen)&quot;
        ;;
        
    &quot;gcp-secret-manager&quot;)
        # Retrieve secrets from GCP Secret Manager
        PROJECT_ID=$(pulumi config get gcp:project)
        
        DB_PASSWORD=$(gcloud secrets versions access latest --secret=&quot;database-password&quot; --project=&quot;$PROJECT_ID&quot;)
        API_KEY=$(gcloud secrets versions access latest --secret=&quot;api-key&quot; --project=&quot;$PROJECT_ID&quot;)
        
        pulumi config set --secret database_password &quot;$DB_PASSWORD&quot;
        pulumi config set --secret api_key &quot;$API_KEY&quot;
        ;;
        
    &quot;vault&quot;)
        # Retrieve secrets from HashiCorp Vault
        export VAULT_ADDR=&quot;${VAULT_ADDR:-https://vault.company.com}&quot;
        
        DB_PASSWORD=$(vault kv get -field=password secret/database)
        API_KEY=$(vault kv get -field=key secret/api)
        
        pulumi config set --secret database_password &quot;$DB_PASSWORD&quot;
        pulumi config set --secret api_key &quot;$API_KEY&quot;
        ;;
        
    *)
        echo &quot;Unknown secret source: $SECRET_SOURCE&quot;
        echo &quot;Supported sources: local, gcp-secret-manager, vault&quot;
        exit 1
        ;;
esac

echo &quot;âœ… Secrets configured for stack: $STACK_NAME&quot;




2. Modular Infrastructure Components

Reusable Component Library:

# components/network.py
&quot;&quot;&quot;Reusable network infrastructure component&quot;&quot;&quot;

import pulumi
import pulumi_gcp as gcp
from typing import Dict, List, Optional

class NetworkComponent(pulumi.ComponentResource):
    def __init__(self, 
                 name: str,
                 project_id: str,
                 region: str,
                 cidr_block: str = &quot;10.0.0.0/16&quot;,
                 enable_nat: bool = True,
                 firewall_rules: Optional[List[Dict]] = None,
                 opts: Optional[pulumi.ResourceOptions] = None):
        
        super().__init__(&quot;custom:network:Network&quot;, name, {}, opts)
        
        # Create VPC
        self.vpc = gcp.compute.Network(f&quot;{name}-vpc&quot;,
            name=f&quot;{project_id}-{name}-vpc&quot;,
            auto_create_subnetworks=False,
            opts=pulumi.ResourceOptions(parent=self))
        
        # Create subnet
        self.subnet = gcp.compute.Subnetwork(f&quot;{name}-subnet&quot;,
            name=f&quot;{project_id}-{name}-subnet&quot;,
            ip_cidr_range=cidr_block,
            region=region,
            network=self.vpc.id,
            opts=pulumi.ResourceOptions(parent=self))
        
        # Create Cloud Router for NAT (if enabled)
        if enable_nat:
            self.router = gcp.compute.Router(f&quot;{name}-router&quot;,
                name=f&quot;{project_id}-{name}-router&quot;,
                region=region,
                network=self.vpc.id,
                opts=pulumi.ResourceOptions(parent=self))
            
            self.nat = gcp.compute.RouterNat(f&quot;{name}-nat&quot;,
                name=f&quot;{project_id}-{name}-nat&quot;,
                router=self.router.name,
                region=region,
                nat_ip_allocate_option=&quot;AUTO_ONLY&quot;,
                source_subnetwork_ip_ranges_to_nat=&quot;ALL_SUBNETWORKS_ALL_IP_RANGES&quot;,
                opts=pulumi.ResourceOptions(parent=self))
        
        # Create firewall rules
        self.firewall_rules = []
        default_rules = [
            {
                &quot;name&quot;: &quot;allow-internal&quot;,
                &quot;allows&quot;: [{&quot;protocol&quot;: &quot;tcp&quot;}, {&quot;protocol&quot;: &quot;udp&quot;}, {&quot;protocol&quot;: &quot;icmp&quot;}],
                &quot;source_ranges&quot;: [cidr_block],
                &quot;description&quot;: &quot;Allow internal communication&quot;
            },
            {
                &quot;name&quot;: &quot;allow-ssh&quot;,
                &quot;allows&quot;: [{&quot;protocol&quot;: &quot;tcp&quot;, &quot;ports&quot;: [&quot;22&quot;]}],
                &quot;source_ranges&quot;: [&quot;0.0.0.0/0&quot;],
                &quot;target_tags&quot;: [&quot;ssh-allowed&quot;],
                &quot;description&quot;: &quot;Allow SSH access&quot;
            }
        ]
        
        rules = firewall_rules or default_rules
        
        for rule in rules:
            firewall = gcp.compute.Firewall(f&quot;{name}-{rule[&apos;name&apos;]}&quot;,
                name=f&quot;{project_id}-{name}-{rule[&apos;name&apos;]}&quot;,
                network=self.vpc.id,
                allows=[gcp.compute.FirewallAllowArgs(**allow) for allow in rule[&quot;allows&quot;]],
                source_ranges=rule.get(&quot;source_ranges&quot;, []),
                target_tags=rule.get(&quot;target_tags&quot;, []),
                description=rule.get(&quot;description&quot;, &quot;&quot;),
                opts=pulumi.ResourceOptions(parent=self))
            
            self.firewall_rules.append(firewall)
        
        # Register outputs
        self.register_outputs({
            &quot;vpc_id&quot;: self.vpc.id,
            &quot;vpc_name&quot;: self.vpc.name,
            &quot;subnet_id&quot;: self.subnet.id,
            &quot;subnet_name&quot;: self.subnet.name
        })


# components/compute.py
&quot;&quot;&quot;Reusable compute infrastructure component&quot;&quot;&quot;

import pulumi
import pulumi_gcp as gcp
from typing import Dict, List, Optional

class ComputeComponent(pulumi.ComponentResource):
    def __init__(self,
                 name: str,
                 project_id: str,
                 zone: str,
                 vpc_network: str,
                 subnet_network: str,
                 machine_type: str = &quot;e2-medium&quot;,
                 image: str = &quot;ubuntu-os-cloud/ubuntu-2004-lts&quot;,
                 startup_script: Optional[str] = None,
                 ssh_keys: Optional[List[str]] = None,
                 tags: Optional[List[str]] = None,
                 opts: Optional[pulumi.ResourceOptions] = None):
        
        super().__init__(&quot;custom:compute:Instance&quot;, name, {}, opts)
        
        # Create static IP
        self.static_ip = gcp.compute.Address(f&quot;{name}-ip&quot;,
            name=f&quot;{project_id}-{name}-ip&quot;,
            region=zone.rsplit(&apos;-&apos;, 1)[0],
            opts=pulumi.ResourceOptions(parent=self))
        
        # Create service account
        self.service_account = gcp.serviceaccount.Account(f&quot;{name}-sa&quot;,
            account_id=f&quot;{project_id}-{name}-sa&quot;,
            display_name=f&quot;{name} Service Account&quot;,
            opts=pulumi.ResourceOptions(parent=self))
        
        # Default startup script if none provided
        default_startup_script = &quot;&quot;&quot;#!/bin/bash
        apt-get update
        apt-get install -y nginx
        systemctl start nginx
        systemctl enable nginx
        &quot;&quot;&quot;
        
        # Prepare metadata
        metadata = {
            &quot;startup-script&quot;: startup_script or default_startup_script,
            &quot;enable-oslogin&quot;: &quot;TRUE&quot;
        }
        
        if ssh_keys:
            metadata[&quot;ssh-keys&quot;] = &quot;\n&quot;.join(ssh_keys)
        
        # Create compute instance
        self.instance = gcp.compute.Instance(f&quot;{name}-instance&quot;,
            name=f&quot;{project_id}-{name}-instance&quot;,
            machine_type=machine_type,
            zone=zone,
            
            boot_disk=gcp.compute.InstanceBootDiskArgs(
                initialize_params=gcp.compute.InstanceBootDiskInitializeParamsArgs(
                    image=image,
                    size=20,
                    type=&quot;pd-ssd&quot;
                )
            ),
            
            network_interfaces=[gcp.compute.InstanceNetworkInterfaceArgs(
                network=vpc_network,
                subnetwork=subnet_network,
                access_configs=[gcp.compute.InstanceNetworkInterfaceAccessConfigArgs(
                    nat_ip=self.static_ip.address
                )]
            )],
            
            service_account=gcp.compute.InstanceServiceAccountArgs(
                email=self.service_account.email,
                scopes=[
                    &quot;https://www.googleapis.com/auth/devstorage.read_only&quot;,
                    &quot;https://www.googleapis.com/auth/logging.write&quot;,
                    &quot;https://www.googleapis.com/auth/monitoring.write&quot;
                ]
            ),
            
            metadata=metadata,
            tags=tags or [],
            allow_stopping_for_update=True,
            
            labels={
                &quot;managed-by&quot;: &quot;pulumi&quot;,
                &quot;component&quot;: name
            },
            
            opts=pulumi.ResourceOptions(parent=self))
        
        # Register outputs
        self.register_outputs({
            &quot;instance_id&quot;: self.instance.id,
            &quot;instance_name&quot;: self.instance.name,
            &quot;external_ip&quot;: self.static_ip.address,
            &quot;internal_ip&quot;: self.instance.network_interfaces[0].network_ip
        })


Component Usage Example:

# __main__.py - Using reusable components
&quot;&quot;&quot;Infrastructure deployment using reusable components&quot;&quot;&quot;

import pulumi
from components.network import NetworkComponent
from components.compute import ComputeComponent
from config.environments import EnvironmentConfig

# Load configuration
config_manager = EnvironmentConfig()
env_config = config_manager.get_environment_config()

# Create network infrastructure
network = NetworkComponent(
    name=&quot;main&quot;,
    project_id=env_config[&quot;project_id&quot;],
    region=env_config[&quot;region&quot;],
    cidr_block=&quot;10.0.0.0/16&quot;,
    enable_nat=True
)

# Create compute infrastructure
web_server = ComputeComponent(
    name=&quot;web&quot;,
    project_id=env_config[&quot;project_id&quot;],
    zone=f&quot;{env_config[&apos;region&apos;]}-a&quot;,
    vpc_network=network.vpc.self_link,
    subnet_network=network.subnet.self_link,
    machine_type=env_config[&quot;instance_type&quot;],
    tags=[&quot;http-allowed&quot;, &quot;ssh-allowed&quot;],
    startup_script=&quot;&quot;&quot;#!/bin/bash
    apt-get update
    apt-get install -y nginx
    
    cat &amp;gt; /var/www/html/index.html &amp;lt;&amp;lt; &apos;EOF&apos;
    &amp;lt;!DOCTYPE html&amp;gt;
    &amp;lt;html&amp;gt;
    &amp;lt;head&amp;gt;
        &amp;lt;title&amp;gt;Pulumi Component Demo&amp;lt;/title&amp;gt;
        &amp;lt;style&amp;gt;
            body { font-family: Arial, sans-serif; margin: 40px; text-align: center; }
            .container { max-width: 600px; margin: 0 auto; }
            .status { color: #28a745; font-weight: bold; }
        &amp;lt;/style&amp;gt;
    &amp;lt;/head&amp;gt;
    &amp;lt;body&amp;gt;
        &amp;lt;div class=&quot;container&quot;&amp;gt;
            &amp;lt;h1&amp;gt;ðŸ—ï¸ Pulumi Component Architecture&amp;lt;/h1&amp;gt;
            &amp;lt;p class=&quot;status&quot;&amp;gt;âœ… Deployed using reusable components&amp;lt;/p&amp;gt;
            &amp;lt;p&amp;gt;Environment: {environment}&amp;lt;/p&amp;gt;
            &amp;lt;p&amp;gt;Stack: {stack}&amp;lt;/p&amp;gt;
        &amp;lt;/div&amp;gt;
    &amp;lt;/body&amp;gt;
    &amp;lt;/html&amp;gt;
    EOF
    
    sed -i &apos;s/{environment}/&apos;$PULUMI_STACK&apos;/g&apos; /var/www/html/index.html
    sed -i &apos;s/{stack}/&apos;$PULUMI_STACK&apos;/g&apos; /var/www/html/index.html
    
    systemctl restart nginx
    &quot;&quot;&quot;)

# Export important outputs
pulumi.export(&quot;vpc_id&quot;, network.vpc.id)
pulumi.export(&quot;subnet_id&quot;, network.subnet.id)
pulumi.export(&quot;web_server_ip&quot;, web_server.static_ip.address)
pulumi.export(&quot;web_server_url&quot;, pulumi.Output.concat(&quot;http://&quot;, web_server.static_ip.address))
pulumi.export(&quot;environment&quot;, env_config[&quot;environment&quot;])






Troubleshooting and Best Practices



1. Common Issues and Resolution

Authentication and Permissions:

#!/bin/bash
# scripts/troubleshoot-auth.sh

echo &quot;ðŸ” Pulumi Authentication Troubleshooting&quot;

# Check Pulumi login status
echo &quot;Checking Pulumi authentication...&quot;
if pulumi whoami &amp;gt; /dev/null 2&amp;gt;&amp;amp;1; then
    echo &quot;âœ… Pulumi authentication: $(pulumi whoami)&quot;
else
    echo &quot;âŒ Pulumi authentication failed&quot;
    echo &quot;Run: pulumi login&quot;
    exit 1
fi

# Check GCP authentication
echo &quot;Checking GCP authentication...&quot;
if gcloud auth list --filter=status:ACTIVE --format=&quot;value(account)&quot; | head -n1 &amp;gt; /dev/null; then
    echo &quot;âœ… GCP authentication: $(gcloud auth list --filter=status:ACTIVE --format=&quot;value(account)&quot; | head -n1)&quot;
else
    echo &quot;âŒ GCP authentication failed&quot;
    echo &quot;Run: gcloud auth login&quot;
    exit 1
fi

# Check GCP project access
PROJECT_ID=$(pulumi config get gcp:project 2&amp;gt;/dev/null || echo &quot;&quot;)
if [ -n &quot;$PROJECT_ID&quot; ]; then
    if gcloud projects describe &quot;$PROJECT_ID&quot; &amp;gt; /dev/null 2&amp;gt;&amp;amp;1; then
        echo &quot;âœ… GCP project access: $PROJECT_ID&quot;
    else
        echo &quot;âŒ Cannot access GCP project: $PROJECT_ID&quot;
        echo &quot;Check project ID and permissions&quot;
        exit 1
    fi
else
    echo &quot;âš ï¸  No GCP project configured&quot;
    echo &quot;Run: pulumi config set gcp:project YOUR_PROJECT_ID&quot;
fi

# Check required APIs
echo &quot;Checking required GCP APIs...&quot;
required_apis=(
    &quot;compute.googleapis.com&quot;
    &quot;storage.googleapis.com&quot;
    &quot;sqladmin.googleapis.com&quot;
    &quot;iam.googleapis.com&quot;
)

for api in &quot;${required_apis[@]}&quot;; do
    if gcloud services list --enabled --filter=&quot;name:$api&quot; --format=&quot;value(name)&quot; | grep -q &quot;$api&quot;; then
        echo &quot;âœ… API enabled: $api&quot;
    else
        echo &quot;âŒ API not enabled: $api&quot;
        echo &quot;Run: gcloud services enable $api&quot;
    fi
done

echo &quot;ðŸŽ‰ Authentication troubleshooting complete&quot;


State and Resource Issues:

#!/bin/bash
# scripts/troubleshoot-state.sh

set -euo pipefail

STACK_NAME=&quot;${1:-$(pulumi stack ls --json | jq -r &apos;.[] | select(.current) | .name&apos;)}&quot;

echo &quot;ðŸ” Troubleshooting Pulumi state for stack: $STACK_NAME&quot;

# Check stack status
echo &quot;Checking stack status...&quot;
if pulumi stack select &quot;$STACK_NAME&quot; &amp;gt; /dev/null 2&amp;gt;&amp;amp;1; then
    echo &quot;âœ… Stack exists and is accessible: $STACK_NAME&quot;
else
    echo &quot;âŒ Cannot access stack: $STACK_NAME&quot;
    pulumi stack ls
    exit 1
fi

# Check for stack locks
echo &quot;Checking for stack locks...&quot;
STACK_INFO=$(pulumi stack --show-urns --json 2&amp;gt;/dev/null || echo &apos;{}&apos;)
if echo &quot;$STACK_INFO&quot; | jq -e &apos;.deployment.info.locks&apos; &amp;gt; /dev/null 2&amp;gt;&amp;amp;1; then
    echo &quot;âš ï¸  Stack appears to be locked&quot;
    echo &quot;If you&apos;re sure no operations are running, you can cancel:&quot;
    echo &quot;pulumi cancel&quot;
else
    echo &quot;âœ… No stack locks detected&quot;
fi

# Validate current state
echo &quot;Validating current state...&quot;
if pulumi preview --diff &amp;gt; /dev/null 2&amp;gt;&amp;amp;1; then
    echo &quot;âœ… State is valid and up-to-date&quot;
else
    echo &quot;âš ï¸  State validation issues detected&quot;
    echo &quot;Run &apos;pulumi preview --diff&apos; for details&quot;
fi

# Check for orphaned resources
echo &quot;Checking for orphaned resources...&quot;
RESOURCES=$(pulumi stack --show-urns --json | jq -r &apos;.deployment.resources[]?.urn // empty&apos; 2&amp;gt;/dev/null || echo &quot;&quot;)
if [ -n &quot;$RESOURCES&quot; ]; then
    RESOURCE_COUNT=$(echo &quot;$RESOURCES&quot; | wc -l)
    echo &quot;âœ… Found $RESOURCE_COUNT managed resources&quot;
else
    echo &quot;âš ï¸  No managed resources found in state&quot;
fi

# Check backend connectivity
echo &quot;Checking backend connectivity...&quot;
BACKEND_URL=$(pulumi whoami --json | jq -r &apos;.url&apos;)
echo &quot;Backend URL: $BACKEND_URL&quot;

case &quot;$BACKEND_URL&quot; in
    &quot;https://app.pulumi.com&quot;*)
        echo &quot;âœ… Using Pulumi Service backend&quot;
        ;;
    &quot;gs://&quot;*)
        BUCKET_NAME=$(echo &quot;$BACKEND_URL&quot; | sed &apos;s|gs://||&apos; | cut -d&apos;/&apos; -f1)
        if gsutil ls &quot;gs://$BUCKET_NAME&quot; &amp;gt; /dev/null 2&amp;gt;&amp;amp;1; then
            echo &quot;âœ… GCS backend accessible: $BUCKET_NAME&quot;
        else
            echo &quot;âŒ Cannot access GCS backend: $BUCKET_NAME&quot;
        fi
        ;;
    *)
        echo &quot;â„¹ï¸  Using backend: $BACKEND_URL&quot;
        ;;
esac

echo &quot;ðŸŽ‰ State troubleshooting complete&quot;




2. Performance Optimization

Resource Import and Large-Scale Operations:

# scripts/bulk-import.py
&quot;&quot;&quot;Bulk import utility for existing GCP resources&quot;&quot;&quot;

import concurrent.futures
import subprocess
import json
import time
from typing import List, Dict, Tuple
from dataclasses import dataclass

@dataclass
class ImportTask:
    resource_type: str
    pulumi_name: str
    gcp_resource_id: str
    depends_on: List[str] = None

class BulkImporter:
    def __init__(self, max_workers: int = 5, retry_attempts: int = 3):
        self.max_workers = max_workers
        self.retry_attempts = retry_attempts
        self.import_results = {}
    
    def import_resource(self, task: ImportTask) -&amp;gt; Tuple[str, bool, str]:
        &quot;&quot;&quot;Import a single resource with retry logic&quot;&quot;&quot;
        
        for attempt in range(self.retry_attempts):
            try:
                cmd = [
                    &quot;pulumi&quot;, &quot;import&quot;, 
                    task.resource_type,
                    task.pulumi_name,
                    task.gcp_resource_id
                ]
                
                result = subprocess.run(
                    cmd, 
                    capture_output=True, 
                    text=True,
                    timeout=300  # 5 minute timeout
                )
                
                if result.returncode == 0:
                    return task.pulumi_name, True, &quot;Success&quot;
                else:
                    error_msg = result.stderr.strip()
                    if &quot;already exists&quot; in error_msg.lower():
                        return task.pulumi_name, True, &quot;Already exists&quot;
                    elif attempt &amp;lt; self.retry_attempts - 1:
                        time.sleep(2 ** attempt)  # Exponential backoff
                        continue
                    else:
                        return task.pulumi_name, False, error_msg
                        
            except subprocess.TimeoutExpired:
                if attempt &amp;lt; self.retry_attempts - 1:
                    time.sleep(2 ** attempt)
                    continue
                else:
                    return task.pulumi_name, False, &quot;Timeout&quot;
            except Exception as e:
                if attempt &amp;lt; self.retry_attempts - 1:
                    time.sleep(2 ** attempt)
                    continue
                else:
                    return task.pulumi_name, False, str(e)
        
        return task.pulumi_name, False, &quot;Max retries exceeded&quot;
    
    def import_resources_batch(self, tasks: List[ImportTask]) -&amp;gt; Dict[str, Dict]:
        &quot;&quot;&quot;Import multiple resources concurrently&quot;&quot;&quot;
        
        print(f&quot;Importing {len(tasks)} resources with {self.max_workers} workers...&quot;)
        
        with concurrent.futures.ThreadPoolExecutor(max_workers=self.max_workers) as executor:
            # Submit all tasks
            future_to_task = {
                executor.submit(self.import_resource, task): task 
                for task in tasks
            }
            
            # Collect results
            for future in concurrent.futures.as_completed(future_to_task):
                task = future_to_task[future]
                name, success, message = future.result()
                
                self.import_results[name] = {
                    &quot;success&quot;: success,
                    &quot;message&quot;: message,
                    &quot;resource_type&quot;: task.resource_type,
                    &quot;gcp_id&quot;: task.gcp_resource_id
                }
                
                status = &quot;âœ…&quot; if success else &quot;âŒ&quot;
                print(f&quot;{status} {name}: {message}&quot;)
        
        return self.import_results
    
    def generate_import_report(self) -&amp;gt; str:
        &quot;&quot;&quot;Generate a summary report of import operations&quot;&quot;&quot;
        
        total = len(self.import_results)
        successful = sum(1 for r in self.import_results.values() if r[&quot;success&quot;])
        failed = total - successful
        
        report = f&quot;&quot;&quot;
Import Summary Report
====================
Total resources: {total}
Successful: {successful}
Failed: {failed}
Success rate: {(successful/total*100):.1f}%

Failed Imports:
&quot;&quot;&quot;
        
        for name, result in self.import_results.items():
            if not result[&quot;success&quot;]:
                report += f&quot;- {name}: {result[&apos;message&apos;]}\n&quot;
        
        return report

# Example usage
def main():
    importer = BulkImporter(max_workers=3)
    
    # Define import tasks
    import_tasks = [
        ImportTask(
            resource_type=&quot;gcp:compute/network:Network&quot;,
            pulumi_name=&quot;main-vpc&quot;,
            gcp_resource_id=&quot;projects/my-project/global/networks/main-vpc&quot;
        ),
        ImportTask(
            resource_type=&quot;gcp:compute/subnetwork:Subnetwork&quot;, 
            pulumi_name=&quot;main-subnet&quot;,
            gcp_resource_id=&quot;projects/my-project/regions/us-central1/subnetworks/main-subnet&quot;
        ),
        ImportTask(
            resource_type=&quot;gcp:storage/bucket:Bucket&quot;,
            pulumi_name=&quot;app-storage&quot;,
            gcp_resource_id=&quot;my-app-storage-bucket&quot;
        )
    ]
    
    # Execute imports
    results = importer.import_resources_batch(import_tasks)
    
    # Generate report
    report = importer.generate_import_report()
    print(report)
    
    # Save report to file
    with open(&quot;import-report.txt&quot;, &quot;w&quot;) as f:
        f.write(report)

if __name__ == &quot;__main__&quot;:
    main()




3. Enterprise Best Practices

Production Deployment Checklist:

# .pulumi/deployment-checklist.yml
pre_deployment:
  authentication:
    - [ ] Verify cloud provider credentials are valid
    - [ ] Confirm service account permissions are sufficient
    - [ ] Test API access to all required services
    - [ ] Validate Pulumi backend connectivity
  
  configuration:
    - [ ] Review all stack configuration values
    - [ ] Verify secrets are properly encrypted
    - [ ] Confirm environment-specific settings
    - [ ] Validate resource naming conventions
  
  code_quality:
    - [ ] Run unit tests on infrastructure code
    - [ ] Execute linting and static analysis
    - [ ] Perform security scanning of configurations
    - [ ] Review resource dependencies and ordering
  
  state_management:
    - [ ] Backup current state before changes
    - [ ] Verify state backend accessibility
    - [ ] Check for state locks or concurrent operations
    - [ ] Validate state integrity

deployment:
  preview_phase:
    - [ ] Run &apos;pulumi preview&apos; to review changes
    - [ ] Analyze resource creation/modification/deletion
    - [ ] Verify no unexpected changes are present
    - [ ] Confirm deployment scope matches expectations
  
  execution_phase:
    - [ ] Monitor deployment progress actively
    - [ ] Watch for error messages or warnings
    - [ ] Verify critical resources are created successfully
    - [ ] Check service health after deployment
  
  validation_phase:
    - [ ] Test application functionality
    - [ ] Verify network connectivity
    - [ ] Confirm security group rules are working
    - [ ] Validate monitoring and logging setup

post_deployment:
  documentation:
    - [ ] Update infrastructure documentation
    - [ ] Record deployment notes and issues
    - [ ] Update runbooks with any changes
    - [ ] Communicate changes to relevant teams
  
  monitoring:
    - [ ] Verify monitoring alerts are working
    - [ ] Check resource utilization metrics
    - [ ] Confirm backup procedures are operational
    - [ ] Test disaster recovery procedures
  
  security:
    - [ ] Perform security configuration review
    - [ ] Validate access controls and permissions
    - [ ] Check for exposed sensitive data
    - [ ] Review audit logging configuration

maintenance:
  ongoing_tasks:
    - [ ] Schedule regular state backups
    - [ ] Plan for periodic security updates
    - [ ] Monitor for configuration drift
    - [ ] Review and optimize resource costs
  
  incident_response:
    - [ ] Document rollback procedures
    - [ ] Test emergency response protocols
    - [ ] Maintain up-to-date contact information
    - [ ] Keep disaster recovery documentation current






Conclusion

Pulumi represents a transformative approach to Infrastructure as Code, enabling developers to leverage familiar programming languages and tools for cloud infrastructure management. By bridging the gap between application development and infrastructure operations, Pulumi empowers teams to apply software engineering best practices to infrastructure.



Key Advantages of Pulumi:


  Developer Productivity: Native IDE support, debugging, and testing capabilities
  Language Flexibility: Choice of Python, TypeScript, Go, C#, and Java
  Enterprise Ready: Advanced state management, RBAC, and compliance features
  Multi-Cloud Support: Consistent experience across AWS, GCP, Azure, and Kubernetes
  Component Reusability: Build and share infrastructure components as packages




Implementation Success Factors:


  Strategic Planning: Start with pilot projects and gradually expand adoption
  Team Training: Invest in developer education and best practices
  Automation Integration: Implement CI/CD pipelines for infrastructure deployment
  Security Focus: Establish secure configuration and secret management practices
  Monitoring: Implement comprehensive state monitoring and drift detection


Enterprise Adoption Roadmap:

  Pilot Phase: Deploy non-critical infrastructure with small teams
  Expansion Phase: Scale to additional projects and environments
  Standardization Phase: Establish company-wide patterns and components
  Optimization Phase: Implement advanced automation and governance
  Innovation Phase: Explore cutting-edge infrastructure patterns




Pulumi enables organizations to treat infrastructure as software, bringing the same discipline, reliability, and velocity that characterizes modern software development to infrastructure management.

By combining the power of general-purpose programming languages with declarative infrastructure principles, Pulumi provides a future-proof foundation for cloud infrastructure automation.


  â€œPulumi doesnâ€™t just enable Infrastructure as Codeâ€”it enables Infrastructure as Software, where infrastructure becomes a first-class citizen in the software development lifecycle.â€






References


  Pulumi Official Documentation
  Pulumi Python SDK Reference
  Google Cloud Provider for Pulumi
  Pulumi Examples Repository
  Pulumi Best Practices Guide
  Google Cloud IAM Best Practices
  Pulumi State and Backends
  Infrastructure Testing with Pulumi
  Pulumi CI/CD Integration Guide
  Google Cloud Architecture Center

",
            "wordcount": "11545",
            "inLanguage": "en",
            "dateCreated": "2025-11-30/",
            "datePublished": "2025-11-30/",
            "dateModified": "2025-11-30/",
            "author": {
                "@type": "Person",
                "name": "Somaz",
                
                "image": "/assets/img/uploads/profile.png",
                
                "jobTitle": "DevOps Engineer",
                "url": "https://somaz.blog/authors/somaz/",
                "sameAs": [
                    "https://github.com/somaz94","https://www.linkedin.com/in/somaz"
                ]
            },
            "publisher": {
                "@type": "Organization",
                "name": "somaz",
                "url": "https://somaz.blog/",
                "logo": {
                    "@type": "ImageObject",
                    "url": "https://somaz.blog/assets/img/blog-image.png",
                    "width": "600",
                    "height": "315"
                }
            },
            "mainEntityOfPage": "True",
            "genre": "IAC",
            "articleSection": "IAC",
            "keywords": ["pulumi","infrastructure-as-code","cloud-automation","python","typescript","gcp","aws","kubernetes","state-management","devops"]
        }
        </script>
    </body>
</html>
