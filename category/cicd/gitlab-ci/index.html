<!DOCTYPE html>
<html lang="en" class="no-js">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    

    
    

    
    

    
    

    <!-- ✅ Google Tag Manager 추가 -->
    <script>
        (function(w,d,s,l,i){
            w[l]=w[l]||[];
            w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
            var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
            j.async=true;
            j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
            f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-MBP83N4Q');
    </script>
      <!-- ✅ End Google Tag Manager -->

    <!-- Mermaid.js 직접 로드 -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>

    <title>GitLab CI/CD Pipeline Configuration Guide | somaz</title>
    <meta name="description" content="Learn about GitLab CI/CD, pipeline configurations, and practical examples">
    
        <meta name="keywords" content="gitlab, cicd, pipeline, automation">
    

    <!-- Social: Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="GitLab CI/CD Pipeline Configuration Guide | somaz">
    <meta name="twitter:description" content="Learn about GitLab CI/CD, pipeline configurations, and practical examples">

    
        <meta property="twitter:image" content="https://res.cloudinary.com/dkcm26aem/image/upload/v1737534792/gitlab-ci_v19gig.png">
    
    
    
        <meta name="twitter:site" content="@twitter_username">
    

    <!-- Social: Facebook / Open Graph -->
    <meta property="og:url" content="https://somaz.blog/category/cicd/gitlab-ci/">
    <meta property="og:title" content="GitLab CI/CD Pipeline Configuration Guide | somaz">
    <meta property="og:image" content="https://res.cloudinary.com/dkcm26aem/image/upload/v1737534792/gitlab-ci_v19gig.png">
    <meta property="og:description" content="Learn about GitLab CI/CD, pipeline configurations, and practical examples">
    <meta property="og:site_name" content="Somaz Tech Blog">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/assets/img/icons/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/img/icons/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/img/icons/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/img/icons/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/img/icons/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/img/icons/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/img/icons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/icons/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/img/icons/apple-touch-icon-152x152.png" />

    <!-- Windows 8 Tile Icons -->
    <meta name="application-name" content="somaz">
    <meta name="msapplication-TileColor" content="#141414">
    <meta name="msapplication-square70x70logo" content="smalltile.png" />
    <meta name="msapplication-square150x150logo" content="mediumtile.png" />
    <meta name="msapplication-wide310x150logo" content="widetile.png" />
    <meta name="msapplication-square310x310logo" content="largetile.png" />
    
    <!-- Android Lolipop Theme Color -->
    <meta name="theme-color" content="#141414">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Titillium+Web:300,400,700" rel="stylesheet">

    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="canonical" href="https://somaz.blog/category/cicd/gitlab-ci/">
    <link rel="alternate" type="application/rss+xml" title="Somaz Tech Blog" href="https://somaz.blog/feed.xml" />

    <!-- Include extra styles -->
    

    <!-- JavaScript enabled/disabled -->
    <script>
        document.querySelector('html').classList.remove('no-js');
    </script>

    <!-- Google Adsense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8725590811736154"
        crossorigin="anonymous"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"> -->
    <!-- <link href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/variable/woff2/SUIT-Variable.css" rel="stylesheet"> -->
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- <link href="https://fonts.googleapis.com/css2?family=Albert+Sans:wght@400;500;700&display=swap" rel="stylesheet"> -->

    <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml" />

</head>
<!-- ✅ Google Tag Manager (noscript) -->
<noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MBP83N4Q"
            height="0" width="0" style="display:none;visibility:hidden">
    </iframe>
</noscript>
<!-- ✅ End Google Tag Manager (noscript) -->
    <body class="has-push-menu">
        





        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" display="none" version="1.1"><defs><symbol id="icon-menu" viewBox="0 0 1024 1024"><path class="path1" d="M128 213.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 725.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 469.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5z"/></symbol><symbol id="icon-search" viewBox="0 0 951 1024"><path class="path1" d="M658.286 475.429q0-105.714-75.143-180.857t-180.857-75.143-180.857 75.143-75.143 180.857 75.143 180.857 180.857 75.143 180.857-75.143 75.143-180.857zM950.857 950.857q0 29.714-21.714 51.429t-51.429 21.714q-30.857 0-51.429-21.714l-196-195.429q-102.286 70.857-228 70.857-81.714 0-156.286-31.714t-128.571-85.714-85.714-128.571-31.714-156.286 31.714-156.286 85.714-128.571 128.571-85.714 156.286-31.714 156.286 31.714 128.571 85.714 85.714 128.571 31.714 156.286q0 125.714-70.857 228l196 196q21.143 21.143 21.143 51.429z"/></symbol><symbol id="icon-close" viewBox="0 0 1000 1000"><path d="M969.8,870.3c27,27.7,27,71.8,0,99.1C955.7,983,937.9,990,920,990c-17.9,0-35.7-7-49.7-20.7L500,599L129.6,969.4C115.6,983,97.8,990,79.9,990s-35.7-7-49.7-20.7c-27-27.3-27-71.4,0-99.1L400.9,500L30.3,129.3c-27-27.3-27-71.4,0-99.1c27.3-27,71.8-27,99.4,0L500,400.9L870.4,30.2c27.7-27,71.8-27,99.4,0c27,27.7,27,71.8,0,99.1L599.1,500L969.8,870.3z"/></symbol><symbol id="icon-twitter" viewBox="0 0 951 1024"><path class="path1" d="M925.714 233.143q-38.286 56-92.571 95.429 0.571 8 0.571 24 0 74.286-21.714 148.286t-66 142-105.429 120.286-147.429 83.429-184.571 31.143q-154.857 0-283.429-82.857 20 2.286 44.571 2.286 128.571 0 229.143-78.857-60-1.143-107.429-36.857t-65.143-91.143q18.857 2.857 34.857 2.857 24.571 0 48.571-6.286-64-13.143-106-63.714t-42-117.429v-2.286q38.857 21.714 83.429 23.429-37.714-25.143-60-65.714t-22.286-88q0-50.286 25.143-93.143 69.143 85.143 168.286 136.286t212.286 56.857q-4.571-21.714-4.571-42.286 0-76.571 54-130.571t130.571-54q80 0 134.857 58.286 62.286-12 117.143-44.571-21.143 65.714-81.143 101.714 53.143-5.714 106.286-28.571z"/></symbol><symbol id="icon-facebook" viewBox="0 0 585 1024"><path class="path1" d="M548 6.857v150.857h-89.714q-49.143 0-66.286 20.571t-17.143 61.714v108h167.429l-22.286 169.143h-145.143v433.714h-174.857v-433.714h-145.714v-169.143h145.714v-124.571q0-106.286 59.429-164.857t158.286-58.571q84 0 130.286 6.857z"/></symbol><symbol id="icon-clock" viewBox="0 0 1000 1000"><path d="M500,10C229.8,10,10,229.8,10,500c0,270.2,219.8,490,490,490c270.2,0,490-219.8,490-490C990,229.8,770.2,10,500,10z M500,910.2c-226.2,0-410.2-184-410.2-410.2c0-226.2,184-410.2,410.2-410.2c226.2,0,410.2,184,410.2,410.2C910.2,726.1,726.2,910.2,500,910.2z M753.1,374c8.2,11.9,5.2,28.1-6.6,36.3L509.9,573.7c-4.4,3.1-9.6,4.6-14.8,4.6c-4.1,0-8.3-1-12.1-3c-8.6-4.5-14-13.4-14-23.1V202.5c0-14.4,11.7-26.1,26.1-26.1c14.4,0,26.1,11.7,26.1,26.1v300l195.6-135.1C728.7,359.2,744.9,362.1,753.1,374z"/></symbol><symbol id="icon-calendar" viewBox="0 0 1000 1000"><path d="M920,500v420H80V500H920 M990,430H10v490c0,38.7,31.3,70,70,70h840c38.7,0,70-31.3,70-70V430L990,430z"/><path d="M850,80v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80H360v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80C72.8,80,10,142.7,10,220v140h980V220C990,142.7,927.2,80,850,80z"/><path d="M255,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C290,25.8,274.3,10,255,10z"/><path d="M745,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C780,25.8,764.3,10,745,10z"/></symbol><symbol id="icon-github" viewBox="0 0 12 14"><path d="M6 1q1.633 0 3.012 0.805t2.184 2.184 0.805 3.012q0 1.961-1.145 3.527t-2.957 2.168q-0.211 0.039-0.312-0.055t-0.102-0.234q0-0.023 0.004-0.598t0.004-1.051q0-0.758-0.406-1.109 0.445-0.047 0.801-0.141t0.734-0.305 0.633-0.52 0.414-0.82 0.16-1.176q0-0.93-0.617-1.609 0.289-0.711-0.062-1.594-0.219-0.070-0.633 0.086t-0.719 0.344l-0.297 0.187q-0.727-0.203-1.5-0.203t-1.5 0.203q-0.125-0.086-0.332-0.211t-0.652-0.301-0.664-0.105q-0.352 0.883-0.062 1.594-0.617 0.68-0.617 1.609 0 0.664 0.16 1.172t0.41 0.82 0.629 0.523 0.734 0.305 0.801 0.141q-0.305 0.281-0.383 0.805-0.164 0.078-0.352 0.117t-0.445 0.039-0.512-0.168-0.434-0.488q-0.148-0.25-0.379-0.406t-0.387-0.187l-0.156-0.023q-0.164 0-0.227 0.035t-0.039 0.090 0.070 0.109 0.102 0.094l0.055 0.039q0.172 0.078 0.34 0.297t0.246 0.398l0.078 0.18q0.102 0.297 0.344 0.48t0.523 0.234 0.543 0.055 0.434-0.027l0.18-0.031q0 0.297 0.004 0.691t0.004 0.426q0 0.141-0.102 0.234t-0.312 0.055q-1.812-0.602-2.957-2.168t-1.145-3.527q0-1.633 0.805-3.012t2.184-2.184 3.012-0.805zM2.273 9.617q0.023-0.055-0.055-0.094-0.078-0.023-0.102 0.016-0.023 0.055 0.055 0.094 0.070 0.047 0.102-0.016zM2.516 9.883q0.055-0.039-0.016-0.125-0.078-0.070-0.125-0.023-0.055 0.039 0.016 0.125 0.078 0.078 0.125 0.023zM2.75 10.234q0.070-0.055 0-0.148-0.062-0.102-0.133-0.047-0.070 0.039 0 0.141t0.133 0.055zM3.078 10.562q0.062-0.062-0.031-0.148-0.094-0.094-0.156-0.023-0.070 0.062 0.031 0.148 0.094 0.094 0.156 0.023zM3.523 10.758q0.023-0.086-0.102-0.125-0.117-0.031-0.148 0.055t0.102 0.117q0.117 0.047 0.148-0.047zM4.016 10.797q0-0.102-0.133-0.086-0.125 0-0.125 0.086 0 0.102 0.133 0.086 0.125 0 0.125-0.086zM4.469 10.719q-0.016-0.086-0.141-0.070-0.125 0.023-0.109 0.117t0.141 0.062 0.109-0.109z"></path></symbol><symbol id="icon-medium" viewBox="0 0 1000 1000"><path d="M336.5,240.2v641.5c0,9.1-2.3,16.9-6.8,23.2s-11.2,9.6-20,9.6c-6.2,0-12.2-1.5-18-4.4L37.3,782.7c-7.7-3.6-14.1-9.8-19.4-18.3S10,747.4,10,739V115.5c0-7.3,1.8-13.5,5.5-18.6c3.6-5.1,8.9-7.7,15.9-7.7c5.1,0,13.1,2.7,24.1,8.2l279.5,140C335.9,238.6,336.5,239.5,336.5,240.2L336.5,240.2z M371.5,295.5l292,473.6l-292-145.5V295.5z M990,305.3v576.4c0,9.1-2.6,16.5-7.7,22.1c-5.1,5.7-12,8.5-20.8,8.5s-17.3-2.4-25.7-7.1L694.7,784.9L990,305.3z M988.4,239.7c0,1.1-46.8,77.6-140.3,229.4C754.6,621,699.8,709.8,683.8,735.7L470.5,389l177.2-288.2c6.2-10.2,15.7-15.3,28.4-15.3c5.1,0,9.8,1.1,14.2,3.3l295.9,147.7C987.6,237.1,988.4,238.2,988.4,239.7L988.4,239.7z"/></symbol><symbol id="icon-instagram" viewBox="0 0 489.84 489.84"><path d="M249.62,50.46c65.4,0,73.14.25,99,1.43C372.47,53,385.44,57,394.07,60.32a75.88,75.88,0,0,1,28.16,18.32,75.88,75.88,0,0,1,18.32,28.16c3.35,8.63,7.34,21.6,8.43,45.48,1.18,25.83,1.43,33.57,1.43,99s-0.25,73.14-1.43,99c-1.09,23.88-5.08,36.85-8.43,45.48a81.11,81.11,0,0,1-46.48,46.48c-8.63,3.35-21.6,7.34-45.48,8.43-25.82,1.18-33.57,1.43-99,1.43s-73.15-.25-99-1.43c-23.88-1.09-36.85-5.08-45.48-8.43A75.88,75.88,0,0,1,77,423.86,75.88,75.88,0,0,1,58.69,395.7c-3.35-8.63-7.34-21.6-8.43-45.48-1.18-25.83-1.43-33.57-1.43-99s0.25-73.14,1.43-99c1.09-23.88,5.08-36.85,8.43-45.48A75.88,75.88,0,0,1,77,78.64a75.88,75.88,0,0,1,28.16-18.32c8.63-3.35,21.6-7.34,45.48-8.43,25.83-1.18,33.57-1.43,99-1.43m0-44.13c-66.52,0-74.86.28-101,1.47s-43.87,5.33-59.45,11.38A120.06,120.06,0,0,0,45.81,47.44,120.06,120.06,0,0,0,17.56,90.82C11.5,106.4,7.36,124.2,6.17,150.27s-1.47,34.46-1.47,101,0.28,74.86,1.47,101,5.33,43.87,11.38,59.45a120.06,120.06,0,0,0,28.25,43.38,120.06,120.06,0,0,0,43.38,28.25c15.58,6.05,33.38,10.19,59.45,11.38s34.46,1.47,101,1.47,74.86-.28,101-1.47,43.87-5.33,59.45-11.38a125.24,125.24,0,0,0,71.63-71.63c6.05-15.58,10.19-33.38,11.38-59.45s1.47-34.46,1.47-101-0.28-74.86-1.47-101-5.33-43.87-11.38-59.45a120.06,120.06,0,0,0-28.25-43.38,120.06,120.06,0,0,0-43.38-28.25C394.47,13.13,376.67,9,350.6,7.8s-34.46-1.47-101-1.47h0Z" transform="translate(-4.7 -6.33)" /><path d="M249.62,125.48A125.77,125.77,0,1,0,375.39,251.25,125.77,125.77,0,0,0,249.62,125.48Zm0,207.41a81.64,81.64,0,1,1,81.64-81.64A81.64,81.64,0,0,1,249.62,332.89Z" transform="translate(-4.7 -6.33)"/><circle cx="375.66" cy="114.18" r="29.39" /></symbol><symbol id="icon-linkedin" viewBox="0 0 12 14"><path d="M2.727 4.883v7.742h-2.578v-7.742h2.578zM2.891 2.492q0.008 0.57-0.395 0.953t-1.059 0.383h-0.016q-0.641 0-1.031-0.383t-0.391-0.953q0-0.578 0.402-0.957t1.051-0.379 1.039 0.379 0.398 0.957zM12 8.187v4.437h-2.57v-4.141q0-0.82-0.316-1.285t-0.988-0.465q-0.492 0-0.824 0.27t-0.496 0.668q-0.086 0.234-0.086 0.633v4.32h-2.57q0.016-3.117 0.016-5.055t-0.008-2.313l-0.008-0.375h2.57v1.125h-0.016q0.156-0.25 0.32-0.438t0.441-0.406 0.68-0.34 0.895-0.121q1.336 0 2.148 0.887t0.813 2.598z"></path></symbol><symbol id="icon-heart" viewBox="0 0 34 30"><path d="M17,29.7 L16.4,29.2 C3.5,18.7 0,15 0,9 C0,4 4,0 9,0 C13.1,0 15.4,2.3 17,4.1 C18.6,2.3 20.9,0 25,0 C30,0 34,4 34,9 C34,15 30.5,18.7 17.6,29.2 L17,29.7 Z M9,2 C5.1,2 2,5.1 2,9 C2,14.1 5.2,17.5 17,27.1 C28.8,17.5 32,14.1 32,9 C32,5.1 28.9,2 25,2 C21.5,2 19.6,4.1 18.1,5.8 L17,7.1 L15.9,5.8 C14.4,4.1 12.5,2 9,2 Z" id="Shape"></path></symbol><symbol id="icon-arrow-right" viewBox="0 0 25.452 25.452"><path d="M4.471,24.929v-2.004l12.409-9.788c0.122-0.101,0.195-0.251,0.195-0.411c0-0.156-0.073-0.31-0.195-0.409L4.471,2.526V0.522c0-0.2,0.115-0.384,0.293-0.469c0.18-0.087,0.396-0.066,0.552,0.061l15.47,12.202c0.123,0.1,0.195,0.253,0.195,0.409c0,0.16-0.072,0.311-0.195,0.411L5.316,25.34c-0.155,0.125-0.372,0.147-0.552,0.061C4.586,25.315,4.471,25.13,4.471,24.929z"/></symbol><symbol id="icon-star" viewBox="0 0 48 48"><path fill="currentColor" d="M44,24c0,11.045-8.955,20-20,20S4,35.045,4,24S12.955,4,24,4S44,12.955,44,24z"/><path fill="#ffffff" d="M24,11l3.898,7.898l8.703,1.301l-6.301,6.102l1.5,8.699L24,30.898L16.199,35l1.5-8.699l-6.301-6.102  l8.703-1.301L24,11z"/></symbol><symbol id="icon-read" viewBox="0 0 32 32"><path fill="currentColor" d="M29,4H3C1.343,4,0,5.343,0,7v18c0,1.657,1.343,3,3,3h10c0,0.552,0.448,1,1,1h4c0.552,0,1-0.448,1-1h10  c1.657,0,3-1.343,3-3V7C32,5.343,30.657,4,29,4z M29,5v20H18.708c-0.618,0-1.236,0.146-1.789,0.422l-0.419,0.21V5H29z M15.5,5  v20.632l-0.419-0.21C14.528,25.146,13.91,25,13.292,25H3V5H15.5z M31,25c0,1.103-0.897,2-2,2H18v1h-4v-1H3c-1.103,0-2-0.897-2-2V7  c0-0.737,0.405-1.375,1-1.722V25c0,0.552,0.448,1,1,1h10.292c0.466,0,0.925,0.108,1.342,0.317l0.919,0.46  c0.141,0.07,0.294,0.106,0.447,0.106c0.153,0,0.306-0.035,0.447-0.106l0.919-0.46C17.783,26.108,18.242,26,18.708,26H29  c0.552,0,1-0.448,1-1V5.278C30.595,5.625,31,6.263,31,7V25z M6,12.5C6,12.224,6.224,12,6.5,12h5c0.276,0,0.5,0.224,0.5,0.5  S11.776,13,11.5,13h-5C6.224,13,6,12.776,6,12.5z M6,14.5C6,14.224,6.224,14,6.5,14h5c0.276,0,0.5,0.224,0.5,0.5S11.776,15,11.5,15  h-5C6.224,15,6,14.776,6,14.5z M6,16.5C6,16.224,6.224,16,6.5,16h5c0.276,0,0.5,0.224,0.5,0.5S11.776,17,11.5,17h-5  C6.224,17,6,16.776,6,16.5z M20,12.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,13,25.5,13h-5  C20.224,13,20,12.776,20,12.5z M20,14.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,15,25.5,15h-5  C20.224,15,20,14.776,20,14.5z M20,16.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,17,25.5,17h-5  C20.224,17,20,16.776,20,16.5z"></path></symbol><symbol id="icon-tistory" viewBox="0 0 24 24"><path d="M4 4h16v3h-6v13h-4V7H4V4z"/></symbol></defs></svg>

        <header class="bar-header">
    <a id="menu" role="button">
        <svg id="open" class="icon-menu"><use xlink:href="#icon-menu"></use></svg>
    </a>
    <h1 class="logo">
        <a href="/">
            
                somaz <span class="version">v3.1.2</span>
            
        </a>
    </h1>
    <a id="search" class="dosearch" role="button">
        <svg class="icon-search"><use xlink:href="#icon-search"></use></svg>
    </a>
    
        <a href="https://github.com/thiagorossener/jekflix-template" class="get-theme" role="button">
            Get this theme!
        </a>
    
</header>

<div id="mask" class="overlay"></div>

<aside class="sidebar" id="sidebar">
    <nav id="navigation">
      <h2>Menu</h2>
      <ul>
  
    
      <li>
        <a href="https://somaz.blog/">Home</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/about">About</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/category">Category</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/contact">Contact</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/feed.xml">Feed</a>
      </li>
    
  
</ul>

    </nav>
</aside>

<div class="search-wrapper">
    <div class="search-form">
        <input type="text" class="search-field" placeholder="Search">
        <svg class="icon-remove-sign"><use xlink:href="#icon-close"></use></svg>
        <ul class="search-results search-list"></ul>
    </div>
</div>



        <section class="post two-columns">
            <article role="article" class="post-content">
                <p class="post-info">
                    
                        <svg class="icon-calendar" id="date"><use xlink:href="#icon-calendar"></use></svg>
                        <time class="date" datetime="2025-04-29T00:00:00+00:00">
                            


April 29, 2025

                        </time>
                    
                    <svg id="clock" class="icon-clock"><use xlink:href="#icon-clock"></use></svg>
                    <span>15 min to read</span>
                </p>
                <h1 class="post-title">GitLab CI/CD Pipeline Configuration Guide</h1>
                <p class="post-subtitle">Understanding GitLab CI/CD workflow and .gitlab-ci.yml configuration</p>

                
                    <img src="https://res.cloudinary.com/dkcm26aem/image/upload/v1737534792/gitlab-ci_v19gig.png" alt="Featured image" class="post-cover">
                

                <!-- Pagination links -->



                <!-- Add your table of contents here -->


                <p><br /></p>

<hr />

<h2 id="overview">Overview</h2>
<p>Let’s explore GitLab CI/CD workflow and learn how to write <code class="language-plaintext highlighter-rouge">.gitlab-ci.yml</code> files for automated pipelines. For GitLab and GitLab Runner installation, please refer to our previous posts:</p>
<ul>
  <li><a href="https://somaz.link/posts/gitlab-installation">GitLab Installation Guide</a></li>
  <li><a href="https://somaz.link/posts/gitlab-runner-setup">GitLab Runner Setup</a></li>
</ul>

<p><br /></p>

<h3 id="what-is-gitlab-cicd">What is GitLab CI/CD?</h3>

<blockquote>
  <p>GitLab CI/CD (Continuous Integration/Continuous Deployment) is a built-in feature that automates the process of building, testing, and deploying applications. <br /><br />It helps ensure code quality and stability by running tests and validations for every code change, minimizing human error and improving development efficiency.</p>
</blockquote>

<p><br /></p>

<h3 id="how-gitlab-cicd-works">How GitLab CI/CD Works</h3>

<h4 id="core-components">Core Components:</h4>

<div class="info-box info-box-default">
  <ul>
    <li>
      <strong>Configuration</strong><br />
      Uses `.gitlab-ci.yml` file in repository root to define jobs, stages, and rules.
    </li>
    <li>
      <strong>Pipeline</strong><br />
      Triggered by commits or merge requests, follows stages defined in configuration, and can be manual or scheduled.
    </li>
    <li>
      <strong>Jobs</strong><br />
      Individual tasks within pipelines that run in containers or runners to build, test, or deploy actions.
    </li>
    <li>
      <strong>Stages</strong><br />
      Pipeline phases (e.g., build, test, deploy). Jobs in the same stage run in parallel, and stages run sequentially.
    </li>
    <li>
      <strong>Runners</strong><br />
      Agents that execute jobs. They can run on various platforms and be shared or specific to projects.
    </li>
    <li>
      <strong>Artifacts &amp; Caching</strong><br />
      Store build outputs, share between jobs, and cache dependencies for efficient execution.
    </li>
  </ul>
</div>

<p><br /></p>

<h3 id="gitlab-predefined-variables">GitLab Predefined Variables</h3>

<p>Common predefined variables used in pipelines:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CI_COMMIT_REF_NAME    <span class="c"># Branch name being built</span>
CI_COMMIT_SHORT_SHA   <span class="c"># First 8 characters of commit SHA</span>
CI_REGISTRY           <span class="c"># GitLab Container Registry address</span>
CI_PROJECT_DIR        <span class="c"># Full path where repository is cloned</span>
CI_REGISTRY_USER      <span class="c"># GitLab registry user</span>
CI_REGISTRY_PASSWORD  <span class="c"># GitLab registry password</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="pipeline-examples">Pipeline Examples</h3>

<h4 id="1-basic-pipeline">1. Basic Pipeline</h4>

<p><img src="/assets/svg/gitlab-ci/gitlab-ci-basic-pipeline.svg" alt="Basic Pipeline Diagram" /></p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">stages</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">build</span>
  <span class="pi">-</span> <span class="s">test</span>
  <span class="pi">-</span> <span class="s">deploy</span>

<span class="na">image</span><span class="pi">:</span> <span class="s">alpine</span>

<span class="na">build_a</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">build</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">echo "This job builds something."</span>

<span class="na">test_a</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">test</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">echo "This job tests something."</span>

<span class="na">deploy_a</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">deploy</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">echo "This job deploys something."</span>
  <span class="na">environment</span><span class="pi">:</span> <span class="s">production</span>
</code></pre></div></div>

<h4 id="2-dag-directed-acyclic-graph-pipeline">2. DAG (Directed Acyclic Graph) Pipeline</h4>

<p><img src="/assets/svg/gitlab-ci/gitlab-ci-dag-pipeline.svg" alt="DAG Pipeline Diagram" /></p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">stages</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">build</span>
  <span class="pi">-</span> <span class="s">test</span>
  <span class="pi">-</span> <span class="s">deploy</span>

<span class="na">build_a</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">build</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">echo "Building component A"</span>

<span class="na">test_a</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">test</span>
  <span class="na">needs</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">build_a</span><span class="pi">]</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">echo "Testing component A"</span>

<span class="na">deploy_a</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">deploy</span>
  <span class="na">needs</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">test_a</span><span class="pi">]</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">echo "Deploying component A"</span>
</code></pre></div></div>

<h4 id="3-parent-child-pipeline">3. Parent-Child Pipeline</h4>

<p><img src="/assets/svg/gitlab-ci/gitlab-ci-parent-child-pipeline.svg" alt="Parent-Child Pipeline Diagram" /></p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Root .gitlab-ci.yml</span>
<span class="na">stages</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">triggers</span>

<span class="na">trigger_a</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">triggers</span>
  <span class="na">trigger</span><span class="pi">:</span>
    <span class="na">include</span><span class="pi">:</span> <span class="s">a/.gitlab-ci.yml</span>
  <span class="na">rules</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">changes</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">a/*</span>

<span class="c1"># a/.gitlab-ci.yml</span>
<span class="na">stages</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">build</span>
  <span class="pi">-</span> <span class="s">deploy</span>

<span class="na">build_a</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">build</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">echo "Building service A"</span>

<span class="na">deploy_a</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">deploy</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">echo "Deploying service A"</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="practical-example">Practical Example</h3>

<p>Here’s a real-world example with build and deploy stages:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">stages</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">build</span>
  <span class="pi">-</span> <span class="s">deploy</span>

<span class="na">variables</span><span class="pi">:</span>
  <span class="na">BRANCH</span><span class="pi">:</span>
    <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">dev1"</span>
    <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Select</span><span class="nv"> </span><span class="s">branch:</span><span class="nv"> </span><span class="s">dev1</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">dev2"</span>
  <span class="na">NAMESPACE</span><span class="pi">:</span>
    <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">dev1"</span>
    <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Select</span><span class="nv"> </span><span class="s">namespace:</span><span class="nv"> </span><span class="s">dev1</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">dev2"</span>
  <span class="na">SERVICE</span><span class="pi">:</span>
    <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">game"</span>
    <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Select</span><span class="nv"> </span><span class="s">service</span><span class="nv"> </span><span class="s">type"</span>
  <span class="na">CI_REGISTRY_IMAGE</span><span class="pi">:</span> <span class="s">$CI_REGISTRY/$SERVICE</span>
  <span class="na">BUILD_TAG</span><span class="pi">:</span> <span class="s">$BRANCH-$CI_COMMIT_SHORT_SHA</span>
  <span class="na">IMAGE_URL</span><span class="pi">:</span> <span class="s1">'</span><span class="s">${CI_REGISTRY_IMAGE}:${BUILD_TAG}'</span>

<span class="na">.build_image</span><span class="pi">:</span> <span class="nl">&amp;build_image</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">build</span>
  <span class="na">image</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">gcr.io/kaniko-project/executor:debug</span>
    <span class="na">entrypoint</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">"</span><span class="pi">]</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">/kaniko/executor</span> 
      <span class="s">--context $CI_PROJECT_DIR</span> 
      <span class="s">--dockerfile $CI_PROJECT_DIR/$SERVICE.Dockerfile</span> 
      <span class="s">--destination $IMAGE_URL</span> 
      <span class="s">--build-arg NODE_ENV=$BRANCH</span>

<span class="na">.deploy_job</span><span class="pi">:</span> <span class="nl">&amp;deploy_job</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">deploy</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s">dtzar/helm-kubectl</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">kubectl set image deployment $SERVICE-$NAMESPACE</span> 
      <span class="s">app=$IMAGE_URL -n $NAMESPACE</span>

<span class="na">build_image</span><span class="pi">:</span>
  <span class="na">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*build_image</span>
  <span class="na">rules</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">if</span><span class="pi">:</span> <span class="s1">'</span><span class="s">($CI_PIPELINE_SOURCE</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">"web")'</span>
    <span class="pi">-</span> <span class="na">if</span><span class="pi">:</span> <span class="s1">'</span><span class="s">($CI_PIPELINE_SOURCE</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">"trigger")'</span>
  <span class="na">tags</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">build-runner</span>

<span class="na">deploy_job</span><span class="pi">:</span>
  <span class="na">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*deploy_job</span>
  <span class="na">rules</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">if</span><span class="pi">:</span> <span class="s1">'</span><span class="s">($CI_PIPELINE_SOURCE</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">"web")'</span>
    <span class="pi">-</span> <span class="na">if</span><span class="pi">:</span> <span class="s1">'</span><span class="s">($CI_PIPELINE_SOURCE</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">"trigger")'</span>
  <span class="na">tags</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">deploy-runner</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="advanced-pipeline-features">Advanced Pipeline Features</h3>

<h4 id="1-change-based-triggers">1. Change-Based Triggers</h4>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">.change_files</span><span class="pi">:</span> <span class="nl">&amp;change_files</span>
  <span class="na">changes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">apps/**/*</span>
    <span class="pi">-</span> <span class="s">config/*</span>
    <span class="pi">-</span> <span class="s">libs/**/*</span>
    <span class="pi">-</span> <span class="err">*</span><span class="s">.Dockerfile</span>
    <span class="pi">-</span> <span class="s">.gitlab-ci.yml</span>

<span class="na">build_image</span><span class="pi">:</span>
  <span class="na">rules</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">if</span><span class="pi">:</span> <span class="s1">'</span><span class="s">($CI_PIPELINE_SOURCE</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">"push")'</span>
      <span class="na">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*change_files</span>
</code></pre></div></div>

<h4 id="2-cross-project-triggers">2. Cross-Project Triggers</h4>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">build_job</span><span class="pi">:</span>
  <span class="na">after_script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">curl -X POST</span> 
      <span class="s">-F token=${TRIGGER_TOKEN}</span> 
      <span class="s">-F ref=${CI_COMMIT_REF_NAME}</span> 
      <span class="s">-F variables[project_id]=${CI_PROJECT_ID}</span> 
      <span class="s">http://gitlab.example.com/api/v4/projects/100/trigger/pipeline</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="multi-environment-deployment-with-auto-devops">Multi-Environment Deployment with Auto DevOps</h3>

<p>Here’s an example pipeline that automatically deploys to different environments based on branch names:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">stages</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">build</span>
  <span class="pi">-</span> <span class="s">test</span>
  <span class="pi">-</span> <span class="s">review</span>
  <span class="pi">-</span> <span class="s">staging</span>
  <span class="pi">-</span> <span class="s">production</span>

<span class="na">variables</span><span class="pi">:</span>
  <span class="na">DOCKER_DRIVER</span><span class="pi">:</span> <span class="s">overlay2</span>
  <span class="na">DOCKER_TLS_CERTDIR</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
  <span class="na">ROLLOUT_RESOURCE_TYPE</span><span class="pi">:</span> <span class="s">deployment</span>

<span class="na">include</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">template</span><span class="pi">:</span> <span class="s">Auto-DevOps.gitlab-ci.yml</span>

<span class="na">build</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">build</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s">docker:20.10.16</span>
  <span class="na">services</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">docker:20.10.16-dind</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY</span>
    <span class="pi">-</span> <span class="s">docker build -t $CI_REGISTRY_IMAGE:$CI_COMMIT_REF_SLUG .</span>
    <span class="pi">-</span> <span class="s">docker push $CI_REGISTRY_IMAGE:$CI_COMMIT_REF_SLUG</span>

<span class="na">test</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">test</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s">$CI_REGISTRY_IMAGE:$CI_COMMIT_REF_SLUG</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">npm ci</span>
    <span class="pi">-</span> <span class="s">npm test</span>

<span class="na">review</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">review</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">kubectl apply -f k8s/review/</span>
  <span class="na">environment</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">review/$CI_COMMIT_REF_NAME</span>
    <span class="na">url</span><span class="pi">:</span> <span class="s">https://review-$CI_COMMIT_REF_SLUG.$KUBE_INGRESS_BASE_DOMAIN</span>
    <span class="na">on_stop</span><span class="pi">:</span> <span class="s">stop_review</span>
  <span class="na">rules</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">if</span><span class="pi">:</span> <span class="s">$CI_COMMIT_BRANCH != "main" &amp;&amp; $CI_COMMIT_BRANCH != "production"</span>

<span class="na">stop_review</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">review</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">kubectl delete -f k8s/review/</span>
  <span class="na">environment</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">review/$CI_COMMIT_REF_NAME</span>
    <span class="na">action</span><span class="pi">:</span> <span class="s">stop</span>
  <span class="na">when</span><span class="pi">:</span> <span class="s">manual</span>
  <span class="na">rules</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">if</span><span class="pi">:</span> <span class="s">$CI_COMMIT_BRANCH != "main" &amp;&amp; $CI_COMMIT_BRANCH != "production"</span>

<span class="na">staging</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">staging</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">kubectl apply -f k8s/staging/</span>
  <span class="na">environment</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">staging</span>
    <span class="na">url</span><span class="pi">:</span> <span class="s">https://staging.$KUBE_INGRESS_BASE_DOMAIN</span>
  <span class="na">rules</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">if</span><span class="pi">:</span> <span class="s">$CI_COMMIT_BRANCH == "main"</span>

<span class="na">production</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">production</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">kubectl apply -f k8s/production/</span>
  <span class="na">environment</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">production</span>
    <span class="na">url</span><span class="pi">:</span> <span class="s">https://$KUBE_INGRESS_BASE_DOMAIN</span>
  <span class="na">rules</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">if</span><span class="pi">:</span> <span class="s">$CI_COMMIT_BRANCH == "production"</span>
  <span class="na">when</span><span class="pi">:</span> <span class="s">manual</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="caching-and-artifacts">Caching and Artifacts</h3>

<p>Efficient usage of caching and artifacts can dramatically speed up pipelines:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">stages</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">build</span>
  <span class="pi">-</span> <span class="s">test</span>
  <span class="pi">-</span> <span class="s">deploy</span>

<span class="c1"># Global cache definition</span>
<span class="na">cache</span><span class="pi">:</span>
  <span class="na">key</span><span class="pi">:</span> <span class="s">${CI_COMMIT_REF_SLUG}</span>
  <span class="na">paths</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">node_modules/</span>
    <span class="pi">-</span> <span class="s">.yarn</span>
    <span class="pi">-</span> <span class="s">.npm</span>

<span class="na">variables</span><span class="pi">:</span>
  <span class="na">npm_config_cache</span><span class="pi">:</span> <span class="s">.npm</span>
  <span class="na">YARN_CACHE_FOLDER</span><span class="pi">:</span> <span class="s">.yarn</span>

<span class="na">build_app</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">build</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s">node:16-alpine</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">yarn install</span>
    <span class="pi">-</span> <span class="s">yarn build</span>
  <span class="na">artifacts</span><span class="pi">:</span>
    <span class="na">paths</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">dist/</span>
    <span class="na">expire_in</span><span class="pi">:</span> <span class="s">1 week</span>

<span class="na">test_app</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">test</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s">node:16-alpine</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">yarn install</span>
    <span class="pi">-</span> <span class="s">yarn test</span>
  <span class="na">artifacts</span><span class="pi">:</span>
    <span class="na">reports</span><span class="pi">:</span>
      <span class="na">junit</span><span class="pi">:</span> <span class="s">junit.xml</span>
      <span class="na">coverage_report</span><span class="pi">:</span>
        <span class="na">coverage_format</span><span class="pi">:</span> <span class="s">cobertura</span>
        <span class="na">path</span><span class="pi">:</span> <span class="s">coverage/cobertura-coverage.xml</span>

<span class="c1"># Using cache and artifacts together</span>
<span class="na">deploy_app</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">deploy</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s">alpine:latest</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">apk add --no-cache curl</span>
    <span class="pi">-</span> <span class="s">cd dist</span>
    <span class="pi">-</span> <span class="s">tar -czf application.tar.gz *</span>
    <span class="pi">-</span> <span class="s1">'</span><span class="s">curl</span><span class="nv"> </span><span class="s">--header</span><span class="nv"> </span><span class="s">"JOB-TOKEN:</span><span class="nv"> </span><span class="s">$CI_JOB_TOKEN"</span><span class="nv"> </span><span class="s">--upload-file</span><span class="nv"> </span><span class="s">application.tar.gz</span><span class="nv"> </span><span class="s">"${CI_API_V4_URL}/projects/${CI_PROJECT_ID}/packages/generic/my-package/1.0.0/application.tar.gz"'</span>
  <span class="na">dependencies</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">build_app</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="gitlab-cicd-with-docker-compose">GitLab CI/CD with Docker Compose</h3>

<p>This example shows how to use Docker Compose for integration testing:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">stages</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">build</span>
  <span class="pi">-</span> <span class="s">test</span>
  <span class="pi">-</span> <span class="s">deploy</span>

<span class="na">variables</span><span class="pi">:</span>
  <span class="na">DOCKER_HOST</span><span class="pi">:</span> <span class="s">tcp://docker:2375/</span>
  <span class="na">DOCKER_TLS_CERTDIR</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">docker:20.10.16-dind</span>

<span class="na">build</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">build</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s">docker:20.10.16</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">docker-compose build</span>
  <span class="na">artifacts</span><span class="pi">:</span>
    <span class="na">paths</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">docker-compose.yml</span>

<span class="na">integration_test</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">test</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s">docker:20.10.16</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">docker-compose up -d</span>
    <span class="pi">-</span> <span class="s">sleep </span><span class="m">10</span>  <span class="c1"># Wait for services to start</span>
    <span class="pi">-</span> <span class="s">docker-compose exec -T app npm run integration-tests</span>
    <span class="pi">-</span> <span class="s">docker-compose down</span>
  <span class="na">dependencies</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">build</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="parallel-testing-for-faster-pipelines">Parallel Testing for Faster Pipelines</h3>

<p>Breaking tests into parallel jobs can significantly speed up pipelines:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">stages</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">build</span>
  <span class="pi">-</span> <span class="s">test</span>
  <span class="pi">-</span> <span class="s">deploy</span>

<span class="na">build_app</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">build</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">npm ci</span>
    <span class="pi">-</span> <span class="s">npm run build</span>
  <span class="na">artifacts</span><span class="pi">:</span>
    <span class="na">paths</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">dist/</span>
      <span class="pi">-</span> <span class="s">node_modules/</span>

<span class="na">.test_template</span><span class="pi">:</span> <span class="nl">&amp;test_template</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">test</span>
  <span class="na">needs</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">build_app</span>
  <span class="na">artifacts</span><span class="pi">:</span>
    <span class="na">when</span><span class="pi">:</span> <span class="s">always</span>
    <span class="na">reports</span><span class="pi">:</span>
      <span class="na">junit</span><span class="pi">:</span> <span class="s">junit-*.xml</span>

<span class="na">unit_tests</span><span class="pi">:</span>
  <span class="na">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*test_template</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">npm run test:unit</span>

<span class="na">integration_tests</span><span class="pi">:</span>
  <span class="na">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*test_template</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">npm run test:integration</span>

<span class="na">e2e_tests_group1</span><span class="pi">:</span>
  <span class="na">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*test_template</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">npm run test:e2e -- --group=1</span>

<span class="na">e2e_tests_group2</span><span class="pi">:</span>
  <span class="na">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*test_template</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">npm run test:e2e -- --group=2</span>

<span class="na">deploy_app</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">deploy</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">npm run deploy</span>
  <span class="na">environment</span><span class="pi">:</span> <span class="s">production</span>
  <span class="na">only</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">main</span>
  <span class="na">when</span><span class="pi">:</span> <span class="s">manual</span>
</code></pre></div></div>

<p><br /></p>

<h2 id="advanced-configuration-techniques">Advanced Configuration Techniques</h2>

<h3 id="dynamic-environment-configuration">Dynamic Environment Configuration</h3>

<p>This example demonstrates dynamic environment configuration based on Git branches:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">.env_config</span><span class="pi">:</span> <span class="nl">&amp;env_config</span>
  <span class="na">before_script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="pi">|</span>
      <span class="s">if [[ "$CI_COMMIT_BRANCH" == "main" ]]; then</span>
        <span class="s">export ENVIRONMENT="staging"</span>
        <span class="s">export API_URL="https://api.staging.example.com"</span>
      <span class="s">elif [[ "$CI_COMMIT_BRANCH" == "production" ]]; then</span>
        <span class="s">export ENVIRONMENT="production"</span>
        <span class="s">export API_URL="https://api.example.com"</span>
      <span class="s">else</span>
        <span class="s">export ENVIRONMENT="review"</span>
        <span class="s">export API_URL="https://api.review.example.com"</span>
      <span class="s">fi</span>
    <span class="pi">-</span> <span class="s">echo "Configuring for $ENVIRONMENT environment"</span>

<span class="na">build_config</span><span class="pi">:</span>
  <span class="na">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*env_config</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">echo "Building for $ENVIRONMENT using $API_URL"</span>
    <span class="pi">-</span> <span class="s">cat &gt; .env &lt;&lt; EOF</span>
      <span class="s">API_URL=$API_URL</span>
      <span class="s">ENVIRONMENT=$ENVIRONMENT</span>
      <span class="s">BUILD_TIME=$(date)</span>
      <span class="s">COMMIT_SHA=$CI_COMMIT_SHORT_SHA</span>
      <span class="s">EOF</span>
    <span class="pi">-</span> <span class="s">npm run build</span>
</code></pre></div></div>

<h3 id="using-gitlab-ci-with-monorepos">Using GitLab CI with Monorepos</h3>

<p>For monorepo setups, you can use different pipelines for different components:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">workflow</span><span class="pi">:</span>
  <span class="na">rules</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">if</span><span class="pi">:</span> <span class="s">$CI_PIPELINE_SOURCE == "merge_request_event"</span>
    <span class="pi">-</span> <span class="na">if</span><span class="pi">:</span> <span class="s">$CI_COMMIT_BRANCH == "main"</span>
    <span class="pi">-</span> <span class="na">if</span><span class="pi">:</span> <span class="s">$CI_COMMIT_BRANCH == "develop"</span>

<span class="na">stages</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">detect_changes</span>
  <span class="pi">-</span> <span class="s">build</span>
  <span class="pi">-</span> <span class="s">test</span>
  <span class="pi">-</span> <span class="s">deploy</span>

<span class="na">detect_changes</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">detect_changes</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s">alpine:latest</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="pi">|</span>
      <span class="s">echo "Detecting changes..."</span>
      <span class="s">git diff --name-only $CI_COMMIT_BEFORE_SHA $CI_COMMIT_SHA &gt; changes.txt</span>
      
      <span class="s">if grep -q "^frontend/" changes.txt; then</span>
        <span class="s">echo "FRONTEND_CHANGES=true" &gt;&gt; variables.env</span>
      <span class="s">else</span>
        <span class="s">echo "FRONTEND_CHANGES=false" &gt;&gt; variables.env</span>
      <span class="s">fi</span>
      
      <span class="s">if grep -q "^backend/" changes.txt; then</span>
        <span class="s">echo "BACKEND_CHANGES=true" &gt;&gt; variables.env</span>
      <span class="s">else</span>
        <span class="s">echo "BACKEND_CHANGES=false" &gt;&gt; variables.env</span>
      <span class="s">fi</span>
  <span class="na">artifacts</span><span class="pi">:</span>
    <span class="na">reports</span><span class="pi">:</span>
      <span class="na">dotenv</span><span class="pi">:</span> <span class="s">variables.env</span>

<span class="na">build_frontend</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">build</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">echo "Building frontend..."</span>
    <span class="pi">-</span> <span class="s">cd frontend &amp;&amp; npm ci &amp;&amp; npm run build</span>
  <span class="na">needs</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">detect_changes</span>
  <span class="na">rules</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">if</span><span class="pi">:</span> <span class="s">$FRONTEND_CHANGES == "true"</span>

<span class="na">build_backend</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">build</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">echo "Building backend..."</span>
    <span class="pi">-</span> <span class="s">cd backend &amp;&amp; npm ci &amp;&amp; npm run build</span>
  <span class="na">needs</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">detect_changes</span>
  <span class="na">rules</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">if</span><span class="pi">:</span> <span class="s">$BACKEND_CHANGES == "true"</span>
</code></pre></div></div>

<p><br /></p>

<h2 id="troubleshooting-gitlab-ci-pipelines">Troubleshooting GitLab CI Pipelines</h2>

<div class="info-box info-box-warning">
<br />
<strong>Common Pipeline Issues and Solutions:</strong><br /><br />

<strong>1. Pipeline Won't Start:</strong>
   - Check runner availability and tags<br />
   - Verify `.gitlab-ci.yml` syntax with the CI Lint tool<br />
   - Ensure project has correct permissions<br />
   - Check if you've reached concurrent job limits<br /><br />

<strong>2. Job Failures:</strong>
   - Check job logs for specific error messages<br />
   - Verify environment variables are set correctly<br />
   - Check if Docker image is available and correct<br />
   - Ensure runner has sufficient resources<br /><br />

<strong>3. Pipeline Performance Issues:</strong>
   - Use caching for dependencies<br />
   - Implement parallel jobs for tests<br />
   - Only run necessary jobs with conditional rules<br />
   - Use more specific Docker images<br /><br />

<strong>4. Cache Problems:</strong>
   - Verify cache paths are correct<br />
   - Use different cache keys for different branches<br />
   - Check if cache is too large<br />
   - Ensure runner has sufficient storage<br /><br />
</div>

<h3 id="pipeline-debugging-tips">Pipeline Debugging Tips</h3>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">debug_job</span><span class="pi">:</span>
  <span class="na">stage</span><span class="pi">:</span> <span class="s">test</span>
  <span class="na">script</span><span class="pi">:</span>
    <span class="c1"># List environment variables</span>
    <span class="pi">-</span> <span class="s">env | sort</span>
    
    <span class="c1"># Show GitLab CI variables</span>
    <span class="pi">-</span> <span class="s">echo "Project path</span><span class="err">:</span> <span class="s">$CI_PROJECT_PATH"</span>
    <span class="pi">-</span> <span class="s">echo "Job name</span><span class="err">:</span> <span class="s">$CI_JOB_NAME"</span>
    <span class="pi">-</span> <span class="s">echo "Commit SHA</span><span class="err">:</span> <span class="s">$CI_COMMIT_SHA"</span>
    
    <span class="c1"># Show file system information</span>
    <span class="pi">-</span> <span class="s">df -h</span>
    <span class="pi">-</span> <span class="s">ls -la</span>
    
    <span class="c1"># Show network information</span>
    <span class="pi">-</span> <span class="s">ip addr</span>
    <span class="pi">-</span> <span class="s">cat /etc/hosts</span>
    
    <span class="c1"># Show Docker info (if available)</span>
    <span class="pi">-</span> <span class="s">docker info || echo "Docker not available"</span>
  <span class="na">when</span><span class="pi">:</span> <span class="s">manual</span>
</code></pre></div></div>

<p><br /></p>

<h2 id="best-practices">Best Practices</h2>

<div class="info-box info-box-success">
<br />
<strong>GitLab CI/CD Best Practices:</strong><br /><br />

<strong>1. Pipeline Structure:</strong>
   - Keep pipelines simple and focused<br />
   - Use stages to organize jobs logically<br />
   - Group related jobs using templates<br />
   - Use parent-child pipelines for complex workflows<br />
   - Implement DAG (Directed Acyclic Graph) dependencies<br /><br />

<strong>2. Performance Optimization:</strong>
   - Use caching effectively to speed up builds<br />
   - Parallelize tests when possible<br />
   - Use specific, lightweight Docker images<br />
   - Only run necessary jobs with rules<br />
   - Keep build artifacts small and focused<br /><br />

<strong>3. Security Considerations:</strong>
   - Use secret variables for sensitive information<br />
   - Implement branch protection rules<br />
   - Run security scanners in your pipeline<br />
   - Limit access to protected environments<br />
   - Review Docker images for vulnerabilities<br /><br />

<strong>4. Maintainability:</strong>
   - Document pipeline behavior in README<br />
   - Use includes to share common configurations<br />
   - Keep pipeline configuration in version control<br />
   - Follow naming conventions for jobs and stages<br />
   - Use anchors and templates to reduce duplication<br /><br />
</div>

<p><br /></p>

<hr />

<h2 id="reference">Reference</h2>
<ul>
  <li><a href="https://docs.gitlab.com/ee/ci/">GitLab CI/CD Documentation</a></li>
  <li><a href="https://docs.gitlab.com/ee/ci/variables/">GitLab CI/CD Variables</a></li>
  <li><a href="https://docs.gitlab.com/ee/ci/pipelines/">GitLab Pipeline Architecture</a></li>
</ul>


                <!-- Pagination links -->


            </article>

            
                <aside class="see-also">
                    <h2>See also</h2>
                    <ul>
                        
                        
                        
                            <li>
                                <a href="/category/troubleshooting/db-connection-econnreset-resolution/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1757928232/db-connection-econnreset-1_odeqhz.png">
                                    
                                    <h3>Resolving DB Connection Error (ECONNRESET) Issues</h3>
                                </a>
                            </li>
                        
                            <li>
                                <a href="/category/openstack/openstack-trove/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1756185482/openstack-trove-1_ggheju.png">
                                    
                                    <h3>Deep Dive into OpenStack Trove</h3>
                                </a>
                            </li>
                        
                            <li>
                                <a href="/category/database/database-normalization/">
                                    
                                        <img src="https://blog.kakaocdn.net/dn/GY9Lf/btsMP5uevn7/JNMOge6dsyn4R6Lx0CbQF1/img.png">
                                    
                                    <h3>Database Normalization and Denormalization: A Complete Guide</h3>
                                </a>
                            </li>
                        
                    </ul>
                </aside>
            

        </section>

        <!-- Add time bar only for pages without pagination -->
        
            <div class="time-bar" data-minutes="15">
    <span class="time-completed"></span>
    <span class="time-remaining"></span>
    <div class="bar">
        <span class="completed" style="width:0%;"></span>
        <span class="remaining" style="width:100%;"></span>
    </div>
</div>

            <button class="toggle-preview" onclick="togglePreview()">
    <span>Hide Preview ▼</span>
</button>

<div id="recommendationSection" class="recommendation">
    <div class="message">
        <strong>Why don't you read something next?</strong>
        <div>
            <button>
                <svg><use xlink:href="#icon-arrow-right"></use></svg>
                <span>Go back to top</span>
            </button>
        </div>
    </div>
    <div id="previewSection" class="preview-section">
        
        <a href="/category/cicd/gitlab-cicd-template/" class="post-preview">
            <div class="image">
                
                    <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1737534845/gitlab-ci-template_qh2zvi.png">
                
            </div>
            <h3 class="title">GitLab CI/CD Template Guide</h3>
        </a>
    </div>
</div>

<style>
.toggle-preview {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #333;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 4px;
    cursor: pointer;
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.toggle-preview:hover {
    background: #444;
}

.toggle-preview.visible {
    opacity: 1;
}

.recommendation {
    margin-top: 1000px;
    display: block;
    transition: all 0.3s ease;
}

.recommendation.hidden {
    display: none;
}

.hide-preview {
    margin-left: 10px;
    background: none;
    border: 1px solid #666;
    color: #666;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
}

.hide-preview:hover {
    background: #f0f0f0;
}

.preview-section {
    max-height: 1000px;
    overflow: hidden;
    transition: max-height 0.3s ease-out;
}

.preview-section.hidden {
    max-height: 0;
}
</style>

<script>
function togglePreview() {
    const recommendation = document.getElementById('recommendationSection');
    const button = document.querySelector('.toggle-preview span');
    
    if (recommendation.classList.contains('hidden')) {
        recommendation.classList.remove('hidden');
        button.textContent = 'Hide Preview ▼';
    } else {
        recommendation.classList.add('hidden');
        button.textContent = 'Show Preview ▲';
    }
}

window.addEventListener('scroll', function() {
    const toggleButton = document.querySelector('.toggle-preview');
    const recommendation = document.getElementById('recommendationSection');
    const rect = recommendation.getBoundingClientRect();
    
    if (rect.top <= window.innerHeight) {
        toggleButton.classList.add('visible');
    } else {
        toggleButton.classList.remove('visible');
    }
});
</script>

        

        <!-- Show modal if the post is the last one -->
        

        <!-- Show modal before user leaves the page -->
        

        <!-- Add your newsletter subscription form here -->

        <section class="share">
    <h3>Share</h3>
    <a aria-label="Share on Twitter" href="https://twitter.com/intent/tweet?text=&quot;Learn about GitLab CI/CD, pipeline configurations, and practical examples&quot;%20https://somaz.blog/category/cicd/gitlab-ci/%20via%20&#64;twitter_username&hashtags=gitlab,cicd,pipeline,automation"
    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Share on Twitter">
        <svg class="icon icon-twitter"><use xlink:href="#icon-twitter"></use></svg>
    </a>
    <a aria-label="Share on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://somaz.blog/category/cicd/gitlab-ci/"
    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook">
        <svg class="icon icon-facebook"><use xlink:href="#icon-facebook"></use></svg>
    </a>
</section>

        

  <section class="author">
    <div class="details">
      
        <img class="img-rounded" src="/assets/img/uploads/profile.png" alt="Somaz">
      
      <p class="def">Author</p>
      <h3 class="name">
        <a href="/authors/somaz/">Somaz</a>
      </h3>
      <p class="desc">DevOps engineer focused on cloud infrastructure and automation</p>
      <p>
        
          <a href="https://github.com/somaz94" title="Github">
            <svg><use xlink:href="#icon-github"></use></svg>
          </a>
        
        
        
        
        
        
          <a href="https://www.linkedin.com/in/somaz" title="LinkedIn">
            <svg><use xlink:href="#icon-linkedin"></use></svg>
          </a>
        
        
          <a href="https://somaz.tistory.com" title="Tistory">
            <svg><use xlink:href="#icon-tistory"></use></svg>
          </a>
        
      </p>
    </div>
  </section>

  
  
  
  
  
  
  
  

  <script type="application/ld+json">
  {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "Somaz",
      
      "image": "/assets/img/uploads/profile.png",
      
      "jobTitle": "DevOps Engineer",
      "url": "https://somaz.blog/authors/somaz/",
      "sameAs": [
        "https://github.com/somaz94","https://www.linkedin.com/in/somaz","https://{{ author.tistory_username }}.tistory.com"
      ]
  }
  </script>


        

<section class="comments">
    <h3>Comments</h3>
    <div id="disqus_thread"></div>
</section>
<script type="text/javascript">
    var disqus_loaded = false;

    function load_disqus()
    {
        disqus_loaded = true;
        var disqus_shortname = 'https-somaz94-github-io';
        var disqus_title = '';
        var disqus_url = '/category/cicd/gitlab-ci/';
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        var ldr = document.getElementById('disqus_loader');
    };
    window.onscroll = function(e) {
        if ((window.innerHeight + window.scrollY) >= (document.body.offsetHeight - 800)) {
            //hit bottom of page
            if (disqus_loaded==false)
                load_disqus()
        }
    };
</script>



        <footer>
    <p>
      
        <a href="https://github.com/somaz94" title="Github">
          <svg><use xlink:href="#icon-github"></use></svg>
        </a>
      
      
        <a href="https://www.facebook.com/facebook_username" title="Facebook">
          <svg><use xlink:href="#icon-facebook"></use></svg>
        </a>
      
      
        <a href="https://twitter.com/twitter_username" title="Twitter">
          <svg><use xlink:href="#icon-twitter"></use></svg>
        </a>
      
      
        <a href="https://medium.com/@medium_username" title="Medium">
          <svg><use xlink:href="#icon-medium"></use></svg>
        </a>
      
      
        <a href="https://www.instagram.com/instagram_username" title="Instagram">
          <svg><use xlink:href="#icon-instagram"></use></svg>
        </a>
      
      
        <a href="https://www.linkedin.com/in/somaz" title="LinkedIn">
          <svg><use xlink:href="#icon-linkedin"></use></svg>
        </a>
      
      
        <a href="https://somaz.tistory.com" title="Tistory">
          <svg><use xlink:href="#icon-tistory"></use></svg>
        </a>
      
    </p>

    <ul>
  
    
      <li>
        <a href="https://somaz.blog/">Home</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/about">About</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/category">Category</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/contact">Contact</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/feed.xml">Feed</a>
      </li>
    
  
</ul>


    <p>
      <a href="https://somaz.blog/sitemap.xml" title="sitemap">Sitemap</a> |
      <a href="https://somaz.blog/privacy-policy" title="Privacy Policy">Privacy Policy</a>
    </p>

    <p>
      <span>Somaz Tech Blog</span> <svg class="love"><use xlink:href="#icon-heart"></use></svg>
    </p>
</footer>










<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "somaz",
  "description": "DevOps engineer's tech blog.",
  "url": "https://somaz.blog/",
  "logo": {
      "@type": "ImageObject",
      "url": "https://somaz.blog/assets/img/icons/mediumtile.png",
      "width": "600",
      "height": "315"
  },
  "sameAs": [
    "https://github.com/somaz94","https://www.facebook.com/facebook_username","https://twitter.com/twitter_username","https://medium.com/@medium_username","https://www.instagram.com/instagram_username","https://www.linkedin.com/in/somaz","https://{{ site.tistory_username }}.tistory.com"
  ]
}
</script>

<!-- Include the script that allows Netlify CMS login -->
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

<!-- Include the website scripts -->
<script src="/assets/js/scripts.min.js"></script>

<!-- Include Google Analytics script -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-XXXXXXXX-X"></script>
<script>
  var host = window.location.hostname;
  if (host != 'localhost') {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-XXXXXXXX-X');
  }
</script>
  


<!-- Include extra scripts -->



        

        
        
        
        
        
        
        
        
        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "BlogPosting",
            "name": "GitLab CI/CD Pipeline Configuration Guide",
            "headline": "Understanding GitLab CI/CD workflow and .gitlab-ci.yml configuration",
            "description": "Learn about GitLab CI/CD, pipeline configurations, and practical examples",
            "image": "https://res.cloudinary.com/dkcm26aem/image/upload/v1737534792/gitlab-ci_v19gig.png",
            "url": "https://somaz.blog/category/cicd/gitlab-ci/",
            "articleBody": "



Overview
Let’s explore GitLab CI/CD workflow and learn how to write .gitlab-ci.yml files for automated pipelines. For GitLab and GitLab Runner installation, please refer to our previous posts:

  GitLab Installation Guide
  GitLab Runner Setup




What is GitLab CI/CD?


  GitLab CI/CD (Continuous Integration/Continuous Deployment) is a built-in feature that automates the process of building, testing, and deploying applications. It helps ensure code quality and stability by running tests and validations for every code change, minimizing human error and improving development efficiency.




How GitLab CI/CD Works

Core Components:


  
    
      Configuration
      Uses `.gitlab-ci.yml` file in repository root to define jobs, stages, and rules.
    
    
      Pipeline
      Triggered by commits or merge requests, follows stages defined in configuration, and can be manual or scheduled.
    
    
      Jobs
      Individual tasks within pipelines that run in containers or runners to build, test, or deploy actions.
    
    
      Stages
      Pipeline phases (e.g., build, test, deploy). Jobs in the same stage run in parallel, and stages run sequentially.
    
    
      Runners
      Agents that execute jobs. They can run on various platforms and be shared or specific to projects.
    
    
      Artifacts &amp;amp; Caching
      Store build outputs, share between jobs, and cache dependencies for efficient execution.
    
  




GitLab Predefined Variables

Common predefined variables used in pipelines:

CI_COMMIT_REF_NAME    # Branch name being built
CI_COMMIT_SHORT_SHA   # First 8 characters of commit SHA
CI_REGISTRY           # GitLab Container Registry address
CI_PROJECT_DIR        # Full path where repository is cloned
CI_REGISTRY_USER      # GitLab registry user
CI_REGISTRY_PASSWORD  # GitLab registry password




Pipeline Examples

1. Basic Pipeline



stages:
  - build
  - test
  - deploy

image: alpine

build_a:
  stage: build
  script:
    - echo &quot;This job builds something.&quot;

test_a:
  stage: test
  script:
    - echo &quot;This job tests something.&quot;

deploy_a:
  stage: deploy
  script:
    - echo &quot;This job deploys something.&quot;
  environment: production


2. DAG (Directed Acyclic Graph) Pipeline



stages:
  - build
  - test
  - deploy

build_a:
  stage: build
  script:
    - echo &quot;Building component A&quot;

test_a:
  stage: test
  needs: [build_a]
  script:
    - echo &quot;Testing component A&quot;

deploy_a:
  stage: deploy
  needs: [test_a]
  script:
    - echo &quot;Deploying component A&quot;


3. Parent-Child Pipeline



# Root .gitlab-ci.yml
stages:
  - triggers

trigger_a:
  stage: triggers
  trigger:
    include: a/.gitlab-ci.yml
  rules:
    - changes:
        - a/*

# a/.gitlab-ci.yml
stages:
  - build
  - deploy

build_a:
  stage: build
  script:
    - echo &quot;Building service A&quot;

deploy_a:
  stage: deploy
  script:
    - echo &quot;Deploying service A&quot;




Practical Example

Here’s a real-world example with build and deploy stages:

stages:
  - build
  - deploy

variables:
  BRANCH:
    value: &quot;dev1&quot;
    description: &quot;Select branch: dev1 or dev2&quot;
  NAMESPACE:
    value: &quot;dev1&quot;
    description: &quot;Select namespace: dev1 or dev2&quot;
  SERVICE:
    value: &quot;game&quot;
    description: &quot;Select service type&quot;
  CI_REGISTRY_IMAGE: $CI_REGISTRY/$SERVICE
  BUILD_TAG: $BRANCH-$CI_COMMIT_SHORT_SHA
  IMAGE_URL: &apos;${CI_REGISTRY_IMAGE}:${BUILD_TAG}&apos;

.build_image: &amp;amp;build_image
  stage: build
  image:
    name: gcr.io/kaniko-project/executor:debug
    entrypoint: [&quot;&quot;]
  script:
    - /kaniko/executor 
      --context $CI_PROJECT_DIR 
      --dockerfile $CI_PROJECT_DIR/$SERVICE.Dockerfile 
      --destination $IMAGE_URL 
      --build-arg NODE_ENV=$BRANCH

.deploy_job: &amp;amp;deploy_job
  stage: deploy
  image: dtzar/helm-kubectl
  script:
    - kubectl set image deployment $SERVICE-$NAMESPACE 
      app=$IMAGE_URL -n $NAMESPACE

build_image:
  &amp;lt;&amp;lt;: *build_image
  rules:
    - if: &apos;($CI_PIPELINE_SOURCE == &quot;web&quot;)&apos;
    - if: &apos;($CI_PIPELINE_SOURCE == &quot;trigger&quot;)&apos;
  tags:
    - build-runner

deploy_job:
  &amp;lt;&amp;lt;: *deploy_job
  rules:
    - if: &apos;($CI_PIPELINE_SOURCE == &quot;web&quot;)&apos;
    - if: &apos;($CI_PIPELINE_SOURCE == &quot;trigger&quot;)&apos;
  tags:
    - deploy-runner




Advanced Pipeline Features

1. Change-Based Triggers
.change_files: &amp;amp;change_files
  changes:
    - apps/**/*
    - config/*
    - libs/**/*
    - *.Dockerfile
    - .gitlab-ci.yml

build_image:
  rules:
    - if: &apos;($CI_PIPELINE_SOURCE == &quot;push&quot;)&apos;
      &amp;lt;&amp;lt;: *change_files


2. Cross-Project Triggers
build_job:
  after_script:
    - curl -X POST 
      -F token=${TRIGGER_TOKEN} 
      -F ref=${CI_COMMIT_REF_NAME} 
      -F variables[project_id]=${CI_PROJECT_ID} 
      http://gitlab.example.com/api/v4/projects/100/trigger/pipeline




Multi-Environment Deployment with Auto DevOps

Here’s an example pipeline that automatically deploys to different environments based on branch names:

stages:
  - build
  - test
  - review
  - staging
  - production

variables:
  DOCKER_DRIVER: overlay2
  DOCKER_TLS_CERTDIR: &quot;&quot;
  ROLLOUT_RESOURCE_TYPE: deployment

include:
  - template: Auto-DevOps.gitlab-ci.yml

build:
  stage: build
  image: docker:20.10.16
  services:
    - docker:20.10.16-dind
  script:
    - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
    - docker build -t $CI_REGISTRY_IMAGE:$CI_COMMIT_REF_SLUG .
    - docker push $CI_REGISTRY_IMAGE:$CI_COMMIT_REF_SLUG

test:
  stage: test
  image: $CI_REGISTRY_IMAGE:$CI_COMMIT_REF_SLUG
  script:
    - npm ci
    - npm test

review:
  stage: review
  script:
    - kubectl apply -f k8s/review/
  environment:
    name: review/$CI_COMMIT_REF_NAME
    url: https://review-$CI_COMMIT_REF_SLUG.$KUBE_INGRESS_BASE_DOMAIN
    on_stop: stop_review
  rules:
    - if: $CI_COMMIT_BRANCH != &quot;main&quot; &amp;amp;&amp;amp; $CI_COMMIT_BRANCH != &quot;production&quot;

stop_review:
  stage: review
  script:
    - kubectl delete -f k8s/review/
  environment:
    name: review/$CI_COMMIT_REF_NAME
    action: stop
  when: manual
  rules:
    - if: $CI_COMMIT_BRANCH != &quot;main&quot; &amp;amp;&amp;amp; $CI_COMMIT_BRANCH != &quot;production&quot;

staging:
  stage: staging
  script:
    - kubectl apply -f k8s/staging/
  environment:
    name: staging
    url: https://staging.$KUBE_INGRESS_BASE_DOMAIN
  rules:
    - if: $CI_COMMIT_BRANCH == &quot;main&quot;

production:
  stage: production
  script:
    - kubectl apply -f k8s/production/
  environment:
    name: production
    url: https://$KUBE_INGRESS_BASE_DOMAIN
  rules:
    - if: $CI_COMMIT_BRANCH == &quot;production&quot;
  when: manual




Caching and Artifacts

Efficient usage of caching and artifacts can dramatically speed up pipelines:

stages:
  - build
  - test
  - deploy

# Global cache definition
cache:
  key: ${CI_COMMIT_REF_SLUG}
  paths:
    - node_modules/
    - .yarn
    - .npm

variables:
  npm_config_cache: .npm
  YARN_CACHE_FOLDER: .yarn

build_app:
  stage: build
  image: node:16-alpine
  script:
    - yarn install
    - yarn build
  artifacts:
    paths:
      - dist/
    expire_in: 1 week

test_app:
  stage: test
  image: node:16-alpine
  script:
    - yarn install
    - yarn test
  artifacts:
    reports:
      junit: junit.xml
      coverage_report:
        coverage_format: cobertura
        path: coverage/cobertura-coverage.xml

# Using cache and artifacts together
deploy_app:
  stage: deploy
  image: alpine:latest
  script:
    - apk add --no-cache curl
    - cd dist
    - tar -czf application.tar.gz *
    - &apos;curl --header &quot;JOB-TOKEN: $CI_JOB_TOKEN&quot; --upload-file application.tar.gz &quot;${CI_API_V4_URL}/projects/${CI_PROJECT_ID}/packages/generic/my-package/1.0.0/application.tar.gz&quot;&apos;
  dependencies:
    - build_app




GitLab CI/CD with Docker Compose

This example shows how to use Docker Compose for integration testing:

stages:
  - build
  - test
  - deploy

variables:
  DOCKER_HOST: tcp://docker:2375/
  DOCKER_TLS_CERTDIR: &quot;&quot;

services:
  - docker:20.10.16-dind

build:
  stage: build
  image: docker:20.10.16
  script:
    - docker-compose build
  artifacts:
    paths:
      - docker-compose.yml

integration_test:
  stage: test
  image: docker:20.10.16
  script:
    - docker-compose up -d
    - sleep 10  # Wait for services to start
    - docker-compose exec -T app npm run integration-tests
    - docker-compose down
  dependencies:
    - build




Parallel Testing for Faster Pipelines

Breaking tests into parallel jobs can significantly speed up pipelines:

stages:
  - build
  - test
  - deploy

build_app:
  stage: build
  script:
    - npm ci
    - npm run build
  artifacts:
    paths:
      - dist/
      - node_modules/

.test_template: &amp;amp;test_template
  stage: test
  needs:
    - build_app
  artifacts:
    when: always
    reports:
      junit: junit-*.xml

unit_tests:
  &amp;lt;&amp;lt;: *test_template
  script:
    - npm run test:unit

integration_tests:
  &amp;lt;&amp;lt;: *test_template
  script:
    - npm run test:integration

e2e_tests_group1:
  &amp;lt;&amp;lt;: *test_template
  script:
    - npm run test:e2e -- --group=1

e2e_tests_group2:
  &amp;lt;&amp;lt;: *test_template
  script:
    - npm run test:e2e -- --group=2

deploy_app:
  stage: deploy
  script:
    - npm run deploy
  environment: production
  only:
    - main
  when: manual




Advanced Configuration Techniques

Dynamic Environment Configuration

This example demonstrates dynamic environment configuration based on Git branches:

.env_config: &amp;amp;env_config
  before_script:
    - |
      if [[ &quot;$CI_COMMIT_BRANCH&quot; == &quot;main&quot; ]]; then
        export ENVIRONMENT=&quot;staging&quot;
        export API_URL=&quot;https://api.staging.example.com&quot;
      elif [[ &quot;$CI_COMMIT_BRANCH&quot; == &quot;production&quot; ]]; then
        export ENVIRONMENT=&quot;production&quot;
        export API_URL=&quot;https://api.example.com&quot;
      else
        export ENVIRONMENT=&quot;review&quot;
        export API_URL=&quot;https://api.review.example.com&quot;
      fi
    - echo &quot;Configuring for $ENVIRONMENT environment&quot;

build_config:
  &amp;lt;&amp;lt;: *env_config
  script:
    - echo &quot;Building for $ENVIRONMENT using $API_URL&quot;
    - cat &amp;gt; .env &amp;lt;&amp;lt; EOF
      API_URL=$API_URL
      ENVIRONMENT=$ENVIRONMENT
      BUILD_TIME=$(date)
      COMMIT_SHA=$CI_COMMIT_SHORT_SHA
      EOF
    - npm run build


Using GitLab CI with Monorepos

For monorepo setups, you can use different pipelines for different components:

workflow:
  rules:
    - if: $CI_PIPELINE_SOURCE == &quot;merge_request_event&quot;
    - if: $CI_COMMIT_BRANCH == &quot;main&quot;
    - if: $CI_COMMIT_BRANCH == &quot;develop&quot;

stages:
  - detect_changes
  - build
  - test
  - deploy

detect_changes:
  stage: detect_changes
  image: alpine:latest
  script:
    - |
      echo &quot;Detecting changes...&quot;
      git diff --name-only $CI_COMMIT_BEFORE_SHA $CI_COMMIT_SHA &amp;gt; changes.txt
      
      if grep -q &quot;^frontend/&quot; changes.txt; then
        echo &quot;FRONTEND_CHANGES=true&quot; &amp;gt;&amp;gt; variables.env
      else
        echo &quot;FRONTEND_CHANGES=false&quot; &amp;gt;&amp;gt; variables.env
      fi
      
      if grep -q &quot;^backend/&quot; changes.txt; then
        echo &quot;BACKEND_CHANGES=true&quot; &amp;gt;&amp;gt; variables.env
      else
        echo &quot;BACKEND_CHANGES=false&quot; &amp;gt;&amp;gt; variables.env
      fi
  artifacts:
    reports:
      dotenv: variables.env

build_frontend:
  stage: build
  script:
    - echo &quot;Building frontend...&quot;
    - cd frontend &amp;amp;&amp;amp; npm ci &amp;amp;&amp;amp; npm run build
  needs:
    - detect_changes
  rules:
    - if: $FRONTEND_CHANGES == &quot;true&quot;

build_backend:
  stage: build
  script:
    - echo &quot;Building backend...&quot;
    - cd backend &amp;amp;&amp;amp; npm ci &amp;amp;&amp;amp; npm run build
  needs:
    - detect_changes
  rules:
    - if: $BACKEND_CHANGES == &quot;true&quot;




Troubleshooting GitLab CI Pipelines



Common Pipeline Issues and Solutions:

1. Pipeline Won&apos;t Start:
   - Check runner availability and tags
   - Verify `.gitlab-ci.yml` syntax with the CI Lint tool
   - Ensure project has correct permissions
   - Check if you&apos;ve reached concurrent job limits

2. Job Failures:
   - Check job logs for specific error messages
   - Verify environment variables are set correctly
   - Check if Docker image is available and correct
   - Ensure runner has sufficient resources

3. Pipeline Performance Issues:
   - Use caching for dependencies
   - Implement parallel jobs for tests
   - Only run necessary jobs with conditional rules
   - Use more specific Docker images

4. Cache Problems:
   - Verify cache paths are correct
   - Use different cache keys for different branches
   - Check if cache is too large
   - Ensure runner has sufficient storage


Pipeline Debugging Tips

debug_job:
  stage: test
  script:
    # List environment variables
    - env | sort
    
    # Show GitLab CI variables
    - echo &quot;Project path: $CI_PROJECT_PATH&quot;
    - echo &quot;Job name: $CI_JOB_NAME&quot;
    - echo &quot;Commit SHA: $CI_COMMIT_SHA&quot;
    
    # Show file system information
    - df -h
    - ls -la
    
    # Show network information
    - ip addr
    - cat /etc/hosts
    
    # Show Docker info (if available)
    - docker info || echo &quot;Docker not available&quot;
  when: manual




Best Practices



GitLab CI/CD Best Practices:

1. Pipeline Structure:
   - Keep pipelines simple and focused
   - Use stages to organize jobs logically
   - Group related jobs using templates
   - Use parent-child pipelines for complex workflows
   - Implement DAG (Directed Acyclic Graph) dependencies

2. Performance Optimization:
   - Use caching effectively to speed up builds
   - Parallelize tests when possible
   - Use specific, lightweight Docker images
   - Only run necessary jobs with rules
   - Keep build artifacts small and focused

3. Security Considerations:
   - Use secret variables for sensitive information
   - Implement branch protection rules
   - Run security scanners in your pipeline
   - Limit access to protected environments
   - Review Docker images for vulnerabilities

4. Maintainability:
   - Document pipeline behavior in README
   - Use includes to share common configurations
   - Keep pipeline configuration in version control
   - Follow naming conventions for jobs and stages
   - Use anchors and templates to reduce duplication






Reference

  GitLab CI/CD Documentation
  GitLab CI/CD Variables
  GitLab Pipeline Architecture

",
            "wordcount": "2811",
            "inLanguage": "en",
            "dateCreated": "2025-04-29/",
            "datePublished": "2025-04-29/",
            "dateModified": "2025-04-29/",
            "author": {
                "@type": "Person",
                "name": "Somaz",
                
                "image": "/assets/img/uploads/profile.png",
                
                "jobTitle": "DevOps Engineer",
                "url": "https://somaz.blog/authors/somaz/",
                "sameAs": [
                    "https://github.com/somaz94","https://www.linkedin.com/in/somaz"
                ]
            },
            "publisher": {
                "@type": "Organization",
                "name": "somaz",
                "url": "https://somaz.blog/",
                "logo": {
                    "@type": "ImageObject",
                    "url": "https://somaz.blog/assets/img/blog-image.png",
                    "width": "600",
                    "height": "315"
                }
            },
            "mainEntityOfPage": "True",
            "genre": "CICD",
            "articleSection": "CICD",
            "keywords": ["gitlab","cicd","pipeline","automation"]
        }
        </script>
    </body>
</html>
