<!DOCTYPE html>
<html lang="en" class="no-js">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    

    
    

    
    

    
    

    <!-- ✅ Google Tag Manager 추가 -->
    <script>
        (function(w,d,s,l,i){
            w[l]=w[l]||[];
            w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
            var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
            j.async=true;
            j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
            f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-MBP83N4Q');
    </script>
      <!-- ✅ End Google Tag Manager -->

    <!-- Mermaid.js 직접 로드 -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>

    <title>Installing Kubernetes with Kubespray and Adding Worker Nodes (2024V.) | somaz</title>
    <meta name="description" content="Learn how to install Kubernetes using Kubespray and scale worker nodes with this step-by-step tutorial">
    
        <meta name="keywords" content="kubernetes, kubespray, ansible, gcp, installation, cluster-management">
    

    <!-- Social: Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Installing Kubernetes with Kubespray and Adding Worker Nodes (2024V.) | somaz">
    <meta name="twitter:description" content="Learn how to install Kubernetes using Kubespray and scale worker nodes with this step-by-step tutorial">

    
        <meta property="twitter:image" content="https://res.cloudinary.com/dkcm26aem/image/upload/v1737697968/kubespray_uyug5r.png">
    
    
    
        <meta name="twitter:site" content="@twitter_username">
    

    <!-- Social: Facebook / Open Graph -->
    <meta property="og:url" content="https://somaz.blog/category/kubernetes/kubernetes-install-kubespray/">
    <meta property="og:title" content="Installing Kubernetes with Kubespray and Adding Worker Nodes (2024V.) | somaz">
    <meta property="og:image" content="https://res.cloudinary.com/dkcm26aem/image/upload/v1737697968/kubespray_uyug5r.png">
    <meta property="og:description" content="Learn how to install Kubernetes using Kubespray and scale worker nodes with this step-by-step tutorial">
    <meta property="og:site_name" content="Somaz Tech Blog">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/assets/img/icons/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/img/icons/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/img/icons/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/img/icons/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/img/icons/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/img/icons/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/img/icons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/icons/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/img/icons/apple-touch-icon-152x152.png" />

    <!-- Windows 8 Tile Icons -->
    <meta name="application-name" content="somaz">
    <meta name="msapplication-TileColor" content="#141414">
    <meta name="msapplication-square70x70logo" content="smalltile.png" />
    <meta name="msapplication-square150x150logo" content="mediumtile.png" />
    <meta name="msapplication-wide310x150logo" content="widetile.png" />
    <meta name="msapplication-square310x310logo" content="largetile.png" />
    
    <!-- Android Lolipop Theme Color -->
    <meta name="theme-color" content="#141414">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Titillium+Web:300,400,700" rel="stylesheet">

    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="canonical" href="https://somaz.blog/category/kubernetes/kubernetes-install-kubespray/">
    <link rel="alternate" type="application/rss+xml" title="Somaz Tech Blog" href="https://somaz.blog/feed.xml" />

    <!-- Include extra styles -->
    

    <!-- JavaScript enabled/disabled -->
    <script>
        document.querySelector('html').classList.remove('no-js');
    </script>

    <!-- Google Adsense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8725590811736154"
        crossorigin="anonymous"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"> -->
    <!-- <link href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/variable/woff2/SUIT-Variable.css" rel="stylesheet"> -->
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- <link href="https://fonts.googleapis.com/css2?family=Albert+Sans:wght@400;500;700&display=swap" rel="stylesheet"> -->

    <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml" />

</head>
<!-- ✅ Google Tag Manager (noscript) -->
<noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MBP83N4Q"
            height="0" width="0" style="display:none;visibility:hidden">
    </iframe>
</noscript>
<!-- ✅ End Google Tag Manager (noscript) -->
    <body class="has-push-menu">
        





        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" display="none" version="1.1"><defs><symbol id="icon-menu" viewBox="0 0 1024 1024"><path class="path1" d="M128 213.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 725.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 469.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5z"/></symbol><symbol id="icon-search" viewBox="0 0 951 1024"><path class="path1" d="M658.286 475.429q0-105.714-75.143-180.857t-180.857-75.143-180.857 75.143-75.143 180.857 75.143 180.857 180.857 75.143 180.857-75.143 75.143-180.857zM950.857 950.857q0 29.714-21.714 51.429t-51.429 21.714q-30.857 0-51.429-21.714l-196-195.429q-102.286 70.857-228 70.857-81.714 0-156.286-31.714t-128.571-85.714-85.714-128.571-31.714-156.286 31.714-156.286 85.714-128.571 128.571-85.714 156.286-31.714 156.286 31.714 128.571 85.714 85.714 128.571 31.714 156.286q0 125.714-70.857 228l196 196q21.143 21.143 21.143 51.429z"/></symbol><symbol id="icon-close" viewBox="0 0 1000 1000"><path d="M969.8,870.3c27,27.7,27,71.8,0,99.1C955.7,983,937.9,990,920,990c-17.9,0-35.7-7-49.7-20.7L500,599L129.6,969.4C115.6,983,97.8,990,79.9,990s-35.7-7-49.7-20.7c-27-27.3-27-71.4,0-99.1L400.9,500L30.3,129.3c-27-27.3-27-71.4,0-99.1c27.3-27,71.8-27,99.4,0L500,400.9L870.4,30.2c27.7-27,71.8-27,99.4,0c27,27.7,27,71.8,0,99.1L599.1,500L969.8,870.3z"/></symbol><symbol id="icon-twitter" viewBox="0 0 951 1024"><path class="path1" d="M925.714 233.143q-38.286 56-92.571 95.429 0.571 8 0.571 24 0 74.286-21.714 148.286t-66 142-105.429 120.286-147.429 83.429-184.571 31.143q-154.857 0-283.429-82.857 20 2.286 44.571 2.286 128.571 0 229.143-78.857-60-1.143-107.429-36.857t-65.143-91.143q18.857 2.857 34.857 2.857 24.571 0 48.571-6.286-64-13.143-106-63.714t-42-117.429v-2.286q38.857 21.714 83.429 23.429-37.714-25.143-60-65.714t-22.286-88q0-50.286 25.143-93.143 69.143 85.143 168.286 136.286t212.286 56.857q-4.571-21.714-4.571-42.286 0-76.571 54-130.571t130.571-54q80 0 134.857 58.286 62.286-12 117.143-44.571-21.143 65.714-81.143 101.714 53.143-5.714 106.286-28.571z"/></symbol><symbol id="icon-facebook" viewBox="0 0 585 1024"><path class="path1" d="M548 6.857v150.857h-89.714q-49.143 0-66.286 20.571t-17.143 61.714v108h167.429l-22.286 169.143h-145.143v433.714h-174.857v-433.714h-145.714v-169.143h145.714v-124.571q0-106.286 59.429-164.857t158.286-58.571q84 0 130.286 6.857z"/></symbol><symbol id="icon-clock" viewBox="0 0 1000 1000"><path d="M500,10C229.8,10,10,229.8,10,500c0,270.2,219.8,490,490,490c270.2,0,490-219.8,490-490C990,229.8,770.2,10,500,10z M500,910.2c-226.2,0-410.2-184-410.2-410.2c0-226.2,184-410.2,410.2-410.2c226.2,0,410.2,184,410.2,410.2C910.2,726.1,726.2,910.2,500,910.2z M753.1,374c8.2,11.9,5.2,28.1-6.6,36.3L509.9,573.7c-4.4,3.1-9.6,4.6-14.8,4.6c-4.1,0-8.3-1-12.1-3c-8.6-4.5-14-13.4-14-23.1V202.5c0-14.4,11.7-26.1,26.1-26.1c14.4,0,26.1,11.7,26.1,26.1v300l195.6-135.1C728.7,359.2,744.9,362.1,753.1,374z"/></symbol><symbol id="icon-calendar" viewBox="0 0 1000 1000"><path d="M920,500v420H80V500H920 M990,430H10v490c0,38.7,31.3,70,70,70h840c38.7,0,70-31.3,70-70V430L990,430z"/><path d="M850,80v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80H360v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80C72.8,80,10,142.7,10,220v140h980V220C990,142.7,927.2,80,850,80z"/><path d="M255,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C290,25.8,274.3,10,255,10z"/><path d="M745,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C780,25.8,764.3,10,745,10z"/></symbol><symbol id="icon-github" viewBox="0 0 12 14"><path d="M6 1q1.633 0 3.012 0.805t2.184 2.184 0.805 3.012q0 1.961-1.145 3.527t-2.957 2.168q-0.211 0.039-0.312-0.055t-0.102-0.234q0-0.023 0.004-0.598t0.004-1.051q0-0.758-0.406-1.109 0.445-0.047 0.801-0.141t0.734-0.305 0.633-0.52 0.414-0.82 0.16-1.176q0-0.93-0.617-1.609 0.289-0.711-0.062-1.594-0.219-0.070-0.633 0.086t-0.719 0.344l-0.297 0.187q-0.727-0.203-1.5-0.203t-1.5 0.203q-0.125-0.086-0.332-0.211t-0.652-0.301-0.664-0.105q-0.352 0.883-0.062 1.594-0.617 0.68-0.617 1.609 0 0.664 0.16 1.172t0.41 0.82 0.629 0.523 0.734 0.305 0.801 0.141q-0.305 0.281-0.383 0.805-0.164 0.078-0.352 0.117t-0.445 0.039-0.512-0.168-0.434-0.488q-0.148-0.25-0.379-0.406t-0.387-0.187l-0.156-0.023q-0.164 0-0.227 0.035t-0.039 0.090 0.070 0.109 0.102 0.094l0.055 0.039q0.172 0.078 0.34 0.297t0.246 0.398l0.078 0.18q0.102 0.297 0.344 0.48t0.523 0.234 0.543 0.055 0.434-0.027l0.18-0.031q0 0.297 0.004 0.691t0.004 0.426q0 0.141-0.102 0.234t-0.312 0.055q-1.812-0.602-2.957-2.168t-1.145-3.527q0-1.633 0.805-3.012t2.184-2.184 3.012-0.805zM2.273 9.617q0.023-0.055-0.055-0.094-0.078-0.023-0.102 0.016-0.023 0.055 0.055 0.094 0.070 0.047 0.102-0.016zM2.516 9.883q0.055-0.039-0.016-0.125-0.078-0.070-0.125-0.023-0.055 0.039 0.016 0.125 0.078 0.078 0.125 0.023zM2.75 10.234q0.070-0.055 0-0.148-0.062-0.102-0.133-0.047-0.070 0.039 0 0.141t0.133 0.055zM3.078 10.562q0.062-0.062-0.031-0.148-0.094-0.094-0.156-0.023-0.070 0.062 0.031 0.148 0.094 0.094 0.156 0.023zM3.523 10.758q0.023-0.086-0.102-0.125-0.117-0.031-0.148 0.055t0.102 0.117q0.117 0.047 0.148-0.047zM4.016 10.797q0-0.102-0.133-0.086-0.125 0-0.125 0.086 0 0.102 0.133 0.086 0.125 0 0.125-0.086zM4.469 10.719q-0.016-0.086-0.141-0.070-0.125 0.023-0.109 0.117t0.141 0.062 0.109-0.109z"></path></symbol><symbol id="icon-medium" viewBox="0 0 1000 1000"><path d="M336.5,240.2v641.5c0,9.1-2.3,16.9-6.8,23.2s-11.2,9.6-20,9.6c-6.2,0-12.2-1.5-18-4.4L37.3,782.7c-7.7-3.6-14.1-9.8-19.4-18.3S10,747.4,10,739V115.5c0-7.3,1.8-13.5,5.5-18.6c3.6-5.1,8.9-7.7,15.9-7.7c5.1,0,13.1,2.7,24.1,8.2l279.5,140C335.9,238.6,336.5,239.5,336.5,240.2L336.5,240.2z M371.5,295.5l292,473.6l-292-145.5V295.5z M990,305.3v576.4c0,9.1-2.6,16.5-7.7,22.1c-5.1,5.7-12,8.5-20.8,8.5s-17.3-2.4-25.7-7.1L694.7,784.9L990,305.3z M988.4,239.7c0,1.1-46.8,77.6-140.3,229.4C754.6,621,699.8,709.8,683.8,735.7L470.5,389l177.2-288.2c6.2-10.2,15.7-15.3,28.4-15.3c5.1,0,9.8,1.1,14.2,3.3l295.9,147.7C987.6,237.1,988.4,238.2,988.4,239.7L988.4,239.7z"/></symbol><symbol id="icon-instagram" viewBox="0 0 489.84 489.84"><path d="M249.62,50.46c65.4,0,73.14.25,99,1.43C372.47,53,385.44,57,394.07,60.32a75.88,75.88,0,0,1,28.16,18.32,75.88,75.88,0,0,1,18.32,28.16c3.35,8.63,7.34,21.6,8.43,45.48,1.18,25.83,1.43,33.57,1.43,99s-0.25,73.14-1.43,99c-1.09,23.88-5.08,36.85-8.43,45.48a81.11,81.11,0,0,1-46.48,46.48c-8.63,3.35-21.6,7.34-45.48,8.43-25.82,1.18-33.57,1.43-99,1.43s-73.15-.25-99-1.43c-23.88-1.09-36.85-5.08-45.48-8.43A75.88,75.88,0,0,1,77,423.86,75.88,75.88,0,0,1,58.69,395.7c-3.35-8.63-7.34-21.6-8.43-45.48-1.18-25.83-1.43-33.57-1.43-99s0.25-73.14,1.43-99c1.09-23.88,5.08-36.85,8.43-45.48A75.88,75.88,0,0,1,77,78.64a75.88,75.88,0,0,1,28.16-18.32c8.63-3.35,21.6-7.34,45.48-8.43,25.83-1.18,33.57-1.43,99-1.43m0-44.13c-66.52,0-74.86.28-101,1.47s-43.87,5.33-59.45,11.38A120.06,120.06,0,0,0,45.81,47.44,120.06,120.06,0,0,0,17.56,90.82C11.5,106.4,7.36,124.2,6.17,150.27s-1.47,34.46-1.47,101,0.28,74.86,1.47,101,5.33,43.87,11.38,59.45a120.06,120.06,0,0,0,28.25,43.38,120.06,120.06,0,0,0,43.38,28.25c15.58,6.05,33.38,10.19,59.45,11.38s34.46,1.47,101,1.47,74.86-.28,101-1.47,43.87-5.33,59.45-11.38a125.24,125.24,0,0,0,71.63-71.63c6.05-15.58,10.19-33.38,11.38-59.45s1.47-34.46,1.47-101-0.28-74.86-1.47-101-5.33-43.87-11.38-59.45a120.06,120.06,0,0,0-28.25-43.38,120.06,120.06,0,0,0-43.38-28.25C394.47,13.13,376.67,9,350.6,7.8s-34.46-1.47-101-1.47h0Z" transform="translate(-4.7 -6.33)" /><path d="M249.62,125.48A125.77,125.77,0,1,0,375.39,251.25,125.77,125.77,0,0,0,249.62,125.48Zm0,207.41a81.64,81.64,0,1,1,81.64-81.64A81.64,81.64,0,0,1,249.62,332.89Z" transform="translate(-4.7 -6.33)"/><circle cx="375.66" cy="114.18" r="29.39" /></symbol><symbol id="icon-linkedin" viewBox="0 0 12 14"><path d="M2.727 4.883v7.742h-2.578v-7.742h2.578zM2.891 2.492q0.008 0.57-0.395 0.953t-1.059 0.383h-0.016q-0.641 0-1.031-0.383t-0.391-0.953q0-0.578 0.402-0.957t1.051-0.379 1.039 0.379 0.398 0.957zM12 8.187v4.437h-2.57v-4.141q0-0.82-0.316-1.285t-0.988-0.465q-0.492 0-0.824 0.27t-0.496 0.668q-0.086 0.234-0.086 0.633v4.32h-2.57q0.016-3.117 0.016-5.055t-0.008-2.313l-0.008-0.375h2.57v1.125h-0.016q0.156-0.25 0.32-0.438t0.441-0.406 0.68-0.34 0.895-0.121q1.336 0 2.148 0.887t0.813 2.598z"></path></symbol><symbol id="icon-heart" viewBox="0 0 34 30"><path d="M17,29.7 L16.4,29.2 C3.5,18.7 0,15 0,9 C0,4 4,0 9,0 C13.1,0 15.4,2.3 17,4.1 C18.6,2.3 20.9,0 25,0 C30,0 34,4 34,9 C34,15 30.5,18.7 17.6,29.2 L17,29.7 Z M9,2 C5.1,2 2,5.1 2,9 C2,14.1 5.2,17.5 17,27.1 C28.8,17.5 32,14.1 32,9 C32,5.1 28.9,2 25,2 C21.5,2 19.6,4.1 18.1,5.8 L17,7.1 L15.9,5.8 C14.4,4.1 12.5,2 9,2 Z" id="Shape"></path></symbol><symbol id="icon-arrow-right" viewBox="0 0 25.452 25.452"><path d="M4.471,24.929v-2.004l12.409-9.788c0.122-0.101,0.195-0.251,0.195-0.411c0-0.156-0.073-0.31-0.195-0.409L4.471,2.526V0.522c0-0.2,0.115-0.384,0.293-0.469c0.18-0.087,0.396-0.066,0.552,0.061l15.47,12.202c0.123,0.1,0.195,0.253,0.195,0.409c0,0.16-0.072,0.311-0.195,0.411L5.316,25.34c-0.155,0.125-0.372,0.147-0.552,0.061C4.586,25.315,4.471,25.13,4.471,24.929z"/></symbol><symbol id="icon-star" viewBox="0 0 48 48"><path fill="currentColor" d="M44,24c0,11.045-8.955,20-20,20S4,35.045,4,24S12.955,4,24,4S44,12.955,44,24z"/><path fill="#ffffff" d="M24,11l3.898,7.898l8.703,1.301l-6.301,6.102l1.5,8.699L24,30.898L16.199,35l1.5-8.699l-6.301-6.102  l8.703-1.301L24,11z"/></symbol><symbol id="icon-read" viewBox="0 0 32 32"><path fill="currentColor" d="M29,4H3C1.343,4,0,5.343,0,7v18c0,1.657,1.343,3,3,3h10c0,0.552,0.448,1,1,1h4c0.552,0,1-0.448,1-1h10  c1.657,0,3-1.343,3-3V7C32,5.343,30.657,4,29,4z M29,5v20H18.708c-0.618,0-1.236,0.146-1.789,0.422l-0.419,0.21V5H29z M15.5,5  v20.632l-0.419-0.21C14.528,25.146,13.91,25,13.292,25H3V5H15.5z M31,25c0,1.103-0.897,2-2,2H18v1h-4v-1H3c-1.103,0-2-0.897-2-2V7  c0-0.737,0.405-1.375,1-1.722V25c0,0.552,0.448,1,1,1h10.292c0.466,0,0.925,0.108,1.342,0.317l0.919,0.46  c0.141,0.07,0.294,0.106,0.447,0.106c0.153,0,0.306-0.035,0.447-0.106l0.919-0.46C17.783,26.108,18.242,26,18.708,26H29  c0.552,0,1-0.448,1-1V5.278C30.595,5.625,31,6.263,31,7V25z M6,12.5C6,12.224,6.224,12,6.5,12h5c0.276,0,0.5,0.224,0.5,0.5  S11.776,13,11.5,13h-5C6.224,13,6,12.776,6,12.5z M6,14.5C6,14.224,6.224,14,6.5,14h5c0.276,0,0.5,0.224,0.5,0.5S11.776,15,11.5,15  h-5C6.224,15,6,14.776,6,14.5z M6,16.5C6,16.224,6.224,16,6.5,16h5c0.276,0,0.5,0.224,0.5,0.5S11.776,17,11.5,17h-5  C6.224,17,6,16.776,6,16.5z M20,12.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,13,25.5,13h-5  C20.224,13,20,12.776,20,12.5z M20,14.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,15,25.5,15h-5  C20.224,15,20,14.776,20,14.5z M20,16.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,17,25.5,17h-5  C20.224,17,20,16.776,20,16.5z"></path></symbol><symbol id="icon-tistory" viewBox="0 0 24 24"><path d="M4 4h16v3h-6v13h-4V7H4V4z"/></symbol></defs></svg>

        <header class="bar-header">
    <a id="menu" role="button">
        <svg id="open" class="icon-menu"><use xlink:href="#icon-menu"></use></svg>
    </a>
    <h1 class="logo">
        <a href="/">
            
                somaz <span class="version">v3.1.2</span>
            
        </a>
    </h1>
    <a id="search" class="dosearch" role="button">
        <svg class="icon-search"><use xlink:href="#icon-search"></use></svg>
    </a>
    
        <a href="https://github.com/thiagorossener/jekflix-template" class="get-theme" role="button">
            Get this theme!
        </a>
    
</header>

<div id="mask" class="overlay"></div>

<aside class="sidebar" id="sidebar">
    <nav id="navigation">
      <h2>Menu</h2>
      <ul>
  
    
      <li>
        <a href="https://somaz.blog/">Home</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/about">About</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/category">Category</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/contact">Contact</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/feed.xml">Feed</a>
      </li>
    
  
</ul>

    </nav>
</aside>

<div class="search-wrapper">
    <div class="search-form">
        <input type="text" class="search-field" placeholder="Search">
        <svg class="icon-remove-sign"><use xlink:href="#icon-close"></use></svg>
        <ul class="search-results search-list"></ul>
    </div>
</div>



        <section class="post two-columns">
            <article role="article" class="post-content">
                <p class="post-info">
                    
                        <svg class="icon-calendar" id="date"><use xlink:href="#icon-calendar"></use></svg>
                        <time class="date" datetime="2025-01-24T16:00:00+00:00">
                            


January 24, 2025

                        </time>
                    
                    <svg id="clock" class="icon-clock"><use xlink:href="#icon-clock"></use></svg>
                    <span>15 min to read</span>
                </p>
                <h1 class="post-title">Installing Kubernetes with Kubespray and Adding Worker Nodes (2024V.)</h1>
                <p class="post-subtitle">A comprehensive guide to setting up Kubernetes using Kubespray on GCP</p>

                
                    <img src="https://res.cloudinary.com/dkcm26aem/image/upload/v1737697968/kubespray_uyug5r.png" alt="Featured image" class="post-cover">
                

                <!-- Pagination links -->



                <!-- Add your table of contents here -->


                <p><a href="https://medium.com/@sankalp_saxena/provisioning-ha-k8s-cluster-using-ansible-and-kubespray-using-ec2-instances-45a7b7365d97">Image Reference link</a></p>

<p><br /></p>

<hr />

<h2 id="overview">Overview</h2>

<p>Kubespray is a powerful tool that combines the flexibility of Ansible with the robustness of Kubernetes, enabling the deployment of production-ready Kubernetes clusters on various infrastructures. This guide provides detailed instructions for installing a Kubernetes cluster using Kubespray on Google Cloud Platform (GCP) and demonstrates how to add worker nodes to scale your cluster.</p>

<div class="info-box info-box-default-not-check">
  <strong>What is Kubespray?</strong>
  <p>Kubespray is a composition of <a href="https://www.ansible.com/" target="_blank">Ansible</a> playbooks, inventory, provisioning tools, and domain knowledge for deploying a production-ready Kubernetes cluster. It allows for highly customizable deployments and supports multiple cloud providers, bare metal installations, and virtualized environments.</p>
  <p>Key features include:</p>
  <ul>
    <li>Composable attributes</li>
    <li>Multiple network plugin support (Calico, Flannel, Cilium, etc.)</li>
    <li>HA cluster setup</li>
    <li>Configurable addons</li>
    <li>Support for most popular Linux distributions</li>
  </ul>
</div>

<div style="width: 100%; margin: 20px auto;">
  <div class="mermaid">
    graph TD
      A[Kubespray Repository] --&gt; B[Ansible Playbooks]
      B --&gt; C[Kubernetes Components]
      C --&gt; D[Control Plane Setup]
      C --&gt; E[Node Setup]
      C --&gt; F[Networking]
      C --&gt; G[Add-ons]
      
      D --&gt; H[API Server]
      D --&gt; I[Controller Manager]
      D --&gt; J[Scheduler]
      D --&gt; K[etcd]
      
      E --&gt; L[kubelet]
      E --&gt; M[kube-proxy]
      
      F --&gt; N[Network Plugin]
      F --&gt; O[Service Networking]
      
      G --&gt; P[DNS]
      G --&gt; Q[Dashboard]
      G --&gt; R[Metrics Server]
      
      style A fill:#bbdefb,stroke:#333,stroke-width:1px
      style B fill:#90caf9,stroke:#333,stroke-width:1px
      style C fill:#64b5f6,stroke:#333,stroke-width:1px
      style D fill:#42a5f5,stroke:#333,stroke-width:1px
      style E fill:#42a5f5,stroke:#333,stroke-width:1px
      style F fill:#42a5f5,stroke:#333,stroke-width:1px
      style G fill:#42a5f5,stroke:#333,stroke-width:1px
  </div>
</div>

<p><br /><br /><br /></p>

<h2 id="system-configuration">System Configuration</h2>

<p><br /></p>

<h3 id="environment-details">Environment Details</h3>

<div class="table-container">
  <table class="table-beauty">
    <tr>
      <th style="width: 30%;">Component</th>
      <th style="width: 70%;">Specification</th>
    </tr>
    <tr>
      <td>Operating System</td>
      <td>Ubuntu 20.04 LTS (Focal)</td>
    </tr>
    <tr>
      <td>Cloud Provider</td>
      <td>Google Compute Engine (GCP)</td>
    </tr>
    <tr>
      <td>Kubernetes Version</td>
      <td>v1.28.6 (deployed by Kubespray)</td>
    </tr>
    <tr>
      <td>CNI Plugin</td>
      <td>Calico (default)</td>
    </tr>
    <tr>
      <td>Container Runtime</td>
      <td>containerd</td>
    </tr>
    <tr>
      <td>Python Version</td>
      <td>3.10.13</td>
    </tr>
  </table>
</div>

<p><br /></p>

<h3 id="node-specifications">Node Specifications</h3>

<div class="table-container">
  <table class="table-beauty">
    <tr>
      <th style="width: 20%;">Node</th>
      <th style="width: 20%;">Hostname / Name</th>
      <th style="width: 15%;">IP Address</th>
      <th style="width: 10%;">CPU</th>
      <th style="width: 10%;">Memory</th>
      <th style="width: 25%;">Role</th>
    </tr>
    <tr>
      <td>Control Plane Node</td>
      <td>test-server</td>
      <td>10.77.101.62</td>
      <td>2 cores</td>
      <td>8096MB</td>
      <td>Control Plane + etcd</td>
    </tr>
    <tr>
      <td>Worker Node 1</td>
      <td>test-server-agent</td>
      <td>10.77.101.57</td>
      <td>2 cores</td>
      <td>8096MB</td>
      <td>Worker (application)</td>
    </tr>
    <tr>
      <td>Worker Node 2</td>
      <td>test-server-agent2</td>
      <td>10.77.101.200</td>
      <td>2 cores</td>
      <td>8096MB</td>
      <td>Worker (application)</td>
    </tr>
  </table>
</div>

<p><br /></p>

<h2 id="infrastructure-setup">Infrastructure Setup</h2>

<p><br /></p>

<h3 id="infrastructure-as-code-iac">Infrastructure as Code (IaC)</h3>

<p>We use Terraform to provision our GCP infrastructure. Here are the key resources:</p>

<p><br /></p>

<h4 id="control-plane-node-configuration">Control Plane Node Configuration</h4>
<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">resource</span> <span class="s2">"google_compute_address"</span> <span class="s2">"test_server_ip"</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="p">=</span> <span class="nx">var</span><span class="err">.</span><span class="nx">test_server_ip</span>
<span class="p">}</span>

<span class="nx">resource</span> <span class="s2">"google_compute_instance"</span> <span class="s2">"test_server"</span> <span class="p">{</span>
  <span class="nx">name</span>         <span class="p">=</span> <span class="nx">var</span><span class="err">.</span><span class="nx">test_server</span>
  <span class="nx">machine_type</span> <span class="p">=</span> <span class="s2">"n2-standard-2"</span>
  <span class="nx">zone</span>         <span class="p">=</span> <span class="s2">"${var.region}-a"</span>
  
  <span class="nx">boot_disk</span> <span class="p">{</span>
    <span class="nx">initialize_params</span> <span class="p">{</span>
      <span class="nx">image</span> <span class="p">=</span> <span class="s2">"ubuntu-os-cloud/ubuntu-2004-lts"</span>
      <span class="nx">size</span>  <span class="p">=</span> <span class="mi">10</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">network_interface</span> <span class="p">{</span>
    <span class="nx">network</span>    <span class="p">=</span> <span class="nx">var</span><span class="err">.</span><span class="nx">shared_vpc</span>
    <span class="nx">subnetwork</span> <span class="p">=</span> <span class="s2">"${var.subnet_share}-mgmt-a"</span>
    <span class="nx">access_config</span> <span class="p">{</span>
      <span class="nx">nat_ip</span> <span class="p">=</span> <span class="nx">google_compute_address</span><span class="err">.</span><span class="nx">test_server_ip</span><span class="err">.</span><span class="nx">address</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="c1"># Recommended metadata for Kubernetes nodes</span>
  <span class="nx">metadata</span> <span class="p">=</span> <span class="p">{</span>
    <span class="s2">"startup-script"</span> <span class="p">=</span> <span class="o">&lt;&lt;-</span><span class="no">EOF</span><span class="sh">
      #!/bin/bash
      swapoff -a
      sed -i '/swap/d' /etc/fstab
      
      # Set system parameters for Kubernetes
      cat &gt; /etc/sysctl.d/99-kubernetes.conf &lt;&lt;EOF2
      net.bridge.bridge-nf-call-iptables = 1
      net.ipv4.ip_forward = 1
      EOF2
      sysctl --system
</span><span class="no">    EOF
</span>  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="worker-node-configuration">Worker Node Configuration</h4>
<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">resource</span> <span class="s2">"google_compute_address"</span> <span class="s2">"test_server_agent_ip"</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="p">=</span> <span class="nx">var</span><span class="err">.</span><span class="nx">test_server_agent_ip</span>
<span class="p">}</span>

<span class="nx">resource</span> <span class="s2">"google_compute_instance"</span> <span class="s2">"test_server_agent"</span> <span class="p">{</span>
  <span class="nx">name</span>         <span class="p">=</span> <span class="nx">var</span><span class="err">.</span><span class="nx">test_server_agent</span>
  <span class="nx">machine_type</span> <span class="p">=</span> <span class="s2">"n2-standard-2"</span>
  <span class="nx">zone</span>         <span class="p">=</span> <span class="s2">"${var.region}-a"</span>
  
  <span class="nx">boot_disk</span> <span class="p">{</span>
    <span class="nx">initialize_params</span> <span class="p">{</span>
      <span class="nx">image</span> <span class="p">=</span> <span class="s2">"ubuntu-os-cloud/ubuntu-2004-lts"</span>
      <span class="nx">size</span>  <span class="p">=</span> <span class="mi">10</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">network_interface</span> <span class="p">{</span>
    <span class="nx">network</span>    <span class="p">=</span> <span class="nx">var</span><span class="err">.</span><span class="nx">shared_vpc</span>
    <span class="nx">subnetwork</span> <span class="p">=</span> <span class="s2">"${var.subnet_share}-mgmt-a"</span>
    <span class="nx">access_config</span> <span class="p">{</span>
      <span class="nx">nat_ip</span> <span class="p">=</span> <span class="nx">google_compute_address</span><span class="err">.</span><span class="nx">test_server_agent_ip</span><span class="err">.</span><span class="nx">address</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="c1"># Same startup script as control plane for Kubernetes prerequisites</span>
  <span class="nx">metadata</span> <span class="p">=</span> <span class="p">{</span>
    <span class="s2">"startup-script"</span> <span class="p">=</span> <span class="o">&lt;&lt;-</span><span class="no">EOF</span><span class="sh">
      #!/bin/bash
      swapoff -a
      sed -i '/swap/d' /etc/fstab
      
      # Set system parameters for Kubernetes
      cat &gt; /etc/sysctl.d/99-kubernetes.conf &lt;&lt;EOF2
      net.bridge.bridge-nf-call-iptables = 1
      net.ipv4.ip_forward = 1
      EOF2
      sysctl --system
</span><span class="no">    EOF
</span>  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><br /></p>

<h2 id="prerequisites">Prerequisites</h2>

<p>Before starting the Kubespray installation, you need to prepare your environment.</p>

<p><br /></p>

<h3 id="system-requirements">System Requirements</h3>

<ul>
  <li><strong>Operating System</strong>: Ubuntu 20.04 or other supported Linux distributions</li>
  <li><strong>SSH Access</strong>: Between the deployment host and all nodes</li>
  <li><strong>Python</strong>: Version 3.9+ (we’ll use 3.10)</li>
  <li><strong>Ansible</strong>: Will be installed by the setup process</li>
  <li><strong>Git</strong>: For cloning the Kubespray repository</li>
  <li><strong>sudo privileges</strong>: On all nodes</li>
</ul>

<p><br /></p>

<h3 id="node-preparation">Node Preparation</h3>

<h4 id="ssh-key-setup">SSH Key Setup</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Generate SSH key if needed</span>
ssh-keygen <span class="nt">-t</span> rsa <span class="nt">-b</span> 4096 <span class="nt">-C</span> <span class="s2">"kubespray-deployment"</span>

<span class="c"># Copy SSH key to all nodes</span>
ssh-copy-id somaz@10.77.101.62  <span class="c"># Control plane</span>
ssh-copy-id somaz@10.77.101.57  <span class="c"># Worker 1</span>
ssh-copy-id somaz@10.77.101.200 <span class="c"># Worker 2</span>

<span class="c"># Update /etc/hosts for easier node access</span>
<span class="nb">cat</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh"> | sudo tee -a /etc/hosts
10.77.101.62 test-server
10.77.101.57 test-server-agent
10.77.101.200 test-server-agent2
</span><span class="no">EOF
</span></code></pre></div></div>

<h4 id="package-installation">Package Installation</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Update package lists</span>
<span class="nb">sudo </span>apt-get update

<span class="c"># Install Python 3.10</span>
<span class="nb">sudo </span>add-apt-repository ppa:deadsnakes/ppa
<span class="nb">sudo </span>apt-get <span class="nt">-y</span> update
<span class="nb">sudo </span>apt <span class="nb">install</span> <span class="nt">-y</span> python3.10 python3-pip git python3.10-venv

<span class="c"># Verify Python version</span>
python3.10 <span class="nt">--version</span>  <span class="c"># Should show Python 3.10.13</span>
</code></pre></div></div>

<h4 id="system-configuration-1">System Configuration</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Disable swap (required for Kubernetes)</span>
<span class="nb">sudo </span>swapoff <span class="nt">-a</span>
<span class="nb">sudo sed</span> <span class="nt">-i</span> <span class="s1">'/swap/d'</span> /etc/fstab

<span class="c"># Load required kernel modules</span>
<span class="nb">cat</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh"> | sudo tee /etc/modules-load.d/k8s.conf
overlay
br_netfilter
</span><span class="no">EOF

</span><span class="nb">sudo </span>modprobe overlay
<span class="nb">sudo </span>modprobe br_netfilter

<span class="c"># Configure kernel parameters</span>
<span class="nb">cat</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh"> | sudo tee /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-iptables  = 1
net.bridge.bridge-nf-call-ip6tables = 1
net.ipv4.ip_forward                 = 1
</span><span class="no">EOF

</span><span class="nb">sudo </span>sysctl <span class="nt">--system</span>
</code></pre></div></div>

<p><br /></p>

<h2 id="kubespray-deployment-process">Kubespray Deployment Process</h2>

<div style="width: 100%; margin: 20px auto;">
  <div class="mermaid">
    sequenceDiagram
      participant Admin as Operator
      participant Deploy as Deployment Host
      participant CP as Control Plane
      participant Worker as Worker Nodes
      
      Admin-&gt;&gt;Deploy: Clone Kubespray repository
      Admin-&gt;&gt;Deploy: Setup Python virtual environment
      Admin-&gt;&gt;Deploy: Install dependencies
      Admin-&gt;&gt;Deploy: Configure inventory
      Deploy-&gt;&gt;CP: Check SSH connectivity
      Deploy-&gt;&gt;Worker: Check SSH connectivity
      Admin-&gt;&gt;Deploy: Run Ansible playbook
      Deploy-&gt;&gt;CP: Install control plane components
      Deploy-&gt;&gt;Worker: Install worker components
      Deploy-&gt;&gt;CP: Initialize cluster
      Deploy-&gt;&gt;Worker: Join nodes to cluster
      CP-&gt;&gt;Worker: Establish cluster communication
      Admin-&gt;&gt;CP: Configure kubectl
      Admin-&gt;&gt;CP: Verify cluster status
  </div>
</div>

<p><br /></p>

<h3 id="1-clone-repository-and-setup-environment">1. Clone Repository and Setup Environment</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Clone the Kubespray repository</span>
git clone https://github.com/kubernetes-sigs/kubespray.git

<span class="c"># Setup virtual environment</span>
<span class="nv">VENVDIR</span><span class="o">=</span>kubespray-venv
<span class="nv">KUBESPRAYDIR</span><span class="o">=</span>kubespray
python3.10 <span class="nt">-m</span> venv <span class="nv">$VENVDIR</span>
<span class="nb">source</span> <span class="nv">$VENVDIR</span>/bin/activate
<span class="nb">cd</span> <span class="nv">$KUBESPRAYDIR</span>

<span class="c"># Install dependencies</span>
pip <span class="nb">install</span> <span class="nt">-U</span> <span class="nt">-r</span> requirements.txt

<span class="c"># Check Ansible version</span>
ansible <span class="nt">--version</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="2-prepare-ansible-inventory">2. Prepare Ansible Inventory</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Copy sample inventory</span>
<span class="nb">cp</span> <span class="nt">-rfp</span> inventory/sample inventory/somaz-cluster

<span class="c"># Update inventory with nodes</span>
<span class="nb">declare</span> <span class="nt">-a</span> <span class="nv">IPS</span><span class="o">=(</span>10.77.101.62 10.77.101.57<span class="o">)</span>
<span class="nv">CONFIG_FILE</span><span class="o">=</span>inventory/somaz-cluster/hosts.yaml python3 contrib/inventory_builder/inventory.py <span class="k">${</span><span class="nv">IPS</span><span class="p">[@]</span><span class="k">}</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="3-configure-inventory">3. Configure Inventory</h3>

<p>The inventory generator creates a basic configuration, but we’ll make additional adjustments for our setup.</p>

<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># inventory/somaz-cluster/inventory.ini
</span><span class="nn">[all]</span>
<span class="err">test-server</span> <span class="py">ansible_host</span><span class="p">=</span><span class="s">10.77.101.62  ip=10.77.101.62</span>
<span class="err">test-server-agent</span> <span class="py">ansible_host</span><span class="p">=</span><span class="s">10.77.101.57  ip=10.77.101.57</span>

<span class="c"># Control plane node(s)
</span><span class="nn">[kube_control_plane]</span>
<span class="err">test-server</span>

<span class="c"># etcd cluster member(s)
</span><span class="nn">[etcd]</span>
<span class="err">test-server</span>

<span class="c"># Kubernetes worker node(s)
</span><span class="nn">[kube_node]</span>
<span class="err">test-server-agent</span>

<span class="c"># All groups with assigned roles
</span><span class="nn">[k8s_cluster:children]</span>
<span class="err">kube_control_plane</span>
<span class="err">kube_node</span>
<span class="err">calico_rr</span>
</code></pre></div></div>

<h4 id="advanced-inventory-configuration-optional">Advanced Inventory Configuration (Optional)</h4>

<p>You can further customize your deployment by editing these additional files:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Edit group variables for all nodes</span>
vi inventory/somaz-cluster/group_vars/all/all.yml

<span class="c"># Customize Kubernetes-specific parameters</span>
vi inventory/somaz-cluster/group_vars/k8s_cluster/k8s-cluster.yml

<span class="c"># Configure network plugin options</span>
vi inventory/somaz-cluster/group_vars/k8s_cluster/k8s-net-<span class="k">*</span>.yml
</code></pre></div></div>

<p>Common customizations:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">kube_version</code>: Specify Kubernetes version (default is 1.28.6 as of this writing)</li>
  <li><code class="language-plaintext highlighter-rouge">kube_network_plugin</code>: Choose network plugin (calico, flannel, cilium, etc.)</li>
  <li><code class="language-plaintext highlighter-rouge">etcd_deployment_type</code>: etcd deployment method (host or docker-based)</li>
  <li><code class="language-plaintext highlighter-rouge">container_manager</code>: Choose containerd or docker (containerd is recommended)</li>
</ul>

<p><br /></p>

<h3 id="4-verify-ansible-connectivity">4. Verify Ansible Connectivity</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Test connection to all nodes</span>
ansible all <span class="nt">-i</span> inventory/somaz-cluster/inventory.ini <span class="nt">-m</span> ping

<span class="c"># Optional: Update apt cache on all nodes</span>
ansible all <span class="nt">-i</span> inventory/somaz-cluster/inventory.ini <span class="nt">-m</span> apt <span class="nt">-a</span> <span class="s1">'update_cache=yes'</span> <span class="nt">--become</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="5-run-playbook">5. Run Playbook</h3>

<p>Now we’re ready to deploy the Kubernetes cluster using Kubespray’s Ansible playbooks.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Deploy the cluster (this will take 15-30 minutes)</span>
ansible-playbook <span class="nt">-i</span> inventory/somaz-cluster/inventory.ini cluster.yml <span class="nt">--become</span>
</code></pre></div></div>

<div class="info-box info-box-warning-not-check">
  <strong>Important:</strong>
  <p>The cluster deployment can take 15-30 minutes depending on your internet connection speed and server performance. During the deployment process, Ansible will:</p>
  <ul>
    <li>Install container runtime (containerd by default)</li>
    <li>Deploy etcd cluster</li>
    <li>Install Kubernetes components (kubeadm, kubelet, kubectl)</li>
    <li>Initialize the Kubernetes control plane</li>
    <li>Join worker nodes to the cluster</li>
    <li>Deploy network plugins and add-ons</li>
  </ul>
  <p>Be patient and monitor the output for any errors. Most issues can be resolved by looking at the Ansible error messages.</p>
</div>

<p><br /></p>

<h3 id="6-configure-kubectl">6. Configure kubectl</h3>

<p>After successful deployment, you need to configure kubectl to interact with your new cluster.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Create kubectl config directory</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> ~/.kube

<span class="c"># Copy admin configuration</span>
<span class="nb">sudo cp</span> /etc/kubernetes/admin.conf ~/.kube/config
<span class="nb">sudo chown</span> <span class="si">$(</span><span class="nb">id</span> <span class="nt">-u</span><span class="si">)</span>:<span class="si">$(</span><span class="nb">id</span> <span class="nt">-g</span><span class="si">)</span> ~/.kube/config

<span class="c"># Setup kubectl autocomplete (optional but recommended)</span>
<span class="nb">echo</span> <span class="s1">'# kubectl completion and alias'</span> <span class="o">&gt;&gt;</span> ~/.bashrc
<span class="nb">echo</span> <span class="s1">'source &lt;(kubectl completion bash)'</span> <span class="o">&gt;&gt;</span> ~/.bashrc
<span class="nb">echo</span> <span class="s1">'alias k=kubectl'</span> <span class="o">&gt;&gt;</span> ~/.bashrc
<span class="nb">echo</span> <span class="s1">'complete -F __start_kubectl k'</span> <span class="o">&gt;&gt;</span> ~/.bashrc
<span class="nb">source</span> ~/.bashrc

<span class="c"># Test kubectl</span>
kubectl get nodes
</code></pre></div></div>

<p><br /></p>

<h2 id="adding-worker-nodes">Adding Worker Nodes</h2>

<p>One of the key advantages of Kubernetes is its scalability. Let’s add another worker node to our cluster.</p>

<p><br /></p>

<h3 id="1-update-inventory">1. Update Inventory</h3>

<p>First, we need to update our Ansible inventory to include the new worker node.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Add new node to IPS array</span>
<span class="nb">declare</span> <span class="nt">-a</span> <span class="nv">IPS</span><span class="o">=(</span>10.77.101.62 10.77.101.57 10.77.101.200<span class="o">)</span>
<span class="nv">CONFIG_FILE</span><span class="o">=</span>inventory/somaz-cluster/hosts.yaml python3 contrib/inventory_builder/inventory.py <span class="k">${</span><span class="nv">IPS</span><span class="p">[@]</span><span class="k">}</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="2-modify-inventoryini">2. Modify <code class="language-plaintext highlighter-rouge">inventory.ini</code></h3>

<p>After using the inventory builder, it’s good to check and make sure the new node was properly added to the correct groups.</p>

<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># inventory/somaz-cluster/inventory.ini
</span><span class="nn">[all]</span>
<span class="err">test-server</span> <span class="py">ansible_host</span><span class="p">=</span><span class="s">10.77.101.62  ip=10.77.101.62</span>
<span class="err">test-server-agent</span> <span class="py">ansible_host</span><span class="p">=</span><span class="s">10.77.101.57  ip=10.77.101.57</span>
<span class="err">test-server-agent2</span> <span class="py">ansible_host</span><span class="p">=</span><span class="s">10.77.101.200  ip=10.77.101.200</span>

<span class="nn">[kube_control_plane]</span>
<span class="err">test-server</span>

<span class="nn">[etcd]</span>
<span class="err">test-server</span>

<span class="nn">[kube_node]</span>
<span class="err">test-server-agent</span>
<span class="err">test-server-agent2</span>  <span class="c"># Make sure the new node is in the kube_node group
</span></code></pre></div></div>

<p><br /></p>

<h3 id="3-run-scale-playbook">3. Run Scale Playbook</h3>

<p>Kubespray includes a special <code class="language-plaintext highlighter-rouge">scale.yml</code> playbook specifically for adding new worker nodes without affecting the existing cluster.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Add new nodes to the cluster</span>
ansible-playbook <span class="nt">-i</span> inventory/somaz-cluster/inventory.ini scale.yml <span class="nt">--become</span>
</code></pre></div></div>

<div class="info-box info-box-success-not-check">
  <strong>Tip:</strong>
  <p>The <code>scale.yml</code> playbook is designed to only operate on new nodes, which makes it much faster than running the full <code>cluster.yml</code> playbook. It will install the necessary Kubernetes components on the new node and join it to the existing cluster.</p>
</div>

<p><br /><br /></p>

<h3 id="scaling-down-removing-nodes">Scaling Down (Removing Nodes)</h3>

<p>If you need to remove a node from the cluster, Kubespray also provides a removal playbook:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># To remove nodes, first update your inventory to reflect the desired state</span>
<span class="c"># Then run the remove-node playbook</span>
ansible-playbook <span class="nt">-i</span> inventory/somaz-cluster/inventory.ini remove-node.yml <span class="nt">-e</span> <span class="nv">node</span><span class="o">=</span>test-server-agent2 <span class="nt">--become</span>
</code></pre></div></div>

<p><br /></p>

<h2 id="verification-and-monitoring">Verification and Monitoring</h2>

<p><br /></p>

<h3 id="verify-cluster-status">Verify Cluster Status</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Check nodes</span>
kubectl get nodes <span class="nt">-o</span> wide
NAME                 STATUS   ROLES           AGE   VERSION   INTERNAL-IP     EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION     CONTAINER-RUNTIME
test-server          Ready    control-plane   21m   v1.28.6   10.77.101.62    &lt;none&gt;        Ubuntu 20.04.6 LTS   5.15.0-1053-gcp    containerd://1.7.1
test-server-agent    Ready    &lt;none&gt;          20m   v1.28.6   10.77.101.57    &lt;none&gt;        Ubuntu 20.04.6 LTS   5.15.0-1053-gcp    containerd://1.7.1
test-server-agent2   Ready    &lt;none&gt;          65s   v1.28.6   10.77.101.200   &lt;none&gt;        Ubuntu 20.04.6 LTS   5.15.0-1053-gcp    containerd://1.7.1

<span class="c"># Check system namespace</span>
kubectl get po <span class="nt">-n</span> kube-system
NAME                                          READY   STATUS    RESTARTS   AGE
calico-kube-controllers-76475c5546-vb58b      1/1     Running   0          20m
calico-node-hvx95                             1/1     Running   0          20m
calico-node-lq4tg                             1/1     Running   0          20m
calico-node-vftnr                             1/1     Running   0          1m
coredns-77f7cc69db-ctvk6                      1/1     Running   0          19m
coredns-77f7cc69db-h4bbx                      1/1     Running   0          19m
dns-autoscaler-5b576d9b75-pvbwj               1/1     Running   0          19m
kube-apiserver-test-server                    1/1     Running   0          21m
kube-controller-manager-test-server           1/1     Running   0          21m
kube-proxy-5n5tq                              1/1     Running   0          20m
kube-proxy-lx25t                              1/1     Running   0          1m
kube-proxy-s6x8h                              1/1     Running   0          20m
kube-scheduler-test-server                    1/1     Running   0          21m
kubernetes-dashboard-787dd78ffd-jl8bd         1/1     Running   0          19m
metrics-server-67df99fc7d-p8nzk               1/1     Running   0          19m
nginx-proxy-test-server-agent                 1/1     Running   0          20m
nginx-proxy-test-server-agent2                1/1     Running   0          1m
nodelocaldns-fwl5r                            1/1     Running   0          19m
nodelocaldns-hkvk2                            1/1     Running   0          1m
nodelocaldns-szfj6                            1/1     Running   0          19m
</code></pre></div></div>

<p><br /></p>

<h3 id="monitoring-cluster-components">Monitoring Cluster Components</h3>

<p><br /></p>

<script src="https://gist.github.com/somaz94/d9a07cd8028a40d2163f87eaae3c8c96.js"></script>

<p><br /></p>

<h2 id="cluster-maintenance">Cluster Maintenance</h2>

<p><br /></p>

<h3 id="upgrading-the-cluster">Upgrading the Cluster</h3>

<p>Kubespray makes it easy to upgrade your Kubernetes cluster to newer versions.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Update Kubespray repository</span>
<span class="nb">cd</span> <span class="nv">$KUBESPRAYDIR</span>
git fetch <span class="nt">--all</span>
git checkout &lt;desired_version_tag&gt;

<span class="c"># Update dependencies</span>
pip <span class="nb">install</span> <span class="nt">-U</span> <span class="nt">-r</span> requirements.txt

<span class="c"># Update inventory parameters for the new version</span>
<span class="c"># Edit inventory/somaz-cluster/group_vars/k8s_cluster/k8s-cluster.yml</span>
<span class="c"># Set kube_version to the desired version</span>

<span class="c"># Run the upgrade playbook</span>
ansible-playbook <span class="nt">-i</span> inventory/somaz-cluster/group_vars/all/all.yml upgrade-cluster.yml <span class="nt">--become</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="backup-and-restore">Backup and Restore</h3>

<p>It’s crucial to back up your etcd data regularly:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Backup etcd data</span>
ansible-playbook <span class="nt">-i</span> inventory/somaz-cluster/inventory.ini etcd_backup.yml <span class="nt">--become</span>

<span class="c"># This creates a backup in /tmp/etcd_backup on the etcd host(s)</span>
</code></pre></div></div>

<p><br /></p>

<h2 id="troubleshooting">Troubleshooting</h2>

<p><br /></p>

<h3 id="common-issues-and-solutions">Common Issues and Solutions</h3>

<div class="table-container">
  <table class="table-beauty">
    <tr>
      <th style="width: 30%;">Issue</th>
      <th style="width: 30%;">Cause</th>
      <th style="width: 40%;">Solution</th>
    </tr>
    <tr>
      <td>SSH connection failures</td>
      <td>SSH keys not properly set up</td>
      <td>Verify SSH keys with <code>ssh-copy-id</code> and test connections manually</td>
    </tr>
    <tr>
      <td>Python dependencies errors</td>
      <td>Incompatible Python version or packages</td>
      <td>Use the recommended Python version and ensure the virtual environment is activated</td>
    </tr>
    <tr>
      <td>Network plugin failures</td>
      <td>Network configuration issues</td>
      <td>Check node connectivity and firewall rules; verify pods in <code>kube-system</code> namespace</td>
    </tr>
    <tr>
      <td>Node NotReady status</td>
      <td>kubelet not running properly</td>
      <td>Check <code>systemctl status kubelet</code> and kubelet logs</td>
    </tr>
    <tr>
      <td>etcd cluster issues</td>
      <td>etcd member communication problems</td>
      <td>Verify etcd health with <code>etcdctl endpoint health</code> and check etcd logs</td>
    </tr>
  </table>
</div>

<p><br /><br /></p>

<h3 id="kubespray-debug-tips">Kubespray Debug Tips</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Run Ansible in verbose mode for detailed output</span>
ansible-playbook <span class="nt">-i</span> inventory/somaz-cluster/inventory.ini cluster.yml <span class="nt">--become</span> <span class="nt">-vvv</span>

<span class="c"># Check logs on nodes</span>
ansible all <span class="nt">-i</span> inventory/somaz-cluster/inventory.ini <span class="nt">-m</span> shell <span class="nt">-a</span> <span class="s2">"journalctl -xeu kubelet"</span> <span class="nt">--become</span>

<span class="c"># Reset the cluster to start fresh</span>
ansible-playbook <span class="nt">-i</span> inventory/somaz-cluster/inventory.ini reset.yml <span class="nt">--become</span>
</code></pre></div></div>

<p><br /></p>

<h2 id="advanced-configuration">Advanced Configuration</h2>

<p><br /></p>

<h3 id="customizing-the-deployment">Customizing the Deployment</h3>

<p>Kubespray offers extensive customization options through the Ansible inventory. Here are some common customizations:</p>

<p><br /></p>

<h4 id="high-availability-setup">High Availability Setup</h4>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># For HA setup, add multiple control plane nodes in inventory</span>

<span class="c1"># Then in group_vars/all/all.yml</span>
<span class="na">loadbalancer_apiserver</span><span class="pi">:</span>
  <span class="na">address</span><span class="pi">:</span> <span class="s">&lt;VIP address&gt;</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">6443</span>
</code></pre></div></div>

<h4 id="custom-network-configuration">Custom Network Configuration</h4>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># In group_vars/k8s_cluster/k8s-net-calico.yml (for Calico)</span>
<span class="na">calico_ipip_mode</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Always"</span>
<span class="na">calico_vxlan_mode</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Never"</span>
<span class="na">calico_network_backend</span><span class="pi">:</span> <span class="s2">"</span><span class="s">bird"</span>

<span class="c1"># Pod CIDR customization</span>
<span class="na">kube_pods_subnet</span><span class="pi">:</span> <span class="s">10.233.64.0/18</span>

<span class="c1"># Service CIDR customization</span>
<span class="na">kube_service_addresses</span><span class="pi">:</span> <span class="s">10.233.0.0/18</span>
</code></pre></div></div>

<h4 id="add-on-configuration">Add-on Configuration</h4>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># In group_vars/k8s_cluster/addons.yml</span>
<span class="na">dashboard_enabled</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">metrics_server_enabled</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">ingress_nginx_enabled</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<p><br /></p>

<h2 id="conclusion">Conclusion</h2>

<p>You have successfully deployed a Kubernetes cluster using Kubespray and added a worker node to scale your infrastructure. This flexible deployment method allows you to create a production-ready Kubernetes environment on various infrastructures, including cloud providers like GCP and on-premises environments.</p>

<p>Kubespray strikes a balance between the simplicity of kubeadm and the flexibility of full custom deployments, making it an excellent choice for teams that need a customizable yet standardized Kubernetes setup.</p>

<div class="info-box info-box-default-not-check">
  <strong>Next Steps</strong>
  <p>Now that your Kubernetes cluster is up and running, consider:</p>
  <ul>
    <li>Setting up persistent storage with CSI drivers</li>
    <li>Implementing proper networking with an Ingress Controller</li>
    <li>Configuring monitoring with Prometheus and Grafana</li>
    <li>Establishing proper backup procedures for the cluster</li>
    <li>Setting up CI/CD pipelines for your applications</li>
  </ul>
</div>

<p><br /></p>

<hr />

<h2 id="references">References</h2>
<ul>
  <li><a href="https://github.com/kubernetes-sigs/kubespray">Kubespray GitHub Repository</a></li>
  <li><a href="https://kubespray.io/">Kubespray Documentation</a></li>
  <li><a href="https://docs.ansible.com/">Ansible Documentation</a></li>
  <li><a href="https://kubernetes.io/docs/">Kubernetes Documentation</a></li>
  <li><a href="https://cloud.google.com/docs">Google Cloud Platform Documentation</a></li>
  <li><a href="https://docs.tigera.io/calico/latest/getting-started/">Calico Networking Documentation</a></li>
</ul>


                <!-- Pagination links -->


            </article>

            
                <aside class="see-also">
                    <h2>See also</h2>
                    <ul>
                        
                        
                        
                            <li>
                                <a href="/category/openstack/openstack-octavia/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1742267532/openstack_t2tmoc.png">
                                    
                                    <h3>Deep Dive into OpenStack Octavia</h3>
                                </a>
                            </li>
                        
                            <li>
                                <a href="/category/troubleshooting/argocd-ingress-gke/">
                                    
                                        <img src="https://blog.kakaocdn.net/dn/baMOz9/btsGPPRoXDF/KFCDia9hhgPKkgFK8RcPHK/img.png">
                                    
                                    <h3>ArgoCD Ingress Error Resolution Guide (GKE)</h3>
                                </a>
                            </li>
                        
                            <li>
                                <a href="/category/troubleshooting/fluent-bit-opensearch-duplicate-logs/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1754458041/fluenbit-opensearch_lmr5hf.png">
                                    
                                    <h3>Resolving Duplicate Log Issues in Fluent Bit to OpenSearch Integration</h3>
                                </a>
                            </li>
                        
                    </ul>
                </aside>
            

        </section>

        <!-- Add time bar only for pages without pagination -->
        
            <div class="time-bar" data-minutes="15">
    <span class="time-completed"></span>
    <span class="time-remaining"></span>
    <div class="bar">
        <span class="completed" style="width:0%;"></span>
        <span class="remaining" style="width:100%;"></span>
    </div>
</div>

            <button class="toggle-preview" onclick="togglePreview()">
    <span>Hide Preview ▼</span>
</button>

<div id="recommendationSection" class="recommendation">
    <div class="message">
        <strong>Why don't you read something next?</strong>
        <div>
            <button>
                <svg><use xlink:href="#icon-arrow-right"></use></svg>
                <span>Go back to top</span>
            </button>
        </div>
    </div>
    <div id="previewSection" class="preview-section">
        
        <a href="/category/security/vault/" class="post-preview">
            <div class="image">
                
                    <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1737704919/vault_i9zrin.png">
                
            </div>
            <h3 class="title">Understanding HashiCorp Vault - Core Concepts and Architecture</h3>
        </a>
    </div>
</div>

<style>
.toggle-preview {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #333;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 4px;
    cursor: pointer;
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.toggle-preview:hover {
    background: #444;
}

.toggle-preview.visible {
    opacity: 1;
}

.recommendation {
    margin-top: 1000px;
    display: block;
    transition: all 0.3s ease;
}

.recommendation.hidden {
    display: none;
}

.hide-preview {
    margin-left: 10px;
    background: none;
    border: 1px solid #666;
    color: #666;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
}

.hide-preview:hover {
    background: #f0f0f0;
}

.preview-section {
    max-height: 1000px;
    overflow: hidden;
    transition: max-height 0.3s ease-out;
}

.preview-section.hidden {
    max-height: 0;
}
</style>

<script>
function togglePreview() {
    const recommendation = document.getElementById('recommendationSection');
    const button = document.querySelector('.toggle-preview span');
    
    if (recommendation.classList.contains('hidden')) {
        recommendation.classList.remove('hidden');
        button.textContent = 'Hide Preview ▼';
    } else {
        recommendation.classList.add('hidden');
        button.textContent = 'Show Preview ▲';
    }
}

window.addEventListener('scroll', function() {
    const toggleButton = document.querySelector('.toggle-preview');
    const recommendation = document.getElementById('recommendationSection');
    const rect = recommendation.getBoundingClientRect();
    
    if (rect.top <= window.innerHeight) {
        toggleButton.classList.add('visible');
    } else {
        toggleButton.classList.remove('visible');
    }
});
</script>

        

        <!-- Show modal if the post is the last one -->
        

        <!-- Show modal before user leaves the page -->
        

        <!-- Add your newsletter subscription form here -->

        <section class="share">
    <h3>Share</h3>
    <a aria-label="Share on Twitter" href="https://twitter.com/intent/tweet?text=&quot;Learn how to install Kubernetes using Kubespray and scale worker nodes with this step-by-step tutorial&quot;%20https://somaz.blog/category/kubernetes/kubernetes-install-kubespray/%20via%20&#64;twitter_username&hashtags=kubernetes,kubespray,ansible,gcp,installation,cluster-management"
    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Share on Twitter">
        <svg class="icon icon-twitter"><use xlink:href="#icon-twitter"></use></svg>
    </a>
    <a aria-label="Share on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://somaz.blog/category/kubernetes/kubernetes-install-kubespray/"
    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook">
        <svg class="icon icon-facebook"><use xlink:href="#icon-facebook"></use></svg>
    </a>
</section>

        

  <section class="author">
    <div class="details">
      
        <img class="img-rounded" src="/assets/img/uploads/profile.png" alt="Somaz">
      
      <p class="def">Author</p>
      <h3 class="name">
        <a href="/authors/somaz/">Somaz</a>
      </h3>
      <p class="desc">DevOps engineer focused on cloud infrastructure and automation</p>
      <p>
        
          <a href="https://github.com/somaz94" title="Github">
            <svg><use xlink:href="#icon-github"></use></svg>
          </a>
        
        
        
        
        
        
          <a href="https://www.linkedin.com/in/somaz" title="LinkedIn">
            <svg><use xlink:href="#icon-linkedin"></use></svg>
          </a>
        
        
          <a href="https://somaz.tistory.com" title="Tistory">
            <svg><use xlink:href="#icon-tistory"></use></svg>
          </a>
        
      </p>
    </div>
  </section>

  
  
  
  
  
  
  
  

  <script type="application/ld+json">
  {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "Somaz",
      
      "image": "/assets/img/uploads/profile.png",
      
      "jobTitle": "DevOps Engineer",
      "url": "https://somaz.blog/authors/somaz/",
      "sameAs": [
        "https://github.com/somaz94","https://www.linkedin.com/in/somaz","https://{{ author.tistory_username }}.tistory.com"
      ]
  }
  </script>


        

<section class="comments">
    <h3>Comments</h3>
    <div id="disqus_thread"></div>
</section>
<script type="text/javascript">
    var disqus_loaded = false;

    function load_disqus()
    {
        disqus_loaded = true;
        var disqus_shortname = 'https-somaz94-github-io';
        var disqus_title = '';
        var disqus_url = '/category/kubernetes/kubernetes-install-kubespray/';
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        var ldr = document.getElementById('disqus_loader');
    };
    window.onscroll = function(e) {
        if ((window.innerHeight + window.scrollY) >= (document.body.offsetHeight - 800)) {
            //hit bottom of page
            if (disqus_loaded==false)
                load_disqus()
        }
    };
</script>



        <footer>
    <p>
      
        <a href="https://github.com/somaz94" title="Github">
          <svg><use xlink:href="#icon-github"></use></svg>
        </a>
      
      
        <a href="https://www.facebook.com/facebook_username" title="Facebook">
          <svg><use xlink:href="#icon-facebook"></use></svg>
        </a>
      
      
        <a href="https://twitter.com/twitter_username" title="Twitter">
          <svg><use xlink:href="#icon-twitter"></use></svg>
        </a>
      
      
        <a href="https://medium.com/@medium_username" title="Medium">
          <svg><use xlink:href="#icon-medium"></use></svg>
        </a>
      
      
        <a href="https://www.instagram.com/instagram_username" title="Instagram">
          <svg><use xlink:href="#icon-instagram"></use></svg>
        </a>
      
      
        <a href="https://www.linkedin.com/in/somaz" title="LinkedIn">
          <svg><use xlink:href="#icon-linkedin"></use></svg>
        </a>
      
      
        <a href="https://somaz.tistory.com" title="Tistory">
          <svg><use xlink:href="#icon-tistory"></use></svg>
        </a>
      
    </p>

    <ul>
  
    
      <li>
        <a href="https://somaz.blog/">Home</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/about">About</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/category">Category</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/contact">Contact</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/feed.xml">Feed</a>
      </li>
    
  
</ul>


    <p>
      <a href="https://somaz.blog/sitemap.xml" title="sitemap">Sitemap</a> |
      <a href="https://somaz.blog/privacy-policy.html" title="Privacy Policy">Privacy Policy</a>
    </p>

    <p>
      <span>Somaz Tech Blog</span> <svg class="love"><use xlink:href="#icon-heart"></use></svg>
    </p>
</footer>










<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "somaz",
  "description": "DevOps engineer's tech blog.",
  "url": "https://somaz.blog/",
  "logo": {
      "@type": "ImageObject",
      "url": "https://somaz.blog/assets/img/icons/mediumtile.png",
      "width": "600",
      "height": "315"
  },
  "sameAs": [
    "https://github.com/somaz94","https://www.facebook.com/facebook_username","https://twitter.com/twitter_username","https://medium.com/@medium_username","https://www.instagram.com/instagram_username","https://www.linkedin.com/in/somaz","https://{{ site.tistory_username }}.tistory.com"
  ]
}
</script>

<!-- Include the script that allows Netlify CMS login -->
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

<!-- Include the website scripts -->
<script src="/assets/js/scripts.min.js"></script>

<!-- Include Google Analytics script -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-XXXXXXXX-X"></script>
<script>
  var host = window.location.hostname;
  if (host != 'localhost') {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-XXXXXXXX-X');
  }
</script>
  


<!-- Include extra scripts -->



        

        
        
        
        
        
        
        
        
        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "BlogPosting",
            "name": "Installing Kubernetes with Kubespray and Adding Worker Nodes (2024V.)",
            "headline": "A comprehensive guide to setting up Kubernetes using Kubespray on GCP",
            "description": "Learn how to install Kubernetes using Kubespray and scale worker nodes with this step-by-step tutorial",
            "image": "https://res.cloudinary.com/dkcm26aem/image/upload/v1737697968/kubespray_uyug5r.png",
            "url": "https://somaz.blog/category/kubernetes/kubernetes-install-kubespray/",
            "articleBody": "Image Reference link





Overview

Kubespray is a powerful tool that combines the flexibility of Ansible with the robustness of Kubernetes, enabling the deployment of production-ready Kubernetes clusters on various infrastructures. This guide provides detailed instructions for installing a Kubernetes cluster using Kubespray on Google Cloud Platform (GCP) and demonstrates how to add worker nodes to scale your cluster.


  What is Kubespray?
  Kubespray is a composition of Ansible playbooks, inventory, provisioning tools, and domain knowledge for deploying a production-ready Kubernetes cluster. It allows for highly customizable deployments and supports multiple cloud providers, bare metal installations, and virtualized environments.
  Key features include:
  
    Composable attributes
    Multiple network plugin support (Calico, Flannel, Cilium, etc.)
    HA cluster setup
    Configurable addons
    Support for most popular Linux distributions
  



  
    graph TD
      A[Kubespray Repository] --&amp;gt; B[Ansible Playbooks]
      B --&amp;gt; C[Kubernetes Components]
      C --&amp;gt; D[Control Plane Setup]
      C --&amp;gt; E[Node Setup]
      C --&amp;gt; F[Networking]
      C --&amp;gt; G[Add-ons]
      
      D --&amp;gt; H[API Server]
      D --&amp;gt; I[Controller Manager]
      D --&amp;gt; J[Scheduler]
      D --&amp;gt; K[etcd]
      
      E --&amp;gt; L[kubelet]
      E --&amp;gt; M[kube-proxy]
      
      F --&amp;gt; N[Network Plugin]
      F --&amp;gt; O[Service Networking]
      
      G --&amp;gt; P[DNS]
      G --&amp;gt; Q[Dashboard]
      G --&amp;gt; R[Metrics Server]
      
      style A fill:#bbdefb,stroke:#333,stroke-width:1px
      style B fill:#90caf9,stroke:#333,stroke-width:1px
      style C fill:#64b5f6,stroke:#333,stroke-width:1px
      style D fill:#42a5f5,stroke:#333,stroke-width:1px
      style E fill:#42a5f5,stroke:#333,stroke-width:1px
      style F fill:#42a5f5,stroke:#333,stroke-width:1px
      style G fill:#42a5f5,stroke:#333,stroke-width:1px
  




System Configuration



Environment Details


  
    
      Component
      Specification
    
    
      Operating System
      Ubuntu 20.04 LTS (Focal)
    
    
      Cloud Provider
      Google Compute Engine (GCP)
    
    
      Kubernetes Version
      v1.28.6 (deployed by Kubespray)
    
    
      CNI Plugin
      Calico (default)
    
    
      Container Runtime
      containerd
    
    
      Python Version
      3.10.13
    
  




Node Specifications


  
    
      Node
      Hostname / Name
      IP Address
      CPU
      Memory
      Role
    
    
      Control Plane Node
      test-server
      10.77.101.62
      2 cores
      8096MB
      Control Plane + etcd
    
    
      Worker Node 1
      test-server-agent
      10.77.101.57
      2 cores
      8096MB
      Worker (application)
    
    
      Worker Node 2
      test-server-agent2
      10.77.101.200
      2 cores
      8096MB
      Worker (application)
    
  




Infrastructure Setup



Infrastructure as Code (IaC)

We use Terraform to provision our GCP infrastructure. Here are the key resources:



Control Plane Node Configuration
resource &quot;google_compute_address&quot; &quot;test_server_ip&quot; {
  name = var.test_server_ip
}

resource &quot;google_compute_instance&quot; &quot;test_server&quot; {
  name         = var.test_server
  machine_type = &quot;n2-standard-2&quot;
  zone         = &quot;${var.region}-a&quot;
  
  boot_disk {
    initialize_params {
      image = &quot;ubuntu-os-cloud/ubuntu-2004-lts&quot;
      size  = 10
    }
  }

  network_interface {
    network    = var.shared_vpc
    subnetwork = &quot;${var.subnet_share}-mgmt-a&quot;
    access_config {
      nat_ip = google_compute_address.test_server_ip.address
    }
  }
  
  # Recommended metadata for Kubernetes nodes
  metadata = {
    &quot;startup-script&quot; = &amp;lt;&amp;lt;-EOF
      #!/bin/bash
      swapoff -a
      sed -i &apos;/swap/d&apos; /etc/fstab
      
      # Set system parameters for Kubernetes
      cat &amp;gt; /etc/sysctl.d/99-kubernetes.conf &amp;lt;&amp;lt;EOF2
      net.bridge.bridge-nf-call-iptables = 1
      net.ipv4.ip_forward = 1
      EOF2
      sysctl --system
    EOF
  }
}


Worker Node Configuration
resource &quot;google_compute_address&quot; &quot;test_server_agent_ip&quot; {
  name = var.test_server_agent_ip
}

resource &quot;google_compute_instance&quot; &quot;test_server_agent&quot; {
  name         = var.test_server_agent
  machine_type = &quot;n2-standard-2&quot;
  zone         = &quot;${var.region}-a&quot;
  
  boot_disk {
    initialize_params {
      image = &quot;ubuntu-os-cloud/ubuntu-2004-lts&quot;
      size  = 10
    }
  }

  network_interface {
    network    = var.shared_vpc
    subnetwork = &quot;${var.subnet_share}-mgmt-a&quot;
    access_config {
      nat_ip = google_compute_address.test_server_agent_ip.address
    }
  }
  
  # Same startup script as control plane for Kubernetes prerequisites
  metadata = {
    &quot;startup-script&quot; = &amp;lt;&amp;lt;-EOF
      #!/bin/bash
      swapoff -a
      sed -i &apos;/swap/d&apos; /etc/fstab
      
      # Set system parameters for Kubernetes
      cat &amp;gt; /etc/sysctl.d/99-kubernetes.conf &amp;lt;&amp;lt;EOF2
      net.bridge.bridge-nf-call-iptables = 1
      net.ipv4.ip_forward = 1
      EOF2
      sysctl --system
    EOF
  }
}




Prerequisites

Before starting the Kubespray installation, you need to prepare your environment.



System Requirements


  Operating System: Ubuntu 20.04 or other supported Linux distributions
  SSH Access: Between the deployment host and all nodes
  Python: Version 3.9+ (we’ll use 3.10)
  Ansible: Will be installed by the setup process
  Git: For cloning the Kubespray repository
  sudo privileges: On all nodes




Node Preparation

SSH Key Setup
# Generate SSH key if needed
ssh-keygen -t rsa -b 4096 -C &quot;kubespray-deployment&quot;

# Copy SSH key to all nodes
ssh-copy-id somaz@10.77.101.62  # Control plane
ssh-copy-id somaz@10.77.101.57  # Worker 1
ssh-copy-id somaz@10.77.101.200 # Worker 2

# Update /etc/hosts for easier node access
cat &amp;lt;&amp;lt; EOF | sudo tee -a /etc/hosts
10.77.101.62 test-server
10.77.101.57 test-server-agent
10.77.101.200 test-server-agent2
EOF


Package Installation
# Update package lists
sudo apt-get update

# Install Python 3.10
sudo add-apt-repository ppa:deadsnakes/ppa
sudo apt-get -y update
sudo apt install -y python3.10 python3-pip git python3.10-venv

# Verify Python version
python3.10 --version  # Should show Python 3.10.13


System Configuration
# Disable swap (required for Kubernetes)
sudo swapoff -a
sudo sed -i &apos;/swap/d&apos; /etc/fstab

# Load required kernel modules
cat &amp;lt;&amp;lt; EOF | sudo tee /etc/modules-load.d/k8s.conf
overlay
br_netfilter
EOF

sudo modprobe overlay
sudo modprobe br_netfilter

# Configure kernel parameters
cat &amp;lt;&amp;lt; EOF | sudo tee /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-iptables  = 1
net.bridge.bridge-nf-call-ip6tables = 1
net.ipv4.ip_forward                 = 1
EOF

sudo sysctl --system




Kubespray Deployment Process


  
    sequenceDiagram
      participant Admin as Operator
      participant Deploy as Deployment Host
      participant CP as Control Plane
      participant Worker as Worker Nodes
      
      Admin-&amp;gt;&amp;gt;Deploy: Clone Kubespray repository
      Admin-&amp;gt;&amp;gt;Deploy: Setup Python virtual environment
      Admin-&amp;gt;&amp;gt;Deploy: Install dependencies
      Admin-&amp;gt;&amp;gt;Deploy: Configure inventory
      Deploy-&amp;gt;&amp;gt;CP: Check SSH connectivity
      Deploy-&amp;gt;&amp;gt;Worker: Check SSH connectivity
      Admin-&amp;gt;&amp;gt;Deploy: Run Ansible playbook
      Deploy-&amp;gt;&amp;gt;CP: Install control plane components
      Deploy-&amp;gt;&amp;gt;Worker: Install worker components
      Deploy-&amp;gt;&amp;gt;CP: Initialize cluster
      Deploy-&amp;gt;&amp;gt;Worker: Join nodes to cluster
      CP-&amp;gt;&amp;gt;Worker: Establish cluster communication
      Admin-&amp;gt;&amp;gt;CP: Configure kubectl
      Admin-&amp;gt;&amp;gt;CP: Verify cluster status
  




1. Clone Repository and Setup Environment
# Clone the Kubespray repository
git clone https://github.com/kubernetes-sigs/kubespray.git

# Setup virtual environment
VENVDIR=kubespray-venv
KUBESPRAYDIR=kubespray
python3.10 -m venv $VENVDIR
source $VENVDIR/bin/activate
cd $KUBESPRAYDIR

# Install dependencies
pip install -U -r requirements.txt

# Check Ansible version
ansible --version




2. Prepare Ansible Inventory
# Copy sample inventory
cp -rfp inventory/sample inventory/somaz-cluster

# Update inventory with nodes
declare -a IPS=(10.77.101.62 10.77.101.57)
CONFIG_FILE=inventory/somaz-cluster/hosts.yaml python3 contrib/inventory_builder/inventory.py ${IPS[@]}




3. Configure Inventory

The inventory generator creates a basic configuration, but we’ll make additional adjustments for our setup.

# inventory/somaz-cluster/inventory.ini
[all]
test-server ansible_host=10.77.101.62  ip=10.77.101.62
test-server-agent ansible_host=10.77.101.57  ip=10.77.101.57

# Control plane node(s)
[kube_control_plane]
test-server

# etcd cluster member(s)
[etcd]
test-server

# Kubernetes worker node(s)
[kube_node]
test-server-agent

# All groups with assigned roles
[k8s_cluster:children]
kube_control_plane
kube_node
calico_rr


Advanced Inventory Configuration (Optional)

You can further customize your deployment by editing these additional files:

# Edit group variables for all nodes
vi inventory/somaz-cluster/group_vars/all/all.yml

# Customize Kubernetes-specific parameters
vi inventory/somaz-cluster/group_vars/k8s_cluster/k8s-cluster.yml

# Configure network plugin options
vi inventory/somaz-cluster/group_vars/k8s_cluster/k8s-net-*.yml


Common customizations:

  kube_version: Specify Kubernetes version (default is 1.28.6 as of this writing)
  kube_network_plugin: Choose network plugin (calico, flannel, cilium, etc.)
  etcd_deployment_type: etcd deployment method (host or docker-based)
  container_manager: Choose containerd or docker (containerd is recommended)




4. Verify Ansible Connectivity
# Test connection to all nodes
ansible all -i inventory/somaz-cluster/inventory.ini -m ping

# Optional: Update apt cache on all nodes
ansible all -i inventory/somaz-cluster/inventory.ini -m apt -a &apos;update_cache=yes&apos; --become




5. Run Playbook

Now we’re ready to deploy the Kubernetes cluster using Kubespray’s Ansible playbooks.

# Deploy the cluster (this will take 15-30 minutes)
ansible-playbook -i inventory/somaz-cluster/inventory.ini cluster.yml --become



  Important:
  The cluster deployment can take 15-30 minutes depending on your internet connection speed and server performance. During the deployment process, Ansible will:
  
    Install container runtime (containerd by default)
    Deploy etcd cluster
    Install Kubernetes components (kubeadm, kubelet, kubectl)
    Initialize the Kubernetes control plane
    Join worker nodes to the cluster
    Deploy network plugins and add-ons
  
  Be patient and monitor the output for any errors. Most issues can be resolved by looking at the Ansible error messages.




6. Configure kubectl

After successful deployment, you need to configure kubectl to interact with your new cluster.

# Create kubectl config directory
mkdir -p ~/.kube

# Copy admin configuration
sudo cp /etc/kubernetes/admin.conf ~/.kube/config
sudo chown $(id -u):$(id -g) ~/.kube/config

# Setup kubectl autocomplete (optional but recommended)
echo &apos;# kubectl completion and alias&apos; &amp;gt;&amp;gt; ~/.bashrc
echo &apos;source &amp;lt;(kubectl completion bash)&apos; &amp;gt;&amp;gt; ~/.bashrc
echo &apos;alias k=kubectl&apos; &amp;gt;&amp;gt; ~/.bashrc
echo &apos;complete -F __start_kubectl k&apos; &amp;gt;&amp;gt; ~/.bashrc
source ~/.bashrc

# Test kubectl
kubectl get nodes




Adding Worker Nodes

One of the key advantages of Kubernetes is its scalability. Let’s add another worker node to our cluster.



1. Update Inventory

First, we need to update our Ansible inventory to include the new worker node.

# Add new node to IPS array
declare -a IPS=(10.77.101.62 10.77.101.57 10.77.101.200)
CONFIG_FILE=inventory/somaz-cluster/hosts.yaml python3 contrib/inventory_builder/inventory.py ${IPS[@]}




2. Modify inventory.ini

After using the inventory builder, it’s good to check and make sure the new node was properly added to the correct groups.

# inventory/somaz-cluster/inventory.ini
[all]
test-server ansible_host=10.77.101.62  ip=10.77.101.62
test-server-agent ansible_host=10.77.101.57  ip=10.77.101.57
test-server-agent2 ansible_host=10.77.101.200  ip=10.77.101.200

[kube_control_plane]
test-server

[etcd]
test-server

[kube_node]
test-server-agent
test-server-agent2  # Make sure the new node is in the kube_node group




3. Run Scale Playbook

Kubespray includes a special scale.yml playbook specifically for adding new worker nodes without affecting the existing cluster.

# Add new nodes to the cluster
ansible-playbook -i inventory/somaz-cluster/inventory.ini scale.yml --become



  Tip:
  The scale.yml playbook is designed to only operate on new nodes, which makes it much faster than running the full cluster.yml playbook. It will install the necessary Kubernetes components on the new node and join it to the existing cluster.




Scaling Down (Removing Nodes)

If you need to remove a node from the cluster, Kubespray also provides a removal playbook:

# To remove nodes, first update your inventory to reflect the desired state
# Then run the remove-node playbook
ansible-playbook -i inventory/somaz-cluster/inventory.ini remove-node.yml -e node=test-server-agent2 --become




Verification and Monitoring



Verify Cluster Status
# Check nodes
kubectl get nodes -o wide
NAME                 STATUS   ROLES           AGE   VERSION   INTERNAL-IP     EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION     CONTAINER-RUNTIME
test-server          Ready    control-plane   21m   v1.28.6   10.77.101.62    &amp;lt;none&amp;gt;        Ubuntu 20.04.6 LTS   5.15.0-1053-gcp    containerd://1.7.1
test-server-agent    Ready    &amp;lt;none&amp;gt;          20m   v1.28.6   10.77.101.57    &amp;lt;none&amp;gt;        Ubuntu 20.04.6 LTS   5.15.0-1053-gcp    containerd://1.7.1
test-server-agent2   Ready    &amp;lt;none&amp;gt;          65s   v1.28.6   10.77.101.200   &amp;lt;none&amp;gt;        Ubuntu 20.04.6 LTS   5.15.0-1053-gcp    containerd://1.7.1

# Check system namespace
kubectl get po -n kube-system
NAME                                          READY   STATUS    RESTARTS   AGE
calico-kube-controllers-76475c5546-vb58b      1/1     Running   0          20m
calico-node-hvx95                             1/1     Running   0          20m
calico-node-lq4tg                             1/1     Running   0          20m
calico-node-vftnr                             1/1     Running   0          1m
coredns-77f7cc69db-ctvk6                      1/1     Running   0          19m
coredns-77f7cc69db-h4bbx                      1/1     Running   0          19m
dns-autoscaler-5b576d9b75-pvbwj               1/1     Running   0          19m
kube-apiserver-test-server                    1/1     Running   0          21m
kube-controller-manager-test-server           1/1     Running   0          21m
kube-proxy-5n5tq                              1/1     Running   0          20m
kube-proxy-lx25t                              1/1     Running   0          1m
kube-proxy-s6x8h                              1/1     Running   0          20m
kube-scheduler-test-server                    1/1     Running   0          21m
kubernetes-dashboard-787dd78ffd-jl8bd         1/1     Running   0          19m
metrics-server-67df99fc7d-p8nzk               1/1     Running   0          19m
nginx-proxy-test-server-agent                 1/1     Running   0          20m
nginx-proxy-test-server-agent2                1/1     Running   0          1m
nodelocaldns-fwl5r                            1/1     Running   0          19m
nodelocaldns-hkvk2                            1/1     Running   0          1m
nodelocaldns-szfj6                            1/1     Running   0          19m




Monitoring Cluster Components







Cluster Maintenance



Upgrading the Cluster

Kubespray makes it easy to upgrade your Kubernetes cluster to newer versions.

# Update Kubespray repository
cd $KUBESPRAYDIR
git fetch --all
git checkout &amp;lt;desired_version_tag&amp;gt;

# Update dependencies
pip install -U -r requirements.txt

# Update inventory parameters for the new version
# Edit inventory/somaz-cluster/group_vars/k8s_cluster/k8s-cluster.yml
# Set kube_version to the desired version

# Run the upgrade playbook
ansible-playbook -i inventory/somaz-cluster/group_vars/all/all.yml upgrade-cluster.yml --become




Backup and Restore

It’s crucial to back up your etcd data regularly:

# Backup etcd data
ansible-playbook -i inventory/somaz-cluster/inventory.ini etcd_backup.yml --become

# This creates a backup in /tmp/etcd_backup on the etcd host(s)




Troubleshooting



Common Issues and Solutions


  
    
      Issue
      Cause
      Solution
    
    
      SSH connection failures
      SSH keys not properly set up
      Verify SSH keys with ssh-copy-id and test connections manually
    
    
      Python dependencies errors
      Incompatible Python version or packages
      Use the recommended Python version and ensure the virtual environment is activated
    
    
      Network plugin failures
      Network configuration issues
      Check node connectivity and firewall rules; verify pods in kube-system namespace
    
    
      Node NotReady status
      kubelet not running properly
      Check systemctl status kubelet and kubelet logs
    
    
      etcd cluster issues
      etcd member communication problems
      Verify etcd health with etcdctl endpoint health and check etcd logs
    
  




Kubespray Debug Tips

# Run Ansible in verbose mode for detailed output
ansible-playbook -i inventory/somaz-cluster/inventory.ini cluster.yml --become -vvv

# Check logs on nodes
ansible all -i inventory/somaz-cluster/inventory.ini -m shell -a &quot;journalctl -xeu kubelet&quot; --become

# Reset the cluster to start fresh
ansible-playbook -i inventory/somaz-cluster/inventory.ini reset.yml --become




Advanced Configuration



Customizing the Deployment

Kubespray offers extensive customization options through the Ansible inventory. Here are some common customizations:



High Availability Setup
# For HA setup, add multiple control plane nodes in inventory

# Then in group_vars/all/all.yml
loadbalancer_apiserver:
  address: &amp;lt;VIP address&amp;gt;
  port: 6443


Custom Network Configuration
# In group_vars/k8s_cluster/k8s-net-calico.yml (for Calico)
calico_ipip_mode: &quot;Always&quot;
calico_vxlan_mode: &quot;Never&quot;
calico_network_backend: &quot;bird&quot;

# Pod CIDR customization
kube_pods_subnet: 10.233.64.0/18

# Service CIDR customization
kube_service_addresses: 10.233.0.0/18


Add-on Configuration
# In group_vars/k8s_cluster/addons.yml
dashboard_enabled: true
metrics_server_enabled: true
ingress_nginx_enabled: true




Conclusion

You have successfully deployed a Kubernetes cluster using Kubespray and added a worker node to scale your infrastructure. This flexible deployment method allows you to create a production-ready Kubernetes environment on various infrastructures, including cloud providers like GCP and on-premises environments.

Kubespray strikes a balance between the simplicity of kubeadm and the flexibility of full custom deployments, making it an excellent choice for teams that need a customizable yet standardized Kubernetes setup.


  Next Steps
  Now that your Kubernetes cluster is up and running, consider:
  
    Setting up persistent storage with CSI drivers
    Implementing proper networking with an Ingress Controller
    Configuring monitoring with Prometheus and Grafana
    Establishing proper backup procedures for the cluster
    Setting up CI/CD pipelines for your applications
  






References

  Kubespray GitHub Repository
  Kubespray Documentation
  Ansible Documentation
  Kubernetes Documentation
  Google Cloud Platform Documentation
  Calico Networking Documentation

",
            "wordcount": "2861",
            "inLanguage": "en",
            "dateCreated": "2025-01-24/",
            "datePublished": "2025-01-24/",
            "dateModified": "2025-01-24/",
            "author": {
                "@type": "Person",
                "name": "Somaz",
                
                "image": "/assets/img/uploads/profile.png",
                
                "jobTitle": "DevOps Engineer",
                "url": "https://somaz.blog/authors/somaz/",
                "sameAs": [
                    "https://github.com/somaz94","https://www.linkedin.com/in/somaz"
                ]
            },
            "publisher": {
                "@type": "Organization",
                "name": "somaz",
                "url": "https://somaz.blog/",
                "logo": {
                    "@type": "ImageObject",
                    "url": "https://somaz.blog/assets/img/blog-image.png",
                    "width": "600",
                    "height": "315"
                }
            },
            "mainEntityOfPage": "True",
            "genre": "KUBERNETES",
            "articleSection": "KUBERNETES",
            "keywords": ["kubernetes","kubespray","ansible","gcp","installation","cluster-management"]
        }
        </script>
    </body>
</html>
