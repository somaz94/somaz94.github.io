<!DOCTYPE html>
<html lang="en" class="no-js">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    

    
    

    
    

    
    

    <!-- ✅ Google Tag Manager 추가 -->
    <script>
        (function(w,d,s,l,i){
            w[l]=w[l]||[];
            w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
            var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
            j.async=true;
            j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
            f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-MBP83N4Q');
    </script>
      <!-- ✅ End Google Tag Manager -->

    <!-- Mermaid.js 직접 로드 -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>

    <title>Implementing Redis Redlock on Kubernetes — A Complete Guide to Distributed Locks | somaz</title>
    <meta name="description" content="A production-focused overview of the Redis Redlock algorithm and its limitations, Kubernetes-specific pitfalls and remedies, an operations checklist, and com...">
    
        <meta name="keywords" content="kubernetes, redis, redlock, distributed-lock, statefulset, reliability, csi">
    

    <!-- Social: Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Implementing Redis Redlock on Kubernetes — A Complete Guide to Distributed Locks | somaz">
    <meta name="twitter:description" content="A production-focused overview of the Redis Redlock algorithm and its limitations, Kubernetes-specific pitfalls and remedies, an operations checklist, and com...">

    
        <meta property="twitter:image" content="https://res.cloudinary.com/dkcm26aem/image/upload/v1767686660/kubernetes-trouble-redis-1_mtrwpi.png">
    
    
    
        <meta name="twitter:site" content="@twitter_username">
    

    <!-- Social: Facebook / Open Graph -->
    <meta property="og:url" content="https://somaz.blog/category/kubernetes/kubernetes-redis-redlock-in-kubernetes/">
    <meta property="og:title" content="Implementing Redis Redlock on Kubernetes — A Complete Guide to Distributed Locks | somaz">
    <meta property="og:image" content="https://res.cloudinary.com/dkcm26aem/image/upload/v1767686660/kubernetes-trouble-redis-1_mtrwpi.png">
    <meta property="og:description" content="A production-focused overview of the Redis Redlock algorithm and its limitations, Kubernetes-specific pitfalls and remedies, an operations checklist, and com...">
    <meta property="og:site_name" content="Somaz Tech Blog">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/assets/img/icons/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/img/icons/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/img/icons/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/img/icons/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/img/icons/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/img/icons/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/img/icons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/icons/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/img/icons/apple-touch-icon-152x152.png" />

    <!-- Windows 8 Tile Icons -->
    <meta name="application-name" content="somaz">
    <meta name="msapplication-TileColor" content="#141414">
    <meta name="msapplication-square70x70logo" content="smalltile.png" />
    <meta name="msapplication-square150x150logo" content="mediumtile.png" />
    <meta name="msapplication-wide310x150logo" content="widetile.png" />
    <meta name="msapplication-square310x310logo" content="largetile.png" />
    
    <!-- Android Lolipop Theme Color -->
    <meta name="theme-color" content="#141414">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Titillium+Web:300,400,700" rel="stylesheet">

    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="canonical" href="https://somaz.blog/category/kubernetes/kubernetes-redis-redlock-in-kubernetes/">
    <link rel="alternate" type="application/rss+xml" title="Somaz Tech Blog" href="https://somaz.blog/feed.xml" />

    <!-- Include extra styles -->
    

    <!-- JavaScript enabled/disabled -->
    <script>
        document.querySelector('html').classList.remove('no-js');
    </script>

    <!-- Google Adsense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8725590811736154"
        crossorigin="anonymous"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"> -->
    <!-- <link href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/variable/woff2/SUIT-Variable.css" rel="stylesheet"> -->
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- <link href="https://fonts.googleapis.com/css2?family=Albert+Sans:wght@400;500;700&display=swap" rel="stylesheet"> -->

    <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml" />

</head>
<!-- ✅ Google Tag Manager (noscript) -->
<noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MBP83N4Q"
            height="0" width="0" style="display:none;visibility:hidden">
    </iframe>
</noscript>
<!-- ✅ End Google Tag Manager (noscript) -->
    <body class="has-push-menu">
        





        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" display="none" version="1.1"><defs><symbol id="icon-menu" viewBox="0 0 1024 1024"><path class="path1" d="M128 213.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 725.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 469.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5z"/></symbol><symbol id="icon-search" viewBox="0 0 951 1024"><path class="path1" d="M658.286 475.429q0-105.714-75.143-180.857t-180.857-75.143-180.857 75.143-75.143 180.857 75.143 180.857 180.857 75.143 180.857-75.143 75.143-180.857zM950.857 950.857q0 29.714-21.714 51.429t-51.429 21.714q-30.857 0-51.429-21.714l-196-195.429q-102.286 70.857-228 70.857-81.714 0-156.286-31.714t-128.571-85.714-85.714-128.571-31.714-156.286 31.714-156.286 85.714-128.571 128.571-85.714 156.286-31.714 156.286 31.714 128.571 85.714 85.714 128.571 31.714 156.286q0 125.714-70.857 228l196 196q21.143 21.143 21.143 51.429z"/></symbol><symbol id="icon-close" viewBox="0 0 1000 1000"><path d="M969.8,870.3c27,27.7,27,71.8,0,99.1C955.7,983,937.9,990,920,990c-17.9,0-35.7-7-49.7-20.7L500,599L129.6,969.4C115.6,983,97.8,990,79.9,990s-35.7-7-49.7-20.7c-27-27.3-27-71.4,0-99.1L400.9,500L30.3,129.3c-27-27.3-27-71.4,0-99.1c27.3-27,71.8-27,99.4,0L500,400.9L870.4,30.2c27.7-27,71.8-27,99.4,0c27,27.7,27,71.8,0,99.1L599.1,500L969.8,870.3z"/></symbol><symbol id="icon-twitter" viewBox="0 0 951 1024"><path class="path1" d="M925.714 233.143q-38.286 56-92.571 95.429 0.571 8 0.571 24 0 74.286-21.714 148.286t-66 142-105.429 120.286-147.429 83.429-184.571 31.143q-154.857 0-283.429-82.857 20 2.286 44.571 2.286 128.571 0 229.143-78.857-60-1.143-107.429-36.857t-65.143-91.143q18.857 2.857 34.857 2.857 24.571 0 48.571-6.286-64-13.143-106-63.714t-42-117.429v-2.286q38.857 21.714 83.429 23.429-37.714-25.143-60-65.714t-22.286-88q0-50.286 25.143-93.143 69.143 85.143 168.286 136.286t212.286 56.857q-4.571-21.714-4.571-42.286 0-76.571 54-130.571t130.571-54q80 0 134.857 58.286 62.286-12 117.143-44.571-21.143 65.714-81.143 101.714 53.143-5.714 106.286-28.571z"/></symbol><symbol id="icon-facebook" viewBox="0 0 585 1024"><path class="path1" d="M548 6.857v150.857h-89.714q-49.143 0-66.286 20.571t-17.143 61.714v108h167.429l-22.286 169.143h-145.143v433.714h-174.857v-433.714h-145.714v-169.143h145.714v-124.571q0-106.286 59.429-164.857t158.286-58.571q84 0 130.286 6.857z"/></symbol><symbol id="icon-clock" viewBox="0 0 1000 1000"><path d="M500,10C229.8,10,10,229.8,10,500c0,270.2,219.8,490,490,490c270.2,0,490-219.8,490-490C990,229.8,770.2,10,500,10z M500,910.2c-226.2,0-410.2-184-410.2-410.2c0-226.2,184-410.2,410.2-410.2c226.2,0,410.2,184,410.2,410.2C910.2,726.1,726.2,910.2,500,910.2z M753.1,374c8.2,11.9,5.2,28.1-6.6,36.3L509.9,573.7c-4.4,3.1-9.6,4.6-14.8,4.6c-4.1,0-8.3-1-12.1-3c-8.6-4.5-14-13.4-14-23.1V202.5c0-14.4,11.7-26.1,26.1-26.1c14.4,0,26.1,11.7,26.1,26.1v300l195.6-135.1C728.7,359.2,744.9,362.1,753.1,374z"/></symbol><symbol id="icon-calendar" viewBox="0 0 1000 1000"><path d="M920,500v420H80V500H920 M990,430H10v490c0,38.7,31.3,70,70,70h840c38.7,0,70-31.3,70-70V430L990,430z"/><path d="M850,80v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80H360v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80C72.8,80,10,142.7,10,220v140h980V220C990,142.7,927.2,80,850,80z"/><path d="M255,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C290,25.8,274.3,10,255,10z"/><path d="M745,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C780,25.8,764.3,10,745,10z"/></symbol><symbol id="icon-github" viewBox="0 0 12 14"><path d="M6 1q1.633 0 3.012 0.805t2.184 2.184 0.805 3.012q0 1.961-1.145 3.527t-2.957 2.168q-0.211 0.039-0.312-0.055t-0.102-0.234q0-0.023 0.004-0.598t0.004-1.051q0-0.758-0.406-1.109 0.445-0.047 0.801-0.141t0.734-0.305 0.633-0.52 0.414-0.82 0.16-1.176q0-0.93-0.617-1.609 0.289-0.711-0.062-1.594-0.219-0.070-0.633 0.086t-0.719 0.344l-0.297 0.187q-0.727-0.203-1.5-0.203t-1.5 0.203q-0.125-0.086-0.332-0.211t-0.652-0.301-0.664-0.105q-0.352 0.883-0.062 1.594-0.617 0.68-0.617 1.609 0 0.664 0.16 1.172t0.41 0.82 0.629 0.523 0.734 0.305 0.801 0.141q-0.305 0.281-0.383 0.805-0.164 0.078-0.352 0.117t-0.445 0.039-0.512-0.168-0.434-0.488q-0.148-0.25-0.379-0.406t-0.387-0.187l-0.156-0.023q-0.164 0-0.227 0.035t-0.039 0.090 0.070 0.109 0.102 0.094l0.055 0.039q0.172 0.078 0.34 0.297t0.246 0.398l0.078 0.18q0.102 0.297 0.344 0.48t0.523 0.234 0.543 0.055 0.434-0.027l0.18-0.031q0 0.297 0.004 0.691t0.004 0.426q0 0.141-0.102 0.234t-0.312 0.055q-1.812-0.602-2.957-2.168t-1.145-3.527q0-1.633 0.805-3.012t2.184-2.184 3.012-0.805zM2.273 9.617q0.023-0.055-0.055-0.094-0.078-0.023-0.102 0.016-0.023 0.055 0.055 0.094 0.070 0.047 0.102-0.016zM2.516 9.883q0.055-0.039-0.016-0.125-0.078-0.070-0.125-0.023-0.055 0.039 0.016 0.125 0.078 0.078 0.125 0.023zM2.75 10.234q0.070-0.055 0-0.148-0.062-0.102-0.133-0.047-0.070 0.039 0 0.141t0.133 0.055zM3.078 10.562q0.062-0.062-0.031-0.148-0.094-0.094-0.156-0.023-0.070 0.062 0.031 0.148 0.094 0.094 0.156 0.023zM3.523 10.758q0.023-0.086-0.102-0.125-0.117-0.031-0.148 0.055t0.102 0.117q0.117 0.047 0.148-0.047zM4.016 10.797q0-0.102-0.133-0.086-0.125 0-0.125 0.086 0 0.102 0.133 0.086 0.125 0 0.125-0.086zM4.469 10.719q-0.016-0.086-0.141-0.070-0.125 0.023-0.109 0.117t0.141 0.062 0.109-0.109z"></path></symbol><symbol id="icon-medium" viewBox="0 0 1000 1000"><path d="M336.5,240.2v641.5c0,9.1-2.3,16.9-6.8,23.2s-11.2,9.6-20,9.6c-6.2,0-12.2-1.5-18-4.4L37.3,782.7c-7.7-3.6-14.1-9.8-19.4-18.3S10,747.4,10,739V115.5c0-7.3,1.8-13.5,5.5-18.6c3.6-5.1,8.9-7.7,15.9-7.7c5.1,0,13.1,2.7,24.1,8.2l279.5,140C335.9,238.6,336.5,239.5,336.5,240.2L336.5,240.2z M371.5,295.5l292,473.6l-292-145.5V295.5z M990,305.3v576.4c0,9.1-2.6,16.5-7.7,22.1c-5.1,5.7-12,8.5-20.8,8.5s-17.3-2.4-25.7-7.1L694.7,784.9L990,305.3z M988.4,239.7c0,1.1-46.8,77.6-140.3,229.4C754.6,621,699.8,709.8,683.8,735.7L470.5,389l177.2-288.2c6.2-10.2,15.7-15.3,28.4-15.3c5.1,0,9.8,1.1,14.2,3.3l295.9,147.7C987.6,237.1,988.4,238.2,988.4,239.7L988.4,239.7z"/></symbol><symbol id="icon-instagram" viewBox="0 0 489.84 489.84"><path d="M249.62,50.46c65.4,0,73.14.25,99,1.43C372.47,53,385.44,57,394.07,60.32a75.88,75.88,0,0,1,28.16,18.32,75.88,75.88,0,0,1,18.32,28.16c3.35,8.63,7.34,21.6,8.43,45.48,1.18,25.83,1.43,33.57,1.43,99s-0.25,73.14-1.43,99c-1.09,23.88-5.08,36.85-8.43,45.48a81.11,81.11,0,0,1-46.48,46.48c-8.63,3.35-21.6,7.34-45.48,8.43-25.82,1.18-33.57,1.43-99,1.43s-73.15-.25-99-1.43c-23.88-1.09-36.85-5.08-45.48-8.43A75.88,75.88,0,0,1,77,423.86,75.88,75.88,0,0,1,58.69,395.7c-3.35-8.63-7.34-21.6-8.43-45.48-1.18-25.83-1.43-33.57-1.43-99s0.25-73.14,1.43-99c1.09-23.88,5.08-36.85,8.43-45.48A75.88,75.88,0,0,1,77,78.64a75.88,75.88,0,0,1,28.16-18.32c8.63-3.35,21.6-7.34,45.48-8.43,25.83-1.18,33.57-1.43,99-1.43m0-44.13c-66.52,0-74.86.28-101,1.47s-43.87,5.33-59.45,11.38A120.06,120.06,0,0,0,45.81,47.44,120.06,120.06,0,0,0,17.56,90.82C11.5,106.4,7.36,124.2,6.17,150.27s-1.47,34.46-1.47,101,0.28,74.86,1.47,101,5.33,43.87,11.38,59.45a120.06,120.06,0,0,0,28.25,43.38,120.06,120.06,0,0,0,43.38,28.25c15.58,6.05,33.38,10.19,59.45,11.38s34.46,1.47,101,1.47,74.86-.28,101-1.47,43.87-5.33,59.45-11.38a125.24,125.24,0,0,0,71.63-71.63c6.05-15.58,10.19-33.38,11.38-59.45s1.47-34.46,1.47-101-0.28-74.86-1.47-101-5.33-43.87-11.38-59.45a120.06,120.06,0,0,0-28.25-43.38,120.06,120.06,0,0,0-43.38-28.25C394.47,13.13,376.67,9,350.6,7.8s-34.46-1.47-101-1.47h0Z" transform="translate(-4.7 -6.33)" /><path d="M249.62,125.48A125.77,125.77,0,1,0,375.39,251.25,125.77,125.77,0,0,0,249.62,125.48Zm0,207.41a81.64,81.64,0,1,1,81.64-81.64A81.64,81.64,0,0,1,249.62,332.89Z" transform="translate(-4.7 -6.33)"/><circle cx="375.66" cy="114.18" r="29.39" /></symbol><symbol id="icon-linkedin" viewBox="0 0 12 14"><path d="M2.727 4.883v7.742h-2.578v-7.742h2.578zM2.891 2.492q0.008 0.57-0.395 0.953t-1.059 0.383h-0.016q-0.641 0-1.031-0.383t-0.391-0.953q0-0.578 0.402-0.957t1.051-0.379 1.039 0.379 0.398 0.957zM12 8.187v4.437h-2.57v-4.141q0-0.82-0.316-1.285t-0.988-0.465q-0.492 0-0.824 0.27t-0.496 0.668q-0.086 0.234-0.086 0.633v4.32h-2.57q0.016-3.117 0.016-5.055t-0.008-2.313l-0.008-0.375h2.57v1.125h-0.016q0.156-0.25 0.32-0.438t0.441-0.406 0.68-0.34 0.895-0.121q1.336 0 2.148 0.887t0.813 2.598z"></path></symbol><symbol id="icon-heart" viewBox="0 0 34 30"><path d="M17,29.7 L16.4,29.2 C3.5,18.7 0,15 0,9 C0,4 4,0 9,0 C13.1,0 15.4,2.3 17,4.1 C18.6,2.3 20.9,0 25,0 C30,0 34,4 34,9 C34,15 30.5,18.7 17.6,29.2 L17,29.7 Z M9,2 C5.1,2 2,5.1 2,9 C2,14.1 5.2,17.5 17,27.1 C28.8,17.5 32,14.1 32,9 C32,5.1 28.9,2 25,2 C21.5,2 19.6,4.1 18.1,5.8 L17,7.1 L15.9,5.8 C14.4,4.1 12.5,2 9,2 Z" id="Shape"></path></symbol><symbol id="icon-arrow-right" viewBox="0 0 25.452 25.452"><path d="M4.471,24.929v-2.004l12.409-9.788c0.122-0.101,0.195-0.251,0.195-0.411c0-0.156-0.073-0.31-0.195-0.409L4.471,2.526V0.522c0-0.2,0.115-0.384,0.293-0.469c0.18-0.087,0.396-0.066,0.552,0.061l15.47,12.202c0.123,0.1,0.195,0.253,0.195,0.409c0,0.16-0.072,0.311-0.195,0.411L5.316,25.34c-0.155,0.125-0.372,0.147-0.552,0.061C4.586,25.315,4.471,25.13,4.471,24.929z"/></symbol><symbol id="icon-star" viewBox="0 0 48 48"><path fill="currentColor" d="M44,24c0,11.045-8.955,20-20,20S4,35.045,4,24S12.955,4,24,4S44,12.955,44,24z"/><path fill="#ffffff" d="M24,11l3.898,7.898l8.703,1.301l-6.301,6.102l1.5,8.699L24,30.898L16.199,35l1.5-8.699l-6.301-6.102  l8.703-1.301L24,11z"/></symbol><symbol id="icon-read" viewBox="0 0 32 32"><path fill="currentColor" d="M29,4H3C1.343,4,0,5.343,0,7v18c0,1.657,1.343,3,3,3h10c0,0.552,0.448,1,1,1h4c0.552,0,1-0.448,1-1h10  c1.657,0,3-1.343,3-3V7C32,5.343,30.657,4,29,4z M29,5v20H18.708c-0.618,0-1.236,0.146-1.789,0.422l-0.419,0.21V5H29z M15.5,5  v20.632l-0.419-0.21C14.528,25.146,13.91,25,13.292,25H3V5H15.5z M31,25c0,1.103-0.897,2-2,2H18v1h-4v-1H3c-1.103,0-2-0.897-2-2V7  c0-0.737,0.405-1.375,1-1.722V25c0,0.552,0.448,1,1,1h10.292c0.466,0,0.925,0.108,1.342,0.317l0.919,0.46  c0.141,0.07,0.294,0.106,0.447,0.106c0.153,0,0.306-0.035,0.447-0.106l0.919-0.46C17.783,26.108,18.242,26,18.708,26H29  c0.552,0,1-0.448,1-1V5.278C30.595,5.625,31,6.263,31,7V25z M6,12.5C6,12.224,6.224,12,6.5,12h5c0.276,0,0.5,0.224,0.5,0.5  S11.776,13,11.5,13h-5C6.224,13,6,12.776,6,12.5z M6,14.5C6,14.224,6.224,14,6.5,14h5c0.276,0,0.5,0.224,0.5,0.5S11.776,15,11.5,15  h-5C6.224,15,6,14.776,6,14.5z M6,16.5C6,16.224,6.224,16,6.5,16h5c0.276,0,0.5,0.224,0.5,0.5S11.776,17,11.5,17h-5  C6.224,17,6,16.776,6,16.5z M20,12.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,13,25.5,13h-5  C20.224,13,20,12.776,20,12.5z M20,14.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,15,25.5,15h-5  C20.224,15,20,14.776,20,14.5z M20,16.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,17,25.5,17h-5  C20.224,17,20,16.776,20,16.5z"></path></symbol><symbol id="icon-tistory" viewBox="0 0 24 24"><path d="M4 4h16v3h-6v13h-4V7H4V4z"/></symbol></defs></svg>

        <header class="bar-header">
    <a id="menu" role="button">
        <svg id="open" class="icon-menu"><use xlink:href="#icon-menu"></use></svg>
    </a>
    <h1 class="logo">
        <a href="/">
            
                somaz <span class="version">v3.1.2</span>
            
        </a>
    </h1>
    <a id="search" class="dosearch" role="button">
        <svg class="icon-search"><use xlink:href="#icon-search"></use></svg>
    </a>
    
        <a href="https://github.com/thiagorossener/jekflix-template" class="get-theme" role="button">
            Get this theme!
        </a>
    
</header>

<div id="mask" class="overlay"></div>

<aside class="sidebar" id="sidebar">
    <nav id="navigation">
      <h2>Menu</h2>
      <ul>
  
    
      <li>
        <a href="https://somaz.blog/">Home</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/about">About</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/category">Category</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/contact">Contact</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/feed.xml">Feed</a>
      </li>
    
  
</ul>

    </nav>
</aside>

<div class="search-wrapper">
    <div class="search-form">
        <input type="text" class="search-field" placeholder="Search">
        <svg class="icon-remove-sign"><use xlink:href="#icon-close"></use></svg>
        <ul class="search-results search-list"></ul>
    </div>
</div>



        <section class="post two-columns">
            <article role="article" class="post-content">
                <p class="post-info">
                    
                        <svg class="icon-calendar" id="date"><use xlink:href="#icon-calendar"></use></svg>
                        <time class="date" datetime="2025-11-05T00:00:00+00:00">
                            


November 5, 2025

                        </time>
                    
                    <svg id="clock" class="icon-clock"><use xlink:href="#icon-clock"></use></svg>
                    <span>14 min to read</span>
                </p>
                <h1 class="post-title">Implementing Redis Redlock on Kubernetes — A Complete Guide to Distributed Locks</h1>
                <p class="post-subtitle">Principles of Redlock, safe implementation patterns on Kubernetes, operational pitfalls, and alternatives</p>

                
                    <img src="https://res.cloudinary.com/dkcm26aem/image/upload/v1767686660/kubernetes-trouble-redis-1_mtrwpi.png" alt="Featured image" class="post-cover">
                

                <!-- Pagination links -->



                <!-- Add your table of contents here -->


                <p><br /></p>

<hr />

<h2 id="overview">Overview</h2>

<p>Concurrency control is one of the trickiest problems in distributed systems.</p>

<p>When multiple instances contend for the same resource, you need a reliable locking mechanism to maintain data consistency and prevent race conditions.</p>

<p>A naive single Redis instance with SET NX is unsafe under network partitions, instance failures, and clock drift. To address these risks, Redis creator Salvatore Sanfilippo proposed the <strong>Redlock</strong> algorithm.</p>

<p>This post covers how Redlock works, safe implementation patterns on Kubernetes, must-have operational checks,</p>

<p>and how Redlock compares to DB- and Consul/etcd-based locking — all from a production perspective.</p>

<div class="info-box info-box-default-not-check">
  <strong>Scope</strong>
  <p>This guide targets teams operating Redis-based distributed locks reliably in on-premises or hybrid Kubernetes environments. It focuses on concepts, design, and operations — without code snippets.</p>
</div>

<p><br /></p>

<h2 id="what-is-redlock">What is Redlock?</h2>

<p><br /></p>

<h3 id="key-ideas">Key ideas</h3>

<ul>
  <li>A client must acquire the lock on a <strong>majority (N/2+1)</strong> of independent Redis instances to succeed.</li>
  <li>Locks use a <strong>TTL</strong> and a <strong>unique token</strong> to validate ownership and guarantee automatic release.</li>
  <li>Compute effective validity by accounting for <strong>clock drift</strong>, and release any partially acquired locks on failure.</li>
</ul>

<p><br /></p>

<h3 id="why-multiple-instances">Why multiple instances?</h3>

<ul>
  <li>Eliminate single points of failure (SPOF)</li>
  <li>Prevent split-brain/effective double-locks during network partitions</li>
  <li>Gain tolerance to inter-node clock skew</li>
</ul>

<p><br /></p>

<h2 id="how-redlock-works-deep-dive">How Redlock Works (Deep dive)</h2>

<p><br /></p>

<h3 id="1-acquire">1) Acquire</h3>

<ul>
  <li>Attempt to acquire the lock concurrently across instances with a unique token and TTL.</li>
  <li>Sum the elapsed time and compute the <strong>effective validity</strong> relative to the TTL.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">acquire_lock</span><span class="p">(</span><span class="n">resource_name</span><span class="p">,</span> <span class="n">ttl</span><span class="p">):</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">current_time</span><span class="p">()</span>
    <span class="n">successful_locks</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">unique_value</span> <span class="o">=</span> <span class="n">generate_unique_id</span><span class="p">()</span>
    
    <span class="c1"># To all Redis instances at the same time
</span>    <span class="k">for</span> <span class="n">redis_instance</span> <span class="ow">in</span> <span class="n">redis_instances</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">redis_instance</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="n">resource_name</span><span class="p">,</span> <span class="n">unique_value</span><span class="p">,</span> <span class="n">px</span><span class="o">=</span><span class="n">ttl</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="n">successful_locks</span> <span class="o">+=</span> <span class="mi">1</span>
    
    <span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">current_time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
    <span class="n">drift</span> <span class="o">=</span> <span class="p">(</span><span class="n">ttl</span> <span class="o">*</span> <span class="mf">0.01</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span>  <span class="c1"># Clock drift calibration
</span>    
    <span class="c1"># Success conditions: majority + valid time left
</span>    <span class="k">if</span> <span class="n">successful_locks</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">redis_instances</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">validity_time</span> <span class="o">=</span> <span class="n">ttl</span> <span class="o">-</span> <span class="n">elapsed_time</span> <span class="o">-</span> <span class="n">drift</span>
        <span class="k">if</span> <span class="n">validity_time</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span><span class="p">,</span> <span class="n">validity_time</span>
    
    <span class="c1"># Unlock on all instances in case of failure
</span>    <span class="n">release_lock</span><span class="p">(</span><span class="n">resource_name</span><span class="p">,</span> <span class="n">unique_value</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">0</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="2-success-conditions">2) Success conditions</h3>

<ul>
  <li>Majority of instances acquired</li>
  <li>TTL − (elapsed + drift) &gt; 0</li>
</ul>

<p><br /></p>

<h3 id="3-release">3) Release</h3>

<ul>
  <li>Delete only if the stored token matches the owner token (atomicity)</li>
  <li>On failure/timeout, release any partial acquisitions</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">## Lua script </span>
<span class="k">if </span>redis.call<span class="o">(</span><span class="s2">"get"</span>, KEYS[1]<span class="o">)</span> <span class="o">==</span> ARGV[1] <span class="k">then
    return </span>redis.call<span class="o">(</span><span class="s2">"del"</span>, KEYS[1]<span class="o">)</span>
<span class="k">else
    return </span>0
end
</code></pre></div></div>

<p><br /></p>

<h2 id="common-kubernetes-pitfalls">Common Kubernetes Pitfalls</h2>

<p>Many teams assume that deploying Redis as a StatefulSet with a Headless Service makes Redlock safe by default. It does not, for several reasons:</p>

<ul>
  <li><strong>Headless DNS limitations</strong>: Even with multiple A records, many Redis clients use only the first IP.</li>
  <li><strong>Lack of independence</strong>: Co-locating pods on the same node/rack/storage overlaps failure domains.</li>
  <li><strong>Client awareness</strong>: Clients may not treat pods as distinct, independently monitored instances.</li>
</ul>

<p><br /></p>

<h2 id="correct-implementation-patterns-kubernetes">Correct Implementation Patterns (Kubernetes)</h2>

<p><br /></p>

<h3 id="method-1--per-pod-services-recommended">Method 1 — Per-pod Services (recommended)</h3>

<ul>
  <li>Expose a <strong>dedicated Service</strong> per Redis pod to create clear, stable endpoints.</li>
  <li>The application creates <strong>independent connections</strong> to each Service for the Redlock cluster.</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">redis-0</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">redis-cluster</span>
    <span class="na">statefulset.kubernetes.io/pod-name</span><span class="pi">:</span> <span class="s">redis-cluster-0</span>
  <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">6379</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">6379</span>

<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">redis-1</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">redis-cluster</span>
    <span class="na">statefulset.kubernetes.io/pod-name</span><span class="pi">:</span> <span class="s">redis-cluster-1</span>
  <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">6379</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">6379</span>

<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">redis-2</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">redis-cluster</span>
    <span class="na">statefulset.kubernetes.io/pod-name</span><span class="pi">:</span> <span class="s">redis-cluster-2</span>
  <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">6379</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">6379</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="method-2--pod-anti-affinity">Method 2 — Pod anti-affinity</h3>

<ul>
  <li>Enforce <strong>spread policies</strong> to avoid co-scheduling on the same node/rack.</li>
  <li>Maximize independence across failure domains (node/power/network/storage).</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">StatefulSet</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">redis-cluster</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">affinity</span><span class="pi">:</span>
        <span class="na">podAntiAffinity</span><span class="pi">:</span>
          <span class="na">requiredDuringSchedulingIgnoredDuringExecution</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">labelSelector</span><span class="pi">:</span>
              <span class="na">matchExpressions</span><span class="pi">:</span>
              <span class="pi">-</span> <span class="na">key</span><span class="pi">:</span> <span class="s">app</span>
                <span class="na">operator</span><span class="pi">:</span> <span class="s">In</span>
                <span class="na">values</span><span class="pi">:</span>
                <span class="pi">-</span> <span class="s">redis-cluster</span>
            <span class="na">topologyKey</span><span class="pi">:</span> <span class="s">kubernetes.io/hostname</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="method-3--dns-based-dynamic-discovery">Method 3 — DNS-based dynamic discovery</h3>

<ul>
  <li><strong>Periodically resolve</strong> headless endpoints to refresh the connection pool dynamically.</li>
  <li>Tune connection/retry/timeout policies <strong>conservatively for Redlock assumptions</strong>.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">const</span> <span class="n">dns</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s">'dns'</span><span class="p">).</span><span class="n">promises</span><span class="p">;</span>

<span class="k">async</span> <span class="n">function</span> <span class="n">getRedisInstances</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">const</span> <span class="n">addresses</span> <span class="o">=</span> <span class="k">await</span> <span class="n">dns</span><span class="p">.</span><span class="n">lookup</span><span class="p">(</span><span class="s">'redis-service'</span><span class="p">,</span> <span class="p">{</span> <span class="nb">all</span><span class="p">:</span> <span class="n">true</span> <span class="p">});</span>
  <span class="k">return</span> <span class="n">addresses</span><span class="p">.</span><span class="nb">map</span><span class="p">(</span><span class="n">addr</span> <span class="o">=&gt;</span> <span class="p">({</span>
    <span class="n">host</span><span class="p">:</span> <span class="n">addr</span><span class="p">.</span><span class="n">address</span><span class="p">,</span>
    <span class="n">port</span><span class="p">:</span> <span class="mi">6379</span>
  <span class="p">}));</span>
<span class="p">}</span>

<span class="k">async</span> <span class="n">function</span> <span class="n">createRedlock</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">const</span> <span class="n">instances</span> <span class="o">=</span> <span class="k">await</span> <span class="n">getRedisInstances</span><span class="p">();</span>
  <span class="k">return</span> <span class="n">new</span> <span class="n">Redlock</span><span class="p">(</span><span class="n">instances</span><span class="p">.</span><span class="nb">map</span><span class="p">(</span><span class="n">config</span> <span class="o">=&gt;</span> <span class="n">new</span> <span class="n">Redis</span><span class="p">(</span><span class="n">config</span><span class="p">)));</span>
<span class="p">}</span>
</code></pre></div></div>

<p><br /></p>

<h2 id="real-world-implementation-patterns-no-code">Real-world Implementation Patterns (No code)</h2>

<p><br /></p>

<h3 id="application-layer-eg-nodejs-java">Application layer (e.g., Node.js, Java)</h3>

<ul>
  <li>Use the <strong>same lock key</strong> across at least three independent Redis instances to achieve majority consensus.</li>
  <li>Maintain <strong>separate event/error handlers</strong> per connection and observe connection health independently.</li>
  <li>Configure Redlock client retry counts/delays/jitter and drift factors <strong>explicitly</strong>.</li>
</ul>

<h4 id="node">Node</h4>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">Redis</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">ioredis</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">Redlock</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">redlock</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">class</span> <span class="nx">RedlockService</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Connections using per-pod Services</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">redisClients</span> <span class="o">=</span> <span class="p">[</span>
      <span class="k">new</span> <span class="nx">Redis</span><span class="p">({</span>
        <span class="na">host</span><span class="p">:</span> <span class="dl">'</span><span class="s1">redis-0.default.svc.cluster.local</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">port</span><span class="p">:</span> <span class="mi">6379</span><span class="p">,</span>
        <span class="na">retryDelayOnFailover</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="na">maxRetriesPerRequest</span><span class="p">:</span> <span class="mi">3</span>
      <span class="p">}),</span>
      <span class="k">new</span> <span class="nx">Redis</span><span class="p">({</span>
        <span class="na">host</span><span class="p">:</span> <span class="dl">'</span><span class="s1">redis-1.default.svc.cluster.local</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">port</span><span class="p">:</span> <span class="mi">6379</span><span class="p">,</span>
        <span class="na">retryDelayOnFailover</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="na">maxRetriesPerRequest</span><span class="p">:</span> <span class="mi">3</span>
      <span class="p">}),</span>
      <span class="k">new</span> <span class="nx">Redis</span><span class="p">({</span>
        <span class="na">host</span><span class="p">:</span> <span class="dl">'</span><span class="s1">redis-2.default.svc.cluster.local</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">port</span><span class="p">:</span> <span class="mi">6379</span><span class="p">,</span>
        <span class="na">retryDelayOnFailover</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="na">maxRetriesPerRequest</span><span class="p">:</span> <span class="mi">3</span>
      <span class="p">})</span>
    <span class="p">];</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">redlock</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Redlock</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">redisClients</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">retryCount</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
      <span class="na">retryDelay</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
      <span class="na">retryJitter</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
      <span class="na">driftFactor</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span>
      <span class="na">clockDriftMs</span><span class="p">:</span> <span class="mi">2</span>
    <span class="p">});</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">setupEventHandlers</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">setupEventHandlers</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">redisClients</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">client</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">client</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">connect</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Redis-</span><span class="p">${</span><span class="nx">index</span><span class="p">}</span><span class="s2"> connected`</span><span class="p">);</span>
      <span class="p">});</span>
      
      <span class="nx">client</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">`Redis-</span><span class="p">${</span><span class="nx">index</span><span class="p">}</span><span class="s2"> error:`</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">});</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">redlock</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">clientError</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Redlock client error:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">acquireLock</span><span class="p">(</span><span class="nx">resource</span><span class="p">,</span> <span class="nx">ttl</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Attempting to acquire lock: </span><span class="p">${</span><span class="nx">resource</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">lock</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">redlock</span><span class="p">.</span><span class="nx">acquire</span><span class="p">([</span><span class="nx">resource</span><span class="p">],</span> <span class="nx">ttl</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Lock acquired: </span><span class="p">${</span><span class="nx">resource</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">lock</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">`Failed to acquire lock: </span><span class="p">${</span><span class="nx">resource</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
      <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">releaseLock</span><span class="p">(</span><span class="nx">lock</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">await</span> <span class="nx">lock</span><span class="p">.</span><span class="nx">release</span><span class="p">();</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Lock released: </span><span class="p">${</span><span class="nx">lock</span><span class="p">.</span><span class="nx">resources</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">`Failed to release lock:`</span><span class="p">,</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
      <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Usage example</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">criticalSection</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">redlockService</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RedlockService</span><span class="p">();</span>
  
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">lock</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">redlockService</span><span class="p">.</span><span class="nx">acquireLock</span><span class="p">(</span><span class="dl">'</span><span class="s1">user-action-123</span><span class="dl">'</span><span class="p">,</span> <span class="mi">15000</span><span class="p">);</span>
    
    <span class="k">try</span> <span class="p">{</span>
      <span class="c1">// Work performed in critical section</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Performing critical work...</span><span class="dl">'</span><span class="p">);</span>
      <span class="k">await</span> <span class="nx">performCriticalOperation</span><span class="p">();</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Work completed</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
      <span class="k">await</span> <span class="nx">redlockService</span><span class="p">.</span><span class="nx">releaseLock</span><span class="p">(</span><span class="nx">lock</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Work failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="java-redisson">Java (Redisson)</h4>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.redisson.Redisson</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.redisson.api.RLock</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.redisson.api.RedissonClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.redisson.config.Config</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RedlockService</span> <span class="o">{</span>
    
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">RedissonClient</span> <span class="n">redissonClient</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="nf">RedlockService</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">Config</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Config</span><span class="o">();</span>
        <span class="n">config</span><span class="o">.</span><span class="na">useReplicatedServers</span><span class="o">()</span>
            <span class="o">.</span><span class="na">addNodeAddress</span><span class="o">(</span><span class="s">"redis://redis-0.default.svc.cluster.local:6379"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">addNodeAddress</span><span class="o">(</span><span class="s">"redis://redis-1.default.svc.cluster.local:6379"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">addNodeAddress</span><span class="o">(</span><span class="s">"redis://redis-2.default.svc.cluster.local:6379"</span><span class="o">);</span>
        
        <span class="k">this</span><span class="o">.</span><span class="na">redissonClient</span> <span class="o">=</span> <span class="nc">Redisson</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">config</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">executeWithLock</span><span class="o">(</span><span class="nc">String</span> <span class="n">lockName</span><span class="o">,</span> <span class="kt">int</span> <span class="n">ttlSeconds</span><span class="o">,</span> <span class="nc">Runnable</span> <span class="n">task</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">RLock</span> <span class="n">lock</span> <span class="o">=</span> <span class="n">redissonClient</span><span class="o">.</span><span class="na">getLock</span><span class="o">(</span><span class="n">lockName</span><span class="o">);</span>
        
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">lock</span><span class="o">.</span><span class="na">tryLock</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="n">ttlSeconds</span><span class="o">,</span> <span class="nc">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">))</span> <span class="o">{</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Lock acquired: {}"</span><span class="o">,</span> <span class="n">lockName</span><span class="o">);</span>
                    <span class="n">task</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
                    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
                    <span class="n">lock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
                    <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Lock released: {}"</span><span class="o">,</span> <span class="n">lockName</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">log</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">"Failed to acquire lock: {}"</span><span class="o">,</span> <span class="n">lockName</span><span class="o">);</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">interrupt</span><span class="o">();</span>
            <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"Interrupted while acquiring lock: {}"</span><span class="o">,</span> <span class="n">lockName</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="lock-lifecycle">Lock lifecycle</h3>

<ul>
  <li>Set TTL to 2–3× expected work time (including buffer).</li>
  <li>For long-running work, include <strong>lock extend/refresh</strong> and define rollback/retry on failure.</li>
  <li>Release locks <strong>only after verifying the ownership token</strong> (avoid cross-release).</li>
</ul>

<p><br /></p>

<h2 id="operations-checklist">Operations Checklist</h2>

<p><br /></p>

<h3 id="1-clock-synchronization">1) Clock synchronization</h3>

<ul>
  <li>Enable NTP/Chrony on all nodes and build a drift monitoring dashboard.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Check NTP synchronization state</span>
chrony sources <span class="nt">-v</span>

<span class="c"># Reduce clock drift</span>
<span class="nb">echo</span> <span class="s2">"server time.google.com iburst"</span> <span class="o">&gt;&gt;</span> /etc/chrony.conf
systemctl restart chronyd
</code></pre></div></div>

<p><br /></p>

<h3 id="2-ttltimeout-policies">2) TTL/timeout policies</h3>

<ul>
  <li>Keep connection/command timeouts low; use short, shallow retries for <strong>fast failure</strong>.</li>
  <li>Derive TTLs from <strong>workload profiling</strong>, including peak scenarios.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>const expectedWorkTime <span class="o">=</span> 5000<span class="p">;</span>  // 5 seconds
const safetyMargin <span class="o">=</span> 2<span class="p">;</span>
const ttl <span class="o">=</span> expectedWorkTime <span class="k">*</span> safetyMargin<span class="p">;</span>  // 10 seconds
</code></pre></div></div>

<p><br /></p>

<h3 id="3-observability">3) Observability</h3>

<ul>
  <li>Collect and alert on the following metrics:</li>
</ul>

<div class="table-container">
  <table class="table-beauty">
    <tr>
      <th>Metric</th>
      <th>Purpose</th>
    </tr>
    <tr>
      <td>redlock_acquire_success_total</td>
      <td>Lock acquisition success trend</td>
    </tr>
    <tr>
      <td>redlock_acquire_failure_total</td>
      <td>Diagnose lock acquisition failures</td>
    </tr>
    <tr>
      <td>redlock_acquire_duration_seconds</td>
      <td>Distribution of acquisition latency</td>
    </tr>
    <tr>
      <td>redlock_validity_time_remaining</td>
      <td>Observe remaining validity time</td>
    </tr>
    <tr>
      <td>redis_connection_failures_total</td>
      <td>Per-instance connection stability</td>
    </tr>
  </table>
</div>

<p><br /></p>

<h3 id="4-failure-scenarios">4) Failure scenarios</h3>

<ul>
  <li>Provide safe abort/rollback paths when lock extension fails.</li>
  <li>After partial success/failure, <strong>release on all instances</strong> to restore consistency.</li>
  <li>Rehearse network partitions, node failures, and clock skew scenarios in advance.</li>
</ul>

<p><br /></p>

<h2 id="alternatives-and-comparison">Alternatives and Comparison</h2>

<p><br /></p>

<h3 id="vs-database-based-locking">vs. Database-based locking</h3>

<div class="table-container">
  <table class="table-beauty">
    <tr>
      <th>Aspect</th>
      <th>Redlock</th>
      <th>Database Lock</th>
    </tr>
    <tr>
      <td>Performance</td>
      <td>Very fast</td>
      <td>Relatively slower</td>
    </tr>
    <tr>
      <td>Complexity</td>
      <td>Medium</td>
      <td>Simple</td>
    </tr>
    <tr>
      <td>Consistency</td>
      <td>Eventual</td>
      <td>Strong (transactional)</td>
    </tr>
    <tr>
      <td>Failure recovery</td>
      <td>Automatic TTL expiry</td>
      <td>Manual/transactional release</td>
    </tr>
  </table>
</div>

<p><br /></p>

<h3 id="vs-consuletcd-based-locking">vs. Consul/etcd-based locking</h3>

<div class="table-container">
  <table class="table-beauty">
    <tr>
      <th>Aspect</th>
      <th>Redlock</th>
      <th>Consul/etcd</th>
    </tr>
    <tr>
      <td>Infrastructure complexity</td>
      <td>Low</td>
      <td>High</td>
    </tr>
    <tr>
      <td>Performance</td>
      <td>Very fast</td>
      <td>Fast</td>
    </tr>
    <tr>
      <td>Consensus</td>
      <td>Majority vote</td>
      <td>Raft</td>
    </tr>
    <tr>
      <td>Ecosystem</td>
      <td>Redis-centric</td>
      <td>Microservices/Orchestration</td>
    </tr>
  </table>
</div>

<p><br /></p>

<h2 id="when-to-use-redlock">When to Use Redlock</h2>

<p><br /></p>

<h3 id="well-suited-for">Well-suited for</h3>

<ul>
  <li>Real-time systems where very low latency and high throughput matter</li>
  <li>Teams that already operate Redis with low operational overhead</li>
  <li>Simple lock semantics (acquire/extend/release) without stringent consensus requirements</li>
</ul>

<p><br /></p>

<h3 id="avoid-when">Avoid when</h3>

<ul>
  <li>Domains requiring <strong>strict strong consistency</strong> (e.g., finance)</li>
  <li>Environments with frequent partitions or <strong>poor time synchronization</strong></li>
  <li>Workloads where consensus correctness is paramount (prefer Raft-based approaches)</li>
</ul>

<p><br /></p>

<h2 id="conclusion-safe-redlock-on-kubernetes">Conclusion: Safe Redlock on Kubernetes</h2>

<p>Redlock is elegant, but <strong>correct implementation</strong> is everything.</p>

<p>On Kubernetes, a StatefulSet alone is insufficient — you need <strong>independent access paths</strong> to each Redis instance and <strong>separation of failure domains</strong>.</p>

<p>Combine that with clock sync, TTL/timeout discipline, observability, and failure drills to achieve operational reliability. Redlock is not a universal answer; depending on requirements, DB- or Consul/etcd-based locking may be a better fit.</p>

<p><br /></p>

<hr />

<h2 id="references">References</h2>

<ul>
  <li>Redis Redlock official documentation</li>
  <li>Martin Kleppmann’s critique of Redlock</li>
  <li>Kubernetes StatefulSet guide</li>
  <li>Redis clustering best practices</li>
  <li>Kubernetes Storage Concepts</li>
</ul>



                <!-- Pagination links -->


            </article>

            
                <aside class="see-also">
                    <h2>See also</h2>
                    <ul>
                        
                        
                        
                            <li>
                                <a href="/category/cs/context-switching/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1767769259/context-switch-1_s1n69e.png">
                                    
                                    <h3>Context Switch Deep Dive - The Hidden Performance Cost in Container Environments</h3>
                                </a>
                            </li>
                        
                            <li>
                                <a href="/category/aws/aws-efs-kubernetes-guide/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1767685797/kubernetes-efs-1_ek4rbd.png">
                                    
                                    <h3>AWS Elastic File System (EFS) with Kubernetes - Complete Implementation Guide</h3>
                                </a>
                            </li>
                        
                            <li>
                                <a href="/category/cs/tls-https/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1767770122/tls-handshake-1_nwd3f0.png">
                                    
                                    <h3>TLS Handshake and Certificate Architecture - A Deep Dive into HTTPS Security</h3>
                                </a>
                            </li>
                        
                    </ul>
                </aside>
            

        </section>

        <!-- Add time bar only for pages without pagination -->
        
            <div class="time-bar" data-minutes="14">
    <span class="time-completed"></span>
    <span class="time-remaining"></span>
    <div class="bar">
        <span class="completed" style="width:0%;"></span>
        <span class="remaining" style="width:100%;"></span>
    </div>
</div>

            <button class="toggle-preview" onclick="togglePreview()">
    <span>Hide Preview ▼</span>
</button>

<div id="recommendationSection" class="recommendation">
    <div class="message">
        <strong>Why don't you read something next?</strong>
        <div>
            <button>
                <svg><use xlink:href="#icon-arrow-right"></use></svg>
                <span>Go back to top</span>
            </button>
        </div>
    </div>
    <div id="previewSection" class="preview-section">
        
        <a href="/category/storage/ceph-erasure-code/" class="post-preview">
            <div class="image">
                
                    <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1755133935/ceph-erasure-code_kheagu.png">
                
            </div>
            <h3 class="title">Advanced Ceph Erasure Code Configuration and Performance Optimization</h3>
        </a>
    </div>
</div>

<style>
.toggle-preview {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #333;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 4px;
    cursor: pointer;
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.toggle-preview:hover {
    background: #444;
}

.toggle-preview.visible {
    opacity: 1;
}

.recommendation {
    margin-top: 1000px;
    display: block;
    transition: all 0.3s ease;
}

.recommendation.hidden {
    display: none;
}

.hide-preview {
    margin-left: 10px;
    background: none;
    border: 1px solid #666;
    color: #666;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
}

.hide-preview:hover {
    background: #f0f0f0;
}

.preview-section {
    max-height: 1000px;
    overflow: hidden;
    transition: max-height 0.3s ease-out;
}

.preview-section.hidden {
    max-height: 0;
}
</style>

<script>
function togglePreview() {
    const recommendation = document.getElementById('recommendationSection');
    const button = document.querySelector('.toggle-preview span');
    
    if (recommendation.classList.contains('hidden')) {
        recommendation.classList.remove('hidden');
        button.textContent = 'Hide Preview ▼';
    } else {
        recommendation.classList.add('hidden');
        button.textContent = 'Show Preview ▲';
    }
}

window.addEventListener('scroll', function() {
    const toggleButton = document.querySelector('.toggle-preview');
    const recommendation = document.getElementById('recommendationSection');
    const rect = recommendation.getBoundingClientRect();
    
    if (rect.top <= window.innerHeight) {
        toggleButton.classList.add('visible');
    } else {
        toggleButton.classList.remove('visible');
    }
});
</script>

        

        <!-- Show modal if the post is the last one -->
        

        <!-- Show modal before user leaves the page -->
        

        <!-- Add your newsletter subscription form here -->

        <section class="share">
    <h3>Share</h3>
    <a aria-label="Share on Twitter" href="https://twitter.com/intent/tweet?text=&quot;A production-focused overview of the Redis Redlock algorithm and its limitations, Kubernetes-specific pitfalls and remedies, an operations checklist, and comparisons with DB- and Consul/etcd-based locking.&quot;%20https://somaz.blog/category/kubernetes/kubernetes-redis-redlock-in-kubernetes/%20via%20&#64;twitter_username&hashtags=kubernetes,redis,redlock,distributed-lock,statefulset,reliability,csi"
    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Share on Twitter">
        <svg class="icon icon-twitter"><use xlink:href="#icon-twitter"></use></svg>
    </a>
    <a aria-label="Share on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://somaz.blog/category/kubernetes/kubernetes-redis-redlock-in-kubernetes/"
    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook">
        <svg class="icon icon-facebook"><use xlink:href="#icon-facebook"></use></svg>
    </a>
</section>

        

  <section class="author">
    <div class="details">
      
        <img class="img-rounded" src="/assets/img/uploads/profile.png" alt="Somaz">
      
      <p class="def">Author</p>
      <h3 class="name">
        <a href="/authors/somaz/">Somaz</a>
      </h3>
      <p class="desc">DevOps engineer focused on cloud infrastructure and automation</p>
      <p>
        
          <a href="https://github.com/somaz94" title="Github">
            <svg><use xlink:href="#icon-github"></use></svg>
          </a>
        
        
        
        
        
        
          <a href="https://www.linkedin.com/in/somaz" title="LinkedIn">
            <svg><use xlink:href="#icon-linkedin"></use></svg>
          </a>
        
        
          <a href="https://somaz.tistory.com" title="Tistory">
            <svg><use xlink:href="#icon-tistory"></use></svg>
          </a>
        
      </p>
    </div>
  </section>

  
  
  
  
  
  
  
  

  <script type="application/ld+json">
  {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "Somaz",
      
      "image": "/assets/img/uploads/profile.png",
      
      "jobTitle": "DevOps Engineer",
      "url": "https://somaz.blog/authors/somaz/",
      "sameAs": [
        "https://github.com/somaz94","https://www.linkedin.com/in/somaz","https://{{ author.tistory_username }}.tistory.com"
      ]
  }
  </script>


        

<section class="comments">
    <h3>Comments</h3>
    <div id="disqus_thread"></div>
</section>
<script type="text/javascript">
    var disqus_loaded = false;

    function load_disqus()
    {
        disqus_loaded = true;
        var disqus_shortname = 'https-somaz94-github-io';
        var disqus_title = '';
        var disqus_url = '/category/kubernetes/kubernetes-redis-redlock-in-kubernetes/';
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        var ldr = document.getElementById('disqus_loader');
    };
    window.onscroll = function(e) {
        if ((window.innerHeight + window.scrollY) >= (document.body.offsetHeight - 800)) {
            //hit bottom of page
            if (disqus_loaded==false)
                load_disqus()
        }
    };
</script>



        <footer>
    <p>
      
        <a href="https://github.com/somaz94" title="Github">
          <svg><use xlink:href="#icon-github"></use></svg>
        </a>
      
      
        <a href="https://www.facebook.com/facebook_username" title="Facebook">
          <svg><use xlink:href="#icon-facebook"></use></svg>
        </a>
      
      
        <a href="https://twitter.com/twitter_username" title="Twitter">
          <svg><use xlink:href="#icon-twitter"></use></svg>
        </a>
      
      
        <a href="https://medium.com/@medium_username" title="Medium">
          <svg><use xlink:href="#icon-medium"></use></svg>
        </a>
      
      
        <a href="https://www.instagram.com/instagram_username" title="Instagram">
          <svg><use xlink:href="#icon-instagram"></use></svg>
        </a>
      
      
        <a href="https://www.linkedin.com/in/somaz" title="LinkedIn">
          <svg><use xlink:href="#icon-linkedin"></use></svg>
        </a>
      
      
        <a href="https://somaz.tistory.com" title="Tistory">
          <svg><use xlink:href="#icon-tistory"></use></svg>
        </a>
      
    </p>

    <ul>
  
    
      <li>
        <a href="https://somaz.blog/">Home</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/about">About</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/category">Category</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/contact">Contact</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz.blog/feed.xml">Feed</a>
      </li>
    
  
</ul>


    <p>
      <a href="https://somaz.blog/sitemap.xml" title="sitemap">Sitemap</a> |
      <a href="https://somaz.blog/privacy-policy" title="Privacy Policy">Privacy Policy</a>
    </p>

    <p>
      <span>Somaz Tech Blog</span> <svg class="love"><use xlink:href="#icon-heart"></use></svg>
    </p>
</footer>










<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "somaz",
  "description": "DevOps engineer's tech blog.",
  "url": "https://somaz.blog/",
  "logo": {
      "@type": "ImageObject",
      "url": "https://somaz.blog/assets/img/icons/mediumtile.png",
      "width": "600",
      "height": "315"
  },
  "sameAs": [
    "https://github.com/somaz94","https://www.facebook.com/facebook_username","https://twitter.com/twitter_username","https://medium.com/@medium_username","https://www.instagram.com/instagram_username","https://www.linkedin.com/in/somaz","https://{{ site.tistory_username }}.tistory.com"
  ]
}
</script>

<!-- Include the script that allows Netlify CMS login -->
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

<!-- Include the website scripts -->
<script src="/assets/js/scripts.min.js"></script>

<!-- Include Google Analytics script -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-XXXXXXXX-X"></script>
<script>
  var host = window.location.hostname;
  if (host != 'localhost') {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-XXXXXXXX-X');
  }
</script>
  


<!-- Include extra scripts -->



        

        
        
        
        
        
        
        
        
        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "BlogPosting",
            "name": "Implementing Redis Redlock on Kubernetes — A Complete Guide to Distributed Locks",
            "headline": "Principles of Redlock, safe implementation patterns on Kubernetes, operational pitfalls, and alternatives",
            "description": "A production-focused overview of the Redis Redlock algorithm and its limitations, Kubernetes-specific pitfalls and remedies, an operations checklist, and comparisons with DB- and Consul/etcd-based locking.",
            "image": "https://res.cloudinary.com/dkcm26aem/image/upload/v1767686660/kubernetes-trouble-redis-1_mtrwpi.png",
            "url": "https://somaz.blog/category/kubernetes/kubernetes-redis-redlock-in-kubernetes/",
            "articleBody": "



Overview

Concurrency control is one of the trickiest problems in distributed systems.

When multiple instances contend for the same resource, you need a reliable locking mechanism to maintain data consistency and prevent race conditions.

A naive single Redis instance with SET NX is unsafe under network partitions, instance failures, and clock drift. To address these risks, Redis creator Salvatore Sanfilippo proposed the Redlock algorithm.

This post covers how Redlock works, safe implementation patterns on Kubernetes, must-have operational checks,

and how Redlock compares to DB- and Consul/etcd-based locking — all from a production perspective.


  Scope
  This guide targets teams operating Redis-based distributed locks reliably in on-premises or hybrid Kubernetes environments. It focuses on concepts, design, and operations — without code snippets.




What is Redlock?



Key ideas


  A client must acquire the lock on a majority (N/2+1) of independent Redis instances to succeed.
  Locks use a TTL and a unique token to validate ownership and guarantee automatic release.
  Compute effective validity by accounting for clock drift, and release any partially acquired locks on failure.




Why multiple instances?


  Eliminate single points of failure (SPOF)
  Prevent split-brain/effective double-locks during network partitions
  Gain tolerance to inter-node clock skew




How Redlock Works (Deep dive)



1) Acquire


  Attempt to acquire the lock concurrently across instances with a unique token and TTL.
  Sum the elapsed time and compute the effective validity relative to the TTL.


def acquire_lock(resource_name, ttl):
    start_time = current_time()
    successful_locks = 0
    unique_value = generate_unique_id()
    
    # To all Redis instances at the same time
    for redis_instance in redis_instances:
        if redis_instance.set(resource_name, unique_value, px=ttl, nx=True):
            successful_locks += 1
    
    elapsed_time = current_time() - start_time
    drift = (ttl * 0.01) + 2  # Clock drift calibration
    
    # Success conditions: majority + valid time left
    if successful_locks &amp;gt;= (len(redis_instances) / 2 + 1):
        validity_time = ttl - elapsed_time - drift
        if validity_time &amp;gt; 0:
            return True, validity_time
    
    # Unlock on all instances in case of failure
    release_lock(resource_name, unique_value)
    return False, 0




2) Success conditions


  Majority of instances acquired
  TTL − (elapsed + drift) &amp;gt; 0




3) Release


  Delete only if the stored token matches the owner token (atomicity)
  On failure/timeout, release any partial acquisitions


## Lua script 
if redis.call(&quot;get&quot;, KEYS[1]) == ARGV[1] then
    return redis.call(&quot;del&quot;, KEYS[1])
else
    return 0
end




Common Kubernetes Pitfalls

Many teams assume that deploying Redis as a StatefulSet with a Headless Service makes Redlock safe by default. It does not, for several reasons:


  Headless DNS limitations: Even with multiple A records, many Redis clients use only the first IP.
  Lack of independence: Co-locating pods on the same node/rack/storage overlaps failure domains.
  Client awareness: Clients may not treat pods as distinct, independently monitored instances.




Correct Implementation Patterns (Kubernetes)



Method 1 — Per-pod Services (recommended)


  Expose a dedicated Service per Redis pod to create clear, stable endpoints.
  The application creates independent connections to each Service for the Redlock cluster.


apiVersion: v1
kind: Service
metadata:
  name: redis-0
spec:
  selector:
    app: redis-cluster
    statefulset.kubernetes.io/pod-name: redis-cluster-0
  ports:
    - port: 6379
      targetPort: 6379

---
apiVersion: v1
kind: Service
metadata:
  name: redis-1
spec:
  selector:
    app: redis-cluster
    statefulset.kubernetes.io/pod-name: redis-cluster-1
  ports:
    - port: 6379
      targetPort: 6379

---
apiVersion: v1
kind: Service
metadata:
  name: redis-2
spec:
  selector:
    app: redis-cluster
    statefulset.kubernetes.io/pod-name: redis-cluster-2
  ports:
    - port: 6379
      targetPort: 6379




Method 2 — Pod anti-affinity


  Enforce spread policies to avoid co-scheduling on the same node/rack.
  Maximize independence across failure domains (node/power/network/storage).


apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: redis-cluster
spec:
  template:
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchExpressions:
              - key: app
                operator: In
                values:
                - redis-cluster
            topologyKey: kubernetes.io/hostname




Method 3 — DNS-based dynamic discovery


  Periodically resolve headless endpoints to refresh the connection pool dynamically.
  Tune connection/retry/timeout policies conservatively for Redlock assumptions.


const dns = require(&apos;dns&apos;).promises;

async function getRedisInstances() {
  const addresses = await dns.lookup(&apos;redis-service&apos;, { all: true });
  return addresses.map(addr =&amp;gt; ({
    host: addr.address,
    port: 6379
  }));
}

async function createRedlock() {
  const instances = await getRedisInstances();
  return new Redlock(instances.map(config =&amp;gt; new Redis(config)));
}




Real-world Implementation Patterns (No code)



Application layer (e.g., Node.js, Java)


  Use the same lock key across at least three independent Redis instances to achieve majority consensus.
  Maintain separate event/error handlers per connection and observe connection health independently.
  Configure Redlock client retry counts/delays/jitter and drift factors explicitly.


Node

const Redis = require(&apos;ioredis&apos;);
const Redlock = require(&apos;redlock&apos;);

class RedlockService {
  constructor() {
    // Connections using per-pod Services
    this.redisClients = [
      new Redis({
        host: &apos;redis-0.default.svc.cluster.local&apos;,
        port: 6379,
        retryDelayOnFailover: 100,
        maxRetriesPerRequest: 3
      }),
      new Redis({
        host: &apos;redis-1.default.svc.cluster.local&apos;,
        port: 6379,
        retryDelayOnFailover: 100,
        maxRetriesPerRequest: 3
      }),
      new Redis({
        host: &apos;redis-2.default.svc.cluster.local&apos;,
        port: 6379,
        retryDelayOnFailover: 100,
        maxRetriesPerRequest: 3
      })
    ];

    this.redlock = new Redlock(this.redisClients, {
      retryCount: 3,
      retryDelay: 200,
      retryJitter: 200,
      driftFactor: 0.01,
      clockDriftMs: 2
    });

    this.setupEventHandlers();
  }

  setupEventHandlers() {
    this.redisClients.forEach((client, index) =&amp;gt; {
      client.on(&apos;connect&apos;, () =&amp;gt; {
        console.log(`Redis-${index} connected`);
      });
      
      client.on(&apos;error&apos;, (err) =&amp;gt; {
        console.error(`Redis-${index} error:`, err.message);
      });
    });

    this.redlock.on(&apos;clientError&apos;, (err) =&amp;gt; {
      console.error(&apos;Redlock client error:&apos;, err);
    });
  }

  async acquireLock(resource, ttl = 10000) {
    try {
      console.log(`Attempting to acquire lock: ${resource}`);
      const lock = await this.redlock.acquire([resource], ttl);
      console.log(`Lock acquired: ${resource}`);
      return lock;
    } catch (error) {
      console.error(`Failed to acquire lock: ${resource}`, error.message);
      throw error;
    }
  }

  async releaseLock(lock) {
    try {
      await lock.release();
      console.log(`Lock released: ${lock.resources}`);
    } catch (error) {
      console.error(`Failed to release lock:`, error.message);
      throw error;
    }
  }
}

// Usage example
async function criticalSection() {
  const redlockService = new RedlockService();
  
  try {
    const lock = await redlockService.acquireLock(&apos;user-action-123&apos;, 15000);
    
    try {
      // Work performed in critical section
      console.log(&apos;Performing critical work...&apos;);
      await performCriticalOperation();
      console.log(&apos;Work completed&apos;);
    } finally {
      await redlockService.releaseLock(lock);
    }
  } catch (error) {
    console.error(&apos;Work failed:&apos;, error.message);
  }
}


Java (Redisson)
import org.redisson.Redisson;
import org.redisson.api.RLock;
import org.redisson.api.RedissonClient;
import org.redisson.config.Config;

@Service
public class RedlockService {
    
    private final RedissonClient redissonClient;
    
    public RedlockService() {
        Config config = new Config();
        config.useReplicatedServers()
            .addNodeAddress(&quot;redis://redis-0.default.svc.cluster.local:6379&quot;)
            .addNodeAddress(&quot;redis://redis-1.default.svc.cluster.local:6379&quot;)
            .addNodeAddress(&quot;redis://redis-2.default.svc.cluster.local:6379&quot;);
        
        this.redissonClient = Redisson.create(config);
    }
    
    public boolean executeWithLock(String lockName, int ttlSeconds, Runnable task) {
        RLock lock = redissonClient.getLock(lockName);
        
        try {
            if (lock.tryLock(10, ttlSeconds, TimeUnit.SECONDS)) {
                try {
                    log.info(&quot;Lock acquired: {}&quot;, lockName);
                    task.run();
                    return true;
                } finally {
                    lock.unlock();
                    log.info(&quot;Lock released: {}&quot;, lockName);
                }
            } else {
                log.warn(&quot;Failed to acquire lock: {}&quot;, lockName);
                return false;
            }
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
            log.error(&quot;Interrupted while acquiring lock: {}&quot;, lockName, e);
            return false;
        }
    }
}




Lock lifecycle


  Set TTL to 2–3× expected work time (including buffer).
  For long-running work, include lock extend/refresh and define rollback/retry on failure.
  Release locks only after verifying the ownership token (avoid cross-release).




Operations Checklist



1) Clock synchronization


  Enable NTP/Chrony on all nodes and build a drift monitoring dashboard.


# Check NTP synchronization state
chrony sources -v

# Reduce clock drift
echo &quot;server time.google.com iburst&quot; &amp;gt;&amp;gt; /etc/chrony.conf
systemctl restart chronyd




2) TTL/timeout policies


  Keep connection/command timeouts low; use short, shallow retries for fast failure.
  Derive TTLs from workload profiling, including peak scenarios.


const expectedWorkTime = 5000;  // 5 seconds
const safetyMargin = 2;
const ttl = expectedWorkTime * safetyMargin;  // 10 seconds




3) Observability


  Collect and alert on the following metrics:



  
    
      Metric
      Purpose
    
    
      redlock_acquire_success_total
      Lock acquisition success trend
    
    
      redlock_acquire_failure_total
      Diagnose lock acquisition failures
    
    
      redlock_acquire_duration_seconds
      Distribution of acquisition latency
    
    
      redlock_validity_time_remaining
      Observe remaining validity time
    
    
      redis_connection_failures_total
      Per-instance connection stability
    
  




4) Failure scenarios


  Provide safe abort/rollback paths when lock extension fails.
  After partial success/failure, release on all instances to restore consistency.
  Rehearse network partitions, node failures, and clock skew scenarios in advance.




Alternatives and Comparison



vs. Database-based locking


  
    
      Aspect
      Redlock
      Database Lock
    
    
      Performance
      Very fast
      Relatively slower
    
    
      Complexity
      Medium
      Simple
    
    
      Consistency
      Eventual
      Strong (transactional)
    
    
      Failure recovery
      Automatic TTL expiry
      Manual/transactional release
    
  




vs. Consul/etcd-based locking


  
    
      Aspect
      Redlock
      Consul/etcd
    
    
      Infrastructure complexity
      Low
      High
    
    
      Performance
      Very fast
      Fast
    
    
      Consensus
      Majority vote
      Raft
    
    
      Ecosystem
      Redis-centric
      Microservices/Orchestration
    
  




When to Use Redlock



Well-suited for


  Real-time systems where very low latency and high throughput matter
  Teams that already operate Redis with low operational overhead
  Simple lock semantics (acquire/extend/release) without stringent consensus requirements




Avoid when


  Domains requiring strict strong consistency (e.g., finance)
  Environments with frequent partitions or poor time synchronization
  Workloads where consensus correctness is paramount (prefer Raft-based approaches)




Conclusion: Safe Redlock on Kubernetes

Redlock is elegant, but correct implementation is everything.

On Kubernetes, a StatefulSet alone is insufficient — you need independent access paths to each Redis instance and separation of failure domains.

Combine that with clock sync, TTL/timeout discipline, observability, and failure drills to achieve operational reliability. Redlock is not a universal answer; depending on requirements, DB- or Consul/etcd-based locking may be a better fit.





References


  Redis Redlock official documentation
  Martin Kleppmann’s critique of Redlock
  Kubernetes StatefulSet guide
  Redis clustering best practices
  Kubernetes Storage Concepts


",
            "wordcount": "2556",
            "inLanguage": "en",
            "dateCreated": "2025-11-05/",
            "datePublished": "2025-11-05/",
            "dateModified": "2025-11-05/",
            "author": {
                "@type": "Person",
                "name": "Somaz",
                
                "image": "/assets/img/uploads/profile.png",
                
                "jobTitle": "DevOps Engineer",
                "url": "https://somaz.blog/authors/somaz/",
                "sameAs": [
                    "https://github.com/somaz94","https://www.linkedin.com/in/somaz"
                ]
            },
            "publisher": {
                "@type": "Organization",
                "name": "somaz",
                "url": "https://somaz.blog/",
                "logo": {
                    "@type": "ImageObject",
                    "url": "https://somaz.blog/assets/img/blog-image.png",
                    "width": "600",
                    "height": "315"
                }
            },
            "mainEntityOfPage": "True",
            "genre": "KUBERNETES",
            "articleSection": "KUBERNETES",
            "keywords": ["kubernetes","redis","redlock","distributed-lock","statefulset","reliability","csi"]
        }
        </script>
    </body>
</html>
