<!DOCTYPE html>
<html lang="en" class="no-js">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    

    
    

    
    

    
    

    <!-- ✅ Google Tag Manager 추가 -->
    <script>
        (function(w,d,s,l,i){
            w[l]=w[l]||[];
            w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
            var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
            j.async=true;
            j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
            f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-MBP83N4Q');
    </script>
      <!-- ✅ End Google Tag Manager -->

    <!-- Mermaid.js 직접 로드 -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>

    <title>Creating Kubernetes Operators with Kubebuilder | somaz</title>
    <meta name="description" content="A practical guide to building Kubernetes Operators using Kubebuilder framework">
    
        <meta name="keywords" content="kubernetes, operator, kubebuilder, development">
    

    <!-- Social: Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Creating Kubernetes Operators with Kubebuilder | somaz">
    <meta name="twitter:description" content="A practical guide to building Kubernetes Operators using Kubebuilder framework">

    
        <meta property="twitter:image" content="https://res.cloudinary.com/dkcm26aem/image/upload/v1737356533/kubernetes-operator-kubebuilder_r8hvo4.png">
    
    
    
        <meta name="twitter:site" content="@twitter_username">
    

    <!-- Social: Facebook / Open Graph -->
    <meta property="og:url" content="https://somaz94.github.io/category/kubernetes/k8s-operator-kubebuilder/">
    <meta property="og:title" content="Creating Kubernetes Operators with Kubebuilder | somaz">
    <meta property="og:image" content="https://res.cloudinary.com/dkcm26aem/image/upload/v1737356533/kubernetes-operator-kubebuilder_r8hvo4.png">
    <meta property="og:description" content="A practical guide to building Kubernetes Operators using Kubebuilder framework">
    <meta property="og:site_name" content="Somaz Tech Blog">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/assets/img/icons/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/img/icons/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/img/icons/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/img/icons/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/img/icons/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/img/icons/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/img/icons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/icons/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/img/icons/apple-touch-icon-152x152.png" />

    <!-- Windows 8 Tile Icons -->
    <meta name="application-name" content="somaz">
    <meta name="msapplication-TileColor" content="#141414">
    <meta name="msapplication-square70x70logo" content="smalltile.png" />
    <meta name="msapplication-square150x150logo" content="mediumtile.png" />
    <meta name="msapplication-wide310x150logo" content="widetile.png" />
    <meta name="msapplication-square310x310logo" content="largetile.png" />
    
    <!-- Android Lolipop Theme Color -->
    <meta name="theme-color" content="#141414">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Titillium+Web:300,400,700" rel="stylesheet">

    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="canonical" href="https://somaz94.github.io/category/kubernetes/k8s-operator-kubebuilder/">
    <link rel="alternate" type="application/rss+xml" title="Somaz Tech Blog" href="https://somaz94.github.io/feed.xml" />

    <!-- Include extra styles -->
    

    <!-- JavaScript enabled/disabled -->
    <script>
        document.querySelector('html').classList.remove('no-js');
    </script>

    <!-- Google Adsense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8725590811736154"
        crossorigin="anonymous"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"> -->
    <!-- <link href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/variable/woff2/SUIT-Variable.css" rel="stylesheet"> -->
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- <link href="https://fonts.googleapis.com/css2?family=Albert+Sans:wght@400;500;700&display=swap" rel="stylesheet"> -->

    <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml" />

</head>
<!-- ✅ Google Tag Manager (noscript) -->
<noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MBP83N4Q"
            height="0" width="0" style="display:none;visibility:hidden">
    </iframe>
</noscript>
<!-- ✅ End Google Tag Manager (noscript) -->
    <body class="has-push-menu">
        





        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" display="none" version="1.1"><defs><symbol id="icon-menu" viewBox="0 0 1024 1024"><path class="path1" d="M128 213.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 725.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 469.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5z"/></symbol><symbol id="icon-search" viewBox="0 0 951 1024"><path class="path1" d="M658.286 475.429q0-105.714-75.143-180.857t-180.857-75.143-180.857 75.143-75.143 180.857 75.143 180.857 180.857 75.143 180.857-75.143 75.143-180.857zM950.857 950.857q0 29.714-21.714 51.429t-51.429 21.714q-30.857 0-51.429-21.714l-196-195.429q-102.286 70.857-228 70.857-81.714 0-156.286-31.714t-128.571-85.714-85.714-128.571-31.714-156.286 31.714-156.286 85.714-128.571 128.571-85.714 156.286-31.714 156.286 31.714 128.571 85.714 85.714 128.571 31.714 156.286q0 125.714-70.857 228l196 196q21.143 21.143 21.143 51.429z"/></symbol><symbol id="icon-close" viewBox="0 0 1000 1000"><path d="M969.8,870.3c27,27.7,27,71.8,0,99.1C955.7,983,937.9,990,920,990c-17.9,0-35.7-7-49.7-20.7L500,599L129.6,969.4C115.6,983,97.8,990,79.9,990s-35.7-7-49.7-20.7c-27-27.3-27-71.4,0-99.1L400.9,500L30.3,129.3c-27-27.3-27-71.4,0-99.1c27.3-27,71.8-27,99.4,0L500,400.9L870.4,30.2c27.7-27,71.8-27,99.4,0c27,27.7,27,71.8,0,99.1L599.1,500L969.8,870.3z"/></symbol><symbol id="icon-twitter" viewBox="0 0 951 1024"><path class="path1" d="M925.714 233.143q-38.286 56-92.571 95.429 0.571 8 0.571 24 0 74.286-21.714 148.286t-66 142-105.429 120.286-147.429 83.429-184.571 31.143q-154.857 0-283.429-82.857 20 2.286 44.571 2.286 128.571 0 229.143-78.857-60-1.143-107.429-36.857t-65.143-91.143q18.857 2.857 34.857 2.857 24.571 0 48.571-6.286-64-13.143-106-63.714t-42-117.429v-2.286q38.857 21.714 83.429 23.429-37.714-25.143-60-65.714t-22.286-88q0-50.286 25.143-93.143 69.143 85.143 168.286 136.286t212.286 56.857q-4.571-21.714-4.571-42.286 0-76.571 54-130.571t130.571-54q80 0 134.857 58.286 62.286-12 117.143-44.571-21.143 65.714-81.143 101.714 53.143-5.714 106.286-28.571z"/></symbol><symbol id="icon-facebook" viewBox="0 0 585 1024"><path class="path1" d="M548 6.857v150.857h-89.714q-49.143 0-66.286 20.571t-17.143 61.714v108h167.429l-22.286 169.143h-145.143v433.714h-174.857v-433.714h-145.714v-169.143h145.714v-124.571q0-106.286 59.429-164.857t158.286-58.571q84 0 130.286 6.857z"/></symbol><symbol id="icon-clock" viewBox="0 0 1000 1000"><path d="M500,10C229.8,10,10,229.8,10,500c0,270.2,219.8,490,490,490c270.2,0,490-219.8,490-490C990,229.8,770.2,10,500,10z M500,910.2c-226.2,0-410.2-184-410.2-410.2c0-226.2,184-410.2,410.2-410.2c226.2,0,410.2,184,410.2,410.2C910.2,726.1,726.2,910.2,500,910.2z M753.1,374c8.2,11.9,5.2,28.1-6.6,36.3L509.9,573.7c-4.4,3.1-9.6,4.6-14.8,4.6c-4.1,0-8.3-1-12.1-3c-8.6-4.5-14-13.4-14-23.1V202.5c0-14.4,11.7-26.1,26.1-26.1c14.4,0,26.1,11.7,26.1,26.1v300l195.6-135.1C728.7,359.2,744.9,362.1,753.1,374z"/></symbol><symbol id="icon-calendar" viewBox="0 0 1000 1000"><path d="M920,500v420H80V500H920 M990,430H10v490c0,38.7,31.3,70,70,70h840c38.7,0,70-31.3,70-70V430L990,430z"/><path d="M850,80v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80H360v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80C72.8,80,10,142.7,10,220v140h980V220C990,142.7,927.2,80,850,80z"/><path d="M255,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C290,25.8,274.3,10,255,10z"/><path d="M745,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C780,25.8,764.3,10,745,10z"/></symbol><symbol id="icon-github" viewBox="0 0 12 14"><path d="M6 1q1.633 0 3.012 0.805t2.184 2.184 0.805 3.012q0 1.961-1.145 3.527t-2.957 2.168q-0.211 0.039-0.312-0.055t-0.102-0.234q0-0.023 0.004-0.598t0.004-1.051q0-0.758-0.406-1.109 0.445-0.047 0.801-0.141t0.734-0.305 0.633-0.52 0.414-0.82 0.16-1.176q0-0.93-0.617-1.609 0.289-0.711-0.062-1.594-0.219-0.070-0.633 0.086t-0.719 0.344l-0.297 0.187q-0.727-0.203-1.5-0.203t-1.5 0.203q-0.125-0.086-0.332-0.211t-0.652-0.301-0.664-0.105q-0.352 0.883-0.062 1.594-0.617 0.68-0.617 1.609 0 0.664 0.16 1.172t0.41 0.82 0.629 0.523 0.734 0.305 0.801 0.141q-0.305 0.281-0.383 0.805-0.164 0.078-0.352 0.117t-0.445 0.039-0.512-0.168-0.434-0.488q-0.148-0.25-0.379-0.406t-0.387-0.187l-0.156-0.023q-0.164 0-0.227 0.035t-0.039 0.090 0.070 0.109 0.102 0.094l0.055 0.039q0.172 0.078 0.34 0.297t0.246 0.398l0.078 0.18q0.102 0.297 0.344 0.48t0.523 0.234 0.543 0.055 0.434-0.027l0.18-0.031q0 0.297 0.004 0.691t0.004 0.426q0 0.141-0.102 0.234t-0.312 0.055q-1.812-0.602-2.957-2.168t-1.145-3.527q0-1.633 0.805-3.012t2.184-2.184 3.012-0.805zM2.273 9.617q0.023-0.055-0.055-0.094-0.078-0.023-0.102 0.016-0.023 0.055 0.055 0.094 0.070 0.047 0.102-0.016zM2.516 9.883q0.055-0.039-0.016-0.125-0.078-0.070-0.125-0.023-0.055 0.039 0.016 0.125 0.078 0.078 0.125 0.023zM2.75 10.234q0.070-0.055 0-0.148-0.062-0.102-0.133-0.047-0.070 0.039 0 0.141t0.133 0.055zM3.078 10.562q0.062-0.062-0.031-0.148-0.094-0.094-0.156-0.023-0.070 0.062 0.031 0.148 0.094 0.094 0.156 0.023zM3.523 10.758q0.023-0.086-0.102-0.125-0.117-0.031-0.148 0.055t0.102 0.117q0.117 0.047 0.148-0.047zM4.016 10.797q0-0.102-0.133-0.086-0.125 0-0.125 0.086 0 0.102 0.133 0.086 0.125 0 0.125-0.086zM4.469 10.719q-0.016-0.086-0.141-0.070-0.125 0.023-0.109 0.117t0.141 0.062 0.109-0.109z"></path></symbol><symbol id="icon-medium" viewBox="0 0 1000 1000"><path d="M336.5,240.2v641.5c0,9.1-2.3,16.9-6.8,23.2s-11.2,9.6-20,9.6c-6.2,0-12.2-1.5-18-4.4L37.3,782.7c-7.7-3.6-14.1-9.8-19.4-18.3S10,747.4,10,739V115.5c0-7.3,1.8-13.5,5.5-18.6c3.6-5.1,8.9-7.7,15.9-7.7c5.1,0,13.1,2.7,24.1,8.2l279.5,140C335.9,238.6,336.5,239.5,336.5,240.2L336.5,240.2z M371.5,295.5l292,473.6l-292-145.5V295.5z M990,305.3v576.4c0,9.1-2.6,16.5-7.7,22.1c-5.1,5.7-12,8.5-20.8,8.5s-17.3-2.4-25.7-7.1L694.7,784.9L990,305.3z M988.4,239.7c0,1.1-46.8,77.6-140.3,229.4C754.6,621,699.8,709.8,683.8,735.7L470.5,389l177.2-288.2c6.2-10.2,15.7-15.3,28.4-15.3c5.1,0,9.8,1.1,14.2,3.3l295.9,147.7C987.6,237.1,988.4,238.2,988.4,239.7L988.4,239.7z"/></symbol><symbol id="icon-instagram" viewBox="0 0 489.84 489.84"><path d="M249.62,50.46c65.4,0,73.14.25,99,1.43C372.47,53,385.44,57,394.07,60.32a75.88,75.88,0,0,1,28.16,18.32,75.88,75.88,0,0,1,18.32,28.16c3.35,8.63,7.34,21.6,8.43,45.48,1.18,25.83,1.43,33.57,1.43,99s-0.25,73.14-1.43,99c-1.09,23.88-5.08,36.85-8.43,45.48a81.11,81.11,0,0,1-46.48,46.48c-8.63,3.35-21.6,7.34-45.48,8.43-25.82,1.18-33.57,1.43-99,1.43s-73.15-.25-99-1.43c-23.88-1.09-36.85-5.08-45.48-8.43A75.88,75.88,0,0,1,77,423.86,75.88,75.88,0,0,1,58.69,395.7c-3.35-8.63-7.34-21.6-8.43-45.48-1.18-25.83-1.43-33.57-1.43-99s0.25-73.14,1.43-99c1.09-23.88,5.08-36.85,8.43-45.48A75.88,75.88,0,0,1,77,78.64a75.88,75.88,0,0,1,28.16-18.32c8.63-3.35,21.6-7.34,45.48-8.43,25.83-1.18,33.57-1.43,99-1.43m0-44.13c-66.52,0-74.86.28-101,1.47s-43.87,5.33-59.45,11.38A120.06,120.06,0,0,0,45.81,47.44,120.06,120.06,0,0,0,17.56,90.82C11.5,106.4,7.36,124.2,6.17,150.27s-1.47,34.46-1.47,101,0.28,74.86,1.47,101,5.33,43.87,11.38,59.45a120.06,120.06,0,0,0,28.25,43.38,120.06,120.06,0,0,0,43.38,28.25c15.58,6.05,33.38,10.19,59.45,11.38s34.46,1.47,101,1.47,74.86-.28,101-1.47,43.87-5.33,59.45-11.38a125.24,125.24,0,0,0,71.63-71.63c6.05-15.58,10.19-33.38,11.38-59.45s1.47-34.46,1.47-101-0.28-74.86-1.47-101-5.33-43.87-11.38-59.45a120.06,120.06,0,0,0-28.25-43.38,120.06,120.06,0,0,0-43.38-28.25C394.47,13.13,376.67,9,350.6,7.8s-34.46-1.47-101-1.47h0Z" transform="translate(-4.7 -6.33)" /><path d="M249.62,125.48A125.77,125.77,0,1,0,375.39,251.25,125.77,125.77,0,0,0,249.62,125.48Zm0,207.41a81.64,81.64,0,1,1,81.64-81.64A81.64,81.64,0,0,1,249.62,332.89Z" transform="translate(-4.7 -6.33)"/><circle cx="375.66" cy="114.18" r="29.39" /></symbol><symbol id="icon-linkedin" viewBox="0 0 12 14"><path d="M2.727 4.883v7.742h-2.578v-7.742h2.578zM2.891 2.492q0.008 0.57-0.395 0.953t-1.059 0.383h-0.016q-0.641 0-1.031-0.383t-0.391-0.953q0-0.578 0.402-0.957t1.051-0.379 1.039 0.379 0.398 0.957zM12 8.187v4.437h-2.57v-4.141q0-0.82-0.316-1.285t-0.988-0.465q-0.492 0-0.824 0.27t-0.496 0.668q-0.086 0.234-0.086 0.633v4.32h-2.57q0.016-3.117 0.016-5.055t-0.008-2.313l-0.008-0.375h2.57v1.125h-0.016q0.156-0.25 0.32-0.438t0.441-0.406 0.68-0.34 0.895-0.121q1.336 0 2.148 0.887t0.813 2.598z"></path></symbol><symbol id="icon-heart" viewBox="0 0 34 30"><path d="M17,29.7 L16.4,29.2 C3.5,18.7 0,15 0,9 C0,4 4,0 9,0 C13.1,0 15.4,2.3 17,4.1 C18.6,2.3 20.9,0 25,0 C30,0 34,4 34,9 C34,15 30.5,18.7 17.6,29.2 L17,29.7 Z M9,2 C5.1,2 2,5.1 2,9 C2,14.1 5.2,17.5 17,27.1 C28.8,17.5 32,14.1 32,9 C32,5.1 28.9,2 25,2 C21.5,2 19.6,4.1 18.1,5.8 L17,7.1 L15.9,5.8 C14.4,4.1 12.5,2 9,2 Z" id="Shape"></path></symbol><symbol id="icon-arrow-right" viewBox="0 0 25.452 25.452"><path d="M4.471,24.929v-2.004l12.409-9.788c0.122-0.101,0.195-0.251,0.195-0.411c0-0.156-0.073-0.31-0.195-0.409L4.471,2.526V0.522c0-0.2,0.115-0.384,0.293-0.469c0.18-0.087,0.396-0.066,0.552,0.061l15.47,12.202c0.123,0.1,0.195,0.253,0.195,0.409c0,0.16-0.072,0.311-0.195,0.411L5.316,25.34c-0.155,0.125-0.372,0.147-0.552,0.061C4.586,25.315,4.471,25.13,4.471,24.929z"/></symbol><symbol id="icon-star" viewBox="0 0 48 48"><path fill="currentColor" d="M44,24c0,11.045-8.955,20-20,20S4,35.045,4,24S12.955,4,24,4S44,12.955,44,24z"/><path fill="#ffffff" d="M24,11l3.898,7.898l8.703,1.301l-6.301,6.102l1.5,8.699L24,30.898L16.199,35l1.5-8.699l-6.301-6.102  l8.703-1.301L24,11z"/></symbol><symbol id="icon-read" viewBox="0 0 32 32"><path fill="currentColor" d="M29,4H3C1.343,4,0,5.343,0,7v18c0,1.657,1.343,3,3,3h10c0,0.552,0.448,1,1,1h4c0.552,0,1-0.448,1-1h10  c1.657,0,3-1.343,3-3V7C32,5.343,30.657,4,29,4z M29,5v20H18.708c-0.618,0-1.236,0.146-1.789,0.422l-0.419,0.21V5H29z M15.5,5  v20.632l-0.419-0.21C14.528,25.146,13.91,25,13.292,25H3V5H15.5z M31,25c0,1.103-0.897,2-2,2H18v1h-4v-1H3c-1.103,0-2-0.897-2-2V7  c0-0.737,0.405-1.375,1-1.722V25c0,0.552,0.448,1,1,1h10.292c0.466,0,0.925,0.108,1.342,0.317l0.919,0.46  c0.141,0.07,0.294,0.106,0.447,0.106c0.153,0,0.306-0.035,0.447-0.106l0.919-0.46C17.783,26.108,18.242,26,18.708,26H29  c0.552,0,1-0.448,1-1V5.278C30.595,5.625,31,6.263,31,7V25z M6,12.5C6,12.224,6.224,12,6.5,12h5c0.276,0,0.5,0.224,0.5,0.5  S11.776,13,11.5,13h-5C6.224,13,6,12.776,6,12.5z M6,14.5C6,14.224,6.224,14,6.5,14h5c0.276,0,0.5,0.224,0.5,0.5S11.776,15,11.5,15  h-5C6.224,15,6,14.776,6,14.5z M6,16.5C6,16.224,6.224,16,6.5,16h5c0.276,0,0.5,0.224,0.5,0.5S11.776,17,11.5,17h-5  C6.224,17,6,16.776,6,16.5z M20,12.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,13,25.5,13h-5  C20.224,13,20,12.776,20,12.5z M20,14.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,15,25.5,15h-5  C20.224,15,20,14.776,20,14.5z M20,16.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,17,25.5,17h-5  C20.224,17,20,16.776,20,16.5z"></path></symbol><symbol id="icon-tistory" viewBox="0 0 24 24"><path d="M4 4h16v3h-6v13h-4V7H4V4z"/></symbol></defs></svg>

        <header class="bar-header">
    <a id="menu" role="button">
        <svg id="open" class="icon-menu"><use xlink:href="#icon-menu"></use></svg>
    </a>
    <h1 class="logo">
        <a href="/">
            
                somaz <span class="version">v3.1.2</span>
            
        </a>
    </h1>
    <a id="search" class="dosearch" role="button">
        <svg class="icon-search"><use xlink:href="#icon-search"></use></svg>
    </a>
    
        <a href="https://github.com/thiagorossener/jekflix-template" class="get-theme" role="button">
            Get this theme!
        </a>
    
</header>

<div id="mask" class="overlay"></div>

<aside class="sidebar" id="sidebar">
    <nav id="navigation">
      <h2>Menu</h2>
      <ul>
  
    
      <li>
        <a href="https://somaz94.github.io/">Home</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz94.github.io/about">About</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz94.github.io/category">Category</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz94.github.io/contact">Contact</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz94.github.io/feed.xml">Feed</a>
      </li>
    
  
</ul>

    </nav>
</aside>

<div class="search-wrapper">
    <div class="search-form">
        <input type="text" class="search-field" placeholder="Search">
        <svg class="icon-remove-sign"><use xlink:href="#icon-close"></use></svg>
        <ul class="search-results search-list"></ul>
    </div>
</div>



        <section class="post two-columns">
            <article role="article" class="post-content">
                <p class="post-info">
                    
                        <svg class="icon-calendar" id="date"><use xlink:href="#icon-calendar"></use></svg>
                        <time class="date" datetime="2025-01-14T09:00:00+00:00">
                            


January 14, 2025

                        </time>
                    
                    <svg id="clock" class="icon-clock"><use xlink:href="#icon-clock"></use></svg>
                    <span>9 min to read</span>
                </p>
                <h1 class="post-title">Creating Kubernetes Operators with Kubebuilder</h1>
                <p class="post-subtitle"></p>

                
                    <img src="https://res.cloudinary.com/dkcm26aem/image/upload/v1737356533/kubernetes-operator-kubebuilder_r8hvo4.png" alt="Featured image" class="post-cover">
                

                <!-- Pagination links -->



                <!-- Add your table of contents here -->


                <ul>
  <li><a href="https://github.com/somaz94/helios-lb/">image reference link</a></li>
</ul>

<p><br /></p>

<hr />

<h2 id="-overview">🎯 Overview</h2>
<p>Learn how to create Kubernetes Operators using Kubebuilder, a powerful framework for building custom controllers and APIs.</p>

<p><br /></p>

<h3 id="what-is-kubebuilder">what is kubebuilder?</h3>

<p>Kubebuilder is an SDK for developing Kubernetes Operator. It is a framework that makes it easy to develop CRD and controllers using the Go language.</p>

<p>It simplifies the development of custom controllers and APIs by providing scaffolding, code generation, and integration with Kubernetes tools.</p>

<p>Kubernetes Operator is a custom controller that manages custom resources (CRD) and automates application deployment, expansion, and management.</p>

<h4 id="why-do-i-use-kubbuilder">Why do I use Kubbuilder?</h4>

<ul>
  <li>Code generation: Automatically generates commercial sphere code for CRD and controller.</li>
  <li>Standards-based: built on a controller-runtime library that complies with Kubernetes API patterns.</li>
  <li>Scaffolding: Provides the structure of the project, including configuration files, Dockerfile, and Makefile.</li>
  <li>Testing: supports integration with test tools such as ‘envtest’ for Kubernetes.</li>
  <li>Scalability: You can easily expand and customize the controller to suit your specific needs.</li>
</ul>

<p><br /></p>

<h3 id="-getting-started-with-kubebuilder">🛠 Getting Started with Kubebuilder</h3>

<h4 id="installation">Installation</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Install Kubebuilder</span>
brew <span class="nb">install </span>kubebuilder

<span class="c"># Initialize project</span>
kubebuilder init <span class="nt">--domain</span> example.com <span class="nt">--repo</span> github.com/username/project

<span class="c"># Create API</span>
kubebuilder create api <span class="nt">--group</span> apps <span class="nt">--version</span> v1 <span class="nt">--kind</span> MyApp
</code></pre></div></div>
<ul>
  <li>-domain: Specify API domain (for example, example.com)</li>
  <li>–repo: Set the Go module path for the project</li>
  <li>-group: API group (for example, apps).</li>
  <li>–version: API version (e.g., v1).</li>
  <li>–kind: The name of the user-defined resource, for example, MyApp.</li>
  <li>Define CRD in config/crd/</li>
  <li>API and controller files for api/ and controllers/</li>
</ul>

<h4 id="project-structure">Project Structure</h4>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.
├── api
│   └── v1
├── bin
├── cmd
├── config
│   ├── crd
│   ├── default
│   ├── manager
│   ├── network-policy
│   ├── prometheus
│   ├── rbac
│   └── samples
├── hack
├── internal
│   └── controller
└── test
    ├── e2e
    └── utils
</code></pre></div></div>

<p><br /></p>

<h3 id="-development-workflow">🔄 Development Workflow</h3>

<table class="table-modern">
  <tr>
    <th>Step</th>
    <th>Commands</th>
    <th>Description</th>
  </tr>
  <tr>
    <td>Generate</td>
    <td><code>make generate</code></td>
    <td>Generate code for custom resources</td>
  </tr>
  <tr>
    <td>Manifests</td>
    <td><code>make manifests</code></td>
    <td>Generate CRD manifests</td>
  </tr>
  <tr>
    <td>Test</td>
    <td><code>make test</code></td>
    <td>Run unit tests</td>
  </tr>
  <tr>
    <td>Build</td>
    <td><code>make docker-buildx</code></td>
    <td>Build multi-platform images</td>
  </tr>
  <tr>
    <td>Deploy</td>
    <td><code>make deploy</code></td>
    <td>Deploy to cluster</td>
  </tr>
</table>

<p><br /></p>

<hr />

<h3 id="-create-operator-with-kubbuilder">🌟 Create Operator with Kubbuilder</h3>

<p>It’s the Kubernetes Operator I created.</p>
<ul>
  <li>https://github.com/somaz94/k8s-namespace-sync</li>
  <li>https://github.com/somaz94/helios-lb</li>
</ul>

<h4 id="prerequisites">Prerequisites</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Install kubebuilder</span>
brew <span class="nb">install </span>kubebuilder

<span class="c"># Create git repo and clone</span>
git clone git@github.com-somaz94:somaz94/k8s-namespace-sync.git

<span class="c"># Initialize kube builder project</span>
kubebuilder init <span class="nt">--domain</span> nsync.dev <span class="nt">--repo</span> github.com/somaz94/k8s-namespace-sync

<span class="c"># Create api</span>
kubebuilder create api <span class="nt">--group</span> <span class="nb">sync</span> <span class="nt">--version</span> v1 <span class="nt">--kind</span> NamespaceSync
</code></pre></div></div>

<h4 id="file-structure-explanation">File Structure Explanation</h4>

<p>The crd schema definition is done in the file below.</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">api/v1/namespacesync_types.go</code></li>
</ul>

<p>The main.go is defined in the path below.</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">cmd/main.go</code></li>
</ul>

<p>The controller defines it in that file. In addition to this file, I have organized files for various functions.</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">internal/controller/namespacesync_controller.go</code></li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls
</span>backup					filters.go				namespacesync_controller.go		namespacesync_controller_target_test.go	resources.go				sync.go
events.go				metrics.go				namespacesync_controller_filter_test.go	namespacesync_controller_test.go	suite_test.go				utils.go
</code></pre></div></div>

<p>You can also define the test code on the same path and test it using the make test command.
If you are curious about the details, please check the make file.</p>

<p>If you’re done implementing all the features, create a dockerhub account to upload after the image is built.</p>
<ul>
  <li>Create an Access Token on the Docker Hub website</li>
  <li>https://hub.docker.com/settings/security access</li>
  <li>“New Access Token” click</li>
  <li>Enter token name (e.g. “k8s-namespace-sync”)</li>
  <li>Copy once token is created (save this token well because it only shows once)</li>
</ul>

<p>Log in from the terminal.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker login <span class="nt">-u</span> somaz940
<span class="c"># Enter token</span>
</code></pre></div></div>
<ul>
  <li>Before proceeding with the make test, there is still something to explain.</li>
</ul>

<p><br /></p>

<h3 id="-kubebuilder-markers">📝 Kubebuilder Markers</h3>

<p>It is a kubbuilder marker that defines the schema and presentation method of the Kubernetes Custom Resource Definition (CRD).</p>

<p>If you check the <code class="language-plaintext highlighter-rouge">namespacesync_types.go</code> file, the marker is defined as below.</p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// +kubebuilder:object:root=true</span>
<span class="c">// +kubebuilder:subresource:status</span>
<span class="c">// +kubebuilder:printcolumn:name="Source",type="string",JSONPath=".spec.sourceNamespace"</span>
<span class="c">// +kubebuilder:printcolumn:name="Age",type="date",JSONPath=".metadata.creationTimestamp"</span>
<span class="c">// +kubebuilder:printcolumn:name="Status",type="string",JSONPath=".status.conditions[?(@.type=='Ready')].status"</span>
<span class="c">// +kubebuilder:printcolumn:name="Message",type="string",JSONPath=".status.conditions[?(@.type=='Ready')].message"</span>
</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">+kubebuilder:object:root=true</code>
    <ul>
      <li>This marker indicates that the resource is a root resource.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">+kubebuilder:subresource:status</code>
    <ul>
      <li>This marker indicates that the resource has a status subresource.</li>
      <li>It provides a separate endpoint for status updates.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">+kubebuilder:printcolumn:...</code>
    <ul>
      <li>This marker indicates that the resource has a print column.</li>
      <li>Defined columns
        <ul>
          <li>Source: Displaying <code class="language-plaintext highlighter-rouge">spec.sourceNamespace</code> value</li>
          <li>Age: Show creation time</li>
          <li>Status: Displaying Ready Condition Status</li>
          <li>Message: Displaying message in Ready condition</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>When using makemanifests</p>
<ul>
  <li>Controller-gen reads the markers in the Go code to create a CRD YAML file</li>
  <li>Create RBAC Permissions Configuration File</li>
  <li>Create deliverables in the config/crd/bases directory</li>
</ul>

<p>When using make generator</p>
<ul>
  <li>Create DeepCopy Method for Go Type</li>
  <li>Generating the type conversion code required for Kubernetes client code</li>
</ul>

<p><br /></p>

<p>If you check the makefile, it is defined as follows. After performing all necessary tasks, proceed to the test.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.PHONY: <span class="nb">test
test</span>: manifests generate <span class="nb">fmt </span>vet envtest <span class="c">## Run tests.</span>
	<span class="nv">KUBEBUILDER_ASSETS</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span>shell <span class="si">$(</span>ENVTEST<span class="si">)</span> use <span class="si">$(</span>ENVTEST_K8S_VERSION<span class="si">)</span> <span class="nt">--bin-dir</span> <span class="si">$(</span>LOCALBIN<span class="si">)</span> <span class="nt">-p</span> path<span class="si">)</span><span class="s2">"</span> go <span class="nb">test</span> <span class="nv">$$</span><span class="o">(</span>go list ./... | <span class="nb">grep</span> <span class="nt">-v</span> /e2e<span class="o">)</span> <span class="nt">-coverprofile</span> cover.out
</code></pre></div></div>

<p><br /></p>

<p>And you can specify IMG upload path and K8S test version in makefile.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Image URL to use all building/pushing image targets</span>
IMG ?<span class="o">=</span> somaz940/k8s-namespace-sync:v0.1.6
<span class="c"># ENVTEST_K8S_VERSION refers to the version of kubebuilder assets to be downloaded by envtest binary.</span>
ENVTEST_K8S_VERSION <span class="o">=</span> 1.31.0
</code></pre></div></div>

<p><br /></p>

<p>If the test is successful, make docker-buildx is used to build various platforms at the same time.</p>

<p>I modified the makefile so that it could be built into the late, versiontag, and late+ versiontag environments.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PLATFORMS ?<span class="o">=</span> linux/arm64,linux/amd64,linux/s390x,linux/ppc64le
.PHONY: docker-buildx-tag
docker-buildx-tag: <span class="c">## Build and push docker image for the manager for cross-platform support with specific version</span>
	<span class="c"># copy existing Dockerfile and insert --platform=${BUILDPLATFORM} into Dockerfile.cross</span>
	<span class="nb">sed</span> <span class="nt">-e</span> <span class="s1">'1 s/\\(^FROM\\)/FROM --platform=\\$$\\{BUILDPLATFORM\\}/; t'</span> <span class="nt">-e</span> <span class="s1">' 1,// s//FROM --platform=\\$$\\{BUILDPLATFORM\\}/'</span> Dockerfile <span class="o">&gt;</span> Dockerfile.cross
	- <span class="si">$(</span>CONTAINER_TOOL<span class="si">)</span> buildx create <span class="nt">--name</span> k8s-namespace-sync-builder
	<span class="si">$(</span>CONTAINER_TOOL<span class="si">)</span> buildx use k8s-namespace-sync-builder
	<span class="c"># Build and push version-specific tag</span>
	- <span class="si">$(</span>CONTAINER_TOOL<span class="si">)</span> buildx build <span class="nt">--push</span> <span class="nt">--platform</span><span class="o">=</span><span class="si">$(</span>PLATFORMS<span class="si">)</span> <span class="se">\\</span>
		<span class="nt">--tag</span> <span class="k">${</span><span class="nv">IMG</span><span class="k">}</span> <span class="se">\\</span>
		<span class="nt">-f</span> Dockerfile.cross <span class="nb">.</span>
	- <span class="si">$(</span>CONTAINER_TOOL<span class="si">)</span> buildx <span class="nb">rm </span>k8s-namespace-sync-builder
	<span class="nb">rm </span>Dockerfile.cross

.PHONY: docker-buildx-latest
docker-buildx-latest: <span class="c">## Build and push docker image for the manager for cross-platform support with latest tag</span>
	<span class="c"># copy existing Dockerfile and insert --platform=${BUILDPLATFORM} into Dockerfile.cross</span>
	<span class="nb">sed</span> <span class="nt">-e</span> <span class="s1">'1 s/\\(^FROM\\)/FROM --platform=\\$$\\{BUILDPLATFORM\\}/; t'</span> <span class="nt">-e</span> <span class="s1">' 1,// s//FROM --platform=\\$$\\{BUILDPLATFORM\\}/'</span> Dockerfile <span class="o">&gt;</span> Dockerfile.cross
	- <span class="si">$(</span>CONTAINER_TOOL<span class="si">)</span> buildx create <span class="nt">--name</span> k8s-namespace-sync-builder
	<span class="si">$(</span>CONTAINER_TOOL<span class="si">)</span> buildx use k8s-namespace-sync-builder
	<span class="c"># Build and push latest tag</span>
	- <span class="si">$(</span>CONTAINER_TOOL<span class="si">)</span> buildx build <span class="nt">--push</span> <span class="nt">--platform</span><span class="o">=</span><span class="si">$(</span>PLATFORMS<span class="si">)</span> <span class="se">\\</span>
		<span class="nt">--tag</span> <span class="si">$(</span>shell <span class="nb">echo</span> <span class="k">${</span><span class="nv">IMG</span><span class="k">}</span> | <span class="nb">cut</span> <span class="nt">-f1</span> <span class="nt">-d</span>:<span class="si">)</span>:latest <span class="se">\\</span>
		<span class="nt">-f</span> Dockerfile.cross <span class="nb">.</span>
	- <span class="si">$(</span>CONTAINER_TOOL<span class="si">)</span> buildx <span class="nb">rm </span>k8s-namespace-sync-builder
	<span class="nb">rm </span>Dockerfile.cross

.PHONY: docker-buildx
docker-buildx: <span class="c">## Build and push both version-specific and latest tags</span>
docker-buildx: docker-buildx-tag docker-buildx-latest
</code></pre></div></div>

<p><br /></p>

<p>If you want to deploy to the cluster, you can use the make deploy command.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make deploy <span class="nv">IMG</span><span class="o">=</span>somaz940/k8s-namespace-sync:v0.1.6
</code></pre></div></div>

<p><br /></p>

<p>Check api and crd.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>k get apiservices.apiregistration.k8s.io |grep nsync
v1.sync.nsync.dev                      Local                        True        25s

k get crd |grep nsync
namespacesyncs.sync.nsync.dev                2024-12-16T09:41:00Z
</code></pre></div></div>

<p><br /></p>

<p>I created various sample crd.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls </span>config/samples/
kustomization.yaml			sync_v1_namespacesync_exclude.yaml	sync_v1_namespacesync_target.yaml	test-configmap2.yaml			test-secret2.yaml
sync_v1_namespacesync.yaml		sync_v1_namespacesync_filter.yaml	test-configmap.yaml			test-secret.yaml
</code></pre></div></div>

<p><br /></p>

<p>The start log of the app is as follows.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2024-12-16T09:41:01.541Z        ESC[34minfoESC[0m       setup   creating controller     <span class="o">{</span><span class="s2">"controller"</span>: <span class="s2">"NamespaceSync"</span>, <span class="s2">"scheme"</span>: <span class="s2">"pkg/runtime/scheme.go:100"</span><span class="o">}</span>
2024-12-16T09:41:01.541Z        ESC[34minfoESC[0m       namespacesync-controller        Setting up controller manager
2024-12-16T09:41:01.545Z        ESC[34minfoESC[0m       setup   controller created successfully <span class="o">{</span><span class="s2">"controller"</span>: <span class="s2">"NamespaceSync"</span><span class="o">}</span>
2024-12-16T09:41:01.545Z        ESC[34minfoESC[0m       setup   starting manager
2024-12-16T09:41:01.545Z        ESC[34minfoESC[0m       controller-runtime.metrics      Starting metrics server
2024-12-16T09:41:01.545Z        ESC[34minfoESC[0m       setup   disabling http/2
2024-12-16T09:41:01.545Z        ESC[34minfoESC[0m       starting server <span class="o">{</span><span class="s2">"name"</span>: <span class="s2">"health probe"</span>, <span class="s2">"addr"</span>: <span class="s2">"[::]:8081"</span><span class="o">}</span>
I1216 09:41:01.645802       1 leaderelection.go:254] attempting to acquire leader lease k8s-namespace-sync-system/47c2149c.nsync.dev...
I1216 09:41:01.659829       1 leaderelection.go:268] successfully acquired lease k8s-namespace-sync-system/47c2149c.nsync.dev
2024-12-16T09:41:01.659Z        ESC[35mdebugESC[0m      manager.events  k8s-namespace-sync-controller-manager-5874b756c8-h9ng6_2a3d0c37-b1f0-46c3-bcff-e28ccc2750e9 became leader       <span class="o">{</span><span class="s2">"type"</span>: <span class="s2">"Normal"</span>, <span class="s2">"object"</span>: <span class="o">{</span><span class="s2">"kind"</span>:<span class="s2">"Lease"</span>,<span class="s2">"namespace"</span>:<span class="s2">"k8s-namespace-sync-system"</span>,<span class="s2">"name"</span>:<span class="s2">"47c21
49c.nsync.dev"</span>,<span class="s2">"uid"</span>:<span class="s2">"385be981-f090-4b4e-a341-7888c2858e4b"</span>,<span class="s2">"apiVersion"</span>:<span class="s2">"coordination.k8s.io/v1"</span>,<span class="s2">"resourceVersion"</span>:<span class="s2">"12611207"</span><span class="o">}</span>, <span class="s2">"reason"</span>: <span class="s2">"LeaderElection"</span><span class="o">}</span>
2024-12-16T09:41:01.660Z        ESC[34minfoESC[0m       manager Starting EventSource    <span class="o">{</span><span class="s2">"controller"</span>: <span class="s2">"namespacesync"</span>, <span class="s2">"controllerGroup"</span>: <span class="s2">"sync.nsync.dev"</span>, <span class="s2">"controllerKind"</span>: <span class="s2">"NamespaceSync"</span>, <span class="s2">"source"</span>: <span class="s2">"kind source: *v1.NamespaceSync"</span><span class="o">}</span>
2024-12-16T09:41:01.660Z        ESC[34minfoESC[0m       manager Starting EventSource    <span class="o">{</span><span class="s2">"controller"</span>: <span class="s2">"namespacesync"</span>, <span class="s2">"controllerGroup"</span>: <span class="s2">"sync.nsync.dev"</span>, <span class="s2">"controllerKind"</span>: <span class="s2">"NamespaceSync"</span>, <span class="s2">"source"</span>: <span class="s2">"kind source: *v1.Namespace"</span><span class="o">}</span>
2024-12-16T09:41:01.660Z        ESC[34minfoESC[0m       manager Starting EventSource    <span class="o">{</span><span class="s2">"controller"</span>: <span class="s2">"namespacesync"</span>, <span class="s2">"controllerGroup"</span>: <span class="s2">"sync.nsync.dev"</span>, <span class="s2">"controllerKind"</span>: <span class="s2">"NamespaceSync"</span>, <span class="s2">"source"</span>: <span class="s2">"kind source: *v1.Secret"</span><span class="o">}</span>
2024-12-16T09:41:01.660Z        ESC[34minfoESC[0m       manager Starting EventSource    <span class="o">{</span><span class="s2">"controller"</span>: <span class="s2">"namespacesync"</span>, <span class="s2">"controllerGroup"</span>: <span class="s2">"sync.nsync.dev"</span>, <span class="s2">"controllerKind"</span>: <span class="s2">"NamespaceSync"</span>, <span class="s2">"source"</span>: <span class="s2">"kind source: *v1.ConfigMap"</span><span class="o">}</span>
</code></pre></div></div>

<p><br /></p>

<hr />

<h3 id="-best-practices">💡 Best Practices</h3>

<div class="info-box info-box-success">
<br />
<strong>1. Project Structure:</strong>
   - Organize code logically<br />
   - Separate concerns<br />
   - Use consistent naming<br /><br />

<strong>2. Testing:</strong>
   - Write comprehensive tests<br />
   - Use test fixtures<br />
   - Test edge cases<br /><br />

<strong>3. Deployment:</strong>
   - Use multi-platform builds<br />
   - Implement proper RBAC<br />
   - Monitor performance<br /><br />

<strong>4. Documentation:</strong>
   - Document APIs clearly<br />
   - Include usage examples<br />
   - Maintain changelog<br /><br />
</div>

<p><br /></p>

<hr />

<h3 id="-reference">📚 Reference</h3>
<ul>
  <li><a href="https://github.com/kubernetes-sigs/kubebuilder">Kubebuilder Documentation</a></li>
  <li><a href="https://github.com/somaz94/k8s-namespace-sync">Namespace Sync Example</a></li>
  <li><a href="https://github.com/somaz94/helios-lb">Helios Load Balancer</a></li>
  <li><a href="https://medium.com/@SabujJanaCodes/building-a-kubernetes-operator-in-go-reconciling-our-pdfdoc-crd-for-converting-text-to-pdf-files-d0c0c7da98be">Building Kubernetes Operators</a></li>
</ul>


                <!-- Pagination links -->


            </article>

            
                <aside class="see-also">
                    <h2>See also</h2>
                    <ul>
                        
                        
                        
                            <li>
                                <a href="/category/opensource/minio/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1739945745/minio-architecture_iixb6h.png">
                                    
                                    <h3>Introduction to MinIO - High Performance Object Storage</h3>
                                </a>
                            </li>
                        
                            <li>
                                <a href="/category/cicd/argocd-sso-gitlab/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1739943377/argocd-sso-gitlab_jzuunn.png">
                                    
                                    <h3>Setting up ArgoCD SSO with GitLab</h3>
                                </a>
                            </li>
                        
                            <li>
                                <a href="/category/cicd/argocd-sso-gcp-oauth/">
                                    
                                        <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1739942456/argocd-sso-google-oauth_ssoqyf.png">
                                    
                                    <h3>Setting up ArgoCD SSO with GCP OAuth</h3>
                                </a>
                            </li>
                        
                    </ul>
                </aside>
            

        </section>

        <!-- Add time bar only for pages without pagination -->
        
            <div class="time-bar" data-minutes="9">
    <span class="time-completed"></span>
    <span class="time-remaining"></span>
    <div class="bar">
        <span class="completed" style="width:0%;"></span>
        <span class="remaining" style="width:100%;"></span>
    </div>
</div>

            <div class="recommendation">
    <div class="message">
        <strong>Why don't you read something next?</strong>
        <div>
            <button>
                <svg><use xlink:href="#icon-arrow-right"></use></svg>
                <span>Go back to top</span>
            </button>
        </div>
    </div>
    
    <a href="/category/kubernetes/k8s-helm-chart-packaging/" class="post-preview">
        <div class="image">
            
                <img src="https://res.cloudinary.com/dkcm26aem/image/upload/c_scale,w_380/v1737357972/github-gh-pages_lokj8q.png">
            
        </div>
        <h3 class="title">Creating and Hosting Helm Charts for Kubernetes Operators</h3>
    </a>
</div>

        

        <!-- Show modal if the post is the last one -->
        

        <!-- Show modal before user leaves the page -->
        

        <!-- Add your newsletter subscription form here -->

        <section class="share">
    <h3>Share</h3>
    <a aria-label="Share on Twitter" href="https://twitter.com/intent/tweet?text=&quot;A practical guide to building Kubernetes Operators using Kubebuilder framework&quot;%20https://somaz94.github.io/category/kubernetes/k8s-operator-kubebuilder/%20via%20&#64;twitter_username&hashtags=kubernetes,operator,kubebuilder,development"
    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Share on Twitter">
        <svg class="icon icon-twitter"><use xlink:href="#icon-twitter"></use></svg>
    </a>
    <a aria-label="Share on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://somaz94.github.io/category/kubernetes/k8s-operator-kubebuilder/"
    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook">
        <svg class="icon icon-facebook"><use xlink:href="#icon-facebook"></use></svg>
    </a>
</section>

        

  <section class="author">
    <div class="details">
      
        <img class="img-rounded" src="/assets/img/uploads/profile.png" alt="Somaz">
      
      <p class="def">Author</p>
      <h3 class="name">
        <a href="/authors/somaz/">Somaz</a>
      </h3>
      <p class="desc">DevOps engineer focused on cloud infrastructure and automation</p>
      <p>
        
          <a href="https://github.com/somaz94" title="Github">
            <svg><use xlink:href="#icon-github"></use></svg>
          </a>
        
        
        
        
        
        
          <a href="https://www.linkedin.com/in/somaz" title="LinkedIn">
            <svg><use xlink:href="#icon-linkedin"></use></svg>
          </a>
        
        
          <a href="https://somaz.tistory.com" title="Tistory">
            <svg><use xlink:href="#icon-tistory"></use></svg>
          </a>
        
      </p>
    </div>
  </section>

  
  
  
  
  
  
  
  

  <script type="application/ld+json">
  {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "Somaz",
      
      "image": "/assets/img/uploads/profile.png",
      
      "jobTitle": "DevOps Engineer",
      "url": "https://somaz94.github.io/authors/somaz/",
      "sameAs": [
        "https://github.com/somaz94","https://www.linkedin.com/in/somaz","https://{{ author.tistory_username }}.tistory.com"
      ]
  }
  </script>


        

<section class="comments">
    <h3>Comments</h3>
    <div id="disqus_thread"></div>
</section>
<script type="text/javascript">
    var disqus_loaded = false;

    function load_disqus()
    {
        disqus_loaded = true;
        var disqus_shortname = 'https-somaz94-github-io';
        var disqus_title = '';
        var disqus_url = '/category/kubernetes/k8s-operator-kubebuilder/';
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        var ldr = document.getElementById('disqus_loader');
    };
    window.onscroll = function(e) {
        if ((window.innerHeight + window.scrollY) >= (document.body.offsetHeight - 800)) {
            //hit bottom of page
            if (disqus_loaded==false)
                load_disqus()
        }
    };
</script>



        <footer>
    <p>
      
        <a href="https://github.com/somaz94" title="Github">
          <svg><use xlink:href="#icon-github"></use></svg>
        </a>
      
      
        <a href="https://www.facebook.com/facebook_username" title="Facebook">
          <svg><use xlink:href="#icon-facebook"></use></svg>
        </a>
      
      
        <a href="https://twitter.com/twitter_username" title="Twitter">
          <svg><use xlink:href="#icon-twitter"></use></svg>
        </a>
      
      
        <a href="https://medium.com/@medium_username" title="Medium">
          <svg><use xlink:href="#icon-medium"></use></svg>
        </a>
      
      
        <a href="https://www.instagram.com/instagram_username" title="Instagram">
          <svg><use xlink:href="#icon-instagram"></use></svg>
        </a>
      
      
        <a href="https://www.linkedin.com/in/somaz" title="LinkedIn">
          <svg><use xlink:href="#icon-linkedin"></use></svg>
        </a>
      
      
        <a href="https://somaz.tistory.com" title="Tistory">
          <svg><use xlink:href="#icon-tistory"></use></svg>
        </a>
      
    </p>

    <ul>
  
    
      <li>
        <a href="https://somaz94.github.io/">Home</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz94.github.io/about">About</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz94.github.io/category">Category</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz94.github.io/contact">Contact</a>
      </li>
    
  
    
      <li>
        <a href="https://somaz94.github.io/feed.xml">Feed</a>
      </li>
    
  
</ul>


    <p>
      <span>Somaz Tech Blog</span> <svg class="love"><use xlink:href="#icon-heart"></use></svg>
    </p>
</footer>










<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "somaz",
  "description": "DevOps engineer's tech blog.",
  "url": "https://somaz94.github.io/",
  "logo": {
      "@type": "ImageObject",
      "url": "https://somaz94.github.io/assets/img/icons/mediumtile.png",
      "width": "600",
      "height": "315"
  },
  "sameAs": [
    "https://github.com/somaz94","https://www.facebook.com/facebook_username","https://twitter.com/twitter_username","https://medium.com/@medium_username","https://www.instagram.com/instagram_username","https://www.linkedin.com/in/somaz","https://{{ site.tistory_username }}.tistory.com"
  ]
}
</script>

<!-- Include the script that allows Netlify CMS login -->
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

<!-- Include the website scripts -->
<script src="/assets/js/scripts.min.js"></script>

<!-- Include Google Analytics script -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-XXXXXXXX-X"></script>
<script>
  var host = window.location.hostname;
  if (host != 'localhost') {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-XXXXXXXX-X');
  }
</script>
  


<!-- Include extra scripts -->



        

        
        
        
        
        
        
        
        
        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "BlogPosting",
            "name": "Creating Kubernetes Operators with Kubebuilder",
            "headline": "",
            "description": "A practical guide to building Kubernetes Operators using Kubebuilder framework",
            "image": "https://res.cloudinary.com/dkcm26aem/image/upload/v1737356533/kubernetes-operator-kubebuilder_r8hvo4.png",
            "url": "https://somaz94.github.io/category/kubernetes/k8s-operator-kubebuilder/",
            "articleBody": "
  image reference link






🎯 Overview
Learn how to create Kubernetes Operators using Kubebuilder, a powerful framework for building custom controllers and APIs.



what is kubebuilder?

Kubebuilder is an SDK for developing Kubernetes Operator. It is a framework that makes it easy to develop CRD and controllers using the Go language.

It simplifies the development of custom controllers and APIs by providing scaffolding, code generation, and integration with Kubernetes tools.

Kubernetes Operator is a custom controller that manages custom resources (CRD) and automates application deployment, expansion, and management.

Why do I use Kubbuilder?


  Code generation: Automatically generates commercial sphere code for CRD and controller.
  Standards-based: built on a controller-runtime library that complies with Kubernetes API patterns.
  Scaffolding: Provides the structure of the project, including configuration files, Dockerfile, and Makefile.
  Testing: supports integration with test tools such as ‘envtest’ for Kubernetes.
  Scalability: You can easily expand and customize the controller to suit your specific needs.




🛠 Getting Started with Kubebuilder

Installation
# Install Kubebuilder
brew install kubebuilder

# Initialize project
kubebuilder init --domain example.com --repo github.com/username/project

# Create API
kubebuilder create api --group apps --version v1 --kind MyApp


  -domain: Specify API domain (for example, example.com)
  –repo: Set the Go module path for the project
  -group: API group (for example, apps).
  –version: API version (e.g., v1).
  –kind: The name of the user-defined resource, for example, MyApp.
  Define CRD in config/crd/
  API and controller files for api/ and controllers/


Project Structure
.
├── api
│   └── v1
├── bin
├── cmd
├── config
│   ├── crd
│   ├── default
│   ├── manager
│   ├── network-policy
│   ├── prometheus
│   ├── rbac
│   └── samples
├── hack
├── internal
│   └── controller
└── test
    ├── e2e
    └── utils




🔄 Development Workflow


  
    Step
    Commands
    Description
  
  
    Generate
    make generate
    Generate code for custom resources
  
  
    Manifests
    make manifests
    Generate CRD manifests
  
  
    Test
    make test
    Run unit tests
  
  
    Build
    make docker-buildx
    Build multi-platform images
  
  
    Deploy
    make deploy
    Deploy to cluster
  






🌟 Create Operator with Kubbuilder

It’s the Kubernetes Operator I created.

  https://github.com/somaz94/k8s-namespace-sync
  https://github.com/somaz94/helios-lb


Prerequisites
# Install kubebuilder
brew install kubebuilder

# Create git repo and clone
git clone git@github.com-somaz94:somaz94/k8s-namespace-sync.git

# Initialize kube builder project
kubebuilder init --domain nsync.dev --repo github.com/somaz94/k8s-namespace-sync

# Create api
kubebuilder create api --group sync --version v1 --kind NamespaceSync


File Structure Explanation

The crd schema definition is done in the file below.

  api/v1/namespacesync_types.go


The main.go is defined in the path below.

  cmd/main.go


The controller defines it in that file. In addition to this file, I have organized files for various functions.

  internal/controller/namespacesync_controller.go


ls
backup					filters.go				namespacesync_controller.go		namespacesync_controller_target_test.go	resources.go				sync.go
events.go				metrics.go				namespacesync_controller_filter_test.go	namespacesync_controller_test.go	suite_test.go				utils.go


You can also define the test code on the same path and test it using the make test command.
If you are curious about the details, please check the make file.

If you’re done implementing all the features, create a dockerhub account to upload after the image is built.

  Create an Access Token on the Docker Hub website
  https://hub.docker.com/settings/security access
  “New Access Token” click
  Enter token name (e.g. “k8s-namespace-sync”)
  Copy once token is created (save this token well because it only shows once)


Log in from the terminal.
docker login -u somaz940
# Enter token


  Before proceeding with the make test, there is still something to explain.




📝 Kubebuilder Markers

It is a kubbuilder marker that defines the schema and presentation method of the Kubernetes Custom Resource Definition (CRD).

If you check the namespacesync_types.go file, the marker is defined as below.
// +kubebuilder:object:root=true
// +kubebuilder:subresource:status
// +kubebuilder:printcolumn:name=&quot;Source&quot;,type=&quot;string&quot;,JSONPath=&quot;.spec.sourceNamespace&quot;
// +kubebuilder:printcolumn:name=&quot;Age&quot;,type=&quot;date&quot;,JSONPath=&quot;.metadata.creationTimestamp&quot;
// +kubebuilder:printcolumn:name=&quot;Status&quot;,type=&quot;string&quot;,JSONPath=&quot;.status.conditions[?(@.type==&apos;Ready&apos;)].status&quot;
// +kubebuilder:printcolumn:name=&quot;Message&quot;,type=&quot;string&quot;,JSONPath=&quot;.status.conditions[?(@.type==&apos;Ready&apos;)].message&quot;


  +kubebuilder:object:root=true
    
      This marker indicates that the resource is a root resource.
    
  
  +kubebuilder:subresource:status
    
      This marker indicates that the resource has a status subresource.
      It provides a separate endpoint for status updates.
    
  
  +kubebuilder:printcolumn:...
    
      This marker indicates that the resource has a print column.
      Defined columns
        
          Source: Displaying spec.sourceNamespace value
          Age: Show creation time
          Status: Displaying Ready Condition Status
          Message: Displaying message in Ready condition
        
      
    
  


When using makemanifests

  Controller-gen reads the markers in the Go code to create a CRD YAML file
  Create RBAC Permissions Configuration File
  Create deliverables in the config/crd/bases directory


When using make generator

  Create DeepCopy Method for Go Type
  Generating the type conversion code required for Kubernetes client code




If you check the makefile, it is defined as follows. After performing all necessary tasks, proceed to the test.
.PHONY: test
test: manifests generate fmt vet envtest ## Run tests.
	KUBEBUILDER_ASSETS=&quot;$(shell $(ENVTEST) use $(ENVTEST_K8S_VERSION) --bin-dir $(LOCALBIN) -p path)&quot; go test $$(go list ./... | grep -v /e2e) -coverprofile cover.out




And you can specify IMG upload path and K8S test version in makefile.
# Image URL to use all building/pushing image targets
IMG ?= somaz940/k8s-namespace-sync:v0.1.6
# ENVTEST_K8S_VERSION refers to the version of kubebuilder assets to be downloaded by envtest binary.
ENVTEST_K8S_VERSION = 1.31.0




If the test is successful, make docker-buildx is used to build various platforms at the same time.

I modified the makefile so that it could be built into the late, versiontag, and late+ versiontag environments.
PLATFORMS ?= linux/arm64,linux/amd64,linux/s390x,linux/ppc64le
.PHONY: docker-buildx-tag
docker-buildx-tag: ## Build and push docker image for the manager for cross-platform support with specific version
	# copy existing Dockerfile and insert --platform=${BUILDPLATFORM} into Dockerfile.cross
	sed -e &apos;1 s/\\(^FROM\\)/FROM --platform=\\$$\\{BUILDPLATFORM\\}/; t&apos; -e &apos; 1,// s//FROM --platform=\\$$\\{BUILDPLATFORM\\}/&apos; Dockerfile &amp;gt; Dockerfile.cross
	- $(CONTAINER_TOOL) buildx create --name k8s-namespace-sync-builder
	$(CONTAINER_TOOL) buildx use k8s-namespace-sync-builder
	# Build and push version-specific tag
	- $(CONTAINER_TOOL) buildx build --push --platform=$(PLATFORMS) \\
		--tag ${IMG} \\
		-f Dockerfile.cross .
	- $(CONTAINER_TOOL) buildx rm k8s-namespace-sync-builder
	rm Dockerfile.cross

.PHONY: docker-buildx-latest
docker-buildx-latest: ## Build and push docker image for the manager for cross-platform support with latest tag
	# copy existing Dockerfile and insert --platform=${BUILDPLATFORM} into Dockerfile.cross
	sed -e &apos;1 s/\\(^FROM\\)/FROM --platform=\\$$\\{BUILDPLATFORM\\}/; t&apos; -e &apos; 1,// s//FROM --platform=\\$$\\{BUILDPLATFORM\\}/&apos; Dockerfile &amp;gt; Dockerfile.cross
	- $(CONTAINER_TOOL) buildx create --name k8s-namespace-sync-builder
	$(CONTAINER_TOOL) buildx use k8s-namespace-sync-builder
	# Build and push latest tag
	- $(CONTAINER_TOOL) buildx build --push --platform=$(PLATFORMS) \\
		--tag $(shell echo ${IMG} | cut -f1 -d:):latest \\
		-f Dockerfile.cross .
	- $(CONTAINER_TOOL) buildx rm k8s-namespace-sync-builder
	rm Dockerfile.cross

.PHONY: docker-buildx
docker-buildx: ## Build and push both version-specific and latest tags
docker-buildx: docker-buildx-tag docker-buildx-latest




If you want to deploy to the cluster, you can use the make deploy command.
make deploy IMG=somaz940/k8s-namespace-sync:v0.1.6




Check api and crd.
k get apiservices.apiregistration.k8s.io |grep nsync
v1.sync.nsync.dev                      Local                        True        25s

k get crd |grep nsync
namespacesyncs.sync.nsync.dev                2024-12-16T09:41:00Z




I created various sample crd.
ls config/samples/
kustomization.yaml			sync_v1_namespacesync_exclude.yaml	sync_v1_namespacesync_target.yaml	test-configmap2.yaml			test-secret2.yaml
sync_v1_namespacesync.yaml		sync_v1_namespacesync_filter.yaml	test-configmap.yaml			test-secret.yaml




The start log of the app is as follows.
2024-12-16T09:41:01.541Z        ESC[34minfoESC[0m       setup   creating controller     {&quot;controller&quot;: &quot;NamespaceSync&quot;, &quot;scheme&quot;: &quot;pkg/runtime/scheme.go:100&quot;}
2024-12-16T09:41:01.541Z        ESC[34minfoESC[0m       namespacesync-controller        Setting up controller manager
2024-12-16T09:41:01.545Z        ESC[34minfoESC[0m       setup   controller created successfully {&quot;controller&quot;: &quot;NamespaceSync&quot;}
2024-12-16T09:41:01.545Z        ESC[34minfoESC[0m       setup   starting manager
2024-12-16T09:41:01.545Z        ESC[34minfoESC[0m       controller-runtime.metrics      Starting metrics server
2024-12-16T09:41:01.545Z        ESC[34minfoESC[0m       setup   disabling http/2
2024-12-16T09:41:01.545Z        ESC[34minfoESC[0m       starting server {&quot;name&quot;: &quot;health probe&quot;, &quot;addr&quot;: &quot;[::]:8081&quot;}
I1216 09:41:01.645802       1 leaderelection.go:254] attempting to acquire leader lease k8s-namespace-sync-system/47c2149c.nsync.dev...
I1216 09:41:01.659829       1 leaderelection.go:268] successfully acquired lease k8s-namespace-sync-system/47c2149c.nsync.dev
2024-12-16T09:41:01.659Z        ESC[35mdebugESC[0m      manager.events  k8s-namespace-sync-controller-manager-5874b756c8-h9ng6_2a3d0c37-b1f0-46c3-bcff-e28ccc2750e9 became leader       {&quot;type&quot;: &quot;Normal&quot;, &quot;object&quot;: {&quot;kind&quot;:&quot;Lease&quot;,&quot;namespace&quot;:&quot;k8s-namespace-sync-system&quot;,&quot;name&quot;:&quot;47c21
49c.nsync.dev&quot;,&quot;uid&quot;:&quot;385be981-f090-4b4e-a341-7888c2858e4b&quot;,&quot;apiVersion&quot;:&quot;coordination.k8s.io/v1&quot;,&quot;resourceVersion&quot;:&quot;12611207&quot;}, &quot;reason&quot;: &quot;LeaderElection&quot;}
2024-12-16T09:41:01.660Z        ESC[34minfoESC[0m       manager Starting EventSource    {&quot;controller&quot;: &quot;namespacesync&quot;, &quot;controllerGroup&quot;: &quot;sync.nsync.dev&quot;, &quot;controllerKind&quot;: &quot;NamespaceSync&quot;, &quot;source&quot;: &quot;kind source: *v1.NamespaceSync&quot;}
2024-12-16T09:41:01.660Z        ESC[34minfoESC[0m       manager Starting EventSource    {&quot;controller&quot;: &quot;namespacesync&quot;, &quot;controllerGroup&quot;: &quot;sync.nsync.dev&quot;, &quot;controllerKind&quot;: &quot;NamespaceSync&quot;, &quot;source&quot;: &quot;kind source: *v1.Namespace&quot;}
2024-12-16T09:41:01.660Z        ESC[34minfoESC[0m       manager Starting EventSource    {&quot;controller&quot;: &quot;namespacesync&quot;, &quot;controllerGroup&quot;: &quot;sync.nsync.dev&quot;, &quot;controllerKind&quot;: &quot;NamespaceSync&quot;, &quot;source&quot;: &quot;kind source: *v1.Secret&quot;}
2024-12-16T09:41:01.660Z        ESC[34minfoESC[0m       manager Starting EventSource    {&quot;controller&quot;: &quot;namespacesync&quot;, &quot;controllerGroup&quot;: &quot;sync.nsync.dev&quot;, &quot;controllerKind&quot;: &quot;NamespaceSync&quot;, &quot;source&quot;: &quot;kind source: *v1.ConfigMap&quot;}






💡 Best Practices



1. Project Structure:
   - Organize code logically
   - Separate concerns
   - Use consistent naming

2. Testing:
   - Write comprehensive tests
   - Use test fixtures
   - Test edge cases

3. Deployment:
   - Use multi-platform builds
   - Implement proper RBAC
   - Monitor performance

4. Documentation:
   - Document APIs clearly
   - Include usage examples
   - Maintain changelog






📚 Reference

  Kubebuilder Documentation
  Namespace Sync Example
  Helios Load Balancer
  Building Kubernetes Operators

",
            "wordcount": "1693",
            "inLanguage": "en",
            "dateCreated": "2025-01-14/",
            "datePublished": "2025-01-14/",
            "dateModified": "2025-01-14/",
            "author": {
                "@type": "Person",
                "name": "Somaz",
                
                "image": "/assets/img/uploads/profile.png",
                
                "jobTitle": "DevOps Engineer",
                "url": "https://somaz94.github.io/authors/somaz/",
                "sameAs": [
                    "https://github.com/somaz94","https://www.linkedin.com/in/somaz"
                ]
            },
            "publisher": {
                "@type": "Organization",
                "name": "somaz",
                "url": "https://somaz94.github.io/",
                "logo": {
                    "@type": "ImageObject",
                    "url": "https://somaz94.github.io/assets/img/blog-image.png",
                    "width": "600",
                    "height": "315"
                }
            },
            "mainEntityOfPage": "True",
            "genre": "KUBERNETES",
            "articleSection": "KUBERNETES",
            "keywords": ["kubernetes","operator","kubebuilder","development"]
        }
        </script>
    </body>
</html>
