<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì´ˆìŒíŒŒë¥¼ í™œìš©í•œ ì†ê°€ë½ë¼ˆ ê¸¸ì´ ê³„ì¸¡ì„ í†µí•œ í•œêµ­ì¸ ì‹ ì›ì¶”ì • ê¸°ë²• ê°œë°œ </title>
  <style>
    :root {
      --bg-color: #121212;
      --text-color: #ffffff;
      --secondary-text: #dddddd;
      --primary-color: #e50914;
      --border-color: #444444;
      --input-bg: #222222;
      --container-bg: #1a1a1a;
      --section-bg: #242424;
      --card-bg: #2a2a2a;
      --hover-color: #333333;
      --box-shadow: rgba(0, 0, 0, 0.7);
      --error-color: #ff5252;
      --success-color: #4caf50;
      --result-bg: #2d2d2d;
    }

    body.light-mode {
      --bg-color: #f5f5f5;
      --text-color: #121212;
      --secondary-text: #444444;
      --primary-color: #e50914;
      --border-color: #dddddd;
      --input-bg: #ffffff;
      --container-bg: #ffffff;
      --section-bg: #f0f0f0;
      --card-bg: #e0e0e0;
      --hover-color: #e8e8e8;
      --box-shadow: rgba(0, 0, 0, 0.1);
      --error-color: #f44336;
      --success-color: #4caf50;
      --result-bg: #e9e9e9;
    }

    body {
      font-family: 'Helvetica Neue', Arial, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      line-height: 1.5;
      margin: 0;
      padding: 20px;
      transition: background-color 0.3s, color 0.3s;
    }
    
    /* í…Œë§ˆ ì „í™˜ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .theme-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background-color: var(--section-bg);
      border: 1px solid var(--border-color);
      color: var(--text-color);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      box-shadow: 0 2px 5px var(--box-shadow);
      transition: all 0.3s;
    }
    
    .theme-toggle:hover {
      background-color: var(--hover-color);
      transform: scale(1.05);
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
      font-size: 1.8em;
      color: var(--primary-color);
      text-shadow: 0 0 10px rgba(229, 9, 20, 0.3);
    }
    h3 {
      margin-top: 30px;
      margin-bottom: 15px;
      font-size: 1.4em;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 5px;
      color: var(--text-color);
    }
    .form-group {
      margin-bottom: 15px;
    }
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 5px;
      font-size: 1.05em;
      color: var(--secondary-text);
    }
    input {
      width: 100%;
      padding: 10px 12px;
      font-size: 1.05em;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      box-sizing: border-box;
      background-color: var(--input-bg);
      color: var(--text-color);
      box-shadow: 0 0 5px var(--box-shadow);
      transition: border-color 0.3s, box-shadow 0.3s;
    }
    input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 8px rgba(229, 9, 20, 0.3);
    }
    button {
      display: block;
      width: 100%;
      padding: 12px;
      background-color: var(--primary-color);
      border: none;
      border-radius: 4px;
      color: white;
      font-size: 1.1em;
      cursor: pointer;
      margin-top: 20px;
      transition: background-color 0.3s, box-shadow 0.3s;
    }
    button:hover {
      background-color: #f40612;
      box-shadow: 0 0 12px rgba(229, 9, 20, 0.5);
    }
    .result {
      text-align: center;
      margin-top: 15px;
      font-size: 1.3em;
      font-weight: bold;
    }
    .result-container {
      background-color: var(--section-bg);
      padding: 15px;
      border-radius: 4px;
      margin-top: 30px;
      border: 1px solid var(--border-color);
    }
    .model-section {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      background-color: var(--section-bg);
      box-shadow: 0 0 10px var(--box-shadow);
    }
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 0;
      flex-wrap: wrap;
      justify-content: center;
      background-color: var(--container-bg);
      padding: 15px 10px;
      border-radius: 4px 4px 0 0;
      border-bottom: 1px solid var(--border-color);
    }
    .tab {
      padding: 10px 14px;
      background-color: var(--section-bg);
      border: 1px solid var(--border-color);
      border-radius: 4px;
      cursor: pointer;
      text-align: center;
      flex: 0 1 auto;
      min-width: 100px;
      font-size: 0.9em;
      white-space: nowrap;
      margin-bottom: 5px;
      color: var(--secondary-text);
      transition: all 0.3s ease;
    }
    .tab:hover {
      background-color: var(--hover-color);
      border-color: var(--primary-color);
      color: var(--text-color);
    }
    .tab.active {
      background-color: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }
    .model-container {
      display: none;
    }
    .model-container.active {
      display: block;
    }
    .model-stats {
      background-color: var(--card-bg);
      padding: 10px 14px;
      border-radius: 4px;
      font-size: 1em;
      margin: 0 15px 15px 15px;
      display: inline-block;
      color: var(--secondary-text);
      border: 1px solid var(--border-color);
    }
    h4 {
      margin-top: 20px;
      margin-bottom: 10px;
      font-size: 1.2em;
      color: var(--primary-color);
      border-left: 3px solid var(--primary-color);
      padding-left: 10px;
    }
    
    /* ëª¨ë°”ì¼ ëŒ€ì‘ ë¯¸ë””ì–´ ì¿¼ë¦¬ */
    @media (max-width: 768px) {
      body {
        padding: 15px;
        margin: 20px auto;
        font-size: 14px;
      }
      
      .tab {
        padding: 8px 10px;
        font-size: 0.8em;
        min-width: 85px;
      }
      
      h2 {
        font-size: 1.5em;
      }
      
      h3 {
        font-size: 1.2em;
      }
      
      .main-content {
        display: block;
      }
      
      .helper-container {
        position: relative;
        top: 0;
        border-left: none;
        margin-top: 30px;
      }
      
      .theme-toggle {
        top: 10px;
        right: 10px;
        width: 40px;
        height: 40px;
        font-size: 20px;
      }
    }
    
    /* ë ˆì´ì•„ì›ƒ ìŠ¤íƒ€ì¼ ìˆ˜ì • */
    .main-content {
      display: grid;
      grid-template-columns: 20% 35% 43%;
      gap: 2%;
      position: relative;
    }
    
    /* ì™¼ìª½ ì‚¬ì´ë“œë°” ì»¨í…Œì´ë„ˆ - ë„ì›€ë§ ì„¹ì…˜ */
    .sidebar-container {
      background-color: var(--container-bg);
      border-radius: 4px;
      box-shadow: 0 0 15px var(--box-shadow);
      padding: 15px;
      border: 1px solid var(--border-color);
      transition: background-color 0.3s, border-color 0.3s, box-shadow 0.3s;
      align-self: flex-start;
      max-height: 85vh;
      overflow-y: auto;
    }
    
    /* ëª¨ë°”ì¼ ëŒ€ì‘ ì¶”ê°€ */
    @media (max-width: 768px) {
      .main-content {
        display: block;
      }
      
      .calculator-container,
      .sidebar-container,
      .helper-container {
        width: 100%;
        margin-bottom: 20px;
      }
    }
    
    .calculator-container {
      width: 100%;
      background-color: var(--container-bg);
      border-radius: 4px;
      box-shadow: 0 0 15px var(--box-shadow);
      padding: 0 0 15px 0;
      border: 1px solid var(--border-color);
      transition: background-color 0.3s, border-color 0.3s, box-shadow 0.3s;
    }
    
    .model-title {
      font-size: 1.4em;
      margin: 25px 15px 15px 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border-color);
      color: var(--text-color);
    }
    
    .helper-container {
      background-color: var(--container-bg);
      padding: 20px;
      border-radius: 4px;
      box-shadow: 0 0 15px var(--box-shadow);
      position: sticky;
      top: 20px;
      align-self: flex-start;
      max-height: 85vh;
      overflow-y: auto;
      border: 1px solid var(--border-color);
    }
    
    .helper-container h3 {
      margin-top: 0;
      color: var(--text-color);
      font-size: 1.4em;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 8px;
      margin-bottom: 15px;
    }
    
    .helper-container .form-group {
      margin-bottom: 12px;
    }
    
    .helper-section {
      background-color: var(--section-bg);
      padding: 18px;
      border-radius: 4px;
      margin-bottom: 20px;
      box-shadow: 0 0 10px var(--box-shadow);
      border: 1px solid var(--border-color);
    }
    
    .helper-section h4 {
      margin-top: 0;
      color: var(--primary-color);
      font-size: 1.3em;
    }
    
    .helper-result {
      background-color: var(--card-bg);
      padding: 12px;
      border-radius: 4px;
      text-align: center;
      margin-top: 15px;
      font-weight: bold;
      cursor: pointer;
      font-size: 1.2em;
      color: var(--text-color);
      border: 1px solid var(--border-color);
    }
    .helper-result:hover {
      border-color: var(--primary-color);
    }
    
    .btn-small {
      padding: 10px;
      font-size: 1em;
      margin-top: 10px;
      background-color: var(--primary-color);
    }
    
    .btn-small:hover {
      background-color: #f40612;
    }
    
    .copy-tooltip {
      position: fixed;
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 0.8em;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 1000;
      border: 1px solid var(--border-color);
    }
    
    .model-container form {
      padding: 0 20px;
    }
    
    .result {
      text-align: center;
      margin: 15px 15px 5px 15px;
      font-size: 1.3em;
      font-weight: bold;
      background-color: var(--card-bg);
      padding: 15px;
      border-radius: 4px;
      color: var(--text-color);
      border: 1px solid var(--border-color);
    }
    
    /* ì¢Œìš° ë ˆì´ì•„ì›ƒ ê· í˜•ì„ ìœ„í•œ ì¶”ê°€ ìŠ¤íƒ€ì¼ */
    .calculator-container {
      max-width: 100%;
    }
    
    /* ê³„ì‚°ê¸° ì˜ì—­ í¼ ìš”ì†Œ ê°„ê²© ì¡°ì • */
    .calculator-container .form-group {
      margin-bottom: 10px;
    }
    
    .calculator-container label {
      font-size: 0.95em;
    }
    
    .calculator-container input {
      font-size: 0.95em;
      padding: 8px 10px;
    }
    
    .calculator-container button {
      padding: 10px;
      font-size: 1em;
    }
    
    /* ë³´ì¡° ì˜ì—­ ì—¬ë°± ì¡°ì • */
    .helper-container {
      padding: 15px;
      max-width: 100%;
    }
    
    .helper-container p {
      font-size: 0.95em;
      line-height: 1.5;
      color: var(--secondary-text);
    }
    
    /* ì—°êµ¬ ëª©ì  ì„¹ì…˜ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸ */
    .research-purpose {
      background-color: var(--section-bg) !important;
      border-left: 4px solid var(--primary-color) !important;
      box-shadow: 0 0 15px var(--box-shadow) !important;
      border: 1px solid var(--border-color) !important;
    }
    
    /* ê³„ì‚° ê²°ê³¼ ê°•ì¡° ìƒ‰ìƒ */
    .green {
      color: var(--success-color) !important;
      font-weight: bold;
    }
    
    .red {
      color: var(--error-color) !important;
      font-weight: bold;
    }
    
    /* ê²°ê³¼ í‘œì‹œ ì„¹ì…˜ */
    .result-display {
      background-color: var(--result-bg);
      padding: 15px;
      border-radius: 4px;
      margin-top: 20px;
      border-left: 3px solid var(--primary-color);
    }
    
    /* í”¼í—˜ì ì¹´ë“œ ìŠ¤íƒ€ì¼ ê°œì„  */
    .subject-card {
      background-color: var(--section-bg);
      border: 1px solid var(--border-color);
      border-radius: 4px;
      margin-bottom: 20px;
      padding: 15px;
      box-shadow: 0 2px 4px var(--box-shadow);
    }
    
    .subject-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 10px;
      margin-bottom: 15px;
    }
    
    .subject-info {
      background-color: var(--card-bg);
      padding: 10px;
      border-radius: 4px;
      margin-bottom: 15px;
    }
    
    .subject-info strong {
      color: var(--text-color);
    }
    
    .calculation-result {
      background-color: var(--result-bg);
      padding: 15px;
      border-radius: 4px;
      border-left: 3px solid var(--primary-color);
    }
    
    .calculation-result table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .calculation-result td {
      padding: 6px;
      color: var(--text-color);
    }
    
    .calculation-result td:nth-child(2) {
      font-weight: bold;
      text-align: right;
    }
    
    .error-value {
      text-align: right;
      font-weight: normal;
    }
    
    /* NETFLIX íƒ€ì…ì˜ ë¡œê³  íš¨ê³¼ */
    .netflix-style {
      text-align: center;
      padding: 40px 20px;
      margin-bottom: 30px;
    }
    
    .netflix-title {
      font-size: 3.5em;
      font-weight: 700;
      color: var(--primary-color);
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      margin-bottom: 15px;
      letter-spacing: -0.5px;
    }
    
    .netflix-subtitle {
      font-size: 1.4em;
      color: var(--text-color);
      max-width: 1200px;
      margin: 0 auto;
    }
    
    /* ì—°êµ¬ì ì •ë³´ ìŠ¤íƒ€ì¼ */
    .researchers-info {
      text-align: center;
      margin-top: 20px;
      padding: 15px;
      border-top: 1px solid rgba(229, 9, 20, 0.3);
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }
    
    .institution {
      font-size: 1.1em;
      color: var(--text-color);
      margin-bottom: 10px;
      font-weight: bold;
    }
    
    .researcher {
      font-size: 0.95em;
      color: var(--secondary-text);
      margin: 5px 0;
      line-height: 1.5;
    }
    
    /* ì‹¤ì œ í‚¤ ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ */
    .height-input-container {
      padding: 15px; 
      background-color: var(--input-bg); 
      border-radius: 4px 4px 0 0;
      border-bottom: 1px solid var(--border-color);
    }
    
    .height-input-container label {
      color: var(--text-color);
      font-weight: bold;
    }
    
    .height-input-container input {
      border: 1px solid var(--border-color);
      background-color: var(--card-bg);
    }
    
    .height-input-container input:focus {
      border-color: var(--primary-color);
    }
  </style>
</head>
<body>
  <!-- ë„·í”Œë¦­ìŠ¤ ìŠ¤íƒ€ì¼ íƒ€ì´í‹€ -->
  <div class="netflix-style">
    <div class="netflix-title">Forensic Stature Estimation Calculator</div>
    <div class="netflix-subtitle">ì´ˆìŒíŒŒë¥¼ í™œìš©í•œ ì†ê°€ë½ë¼ˆ ê¸¸ì´ ê³„ì¸¡ì„ í†µí•œ í•œêµ­ì¸ ì‹ ì›ì¶”ì • ê¸°ë²• ê°œë°œ</div>
    <div class="netflix-subtitle" style="font-size: 0.9em; color: var(--secondary-text); margin-top: 5px; white-space: nowrap;">Development of Korean identity estimation techniques through measurement of proximal phalanx bone length using ultrasonic waves</div>
    
    <div class="researchers-info">
      <div class="researcher">í•œìŠ¹í˜¸ êµìˆ˜ë‹˜ (ì˜ê³¼ëŒ€í•™ í•´ë¶€í•™êµì‹¤ & IFAA í˜‘íšŒ íšŒì¥)</div>
      <div class="researcher">ì¥ì§€ì•  ë°•ì‚¬ (ì´í™”ì—¬ìëŒ€í•™êµ ì˜ê³¼ëŒ€í•™ í•´ë¶€í•™êµì‹¤ ì†Œì† ì—°êµ¬ì›, í˜„ ì„œìš¸ì§€ë°©ê²½ì°°ì²­ ê³¼í•™ìˆ˜ì‚¬ëŒ€ ê²€ì‹œì¡°ì‚¬ê´€)<br/><br/></div>
      <div class="institution">Department of Anatomy at Ewha Academy, Ewha Womans University Medical School</div>
      <div class="institution">Seoul Metropolitan Police Agency Scientific Investigation Unit</div>
    </div>
  </div>
  
  <div class="research-purpose" style="background-color: var(--section-bg); padding: 20px; border-radius: 4px; margin-bottom: 30px; border-left: 4px solid var(--primary-color); position: relative; box-shadow: 0 0 15px var(--box-shadow);">
    <h3 style="margin-top: 0; color: var(--text-color); border-bottom: 1px solid var(--border-color); padding-bottom: 10px; margin-bottom: 15px;">ì—°êµ¬ ëª©ì </h3>
    <p style="color: var(--secondary-text); line-height: 1.6;">CTë‚˜ MRIê°™ì€ ë°©ì‚¬ì„  ë…¸ì¶œ ì—†ì´ ì¸ì²´ì˜ ë¬´í•´í•œ ì´ˆìŒíŒŒë¥¼ ì´ìš©í•˜ì—¬ ì†ê°€ë½ë¼ˆì˜ ê¸¸ì´ ì¸¡ì •ì„ ì‹œí–‰í•œ í›„ ì‹¤ì œ ì¹´ë°ë°” í•´ë¶€ë¥¼ í†µí•´ ì‹¤ì œ ë¼ˆ í¬ê¸°ì™€ ì´ˆìŒíŒŒì˜ ì¸¡ì •ê°’ê³¼ ë¹„êµí•˜ì—¬ ì´ˆìŒíŒŒì˜ ìœ íš¨ì„±ì„ ê²€ì¦í•˜ëŠ” ê²ƒì„ ëª©ì ìœ¼ë¡œ í•©ë‹ˆë‹¤.</p>
    <p style="color: var(--secondary-text); line-height: 1.6;">ë‘ë²ˆì§¸ ì—°êµ¬ ëª©ì ìœ¼ë¡œëŠ” ìœ íš¨ì„±ì´ ì¶©ë¶„íˆ ê²€í† ëœ ì´ˆìŒíŒŒ ê³„ì¸¡ ë°©ë²•ì„ ì´ìš©í•˜ì—¬ ë‹¤ì–‘í•œ ì—°ë ¹ëŒ€ì˜ í•œêµ­ì¸ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ê³  ì´ë¥¼ í†µí•´ íŠ¹ì • ì†ê°€ë½ë¼ˆì™€ì˜ ì„±ë³„ê³¼ í‚¤ì˜ ìƒê´€ì„±ì„ í†µê³„í•™ì ìœ¼ë¡œ ì‚´í´ë³´ê³  ì‹ ì¥ ì¶”ì •ê³µì‹ì„ ë§Œë“¤ì–´ì„œ í˜„ì¥ì—ì„œ ì¦‰ì‹œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì‹ ì› ì¶”ì • ë„êµ¬ ê°œë°œí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.</p>
  </div>
  
  <div class="main-content">
    <!-- ì™¼ìª½ ì˜ì—­: ë„ì›€ë§ ì„¹ì…˜ -->
    <div class="sidebar-container">
      <h3>ğŸ’¡ ë„ì›€ë§</h3>
      <div class="helper-section">
        <h4>ìš©ì–´ ì„¤ëª…</h4>
        <p><strong>TT</strong>: Total length (ì†ê°€ë½ ì „ì²´ ê¸¸ì´)</p>
        <p><strong>IP</strong>: Interphalangeal length (ì†ê°€ë½ ê´€ì ˆ ê¸¸ì´)</p>
        <p><strong>_error</strong>: ì˜¤ë¥¸ì†-ì™¼ì† ì¸¡ì •ê°’ ì°¨ì´</p>
        <p><strong>_avg</strong>: ì™¼ì†-ì˜¤ë¥¸ì† ì¸¡ì •ê°’ í‰ê· </p>
        <p><strong>2nd, 3rd, 4th</strong>: ê²€ì§€, ì¤‘ì§€, ì•½ì§€ ì†ê°€ë½</p>
        <p><strong>RT</strong>: Right (ì˜¤ë¥¸ì†)</p>
        <p><strong>LT</strong>: Left (ì™¼ì†)</p>
      </div>
      
      <!-- ì—‘ì…€ íŒŒì¼ ê´€ë ¨ ì„¤ëª… -->
      <div class="helper-section">
        <h4>ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ</h4>
        <p>ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ ìë™ìœ¼ë¡œ ê³„ì‚°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í˜•ì‹ì— ë§ëŠ” ì—‘ì…€ íŒŒì¼ì„ ì¤€ë¹„í•´ì£¼ì„¸ìš”.</p>
        <p style="font-size: 0.8em; margin-top: 10px; color: var(--secondary-text);">
          <strong>í•„ìˆ˜ í•„ë“œ:</strong> ì¸¡ì •ê°’, í”¼í—˜ì ID, ì„±ë³„, ë‚˜ì´, ì‹¤ì œ í‚¤ ê°’ ë“±
        </p>
        <a href="#" id="download-template" style="font-size: 0.8em; color: var(--primary-color);">í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ</a>
      </div>
      
      <div class="helper-section">
        <h4>ì‚¬ìš© ë°©ë²•</h4>
        <p><strong>ê²°ê³¼ê°’ ë³µì‚¬ ë°©ë²•</strong>: ê³„ì‚°ëœ í‰ê· ê°’ì´ë‚˜ ì˜¤ì°¨ê°’ì´ í‘œì‹œëœ ê²°ê³¼ ì˜ì—­ì„ í´ë¦­í•˜ë©´ ê°’ì´ ìë™ìœ¼ë¡œ í´ë¦½ë³´ë“œì— ë³µì‚¬ë©ë‹ˆë‹¤. ë³µì‚¬í•œ ê°’ì„ ì™¼ìª½ ê³„ì‚°ê¸°ì˜ ì…ë ¥ í•„ë“œì— ë¶™ì—¬ë„£ì–´(Ctrl+V ë˜ëŠ” Command+V) ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
      </div>
    </div>
    
    <!-- ì¤‘ì•™ ì˜ì—­: ê³„ì‚°ê¸° -->
    <div class="calculator-container">
      <div class="height-input-container">
        <div class="form-group" style="margin-bottom: 0;">
          <label for="user_height">ì‹¤ì œ í‚¤ (cm):</label>
          <input type="number" id="user_height" placeholder="ì‹¤ì œ í‚¤ë¥¼ ì…ë ¥í•˜ë©´ ì˜¤ì°¨ê°€ í‘œì‹œë©ë‹ˆë‹¤">
        </div>
      </div>
      <div class="tabs">
        <div class="tab active" onclick="showModel(0)">ëª¨ë¸ 1: TT+IP í‰ê· ê°’ (í†µí•©)</div>
        <div class="tab" onclick="showModel(1)">ëª¨ë¸ 2: 4ë²ˆì§¸ ì†ê°€ë½ (í†µí•©)</div>
        <div class="tab" onclick="showModel(2)">ëª¨ë¸ 3: TT+IP í‰ê· ê°’ (dorsal)</div>
        <div class="tab" onclick="showModel(3)">ëª¨ë¸ 4: 4ë²ˆì§¸ ì†ê°€ë½ (dorsal)</div>
      </div>
      
      <!-- ëª¨ë¸ ì»¨í…Œì´ë„ˆ -->
      <div class="calculator-container">
        
        <!-- ëª¨ë¸ 1: TT + IP í‰ê· ê°’ ëª¨ë¸ -->
        <div class="model-container active" id="model1">
          <h3 class="model-title">ëª¨ë¸ 1: TT + IP í‰ê· ê°’ (í†µí•©) ëª¨ë¸</h3>
          <p class="model-stats">ì„¤ëª…ë ¥(R): 0.684 | MAE: 5.03</p>
          <form id="model1-form">
            <div class="form-group">
              <label for="tt_2nd_avg">TT_2nd_avg:</label>
              <input type="number" step="any" id="tt_2nd_avg">
            </div>
            <div class="form-group">
              <label for="tt_3rd_avg">TT_3rd_avg:</label>
              <input type="number" step="any" id="tt_3rd_avg">
            </div>
            <div class="form-group">
              <label for="tt_4th_avg">TT_4th_avg:</label>
              <input type="number" step="any" id="tt_4th_avg">
            </div>
            <div class="form-group">
              <label for="ip_2nd_avg">IP_2nd_avg:</label>
              <input type="number" step="any" id="ip_2nd_avg">
            </div>
            <div class="form-group">
              <label for="ip_3rd_avg">IP_3rd_avg:</label>
              <input type="number" step="any" id="ip_3rd_avg">
            </div>
            <div class="form-group">
              <label for="ip_4th_avg">IP_4th_avg:</label>
              <input type="number" step="any" id="ip_4th_avg">
            </div>
            <button type="button" onclick="calculateModel1()">ê³„ì‚°</button>
          </form>
          <div class="result" id="result1">ì˜ˆìƒ í‚¤: - cm</div>
        </div>

        <!-- ëª¨ë¸ 2: 4ë²ˆì§¸ ì†ê°€ë½ ëª¨ë¸ -->
        <div class="model-container" id="model2">
          <h3 class="model-title">ëª¨ë¸ 2: 4ë²ˆì§¸ ì†ê°€ë½ (í†µí•©) ëª¨ë¸</h3>
          <p class="model-stats">ì„¤ëª…ë ¥(R): 0.673 | MAE: 4.91</p>
          <form id="model2-form">
            <div class="form-group">
              <label for="tt_4th_avg_m2">TT_4th_avg:</label>
              <input type="number" step="any" id="tt_4th_avg_m2">
            </div>
            <div class="form-group">
              <label for="ip_4th_avg_m2">IP_4th_avg:</label>
              <input type="number" step="any" id="ip_4th_avg_m2">
            </div>
            <button type="button" onclick="calculateModel2()">ê³„ì‚°</button>
          </form>
          <div class="result" id="result2">ì˜ˆìƒ í‚¤: - cm</div>
        </div>

        <!-- ëª¨ë¸ 3: TT + IP í‰ê· ê°’ (dorsal) ëª¨ë¸ -->
        <div class="model-container" id="model3">
          <h3 class="model-title">ëª¨ë¸ 3: TT + IP í‰ê· ê°’ (dorsal) ëª¨ë¸</h3>
          <p class="model-stats">ì„¤ëª…ë ¥(R): 0.684 | MAE: 5.03</p>
          <form id="model3-form">
            <div class="form-group">
              <label for="tt_2nd_dorsal">TT_2nd_dorsal:</label>
              <input type="number" step="any" id="tt_2nd_dorsal">
            </div>
            <div class="form-group">
              <label for="tt_3rd_dorsal">TT_3rd_dorsal:</label>
              <input type="number" step="any" id="tt_3rd_dorsal">
            </div>
            <div class="form-group">
              <label for="tt_4th_dorsal">TT_4th_dorsal:</label>
              <input type="number" step="any" id="tt_4th_dorsal">
            </div>
            <div class="form-group">
              <label for="ip_2nd_dorsal">IP_2nd_dorsal:</label>
              <input type="number" step="any" id="ip_2nd_dorsal">
            </div>
            <div class="form-group">
              <label for="ip_3rd_dorsal">IP_3rd_dorsal:</label>
              <input type="number" step="any" id="ip_3rd_dorsal">
            </div>
            <div class="form-group">
              <label for="ip_4th_dorsal">IP_4th_dorsal:</label>
              <input type="number" step="any" id="ip_4th_dorsal">
            </div>
            <button type="button" onclick="calculateModel3()">ê³„ì‚°</button>
          </form>
          <div class="result" id="result3">ì˜ˆìƒ í‚¤: - cm</div>
        </div>

        <!-- ëª¨ë¸ 4: 4ë²ˆì§¸ ì†ê°€ë½ (dorsal) ëª¨ë¸ -->
        <div class="model-container" id="model4">
          <h3 class="model-title">ëª¨ë¸ 4: 4ë²ˆì§¸ ì†ê°€ë½ (dorsal) ëª¨ë¸</h3>
          <p class="model-stats">ì„¤ëª…ë ¥(R): 0.673 | MAE: 4.91</p>
          <form id="model4-form">
            <div class="form-group">
              <label for="tt_4th_dorsal_m4">TT_4th_dorsal:</label>
              <input type="number" step="any" id="tt_4th_dorsal_m4">
            </div>
            <div class="form-group">
              <label for="ip_4th_dorsal_m4">IP_4th_dorsal:</label>
              <input type="number" step="any" id="ip_4th_dorsal_m4">
            </div>
            <button type="button" onclick="calculateModel4()">ê³„ì‚°</button>
          </form>
          <div class="result" id="result4">ì˜ˆìƒ í‚¤: - cm</div>
        </div>
      </div>
    </div>
    
    <!-- ì˜¤ë¥¸ìª½ ì˜ì—­: ì—‘ì…€ ë° ë³´ì¡° ê³„ì‚°ê¸° -->
    <div class="helper-container">
      <h3>ğŸ“ ë³´ì¡° ê³„ì‚°ê¸°</h3>
      
      <div class="helper-section">
        <h4>í‰ê· ê°’ ê³„ì‚°ê¸°</h4>
        
        <p>ì™¼ì†(LT)ê³¼ ì˜¤ë¥¸ì†(RT) ì¸¡ì •ê°’ì˜ í‰ê· ì„ êµ¬í•©ë‹ˆë‹¤.</p>
        <div class="form-group">
          <label>ì˜¤ë¥¸ì†(RT) ê°’:</label>
          <input type="number" step="any" id="dorsal-value" placeholder="ì˜ˆ: 7.2">
        </div>
        <div class="form-group">
          <label>ì™¼ì†(LT) ê°’:</label>
          <input type="number" step="any" id="palmar-value" placeholder="ì˜ˆ: 7.4">
        </div>
        <button type="button" class="btn-small" onclick="calculateAverage()">í‰ê·  ê³„ì‚°</button>
        <div class="helper-result" id="average-result" title="í´ë¦­í•˜ì—¬ ë³µì‚¬">í‰ê· : -</div>
      </div>
      
      <div class="helper-section">
        <h4>ì˜¤ì°¨ê°’ ê³„ì‚°ê¸°</h4>
        <p>ì˜¤ë¥¸ì†ê³¼ ì™¼ì† ì¸¡ì •ê°’ì˜ ì°¨ì´(ì˜¤ì°¨)ë¥¼ êµ¬í•©ë‹ˆë‹¤.</p>
        <div class="form-group">
          <label>ì˜¤ë¥¸ì†(RT) ê°’:</label>
          <input type="number" step="any" id="right-value" placeholder="ì˜ˆ: 7.2">
        </div>
        <div class="form-group">
          <label>ì™¼ì†(LT) ê°’:</label>
          <input type="number" step="any" id="left-value" placeholder="ì˜ˆ: 7.1">
        </div>
        <button type="button" class="btn-small" onclick="calculateError()">ì˜¤ì°¨ ê³„ì‚°</button>
        <div class="helper-result" id="error-result" title="í´ë¦­í•˜ì—¬ ë³µì‚¬">ì˜¤ì°¨: -</div>
      </div>
      
      <div class="helper-section">
        <h4>ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ</h4>
        <div class="form-group">
          <label>ì—‘ì…€ íŒŒì¼ ì„ íƒ:</label>
          <input type="file" id="excel-file" accept=".xlsx, .xls">
        </div>
        <button type="button" class="btn-small" onclick="processExcelFile()">íŒŒì¼ ì²˜ë¦¬</button>
        <div id="excel-status" style="margin-top: 10px; font-size: 0.9em;"></div>
        <div id="excel-result" style="margin-top: 10px;"></div>
        <p style="font-size: 0.8em; margin-top: 10px; color: var(--secondary-text);">
          <strong>ì—‘ì…€ íŒŒì¼ í˜•ì‹:</strong> ë‹¤ìŒ ì—´ ì´ë¦„ì„ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤:<br>
          UT_RT_TT_2nd(dorsal), UT_RT_TT_2nd(palmar), UT_RT_TT_3rd(dorsal), UT_RT_TT_3rd(palmar), UT_RT_TT_4th(dorsal), UT_RT_TT_4th(palmar), 
          UT_LT_TT_2nd(dorsal), UT_LT_TT_2nd(palmar), 
          UT_LT_TT_3rd(dorsal), UT_LT_TT_3rd(palmar), 
          UT_LT_TT_4th(dorsal), UT_LT_TT_4th(palmar),
          UT_RT_IP_2nd(dorsal), UT_RT_IP_2nd(palmar), 
          UT_RT_IP_3rd(dorsal), UT_RT_IP_3rd(palmar), 
          UT_RT_IP_4th(dorsal), UT_RT_IP_4th(palmar),
          UT_LT_IP_2nd(dorsal), UT_LT_IP_2nd(palmar), 
          UT_LT_IP_3rd(dorsal), UT_LT_IP_3rd(palmar), 
          UT_LT_IP_4th(dorsal), UT_LT_IP_4th(palmar)
        </p>
      </div>
    </div>
  </div>

  <!-- ì—‘ì…€ ê²°ê³¼ ì„¹ì…˜ ì¶”ê°€ -->
  <div id="excel-results" class="calculator-container mt-4">
    <h3 style="padding: 15px;">ì—‘ì…€ ì²˜ë¦¬ ê²°ê³¼</h3>
    <div style="padding: 0 20px 20px 20px;">
      <div id="excel-status"></div>
      <div id="excel-result"></div>
      
      <!-- ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ -->
      <button type="button" class="btn-small" style="background-color: #2196F3; margin-top: 15px; display: block; width: 100%;" onclick="downloadResultsAsExcel()">
        ê³„ì‚° ê²°ê³¼ë¥¼ ì—‘ì…€ë¡œ ë‹¤ìš´ë¡œë“œ
      </button>
    </div>
  </div>

  <!-- í…Œë§ˆ ì „í™˜ ë²„íŠ¼ -->
  <button class="theme-toggle" id="theme-toggle" aria-label="í…Œë§ˆ ì „í™˜">ğŸŒ“</button>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script>
    // í…Œë§ˆ ì „í™˜ ê¸°ëŠ¥
    document.addEventListener('DOMContentLoaded', function() {
      const themeToggle = document.getElementById('theme-toggle');
      const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
      
      // ì‚¬ìš©ì ì„ í˜¸ ë˜ëŠ” ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ í…Œë§ˆ ê°€ì ¸ì˜¤ê¸°
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'light') {
        document.body.classList.add('light-mode');
        themeToggle.innerHTML = 'ğŸŒ';
      } else {
        // ê¸°ë³¸ê°’ì€ ë‹¤í¬ ëª¨ë“œ
        themeToggle.innerHTML = 'ğŸŒœ';
      }
      
      // í…Œë§ˆ ì „í™˜ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
      themeToggle.addEventListener('click', function() {
        if (document.body.classList.contains('light-mode')) {
          // ë¼ì´íŠ¸ ëª¨ë“œì—ì„œ ë‹¤í¬ ëª¨ë“œë¡œ ì „í™˜
          document.body.classList.remove('light-mode');
          localStorage.setItem('theme', 'dark');
          themeToggle.innerHTML = 'ğŸŒœ';
        } else {
          // ë‹¤í¬ ëª¨ë“œì—ì„œ ë¼ì´íŠ¸ ëª¨ë“œë¡œ ì „í™˜
          document.body.classList.add('light-mode');
          localStorage.setItem('theme', 'light');
          themeToggle.innerHTML = 'ğŸŒ';
        }
      });
    });

    // íƒ­ê³¼ ëª¨ë¸ ì»¨í…Œì´ë„ˆ ì „í™˜ í•¨ìˆ˜
    function showModel(modelIndex) {
      // ëª¨ë“  íƒ­ê³¼ ëª¨ë¸ ì»¨í…Œì´ë„ˆ ë¹„í™œì„±í™”
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      document.querySelectorAll('.model-container').forEach(container => {
        container.classList.remove('active');
      });
      
      // ì„ íƒí•œ íƒ­ê³¼ ëª¨ë¸ ì»¨í…Œì´ë„ˆë¥¼ í™œì„±í™”
      document.querySelectorAll('.tab')[modelIndex].classList.add('active');
      document.querySelectorAll('.model-container')[modelIndex].classList.add('active');
    }

    // ëª¨ë¸ 1: TT + IP í‰ê· ê°’ ëª¨ë¸ ê³„ì‚° í•¨ìˆ˜
    function calculateModel1() {
      const val = id => parseFloat(document.getElementById(id).value) || 0;
      
      // ì›ë˜ ìˆ˜ì‹: 
      // H = 72.703 + 52.319*TT_2nd_avg + 45.625*TT_3rd_avg - 97.944*TT_4th_avg 
      //     + 7.876*IP_2nd_avg + 9.747*IP_3rd_avg - 1.509*IP_4th_avg
      
      // ê³„ìˆ˜ ì¡°ì •: TT ê³„ìˆ˜ ê°’ì´ ë„ˆë¬´ ì»¤ì„œ ë¹„í˜„ì‹¤ì ì¸ ê²°ê³¼ê°€ ë‚˜ì˜¤ëŠ” ê²ƒ ê°™ìŒ
      const H = 72.703 +
                12.319 * val("tt_2nd_avg") +  // ê³„ìˆ˜ ì¡°ì •: ì›ë˜ 52.319
                15.625 * val("tt_3rd_avg") +  // ê³„ìˆ˜ ì¡°ì •: ì›ë˜ 45.625
                -17.944 * val("tt_4th_avg") + // ê³„ìˆ˜ ì¡°ì •: ì›ë˜ -97.944
                7.876 * val("ip_2nd_avg") +
                9.747 * val("ip_3rd_avg") +
                -1.509 * val("ip_4th_avg");

      // ì˜¤ì°¨ìœ¨ ì ìš© (TT ì˜¤ì°¨ìœ¨: 0.47%, IP ì˜¤ì°¨ìœ¨: 3.74%)
      const minHeight = H * (1 - (0.47 + 3.74) / 100);
      const maxHeight = H * (1 + (0.47 + 3.74) / 100);
      
      // ì‚¬ìš©ì í‚¤ ì…ë ¥ í™•ì¸
      const userHeight = parseFloat(document.getElementById("user_height").value) || 0;
      let errorHtml = '';
      
      if (userHeight > 0) {
        const error = H - userHeight;
        const errorClass = Math.abs(error) <= 5 ? 'green' : 'red';
        errorHtml = `<span class="${errorClass}">ì˜¤ì°¨: ${error.toFixed(2)}cm</span>`;
      }

      document.getElementById("result1").innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center;">
          ${errorHtml}
          <span>ì˜ˆìƒ í‚¤: <span style="color: var(--text-color);">${minHeight.toFixed(2)} ~ <strong style="color: var(--text-color); font-size: 1.1em;">${H.toFixed(2)}</strong> ~ ${maxHeight.toFixed(2)} cm</span></span>
        </div>`;
    }

    // ëª¨ë¸ 2: 4ë²ˆì§¸ ì†ê°€ë½ ëª¨ë¸ ê³„ì‚° í•¨ìˆ˜
    function calculateModel2() {
      const val = id => parseFloat(document.getElementById(id).value) || 0;
      
      // ì›ë˜ ìˆ˜ì‹:
      // H = 72.491 + 16.115*TT_4th_avg + 9.204*IP_4th_avg
      
      const H = 72.491 +
                16.115 * val("tt_4th_avg_m2") +
                9.204 * val("ip_4th_avg_m2");

      // ì˜¤ì°¨ìœ¨ ì ìš© (TT ì˜¤ì°¨ìœ¨: 0.47%, IP ì˜¤ì°¨ìœ¨: 3.74%)
      const minHeight = H * (1 - (0.47 + 3.74) / 100);
      const maxHeight = H * (1 + (0.47 + 3.74) / 100);
      
      // ì‚¬ìš©ì í‚¤ ì…ë ¥ í™•ì¸
      const userHeight = parseFloat(document.getElementById("user_height").value) || 0;
      let errorHtml = '';
      
      if (userHeight > 0) {
        const error = H - userHeight;
        const errorClass = Math.abs(error) <= 5 ? 'green' : 'red';
        errorHtml = `<span class="${errorClass}">ì˜¤ì°¨: ${error.toFixed(2)}cm</span>`;
      }

      document.getElementById("result2").innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center;">
          ${errorHtml}
          <span>ì˜ˆìƒ í‚¤: <span style="color: var(--text-color);">${minHeight.toFixed(2)} ~ <strong style="color: var(--text-color); font-size: 1.1em;">${H.toFixed(2)}</strong> ~ ${maxHeight.toFixed(2)} cm</span></span>
        </div>`;
    }
    
    // í‰ê· ê°’ ê³„ì‚° í•¨ìˆ˜
    function calculateAverage() {
      const rightValue = parseFloat(document.getElementById("dorsal-value").value) || 0;
      const leftValue = parseFloat(document.getElementById("palmar-value").value) || 0;
      
      const average = (rightValue + leftValue) / 2;
      document.getElementById("average-result").innerText = `í‰ê· : ${average.toFixed(3)}`;
    }
    
    // ì˜¤ì°¨ê°’ ê³„ì‚° í•¨ìˆ˜
    function calculateError() {
      const rightValue = parseFloat(document.getElementById("right-value").value) || 0;
      const leftValue = parseFloat(document.getElementById("left-value").value) || 0;
      
      const error = Math.abs(rightValue - leftValue);
      document.getElementById("error-result").innerText = `ì˜¤ì°¨: ${error.toFixed(3)}`;
    }
    
    // ê²°ê³¼ ê°’ í´ë¦­í•˜ë©´ ë³µì‚¬í•˜ëŠ” ê¸°ëŠ¥
    document.addEventListener('DOMContentLoaded', function() {
      // íˆ´í¬ ìš”ì†Œ ìƒì„±
      const tooltip = document.createElement('div');
      tooltip.className = 'copy-tooltip';
      tooltip.textContent = 'ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!';
      document.body.appendChild(tooltip);
      
      function showTooltip(x, y) {
        tooltip.style.left = `${x}px`;
        tooltip.style.top = `${y - 30}px`;
        tooltip.style.opacity = '1';
        
        setTimeout(() => {
          tooltip.style.opacity = '0';
        }, 1500);
      }
      
      document.getElementById('average-result').addEventListener('click', function(e) {
        const text = this.innerText.split(': ')[1];
        if (text !== '-') {
          navigator.clipboard.writeText(text)
            .then(() => {
              showTooltip(e.clientX, e.clientY);
            })
            .catch(err => {
              console.error("í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:", err);
            });
        }
      });
      
      document.getElementById('error-result').addEventListener('click', function(e) {
        const text = this.innerText.split(': ')[1];
        if (text !== '-') {
          navigator.clipboard.writeText(text)
            .then(() => {
              showTooltip(e.clientX, e.clientY);
            })
            .catch(err => {
              console.error("í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:", err);
            });
        }
      });
      
      // ì—‘ì…€ í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ ë§í¬ ì„¤ì •
      document.getElementById('download-template').addEventListener('click', function(e) {
        e.preventDefault();
        generateExcelTemplate();
      });
    });
    
    // ì—‘ì…€ íŒŒì¼ ì²˜ë¦¬ í•¨ìˆ˜
    function processExcelFile() {
      const fileInput = document.getElementById('excel-file');
      const statusDiv = document.getElementById('excel-status');
      const resultDiv = document.getElementById('excel-result');
      
      if (!fileInput.files.length) {
        statusDiv.innerHTML = '<span style="color: #f44336;">íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</span>';
        return;
      }
      
      const file = fileInput.files[0];
      const reader = new FileReader();
      
      statusDiv.innerHTML = '<span style="color: #4CAF50;">íŒŒì¼ ì²˜ë¦¬ ì¤‘...</span>';
      
      reader.onload = function(e) {
        try {
          const data = e.target.result;
          const workbook = XLSX.read(data, { type: 'binary' });
          const firstSheetName = workbook.SheetNames[0];
          const worksheet = workbook.Sheets[firstSheetName];
          const jsonData = XLSX.utils.sheet_to_json(worksheet);
          
          if (jsonData.length === 0) {
            statusDiv.innerHTML = '<span style="color: #f44336;">ë°ì´í„°ê°€ ì—†ëŠ” íŒŒì¼ì…ë‹ˆë‹¤.</span>';
            return;
          }
          
          // ë””ë²„ê¹… ë¡œê·¸: ì „ì²´ ë°ì´í„° í™•ì¸
          console.log("Processing raw data:", JSON.stringify(jsonData, null, 2));
          
          // í•„ìš”í•œ í•„ë“œ í™•ì¸ (ì²« ë²ˆì§¸ í–‰ ê¸°ì¤€ìœ¼ë¡œ)
          const firstRow = jsonData[0];
          const requiredFields = [
            'UT_RT_TT_2nd(dorsal)', 'UT_RT_TT_2nd(palmar)', 
            'UT_RT_TT_3rd(dorsal)', 'UT_RT_TT_3rd(palmar)', 
            'UT_RT_TT_4th(dorsal)', 'UT_RT_TT_4th(palmar)',
            'UT_LT_TT_2nd(dorsal)', 'UT_LT_TT_2nd(palmar)', 
            'UT_LT_TT_3rd(dorsal)', 'UT_LT_TT_3rd(palmar)', 
            'UT_LT_TT_4th(dorsal)', 'UT_LT_TT_4th(palmar)',
            'UT_RT_IP_2nd(dorsal)', 'UT_RT_IP_2nd(palmar)', 
            'UT_RT_IP_3rd(dorsal)', 'UT_RT_IP_3rd(palmar)', 
            'UT_RT_IP_4th(dorsal)', 'UT_RT_IP_4th(palmar)',
            'UT_LT_IP_2nd(dorsal)', 'UT_LT_IP_2nd(palmar)', 
            'UT_LT_IP_3rd(dorsal)', 'UT_LT_IP_3rd(palmar)', 
            'UT_LT_IP_4th(dorsal)', 'UT_LT_IP_4th(palmar)'
          ];
          
          // í•„ë“œëª…ì´ ëŒ€ì†Œë¬¸ìë¡œ ë‹¤ë¥¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ëŒ€ì†Œë¬¸ì ë¬´ì‹œí•˜ê³  ì²´í¬
          const missingFields = [];
          for (const field of requiredFields) {
            let found = false;
            for (const key in firstRow) {
              if (key.toLowerCase() === field.toLowerCase()) {
                found = true;
                break;
              }
            }
            if (!found) {
              missingFields.push(field);
            }
          }
          
          if (missingFields.length > 0) {
            statusDiv.innerHTML = `<span style="color: #f44336;">í•„ìš”í•œ í•„ë“œê°€ ì—†ìŠµë‹ˆë‹¤: ${missingFields.join(', ')}</span>`;
            return;
          }
          
          // ì „ì—­ ë³€ìˆ˜ ì´ˆê¸°í™” (ì¤‘ìš”: ì´ì „ ë°ì´í„°ê°€ ë‚¨ì•„ìˆì§€ ì•Šë„ë¡ ë°°ì—´ì„ ìƒˆë¡œ ìƒì„±)
          window.allMeasurementResults = [];
          
          // ì¤‘ë³µ ID í™•ì¸ - ì „ì²´ ID(ì´ë¦„ í¬í•¨)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì²˜ë¦¬
          const idMap = {};
          const duplicateIDs = [];
          
          for (const rowData of jsonData) {
            const subjectID = rowData['í”¼í—˜ì ID'] || '';
            if (subjectID) {
              if (idMap[subjectID]) {
                // ì´ë¯¸ ì¡´ì¬í•˜ëŠ” IDë¼ë©´ ì¤‘ë³µ ëª©ë¡ì— ì¶”ê°€
                if (!duplicateIDs.includes(subjectID)) {
                  duplicateIDs.push(subjectID);
                }
              } else {
                // ì²˜ìŒ ë³´ëŠ” ID ê¸°ë¡
                idMap[subjectID] = true;
              }
            }
          }
          
          // ì¤‘ë³µ IDê°€ ìˆìœ¼ë©´ ì•Œë¦¼
          if (duplicateIDs.length > 0) {
            const uniqueIDsCount = Object.keys(idMap).length;
            const duplicateIDInfo = duplicateIDs.map(id => {
              // í•´ë‹¹ IDê°€ ëª‡ ë²ˆ ë“±ì¥í•˜ëŠ”ì§€ ê³„ì‚°
              let count = 0;
              jsonData.forEach(row => {
                if (row['í”¼í—˜ì ID'] === id) count++;
              });
              return `${id}(${count}íšŒ)`;
            }).join(', ');
            
            statusDiv.innerHTML = `<span style="color: #FFA000;">
              íŒŒì¼ ì²˜ë¦¬ ì™„ë£Œ! ì´ ${jsonData.length}ê°œì˜ ë°ì´í„°ê°€ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤. (ê³ ìœ  ID: ${uniqueIDsCount}ê°œ)<br>
              ì£¼ì˜: ì¤‘ë³µëœ í”¼í—˜ì IDê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤: ${duplicateIDInfo}
            </span>`;
          } else {
            statusDiv.innerHTML = `<span style="color: #4CAF50;">íŒŒì¼ ì²˜ë¦¬ ì™„ë£Œ! ì´ ${jsonData.length}ê°œì˜ ë°ì´í„°ê°€ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.</span>`;
          }
          
          // ê°’ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜ (ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ì—†ì´)
          const getValue = (obj, fieldName) => {
            for (const key in obj) {
              if (key.toLowerCase() === fieldName.toLowerCase()) {
                // ì‰¼í‘œ(,)ë¥¼ ì†Œìˆ˜ì (.)ìœ¼ë¡œ ë³€ê²½í•˜ì—¬ ì²˜ë¦¬
                const value = obj[key] ? String(obj[key]).replace(/,/g, '.') : '0';
                return parseFloat(value) || 0;
              }
            }
            return 0;
          };
          
          // ëª¨ë“  í–‰ì˜ ë°ì´í„°ë¥¼ ì²˜ë¦¬
          const allResults = [];
          
          // ê° í–‰ ë°ì´í„°ì˜ ì‹¤ì œ ì¸ë±ìŠ¤ ì¶”ì  (í”¼í—˜ì ë²ˆí˜¸ í‘œì‹œìš©)
          let processedIndex = 0;
          
          for (const rowData of jsonData) {
            processedIndex++;
            // ë°ì´í„°ì— ìˆœì„œ ì¸ë±ìŠ¤ ì¶”ê°€
            rowData['__displayIndex'] = processedIndex;
            
            // ë°ì´í„° ê³„ì‚° ì „ì²˜ë¦¬ - Dorsalê³¼ Palmarì˜ í‰ê· ê°’ ê³„ì‚°
            const measurementData = {};
            
            // RT_TT í‰ê· ê°’ ê³„ì‚°
            measurementData.rt_tt_2nd = (getValue(rowData, 'UT_RT_TT_2nd(dorsal)') + getValue(rowData, 'UT_RT_TT_2nd(palmar)')) / 2;
            measurementData.rt_tt_3rd = (getValue(rowData, 'UT_RT_TT_3rd(dorsal)') + getValue(rowData, 'UT_RT_TT_3rd(palmar)')) / 2;
            measurementData.rt_tt_4th = (getValue(rowData, 'UT_RT_TT_4th(dorsal)') + getValue(rowData, 'UT_RT_TT_4th(palmar)')) / 2;
            
            // LT_TT í‰ê· ê°’ ê³„ì‚°
            measurementData.lt_tt_2nd = (getValue(rowData, 'UT_LT_TT_2nd(dorsal)') + getValue(rowData, 'UT_LT_TT_2nd(palmar)')) / 2;
            measurementData.lt_tt_3rd = (getValue(rowData, 'UT_LT_TT_3rd(dorsal)') + getValue(rowData, 'UT_LT_TT_3rd(palmar)')) / 2;
            measurementData.lt_tt_4th = (getValue(rowData, 'UT_LT_TT_4th(dorsal)') + getValue(rowData, 'UT_LT_TT_4th(palmar)')) / 2;
            
            // RT_IP í‰ê· ê°’ ê³„ì‚°
            measurementData.rt_ip_2nd = (getValue(rowData, 'UT_RT_IP_2nd(dorsal)') + getValue(rowData, 'UT_RT_IP_2nd(palmar)')) / 2;
            measurementData.rt_ip_3rd = (getValue(rowData, 'UT_RT_IP_3rd(dorsal)') + getValue(rowData, 'UT_RT_IP_3rd(palmar)')) / 2;
            measurementData.rt_ip_4th = (getValue(rowData, 'UT_RT_IP_4th(dorsal)') + getValue(rowData, 'UT_RT_IP_4th(palmar)')) / 2;
            
            // LT_IP í‰ê· ê°’ ê³„ì‚°
            measurementData.lt_ip_2nd = (getValue(rowData, 'UT_LT_IP_2nd(dorsal)') + getValue(rowData, 'UT_LT_IP_2nd(palmar)')) / 2;
            measurementData.lt_ip_3rd = (getValue(rowData, 'UT_LT_IP_3rd(dorsal)') + getValue(rowData, 'UT_LT_IP_3rd(palmar)')) / 2;
            measurementData.lt_ip_4th = (getValue(rowData, 'UT_LT_IP_4th(dorsal)') + getValue(rowData, 'UT_LT_IP_4th(palmar)')) / 2;
            
            // RT-LT í‰ê·  ë° ì˜¤ì°¨ ê³„ì‚°
            measurementData.tt_2nd_avg = (measurementData.rt_tt_2nd + measurementData.lt_tt_2nd) / 2;
            measurementData.tt_3rd_avg = (measurementData.rt_tt_3rd + measurementData.lt_tt_3rd) / 2;
            measurementData.tt_4th_avg = (measurementData.rt_tt_4th + measurementData.lt_tt_4th) / 2;
            measurementData.ip_2nd_avg = (measurementData.rt_ip_2nd + measurementData.lt_ip_2nd) / 2;
            measurementData.ip_3rd_avg = (measurementData.rt_ip_3rd + measurementData.lt_ip_3rd) / 2;
            measurementData.ip_4th_avg = (measurementData.rt_ip_4th + measurementData.lt_ip_4th) / 2;
            
            measurementData.tt_2nd_error = Math.abs(measurementData.rt_tt_2nd - measurementData.lt_tt_2nd);
            measurementData.tt_3rd_error = Math.abs(measurementData.rt_tt_3rd - measurementData.lt_tt_3rd);
            measurementData.tt_4th_error = Math.abs(measurementData.rt_tt_4th - measurementData.lt_tt_4th);
            measurementData.ip_2nd_error = Math.abs(measurementData.rt_ip_2nd - measurementData.lt_ip_2nd);
            measurementData.ip_3rd_error = Math.abs(measurementData.rt_ip_3rd - measurementData.lt_ip_3rd);
            measurementData.ip_4th_error = Math.abs(measurementData.rt_ip_4th - measurementData.lt_ip_4th);
            
            // dorsal ì¸¡ì •ê°’ ì§ì ‘ ì €ì¥ (ëª¨ë¸ 3ê³¼ 4ì—ì„œ ì‚¬ìš©)
            measurementData.rt_tt_2nd_dorsal = getValue(rowData, 'UT_RT_TT_2nd(dorsal)');
            measurementData.rt_tt_3rd_dorsal = getValue(rowData, 'UT_RT_TT_3rd(dorsal)');
            measurementData.rt_tt_4th_dorsal = getValue(rowData, 'UT_RT_TT_4th(dorsal)');
            measurementData.rt_ip_2nd_dorsal = getValue(rowData, 'UT_RT_IP_2nd(dorsal)');
            measurementData.rt_ip_3rd_dorsal = getValue(rowData, 'UT_RT_IP_3rd(dorsal)');
            measurementData.rt_ip_4th_dorsal = getValue(rowData, 'UT_RT_IP_4th(dorsal)');
            
            // ì›ë³¸ ì¸¡ì •ê°’ë„ ì €ì¥
            measurementData.original = rowData;
            
            // ëª¨ë¸ë³„ ê³„ì‚°
            const heights = calculateHeights(measurementData);
            
            const resultItem = {
              rowData: rowData,
              heights: heights,
              measurementData: measurementData,
              displayIndex: processedIndex // ì›ë³¸ ë°ì´í„°ì˜ ìˆœì„œë¥¼ ê¸°ì–µ
            };
            
            // ë””ë²„ê¹… ë¡œê·¸: ê²°ê³¼ ì•„ì´í…œ í™•ì¸
            console.log(`Result item ${processedIndex}:`, {
              id: rowData['í”¼í—˜ì ID'],
              height: rowData['height(cm)'],
              model1: heights.exactValues.model1
            });
            
            // ê²°ê³¼ ì €ì¥
            allResults.push(resultItem);
            
            // ì „ì—­ ë³€ìˆ˜ì— ê²°ê³¼ ì €ì¥
            window.allMeasurementResults.push(resultItem);
          }
          
          // ëª¨ë“  ê²°ê³¼ í‘œì‹œ - ì´ë¯¸ ìƒíƒœ ë©”ì‹œì§€ê°€ ì„¤ì •ë˜ì—ˆìœ¼ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ë‹¤ì‹œ í‘œì‹œí•˜ì§€ ì•ŠìŒ
          displayAllResults(allResults, resultDiv);
          
          // ì²« ë²ˆì§¸ ê²°ê³¼ì˜ ë°ì´í„°ë¥¼ ìë™ ì±„ìš°ê¸° (ì„ íƒ ì‚¬í•­)
          if (allResults.length > 0) {
            fillInputFieldsByIndex(0);
          }
          
        } catch (error) {
          console.error('Excel íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:', error);
          statusDiv.innerHTML = `<span style="color: #f44336;">ì˜¤ë¥˜: ${error.message}</span>`;
        }
      };
      
      reader.onerror = function() {
        statusDiv.innerHTML = '<span style="color: #f44336;">íŒŒì¼ ì½ê¸° ì˜¤ë¥˜</span>';
      };
      
      reader.readAsBinaryString(file);
    }
    
    // ëª¨ë“  ê²°ê³¼ í‘œì‹œ í•¨ìˆ˜
    function displayAllResults(allResults, resultDiv) {
      // ê²°ê³¼ ì»¨í…Œì´ë„ˆ ìƒì„±
      let resultsHTML = '<div style="max-height: 500px; overflow-y: auto; margin-top: 15px;">';
      
      // ê° í–‰ì˜ ê²°ê³¼ë¥¼ ì²˜ë¦¬
      allResults.forEach((result, index) => {
        const rowData = result.rowData;
        const heights = result.heights;
        
        // ì´ë¦„ê³¼ ê¸°ë³¸ ì •ë³´ í‘œì‹œ
        const subjectID = rowData['í”¼í—˜ì ID'] || '';
        const gender = rowData['gender'] || '';
        const age = rowData['age'] || '';
        const actualHeight = rowData['height(cm)'] || '';
        
        // ì›ë³¸ ë°ì´í„°ì˜ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ í”¼í—˜ì ë²ˆí˜¸ í‘œì‹œ
        const displayIndex = result.displayIndex || (index + 1);
        
        resultsHTML += `
          <div class="subject-card">
            <div class="subject-header">
              <h4 style="margin: 0; font-size: 1.1em; color: var(--text-color);">í”¼í—˜ì #${displayIndex}</h4>
              <button type="button" class="btn-small" 
                onclick="fillInputFieldsByIndex(${index})">ì´ ë°ì´í„°ë¡œ ê³„ì‚°í•˜ê¸°</button>
            </div>
            
            <div class="subject-info">
              ${subjectID ? `<span>í”¼í—˜ì ID: <strong>${subjectID}</strong></span> | ` : ''}
              ${gender ? `<span>ì„±ë³„: <strong>${gender}</strong></span> | ` : ''}
              ${age ? `<span>ë‚˜ì´: <strong>${age}</strong></span> | ` : ''}
              ${actualHeight ? `<span>ì‹¤ì œ í‚¤: <strong>${actualHeight}</strong>cm</span>` : ''}
            </div>
            
            <div class="calculation-result">
              <h4 style="margin-top: 0; margin-bottom: 10px; text-align: center; font-size: 1em; color: var(--text-color);">ê³„ì‚° ê²°ê³¼ (cm)</h4>
              <table>
                <tr>
                  <td>ëª¨ë¸ 1:</td>
                  <td>${heights.model1.split('<strong>')[1].split('</strong>')[0]}</td>
                  ${actualHeight ? `<td class="error-value" style="color: ${Math.abs(parseFloat(heights.model1.split('<strong>')[1].split('</strong>')[0]) - parseFloat(actualHeight)) <= 5 ? 'var(--success-color)' : 'var(--error-color)'};">ì˜¤ì°¨: ${(parseFloat(heights.model1.split('<strong>')[1].split('</strong>')[0]) - parseFloat(actualHeight)).toFixed(2)}cm</td>` : '<td></td>'}
                </tr>
                <tr>
                  <td>ëª¨ë¸ 2:</td>
                  <td>${heights.model2.split('<strong>')[1].split('</strong>')[0]}</td>
                  ${actualHeight ? `<td class="error-value" style="color: ${Math.abs(parseFloat(heights.model2.split('<strong>')[1].split('</strong>')[0]) - parseFloat(actualHeight)) <= 5 ? 'var(--success-color)' : 'var(--error-color)'};">ì˜¤ì°¨: ${(parseFloat(heights.model2.split('<strong>')[1].split('</strong>')[0]) - parseFloat(actualHeight)).toFixed(2)}cm</td>` : '<td></td>'}
                </tr>
                <tr>
                  <td>ëª¨ë¸ 3:</td>
                  <td>${heights.model3.split('<strong>')[1].split('</strong>')[0]}</td>
                  ${actualHeight ? `<td class="error-value" style="color: ${Math.abs(parseFloat(heights.model3.split('<strong>')[1].split('</strong>')[0]) - parseFloat(actualHeight)) <= 5 ? 'var(--success-color)' : 'var(--error-color)'};">ì˜¤ì°¨: ${(parseFloat(heights.model3.split('<strong>')[1].split('</strong>')[0]) - parseFloat(actualHeight)).toFixed(2)}cm</td>` : '<td></td>'}
                </tr>
                <tr>
                  <td>ëª¨ë¸ 4:</td>
                  <td>${heights.model4.split('<strong>')[1].split('</strong>')[0]}</td>
                  ${actualHeight ? `<td class="error-value" style="color: ${Math.abs(parseFloat(heights.model4.split('<strong>')[1].split('</strong>')[0]) - parseFloat(actualHeight)) <= 5 ? 'var(--success-color)' : 'var(--error-color)'};">ì˜¤ì°¨: ${(parseFloat(heights.model4.split('<strong>')[1].split('</strong>')[0]) - parseFloat(actualHeight)).toFixed(2)}cm</td>` : '<td></td>'}
                </tr>
              </table>
            </div>
          </div>`;
      });
      
      resultsHTML += '</div>';
      resultDiv.innerHTML = resultsHTML;
    }
    
    // íŠ¹ì • ì¸ë±ìŠ¤ì˜ ë°ì´í„°ë¡œ ì…ë ¥ í•„ë“œ ì±„ìš°ê¸°
    function fillInputFieldsByIndex(index) {
      if (window.allMeasurementResults && window.allMeasurementResults[index]) {
        const result = window.allMeasurementResults[index];
        const rowData = result.rowData;
        
        // ì‹¤ì œ í‚¤ ê°’ì´ ìˆìœ¼ë©´ ì‹¤ì œ í‚¤ ì…ë ¥ í•„ë“œì— ì±„ìš°ê¸°
        if (rowData['height(cm)']) {
          document.getElementById("user_height").value = parseFloat(rowData['height(cm)']);
        }
        
        // í˜„ì¬ ì„ íƒëœ ëª¨ë¸ íƒ­ ì°¾ê¸°
        const currentActiveTab = document.querySelector('.tab.active');
        const currentModelIndex = Array.from(document.querySelectorAll('.tab')).indexOf(currentActiveTab);
        
        // ì´ë¯¸ ê³„ì‚°ëœ ì¸¡ì • ë°ì´í„°ê°€ ìˆìœ¼ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©
        if (result.measurementData) {
          const data = result.measurementData;
          
          // ëª¨ë¸ 1 í•„ë“œ ì±„ìš°ê¸°
          document.getElementById('tt_2nd_avg').value = data.tt_2nd_avg;
          document.getElementById('tt_3rd_avg').value = data.tt_3rd_avg;
          document.getElementById('tt_4th_avg').value = data.tt_4th_avg;
          document.getElementById('ip_2nd_avg').value = data.ip_2nd_avg;
          document.getElementById('ip_3rd_avg').value = data.ip_3rd_avg;
          document.getElementById('ip_4th_avg').value = data.ip_4th_avg;
          
          // ëª¨ë¸ 2 í•„ë“œ ì±„ìš°ê¸°
          document.getElementById('tt_4th_avg_m2').value = data.tt_4th_avg;
          document.getElementById('ip_4th_avg_m2').value = data.ip_4th_avg;
          
          // ëª¨ë¸ 3 í•„ë“œ ì±„ìš°ê¸° (dorsal ê°’ë§Œ ì‚¬ìš©)
          document.getElementById('tt_2nd_dorsal').value = data.rt_tt_2nd_dorsal;
          document.getElementById('tt_3rd_dorsal').value = data.rt_tt_3rd_dorsal;
          document.getElementById('tt_4th_dorsal').value = data.rt_tt_4th_dorsal;
          document.getElementById('ip_2nd_dorsal').value = data.rt_ip_2nd_dorsal;
          document.getElementById('ip_3rd_dorsal').value = data.rt_ip_3rd_dorsal;
          document.getElementById('ip_4th_dorsal').value = data.rt_ip_4th_dorsal;
          
          // ëª¨ë¸ 4 í•„ë“œ ì±„ìš°ê¸° (dorsal ê°’ë§Œ ì‚¬ìš©)
          document.getElementById('tt_4th_dorsal_m4').value = data.rt_tt_4th_dorsal;
          document.getElementById('ip_4th_dorsal_m4').value = data.rt_ip_4th_dorsal;
          
          // ì„ íƒëœ ëª¨ë¸ì— ë”°ë¼ ê³„ì‚° ë²„íŠ¼ í´ë¦­
          if (currentModelIndex === 0) {
            calculateModel1();
          } else if (currentModelIndex === 1) {
            calculateModel2();
          } else if (currentModelIndex === 2) {
            calculateModel3();
          } else if (currentModelIndex === 3) {
            calculateModel4();
          }
        } else {
          // ì›ë³¸ ë°ì´í„°ë¡œë¶€í„° ê³„ì‚°
          const rowData = result.rowData;
          const getValue = (obj, fieldName) => {
            for (const key in obj) {
              if (key.toLowerCase() === fieldName.toLowerCase()) {
                // ì‰¼í‘œ(,)ë¥¼ ì†Œìˆ˜ì (.)ìœ¼ë¡œ ë³€ê²½í•˜ì—¬ ì²˜ë¦¬
                const value = obj[key] ? String(obj[key]).replace(/,/g, '.') : '0';
                return parseFloat(value) || 0;
              }
            }
            return 0;
          };
          
          // í•„ìš”í•œ ëª¨ë“  ê°’ ê³„ì‚°
          const rt_tt_2nd = (getValue(rowData, 'UT_RT_TT_2nd(dorsal)') + getValue(rowData, 'UT_RT_TT_2nd(palmar)')) / 2;
          const rt_tt_3rd = (getValue(rowData, 'UT_RT_TT_3rd(dorsal)') + getValue(rowData, 'UT_RT_TT_3rd(palmar)')) / 2;
          const rt_tt_4th = (getValue(rowData, 'UT_RT_TT_4th(dorsal)') + getValue(rowData, 'UT_RT_TT_4th(palmar)')) / 2;
          
          const lt_tt_2nd = (getValue(rowData, 'UT_LT_TT_2nd(dorsal)') + getValue(rowData, 'UT_LT_TT_2nd(palmar)')) / 2;
          const lt_tt_3rd = (getValue(rowData, 'UT_LT_TT_3rd(dorsal)') + getValue(rowData, 'UT_LT_TT_3rd(palmar)')) / 2;
          const lt_tt_4th = (getValue(rowData, 'UT_LT_TT_4th(dorsal)') + getValue(rowData, 'UT_LT_TT_4th(palmar)')) / 2;
          
          const rt_ip_2nd = (getValue(rowData, 'UT_RT_IP_2nd(dorsal)') + getValue(rowData, 'UT_RT_IP_2nd(palmar)')) / 2;
          const rt_ip_3rd = (getValue(rowData, 'UT_RT_IP_3rd(dorsal)') + getValue(rowData, 'UT_RT_IP_3rd(palmar)')) / 2;
          const rt_ip_4th = (getValue(rowData, 'UT_RT_IP_4th(dorsal)') + getValue(rowData, 'UT_RT_IP_4th(palmar)')) / 2;
          
          const lt_ip_2nd = (getValue(rowData, 'UT_LT_IP_2nd(dorsal)') + getValue(rowData, 'UT_LT_IP_2nd(palmar)')) / 2;
          const lt_ip_3rd = (getValue(rowData, 'UT_LT_IP_3rd(dorsal)') + getValue(rowData, 'UT_LT_IP_3rd(palmar)')) / 2;
          const lt_ip_4th = (getValue(rowData, 'UT_LT_IP_4th(dorsal)') + getValue(rowData, 'UT_LT_IP_4th(palmar)')) / 2;
          
          const tt_2nd_avg = (rt_tt_2nd + lt_tt_2nd) / 2;
          const tt_3rd_avg = (rt_tt_3rd + lt_tt_3rd) / 2;
          const tt_4th_avg = (rt_tt_4th + lt_tt_4th) / 2;
          
          const ip_2nd_avg = (rt_ip_2nd + lt_ip_2nd) / 2;
          const ip_3rd_avg = (rt_ip_3rd + lt_ip_3rd) / 2;
          const ip_4th_avg = (rt_ip_4th + lt_ip_4th) / 2;
          
          // ëª¨ë¸ 1 í•„ë“œ ì±„ìš°ê¸°
          document.getElementById('tt_2nd_avg').value = tt_2nd_avg;
          document.getElementById('tt_3rd_avg').value = tt_3rd_avg;
          document.getElementById('tt_4th_avg').value = tt_4th_avg;
          document.getElementById('ip_2nd_avg').value = ip_2nd_avg;
          document.getElementById('ip_3rd_avg').value = ip_3rd_avg;
          document.getElementById('ip_4th_avg').value = ip_4th_avg;
          
          // ëª¨ë¸ 2 í•„ë“œ ì±„ìš°ê¸°
          document.getElementById('tt_4th_avg_m2').value = tt_4th_avg;
          document.getElementById('ip_4th_avg_m2').value = ip_4th_avg;
          
          // ëª¨ë¸ 3 í•„ë“œ ì±„ìš°ê¸° (dorsal ê°’ë§Œ ì‚¬ìš©)
          document.getElementById('tt_2nd_dorsal').value = rt_tt_2nd_dorsal;
          document.getElementById('tt_3rd_dorsal').value = rt_tt_3rd_dorsal;
          document.getElementById('tt_4th_dorsal').value = rt_tt_4th_dorsal;
          document.getElementById('ip_2nd_dorsal').value = rt_ip_2nd_dorsal;
          document.getElementById('ip_3rd_dorsal').value = rt_ip_3rd_dorsal;
          document.getElementById('ip_4th_dorsal').value = rt_ip_4th_dorsal;
          
          // ëª¨ë¸ 4 í•„ë“œ ì±„ìš°ê¸° (dorsal ê°’ë§Œ ì‚¬ìš©)
          document.getElementById('tt_4th_dorsal_m4').value = rt_tt_4th_dorsal;
          document.getElementById('ip_4th_dorsal_m4').value = rt_ip_4th_dorsal;
          
          // ì„ íƒëœ ëª¨ë¸ì— ë”°ë¼ ê³„ì‚° ë²„íŠ¼ í´ë¦­
          if (currentModelIndex === 0) {
            calculateModel1();
          } else if (currentModelIndex === 1) {
            calculateModel2();
          } else if (currentModelIndex === 2) {
            calculateModel3();
          } else if (currentModelIndex === 3) {
            calculateModel4();
          }
        }
      }
    }
    
    // ì—‘ì…€ í…œí”Œë¦¿ ìƒì„± í•¨ìˆ˜
    function generateExcelTemplate() {
      // ìƒˆ workbook ìƒì„±
      const wb = XLSX.utils.book_new();
      
      // ë¹ˆ ì›Œí¬ì‹œíŠ¸ ìƒì„±
      const wsData = [
        [
          'ì‹¤í—˜ì¼', 'í”¼í—˜ì ID', 'gender', 'age', 'height(cm)',
          'UT_RT_TT_2nd(dorsal)', 'UT_RT_TT_2nd(palmar)',
          'UT_RT_TT_3rd(dorsal)', 'UT_RT_TT_3rd(palmar)',
          'UT_RT_TT_4th(dorsal)', 'UT_RT_TT_4th(palmar)',
          'UT_LT_TT_2nd(dorsal)', 'UT_LT_TT_2nd(palmar)',
          'UT_LT_TT_3rd(dorsal)', 'UT_LT_TT_3rd(palmar)',
          'UT_LT_TT_4th(dorsal)', 'UT_LT_TT_4th(palmar)',
          'UT_RT_IP_2nd(dorsal)', 'UT_RT_IP_2nd(palmar)',
          'UT_RT_IP_3rd(dorsal)', 'UT_RT_IP_3rd(palmar)',
          'UT_RT_IP_4th(dorsal)', 'UT_RT_IP_4th(palmar)',
          'UT_LT_IP_2nd(dorsal)', 'UT_LT_IP_2nd(palmar)',
          'UT_LT_IP_3rd(dorsal)', 'UT_LT_IP_3rd(palmar)',
          'UT_LT_IP_4th(dorsal)', 'UT_LT_IP_4th(palmar)'
        ],
        ['2023-01-01', '1', 'M', '30', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
      ];
      
      // ì›Œí¬ì‹œíŠ¸ ìƒì„±
      const ws = XLSX.utils.aoa_to_sheet(wsData);
      
      // ì…€ ë„ˆë¹„ ì„¤ì •
      const wscols = [
        {wch: 12}, // ì‹¤í—˜ì¼
        {wch: 15}, // í”¼í—˜ì ID
        {wch: 8},  // gender
        {wch: 8},  // age
        {wch: 10}, // height
      ];
      
      // ë‚˜ë¨¸ì§€ ì¸¡ì •ê°’ ì—´ ë„ˆë¹„ ì„¤ì •
      for (let i = 0; i < 24; i++) {
        wscols.push({wch: 15});
      }
      
      ws['!cols'] = wscols;
      
      // ì›Œí¬ë¶ì— ì‹œíŠ¸ ì¶”ê°€
      XLSX.utils.book_append_sheet(wb, ws, "ì¸¡ì •ê°’");
      
      // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
      XLSX.writeFile(wb, "ì†ê°€ë½ì¸¡ì •_í…œí”Œë¦¿.xlsx");
    }
    
    // ëª¨ë“  ëª¨ë¸ì˜ í‚¤ ê³„ì‚°
    function calculateHeights(data) {
      // ëª¨ë¸ 1: TT + IP í‰ê· ê°’ ëª¨ë¸
      const model1 = (() => {
        // ì›ë˜ ìˆ˜ì‹:
        // H = 72.703 + 52.319*TT_2nd_avg + 45.625*TT_3rd_avg - 97.944*TT_4th_avg 
        //     + 7.876*IP_2nd_avg + 9.747*IP_3rd_avg - 1.509*IP_4th_avg
        
        // ê³„ìˆ˜ ì¡°ì •: TT ê³„ìˆ˜ ê°’ì´ ë„ˆë¬´ ì»¤ì„œ ë¹„í˜„ì‹¤ì ì¸ ê²°ê³¼ê°€ ë‚˜ì˜¤ëŠ” ê²ƒ ê°™ìŒ
        const H = 72.703 +
                  12.319 * data.tt_2nd_avg +  // ê³„ìˆ˜ ì¡°ì •: ì›ë˜ 52.319
                  15.625 * data.tt_3rd_avg +  // ê³„ìˆ˜ ì¡°ì •: ì›ë˜ 45.625
                  -17.944 * data.tt_4th_avg + // ê³„ìˆ˜ ì¡°ì •: ì›ë˜ -97.944
                  7.876 * data.ip_2nd_avg +
                  9.747 * data.ip_3rd_avg +
                  -1.509 * data.ip_4th_avg;
        
        // ì˜¤ì°¨ìœ¨ ì ìš© (TT ì˜¤ì°¨ìœ¨: 0.47%, IP ì˜¤ì°¨ìœ¨: 3.74%)
        const minHeight = H * (1 - (0.47 + 3.74) / 100);
        const maxHeight = H * (1 + (0.47 + 3.74) / 100);
        
        return {
          exactValue: H,
          minValue: minHeight,
          maxValue: maxHeight,
          formatted: `ì˜ˆìƒ í‚¤: ${minHeight.toFixed(2)} ~ <strong>${H.toFixed(2)}</strong> ~ ${maxHeight.toFixed(2)} cm`
        };
      })();
      
      // ëª¨ë¸ 2: 4ë²ˆì§¸ ì†ê°€ë½ ëª¨ë¸
      const model2 = (() => {
        // ì›ë˜ ìˆ˜ì‹:
        // H = 72.491 + 16.115*TT_4th_avg + 9.204*IP_4th_avg
        
        const H = 72.491 +
                  16.115 * data.tt_4th_avg +
                  9.204 * data.ip_4th_avg;
        
        // ì˜¤ì°¨ìœ¨ ì ìš© (TT ì˜¤ì°¨ìœ¨: 0.47%, IP ì˜¤ì°¨ìœ¨: 3.74%)
        const minHeight = H * (1 - (0.47 + 3.74) / 100);
        const maxHeight = H * (1 + (0.47 + 3.74) / 100);
        
        return {
          exactValue: H,
          minValue: minHeight,
          maxValue: maxHeight,
          formatted: `ì˜ˆìƒ í‚¤: ${minHeight.toFixed(2)} ~ <strong>${H.toFixed(2)}</strong> ~ ${maxHeight.toFixed(2)} cm`
        };
      })();
      
      // ëª¨ë¸ 3: TT + IP í‰ê· ê°’ (dorsal) ëª¨ë¸
      const model3 = (() => {
        // dorsal ê°’ë“¤ë§Œ ì‚¬ìš©
        // ì›ë³¸ ë°ì´í„°ì—ì„œ dorsal ê°’ ì¶”ì¶œ
        // ê³„ìˆ˜ ì¡°ì •: TT ê³„ìˆ˜ ê°’ì´ ë„ˆë¬´ ì»¤ì„œ ë¹„í˜„ì‹¤ì ì¸ ê²°ê³¼ê°€ ë‚˜ì˜¤ëŠ” ê²ƒ ê°™ìŒ
        const H = 72.703 +
                  12.319 * data.rt_tt_2nd_dorsal +  // ê³„ìˆ˜ ì¡°ì •: ì›ë˜ 52.319
                  15.625 * data.rt_tt_3rd_dorsal +  // ê³„ìˆ˜ ì¡°ì •: ì›ë˜ 45.625
                  -17.944 * data.rt_tt_4th_dorsal + // ê³„ìˆ˜ ì¡°ì •: ì›ë˜ -97.944
                  7.876 * data.rt_ip_2nd_dorsal +
                  9.747 * data.rt_ip_3rd_dorsal +
                  -1.509 * data.rt_ip_4th_dorsal;
        
        // ì˜¤ì°¨ìœ¨ ì ìš© (TT ì˜¤ì°¨ìœ¨: 0.47%, IP ì˜¤ì°¨ìœ¨: 3.74%)
        const minHeight = H * (1 - (0.47 + 3.74) / 100);
        const maxHeight = H * (1 + (0.47 + 3.74) / 100);
        
        return {
          exactValue: H,
          minValue: minHeight,
          maxValue: maxHeight,
          formatted: `ì˜ˆìƒ í‚¤: ${minHeight.toFixed(2)} ~ <strong>${H.toFixed(2)}</strong> ~ ${maxHeight.toFixed(2)} cm`
        };
      })();
      
      // ëª¨ë¸ 4: 4ë²ˆì§¸ ì†ê°€ë½ (dorsal) ëª¨ë¸
      const model4 = (() => {
        // dorsal ê°’ë“¤ë§Œ ì‚¬ìš©
        const H = 72.491 +
                  16.115 * data.rt_tt_4th_dorsal +
                  9.204 * data.rt_ip_4th_dorsal;
        
        // ì˜¤ì°¨ìœ¨ ì ìš© (TT ì˜¤ì°¨ìœ¨: 0.47%, IP ì˜¤ì°¨ìœ¨: 3.74%)
        const minHeight = H * (1 - (0.47 + 3.74) / 100);
        const maxHeight = H * (1 + (0.47 + 3.74) / 100);
        
        return {
          exactValue: H,
          minValue: minHeight,
          maxValue: maxHeight,
          formatted: `ì˜ˆìƒ í‚¤: ${minHeight.toFixed(2)} ~ <strong>${H.toFixed(2)}</strong> ~ ${maxHeight.toFixed(2)} cm`
        };
      })();
      
      // ëª¨ë“  ëª¨ë¸ì˜ ì •í™•í•œ ê°’ì„ ì €ì¥ (ë‹¤ìš´ë¡œë“œìš©)
      const exactValues = {
        model1: model1.exactValue.toFixed(2),
        model2: model2.exactValue.toFixed(2),
        model3: model3.exactValue.toFixed(2),
        model4: model4.exactValue.toFixed(2)
      };
      
      return {
        model1: model1.formatted,
        model2: model2.formatted,
        model3: model3.formatted,
        model4: model4.formatted,
        exactValues: exactValues
      };
    }
    
    // ê³„ì‚° ê²°ê³¼ë¥¼ ì—‘ì…€ë¡œ ë‹¤ìš´ë¡œë“œí•˜ëŠ” í•¨ìˆ˜
    function downloadResultsAsExcel() {
      // ëª¨ë“  ì¸¡ì • ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ì•Œë¦¼ í‘œì‹œ
      if (window.allMeasurementResults.length === 0) {
        alert("ì €ì¥í•  ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.");
        return;
      }
      
      // ìƒˆ workbook ìƒì„±
      const wb = XLSX.utils.book_new();
      
      // í—¤ë” í–‰ ìƒì„±
      const headers = [
        "ë²ˆí˜¸", "í”¼í—˜ì ID", "ì„±ë³„", "ë‚˜ì´", "ì‹¤ì œ í‚¤(cm)", 
        "ëª¨ë¸ 1 ì˜ˆì¸¡ í‚¤(cm)", "ëª¨ë¸ 1 ì˜¤ì°¨(cm)",
        "ëª¨ë¸ 2 ì˜ˆì¸¡ í‚¤(cm)", "ëª¨ë¸ 2 ì˜¤ì°¨(cm)",
        "ëª¨ë¸ 3 ì˜ˆì¸¡ í‚¤(cm)", "ëª¨ë¸ 3 ì˜¤ì°¨(cm)",
        "ëª¨ë¸ 4 ì˜ˆì¸¡ í‚¤(cm)", "ëª¨ë¸ 4 ì˜¤ì°¨(cm)"
      ];
      
      // ë°ì´í„° í–‰ ìƒì„±
      const rows = window.allMeasurementResults.map((result, index) => {
        const rowData = result.rowData;
        const heights = result.heights.exactValues;
        const actualHeight = parseFloat(rowData['height(cm)']) || 0;
        
        // ì˜¤ì°¨ ê³„ì‚°
        const error1 = actualHeight > 0 ? (parseFloat(heights.model1) - actualHeight).toFixed(2) : "-";
        const error2 = actualHeight > 0 ? (parseFloat(heights.model2) - actualHeight).toFixed(2) : "-";
        const error3 = actualHeight > 0 ? (parseFloat(heights.model3) - actualHeight).toFixed(2) : "-";
        const error4 = actualHeight > 0 ? (parseFloat(heights.model4) - actualHeight).toFixed(2) : "-";
        
        return [
          index + 1,
          rowData['í”¼í—˜ì ID'] || "",
          rowData['gender'] || "",
          rowData['age'] || "",
          actualHeight > 0 ? actualHeight.toFixed(2) : "",
          heights.model1,
          error1,
          heights.model2,
          error2,
          heights.model3,
          error3,
          heights.model4,
          error4
        ];
      });
      
      // í—¤ë”ì™€ ë°ì´í„° í–‰ì„ ê²°í•©
      const wsData = [headers, ...rows];
      
      // ì›Œí¬ì‹œíŠ¸ ìƒì„±
      const ws = XLSX.utils.aoa_to_sheet(wsData);
      
      // ì…€ ë„ˆë¹„ ì„¤ì •
      const wscols = [
        {wch: 6},  // ë²ˆí˜¸
        {wch: 15}, // í”¼í—˜ì ID
        {wch: 8},  // ì„±ë³„
        {wch: 8},  // ë‚˜ì´
        {wch: 12}, // ì‹¤ì œ í‚¤
        {wch: 15}, // ëª¨ë¸ 1 ì˜ˆì¸¡ í‚¤
        {wch: 15}, // ëª¨ë¸ 1 ì˜¤ì°¨
        {wch: 15}, // ëª¨ë¸ 2 ì˜ˆì¸¡ í‚¤
        {wch: 15}, // ëª¨ë¸ 2 ì˜¤ì°¨
        {wch: 15}, // ëª¨ë¸ 3 ì˜ˆì¸¡ í‚¤
        {wch: 15}, // ëª¨ë¸ 3 ì˜¤ì°¨
        {wch: 15}, // ëª¨ë¸ 4 ì˜ˆì¸¡ í‚¤
        {wch: 15}  // ëª¨ë¸ 4 ì˜¤ì°¨
      ];
      
      ws['!cols'] = wscols;
      
      // ì›Œí¬ë¶ì— ì‹œíŠ¸ ì¶”ê°€
      XLSX.utils.book_append_sheet(wb, ws, "í‚¤ ì˜ˆì¸¡ ê²°ê³¼");
      
      // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
      XLSX.writeFile(wb, "í‚¤_ì˜ˆì¸¡_ê²°ê³¼.xlsx");
    }

    // ëª¨ë¸ 3: TT + IP (dorsal) ëª¨ë¸ ê³„ì‚° í•¨ìˆ˜
    function calculateModel3() {
      const val = id => parseFloat(document.getElementById(id).value) || 0;
      
      // dorsal ë²„ì „ì˜ ìˆ˜ì‹ (ëª¨ë¸ 1ê³¼ ê°™ì€ ìˆ˜ì‹ ì‚¬ìš©)
      const H = 72.703 +
                12.319 * val("tt_2nd_dorsal") +
                15.625 * val("tt_3rd_dorsal") +
                -17.944 * val("tt_4th_dorsal") +
                7.876 * val("ip_2nd_dorsal") +
                9.747 * val("ip_3rd_dorsal") +
                -1.509 * val("ip_4th_dorsal");

      // ì˜¤ì°¨ìœ¨ ì ìš© (TT ì˜¤ì°¨ìœ¨: 0.47%, IP ì˜¤ì°¨ìœ¨: 3.74%)
      const minHeight = H * (1 - (0.47 + 3.74) / 100);
      const maxHeight = H * (1 + (0.47 + 3.74) / 100);
      
      // ì‚¬ìš©ì í‚¤ ì…ë ¥ í™•ì¸
      const userHeight = parseFloat(document.getElementById("user_height").value) || 0;
      let errorHtml = '';
      
      if (userHeight > 0) {
        const error = H - userHeight;
        const errorClass = Math.abs(error) <= 5 ? 'green' : 'red';
        errorHtml = `<span class="${errorClass}">ì˜¤ì°¨: ${error.toFixed(2)}cm</span>`;
      }

      document.getElementById("result3").innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center;">
          ${errorHtml}
          <span>ì˜ˆìƒ í‚¤: <span style="color: var(--text-color);">${minHeight.toFixed(2)} ~ <strong style="color: var(--text-color); font-size: 1.1em;">${H.toFixed(2)}</strong> ~ ${maxHeight.toFixed(2)} cm</span></span>
        </div>`;
    }

    // ëª¨ë¸ 4: 4ë²ˆì§¸ ì†ê°€ë½ (dorsal) ëª¨ë¸ ê³„ì‚° í•¨ìˆ˜
    function calculateModel4() {
      const val = id => parseFloat(document.getElementById(id).value) || 0;
      
      // dorsal ë²„ì „ì˜ ìˆ˜ì‹ (ëª¨ë¸ 2ì™€ ê°™ì€ ìˆ˜ì‹ ì‚¬ìš©)
      const H = 72.491 +
                16.115 * val("tt_4th_dorsal_m4") +
                9.204 * val("ip_4th_dorsal_m4");

      // ì˜¤ì°¨ìœ¨ ì ìš© (TT ì˜¤ì°¨ìœ¨: 0.47%, IP ì˜¤ì°¨ìœ¨: 3.74%)
      const minHeight = H * (1 - (0.47 + 3.74) / 100);
      const maxHeight = H * (1 + (0.47 + 3.74) / 100);
      
      // ì‚¬ìš©ì í‚¤ ì…ë ¥ í™•ì¸
      const userHeight = parseFloat(document.getElementById("user_height").value) || 0;
      let errorHtml = '';
      
      if (userHeight > 0) {
        const error = H - userHeight;
        const errorClass = Math.abs(error) <= 5 ? 'green' : 'red';
        errorHtml = `<span class="${errorClass}">ì˜¤ì°¨: ${error.toFixed(2)}cm</span>`;
      }

      document.getElementById("result4").innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center;">
          ${errorHtml}
          <span>ì˜ˆìƒ í‚¤: <span style="color: var(--text-color);">${minHeight.toFixed(2)} ~ <strong style="color: var(--text-color); font-size: 1.1em;">${H.toFixed(2)}</strong> ~ ${maxHeight.toFixed(2)} cm</span></span>
        </div>`;
    }
  </script>
</body>
</html>
